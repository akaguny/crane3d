var b4w="object"===typeof b4w?b4w:function(a){var r={};a.module=r;var u={};a.register=function(a,b){r[a]||(r[a]=b)};a.require=function(a,b){if(!r[a])throw Error('Module "'+a+'" not found');b=b||"__b4w_default";u[b]||(u[b]=function(a){return function(b){var f=r[b];if(!f)throw Error('Module "'+b+'" not found');f._compiled||(f._compiled={});f._compiled[a]||(f._compiled[a]={},f(f._compiled[a],u[a]));return f._compiled[a]}}(b));return u[b](a)};a.module_check=function(a){return r[a]?!0:!1};a.get_namespace=
function(a){for(var b in u)if(u[b]==a)return b;return""};a.worker_listeners=[];a.worker_namespaces=[];return a}({});"object"==typeof module&&module.exports&&(GLOBAL.b4w={module:{}});
b4w.module.__version=function(a,r){function u(){var a=h,b=a.getDate(),b=10>b?"0"+String(b):String(b),f=a.getMonth()+1,f=10>f?"0"+String(f):String(f),n=String(a.getFullYear()),q=a.getHours(),q=10>q?"0"+String(q):String(q),d=a.getMinutes(),d=10>d?"0"+String(d):String(d),a=a.getSeconds(),a=10>a?"0"+String(a):String(a);return b+"."+f+"."+n+" "+q+":"+d+":"+a}var h=new Date(2015,8,30,10,21,3),b=[15,9];a.version=function(){return b};a.version_str=function(){for(var a="",c=0;c<b.length;c++)a=1==c?a+(10>b[c]?
"0"+b[c]:b[c]):a+b[c],c!=b.length-1&&(a+=".");return a};a.type=function(){return"RELEASE"};a.date=function(){return h};a.date_str=u;a.timestamp=function(){var a=u(),a=a.split(" ").join("").split(":").join("").split(".").join("");return"?t="+a}};"object"==typeof module&&module.exports&&b4w.module.__version(exports);b4w.module.__config=function(a,r){function u(){return b4w.module_check(a.paths.built_in_data_module)}function h(){for(var c=a.paths,f=null,l=document.getElementsByTagName("script"),h=0;h<l.length;h++){for(var d=l[h].src,k=0;k<c.js_src_search_paths.length;k++)if(0<=d.indexOf(c.js_src_search_paths[k])){f=d;break}if(null!==f)break}f||(b.warn("Couldn't determine path to ancillary resources, fallback to the current page directory"),f=document.location.href);c=f.indexOf("?");0<=c&&(f=f.substring(0,c));
return f.substring(0,f.lastIndexOf("/")+1)}var b=r("__print"),l=r("__util");a.P_LOW=1;a.P_HIGH=2;a.P_ULTRA=3;a.P_CUSTOM=4;a.context={alpha:!0,antialias:!1,premultipliedAlpha:!0};a.context_save=l.clone_object_r(a.context);a.defaults={alpha_sort:!0,alpha_sort_threshold:.1,alpha_clip_filtering_hack:!1,min_format_version:[5,6],max_fps:1E4,console_verbose:!1,do_not_load_resources:!1,use_min50:!1,fps_measurement_interval:1.5,fps_callback_interval:10,background_color:[0,0,0,0],lod_transition_ratio:.01,render_resolution_factor:1,
canvas_resolution_factor:1,texture_min_filter:3,allow_cors:!1,force_low_quality_nodes:!1,anisotropic_filtering:!0,show_hud_debug_info:!1,depth_textures:!0,shadows:!0,anaglyph_use:!1,reflections:!0,refractions:!0,ssao:!0,dof:!0,god_rays:!0,bloom:!0,motion_blur:!0,compositing:!0,antialiasing:!0,smaa:!1,wireframe_debug:!1,water_wireframe_debug:!1,foam:!0,parallax:!0,dynamic_grass:!0,procedural_fog:!0,water_dynamic:!0,shore_smoothing:!0,shore_distance:!0,max_texture_size:1024,max_cube_map_size:512,use_dds:!0,
precision:"highp",quality:a.P_HIGH,allow_vertex_textures:!0,no_phy_interp_hack:!1,shader_constants_hack:!1,disable_blend_shadows_hack:!1,vert_anim_mix_normals_hack:!1,is_mobile_device:!1,disable_doppler_hack:!1,cors_chrome_hack:!1,init_wa_context_hack:!1,clear_procedural_sky_hack:!1,sky_update_hack:!1,seq_video_fallback:!1,allow_hidpi:!1,gyro_use:!1,firefox_shadows_slink_hack:!1,mobile_firefox_media_hack:!1,enable_selectable:!0,enable_outlining:!0,glow_materials:!0,max_vertex_uniform_vectors:128,
ie11_edge_touchscreen_hack:!1,ios_depth_hack:!1,macos_tex_reuse_hack:!1,loaded_data_version:[0,0],edge_min_tex_size_hack:!1,quality_aa:!0};a.defaults_save=l.clone_object_r(a.defaults);a.animation={framerate:-1,frames_blending_hack:!1,frame_steps:1};a.controls={mouse_wheel_notch_multiplier:1/120};a.assets={dir:"ASSETS=../../assets/",max_requests:15,prevent_caching:!0,min50_available:!1,dds_available:!1};a.assets_save=l.clone_object_r(a.assets);a.paths={shaders_dir:"",shaders_include_dir:"include/",
shaders_postp_dir:"postprocessing/",built_in_data_module:"built_in_data",js_src_search_paths:"b4w.min.js b4w.full.min.js b4w.simple.min.js b4w.whitespace.min.js src/b4w.js USER_DEFINED_MODULE".split(" "),resources_dir:"./",smaa_search_texture_path:"",smaa_area_texture_path:""};a.physics={enabled:!0,max_fps:60,uranium_path:"",calc_fps:!1,ping:!1,use_workers:!0};a.physics_save=l.clone_object_r(a.physics);a.scenes={grass_tex_size:1024,cubemap_tex_size:384,cube_reflect_low:32,cube_reflect_medium:128,
cube_reflect_high:256,plane_reflect_low:.25,plane_reflect_medium:.5,plane_reflect_high:1};a.scenes_save=l.clone_object_r(a.scenes);a.sfx={webaudio:!0,mix_mode:!1,audio_loading_hack:!1,clamp_playback_rate_hack:!1,disable_playback_rate_hack:!1};a.sfx_save=l.clone_object_r(a.sfx);a.outlining={outlining_overview_mode:!1,outline_color:[1,.4,.05],outline_duration:.2,outline_period:3.8,outline_relapses:1};a.debug_subs={enabled:!1,subs_type:"MAIN_OPAQUE",subs_number:0,slink_type:"DEPTH"};a.debug_subs_save=
l.clone_object_r(a.debug_subs);a.apply_quality=function(){var b=a.defaults,f=a.physics,l=a.scenes;switch(b.quality){case a.P_ULTRA:b.shadows=!0;b.shore_smoothing=!0;b.ssao=!0;b.dof=!0;b.god_rays=!0;b.bloom=!0;b.reflections=!0;b.refractions=!0;b.foam=!0;b.parallax=!0;b.dynamic_grass=!0;b.procedural_fog=!0;b.render_resolution_factor=1.75;l.grass_tex_size=2048;b.texture_min_filter=3;b.anisotropic_filtering=!0;b.use_min50=!1;b.precision="highp";b.water_dynamic=!0;b.shore_distance=!0;b.antialiasing=!0;
b.smaa=!0;b.compositing=!0;b.motion_blur=!0;b.allow_hidpi=!0;b.enable_outlining=!0;b.glow_materials=!0;f.max_fps=120;break;case a.P_HIGH:b.shadows=!0;b.shore_smoothing=!0;b.ssao=!0;b.dof=!0;b.god_rays=!0;b.bloom=!0;b.reflections=!0;b.refractions=!0;b.foam=!0;b.parallax=!0;b.dynamic_grass=!0;b.procedural_fog=!0;b.render_resolution_factor=1;l.grass_tex_size=1024;b.texture_min_filter=3;b.anisotropic_filtering=!0;b.use_min50=!1;b.precision="highp";b.water_dynamic=!0;b.shore_distance=!0;b.antialiasing=
!0;b.smaa=!1;b.compositing=!0;b.motion_blur=!0;b.allow_hidpi=!1;b.enable_outlining=!0;b.glow_materials=!0;f.max_fps=60;break;case a.P_LOW:b.shadows=!1,b.shore_smoothing=!1,b.ssao=!1,b.dof=!1,b.god_rays=!1,b.bloom=!1,b.reflections=!1,b.refractions=!1,b.foam=!1,b.parallax=!1,b.dynamic_grass=!1,b.procedural_fog=!1,b.render_resolution_factor=1,l.grass_tex_size=512,b.texture_min_filter=2,b.anisotropic_filtering=!1,b.use_min50=!0,b.precision="mediump",b.water_dynamic=!1,b.shore_distance=!1,b.antialiasing=
!1,b.smaa=!1,b.compositing=!1,b.motion_blur=!1,b.allow_hidpi=!1,b.enable_outlining=!1,b.glow_materials=!1,f.max_fps=60}};a.set=function(c,f){switch(c){case "allow_cors":a.defaults.allow_cors=f;break;case "allow_hidpi":a.defaults.allow_hidpi=f;break;case "alpha":a.context.alpha=f;break;case "alpha_sort":a.defaults.alpha_sort=f;break;case "alpha_sort_threshold":a.defaults.alpha_sort_threshold=f;break;case "anaglyph_use":a.defaults.anaglyph_use=f;break;case "animation_framerate":a.animation.framerate=
f;break;case "antialiasing":a.defaults.antialiasing=f;break;case "assets_dds_available":a.assets.dds_available=f;break;case "assets_min50_available":a.assets.min50_available=f;break;case "audio":a.sfx.webaudio=f;break;case "background_color":a.defaults.background_color=f;break;case "built_in_module_name":a.paths.built_in_data_module=f;break;case "canvas_resolution_factor":a.defaults.canvas_resolution_factor=f;break;case "console_verbose":a.defaults.console_verbose=f;break;case "do_not_load_resources":a.defaults.do_not_load_resources=
f;break;case "gyro_use":a.defaults.gyro_use=f;break;case "physics_enabled":a.physics.enabled=f;break;case "physics_uranium_path":a.physics.uranium_path=f;break;case "physics_calc_fps":a.physics.calc_fps=f;break;case "physics_use_workers":a.physics.use_workers=f;break;case "precision":a.defaults.precision=f;break;case "quality":a.defaults.quality=f;break;case "render_resolution_factor":a.defaults.render_resolution_factor=f;break;case "sfx_mix_mode":a.sfx.mix_mode=f;break;case "shaders_dir":a.paths.shaders_dir=
f;break;case "show_hud_debug_info":a.defaults.show_hud_debug_info=f;break;case "smaa":a.defaults.smaa=f;break;case "smaa_search_texture_path":a.paths.smaa_search_texture_path=f;break;case "smaa_area_texture_path":a.paths.smaa_area_texture_path=f;break;case "wireframe_debug":a.defaults.wireframe_debug=f;break;case "enable_selectable":a.defaults.enable_selectable=f;break;case "enable_outlining":a.defaults.enable_outlining=f;break;case "outlining_overview_mode":a.outlining.outlining_overview_mode=f;
break;case "glow_materials":a.defaults.glow_materials=f;break;default:b.error("Unknown config property: "+c)}};a.get=function(c){switch(c){case "allow_cors":return a.defaults.allow_cors;case "allow_hidpi":return a.defaults.allow_hidpi;case "alpha":return a.context.alpha;case "alpha_sort":return a.defaults.alpha_sort;case "alpha_sort_threshold":return a.defaults.alpha_sort_threshold;case "anaglyph_use":return a.defaults.anaglyph_use;case "animation_framerate":return a.animation.framerate;case "antialiasing":return a.defaults.antialiasing;
case "assets_dds_available":return a.assets.dds_available;case "assets_min50_available":return a.assets.min50_available;case "audio":return a.sfx.webaudio;case "background_color":return a.defaults.background_color;case "built_in_module_name":return a.paths.built_in_data_module;case "canvas_resolution_factor":return a.defaults.canvas_resolution_factor;case "console_verbose":return a.defaults.console_verbose;case "do_not_load_resources":return a.defaults.do_not_load_resources;case "gyro_use":return a.defaults.gyro_use;
case "physics_enabled":return a.physics.enabled;case "physics_uranium_path":return a.physics.uranium_path;case "physics_calc_fps":return a.physics.calc_fps;case "physics_use_workers":return a.physics.use_workers;case "precision":return a.defaults.precision;case "quality":return a.defaults.quality;case "render_resolution_factor":return a.defaults.render_resolution_factor;case "sfx_mix_mode":return a.sfx.mix_mode;case "shaders_dir":return a.paths.shaders_dir;case "show_hud_debug_info":return a.defaults.show_hud_debug_info;
case "smaa":return a.defaults.smaa;case "smaa_search_texture_path":return a.paths.smaa_search_texture_path;case "smaa_area_texture_path":return a.paths.smaa_area_texture_path;case "wireframe_debug":return a.defaults.wireframe_debug;case "enable_selectable":return a.defaults.enable_selectable;case "enable_outlining":return a.defaults.enable_outlining;case "outlining_overview_mode":return a.outlining.outlining_overview_mode;case "glow_materials":return a.defaults.glow_materials;default:b.error("Unknown config property: "+
c)}};a.reset=function(){a.context=l.clone_object_r(a.context_save);a.defaults=l.clone_object_r(a.defaults_save);a.assets=l.clone_object_r(a.assets_save);a.physics=l.clone_object_r(a.physics_save);a.scenes=l.clone_object_r(a.scenes_save);a.sfx=l.clone_object_r(a.sfx_save);a.debug_subs=l.clone_object_r(a.debug_subs_save)};a.is_built_in_data=u;a.set_paths=function(){var b=a.paths,f=a.physics;u()||""!=b.shaders_dir||(b.shaders_dir=h()+"../shaders/");if(u())b.smaa_search_texture_path="smaa_search_texture.png",
b.smaa_area_texture_path="smaa_area_texture.png";else if(""==b.smaa_search_texture_path||""==b.smaa_area_texture_path){var l=h()+b.resources_dir;b.smaa_search_texture_path=b.smaa_search_texture_path||l+"smaa_search_texture.png";b.smaa_area_texture_path=b.smaa_area_texture_path||l+"smaa_area_texture.png"}f.enabled&&""==f.uranium_path&&(l=h()+b.resources_dir,f.uranium_path=l+"uranium.js")};a.get_std_assets_path=function(){return a.assets.dir.replace("ASSETS=","")}};b4w.module.__anchors=function(a,r){function u(a,e){var v=document.createElement("div"),c=v.style;c.position="absolute";c.backgroundColor="black";c.borderRadius="20px 20px 20px 0px";c.boxShadow="0px 0px 10px rgb(180, 180, 200)";c.opacity=1;c.padding="8px 12px";c.lineHeight="15px";c.visibility="hidden";c.fontSize="12px";var m=d.get_container();m.appendChild(v);var p=k.get_meta_tags(a),F=p.title||a.name,t=document.createElement("span"),x=t.style;t.innerHTML=F;x.fontWeight="bold";x.fontSize="12px";x.lineHeight=
"15px";x.color="#fff";x.fontFamily="Arial";l(t);v.appendChild(t);var f=p.description;if(f){var p=document.createElement("div"),A=p.style;A.position="absolute";A.bottom="0px";A.left="0px";A.backgroundColor="#000";A.borderRadius="20px 20px 20px 0px";A.boxShadow="0px 0px 10px rgb(180, 180, 200)";A.visibility="hidden";A.padding="8px 12px";A.overflow="hidden";A.lineHeight="15px";A.fontSize="12px";A.zIndex="2";v.appendChild(p);var F=document.createElement("span"),P=F.style;F.innerHTML=f;P.fontSize="12px";
P.fontFamily="Arial";P.fontWeight="bold";P.lineHeight="15px";P.color="#fff";P.visibility="hidden";p.appendChild(F);var B=!1,n=!1;m.addEventListener("click",function(a){if(!(B||n||G))if(a.target!=t&&a.target!=v||"hidden"!=A.visibility||1!=c.opacity)"visible"==A.visibility&&(c.visibility="visible",x.visibility="visible",A.visibility="hidden",P.visibility="hidden");else{c.visibility="hidden";x.visibility="hidden";A.visibility="visible";B=n=!0;a=v.offsetWidth-24;var g=v.offsetHeight-16,m=Math.min(e,h(f,
"12px")),F=b(f,"12px",m);F==g&&(A.height=F+"px");m!=a?N.animate(a,m,200,function(a){a==m&&("visible"==A.visibility&&(P.visibility="visible"),B=!1);A.width=a+"px"}):B=!1;F!=g?N.animate(g,F,200,function(a){a==F&&("visible"==A.visibility&&(P.visibility="visible"),n=!1);A.height=a+"px"}):n=!1;n||B||(P.visibility="visible")}},!1)}return v}function h(a,b,e){e=document.createElement("div");var c=document.createElement("span"),m=e.style;c.innerHTML=a;c.style.fontSize=b;c.style.fontFamily="Arial";c.style.fontWeight=
"bold";c.style.color="#fff";c.style.visibility="hidden";m.lineHeight="15px";e.appendChild(c);m.position="absolute";m.visibility="hidden";m.fontSize=b;m.display="inline-block";m.lineHeight="15px";document.body.appendChild(e);a=e.offsetWidth+1;document.body.removeChild(e);return a}function b(a,b,e){var c=document.createElement("div"),m=document.createElement("span"),d=c.style;m.innerHTML=a;m.style.fontSize=b;m.style.fontFamily="Arial";m.style.fontWeight="bold";m.style.color="#fff";m.style.visibility=
"hidden";d.lineHeight="15px";c.appendChild(m);d.position="absolute";d.visibility="hidden";d.fontSize=b;d.display="inline-block";d.width=e+"px";d.lineHeight="15px";document.body.appendChild(c);a=c.offsetHeight;document.body.removeChild(c);return a}function l(a){a.style["-webkit-touch-callout"]="none";a.style["-webkit-user-select"]="none";a.style["-khtml-user-select"]="none";a.style["-moz-user-select"]="none";a.style["-ms-user-select"]="none";a.style["user-select"]="none";a.style.cursor="default"}function c(){for(var a=
0,b=0;b<w.length;b++)w[b].detect_visibility&&a++;t=new Float32Array(3*a)}function f(a,b){return b.depth-a.depth}var n=r("__batch"),q=r("__camera"),d=r("__container"),k=r("__objects"),e=r("__print"),m=r("__renderer"),B=r("__scenes"),N=r("__time");r("__util");r("__config");var G=!1,w=[],t=new Float32Array(0),C=new Uint8Array(16),D=new Float32Array(2),p=new Float32Array(3);a.append=function(a){var b;a:{for(b=0;b<w.length;b++)if(w[b].obj==a){b=!0;break a}b=!1}if(!b){b=a.anchor.detect_visibility&&Boolean(B.get_subs(B.get_main(),
"ANCHOR_VISIBILITY"));b={type:a.anchor.type,obj:a,x:0,y:0,depth:0,appearance:"out",detect_visibility:b,element:null,move_cb:null,annotation_max_width:a.anchor.max_width,annotation_height:0,element_id:a.anchor.element_id};switch(b.type){case "ANNOTATION":b.element=u(a,b.annotation_max_width);b.annotation_height=b.element.offsetHeight;break;case "ELEMENT":b.element=document.getElementById(a.anchor.element_id),b.element||(e.warn("Anchor HTML element was not found, making it generic"),b.type="GENERIC")}w.push(b);
c()}};a.remove=function(a){for(var b=0;b<w.length;b++){var e=w[b];if(e.obj==a){"ANNOTATION"==e.type&&(a=e,d.get_container().removeChild(a.element));w.splice(b,1);c();break}}};a.update=function(){for(var a=0,b=w.length;b--;){var e=w[b];e.detect_visibility&&(t.set(e.obj.render.trans,3*a),a++);var c,m=e,d=p;c=B.get_camera(B.get_main());c=d=q.project_point(c,m.obj.render.trans,d);m=c[0];d=c[1];c=c[2];if(m!=e.x||d!=e.y||c!=e.depth){switch(e.type){case "ANNOTATION":var F=e.element;F.style.left=Math.floor(m)+
"px";F.style.top=Math.floor(d-e.annotation_height)+"px";break;case "ELEMENT":var F=e.element,k=F.getBoundingClientRect();F.style.cssText+="left:"+Math.floor(m-k.width/2)+"px;top:"+Math.floor(d-k.height/2)+"px;"}e.x=m;e.y=d;e.depth=c;e.move_cb&&e.move_cb(m,d,e.appearance,e.obj,F)}}w.sort(f);for(b=0;b<w.length;b++)e=w[b],"GENERIC"!=e.type&&(e.element.style.zIndex=b);0<a&&(a=B.get_subs(B.get_main(),"ANCHOR_VISIBILITY").bundles[0].batch,n.update_anchor_visibility_batch(a,t))};a.update_visibility=function(){for(var a=
d.get_container(),b=w.length;b--;){var e=w[b],c=e.obj,p=e.x,k=e.y,F=e.depth,F=0>p||0>k||0>F||1<F||B.is_hidden(c)||p>=a.clientWidth||k>=a.clientHeight?"out":"visible";if(e.detect_visibility&&"out"!=F){var F=e,t=B.get_subs(B.get_main(),"ANCHOR_VISIBILITY").camera,x=d.canvas_to_viewport_coords(F.x,F.y,D,t);m.read_pixels(t.framebuffer,x[0],t.height-x[1],2,2,C);F=1020==C[0]+C[4]+C[8]+C[12]?"visible":"out"==F.appearance||0==C[0]+C[4]+C[8]+C[12]?"covered":F.appearance}if(F!=e.appearance){switch(e.type){case "ANNOTATION":case "ELEMENT":var f=
e.element;if(!f)break;"out"==F?(f.style.visibility="hidden",f.children.length&&(f.children[0].style.visibility="hidden"),"ANNOTATION"==e.type&&1<f.children.length&&(t=f.children[1],t.style.visibility="hidden",t.children.length&&(t.children[0].style.visibility="hidden"))):"visible"==F?(f.style.visibility="visible",f.children.length&&(f.children[0].style.visibility="visible"),f.style.opacity=1):(f.style.visibility="visible",f.style.opacity=.1,f.children.length&&(f.children[0].style.visibility="visible"),
"ANNOTATION"==e.type&&1<f.children.length&&(t=f.children[1],t.style.visibility="hidden",t.children.length&&(t.children[0].style.visibility="hidden")))}e.appearance=F;e.move_cb&&e.move_cb(p,k,e.appearance,c,f)}}};a.attach_move_cb=function(a,b){for(var e=0;e<w.length;e++)w[e].obj==a&&(w[e].move_cb=b)};a.detach_move_cb=function(a){for(var b=0;b<w.length;b++)w[b].obj==a&&(w[b].move_cb=null)};a.cleanup=function(){for(var a=0;a<w.length;a++){var b=w[a];"ANNOTATION"==b.type&&d.get_container().removeChild(b.element)}w.length=
0};a.is_anchor=function(a){for(var b=0;b<w.length;b++)if(w[b].obj==a)return!0;return!1};a.get_element_id=function(a){for(var b=0;b<w.length;b++)if(w[b].obj==a)return w[b].element_id;return!1};a.pause=function(){G=!0};a.resume=function(){G=!1}};b4w.module.__armature=function(a,r){function u(a){a=a.render;for(var b=a.skinned_renders,e=a.mesh_to_arm_bone_maps,c=0;c<b.length;c++){for(var m=b[c],d=e[c],k=0;k<d.length;k+=2)for(var p=d[k],g=d[k+1],f=0;4>f;f++)m.quats_before[p+f]=a.quats_before[g+f],m.quats_after[p+f]=a.quats_after[g+f],m.trans_before[p+f]=a.trans_before[g+f],m.trans_after[p+f]=a.trans_after[g+f];m.frame_factor=a.frame_factor}}function h(a,b,e,c){var m=a.tsr_bone_pose,k=a.tsr_local_rest,f=a.tsr_local_pose,p=a.parent_bone_ptr;p?
(p=p.tsr_local_pose,b?l.multiply(p,m,f):(b=d,l.invert(p,b),l.multiply(b,f,m))):b?l.copy(m,f):l.copy(f,m);m=q;l.invert(k,m);l.multiply(f,m,m);k=a.bone_index;e[4*k]=m[0];e[4*k+1]=m[1];e[4*k+2]=m[2];e[4*k+3]=m[3];c[4*k]=m[4];c[4*k+1]=m[5];c[4*k+2]=m[6];c[4*k+3]=m[7];a=a.descend_bones_ptrs;for(k=0;k<a.length;k++)f=a[k],f.constraint||h(f,!0,e,c)}var b=r("__util"),l=r("__tsr"),c=r("__quat"),f=r("__mat4"),n=r("__vec3"),q=new Float32Array(8),d=new Float32Array(8),k=new Float32Array(4),e=new Float32Array(4),
m=new Float32Array(4);a.update_object=function(a,e){for(var c=a.data.bones,m=a.pose.bones,d={},k=0;k<m.length;k++){var h=m[k],p=h.bone,g=p.name,y=g,g={bone_index:0,vgroup_index:-1,parent_bone_ptr:null,descend_bones_ptrs:[],chain:[],constraint:null,tsr_bone_rest:l.create(),tsr_bone_pose:l.create(),tsr_local_rest:l.create(),tsr_local_pose:l.create(),tsr_basis:l.create(),tsr_channel_cache:l.create(),tsr_channel_cache_valid:!1,tail:new Float32Array(3)},y=d[y]=g,g=new Float32Array(p.matrix_local),v=new Float32Array(16);
f.invert(g,v);var h=new Float32Array(h.matrix_basis),u=y.tail;n.subtract(p.tail_local,p.head_local,u);b.vecdir_multiply_matrix(u,v,u);l.from_mat4(g,y.tsr_local_rest);l.from_mat4(h,y.tsr_basis);l.copy(y.tsr_local_rest,y.tsr_local_pose)}for(k=0;k<c.length;k++){g=c[k].name;h=b.keysearch("name",g,m);y=d[g];p=h.parent_recursive;y.chain.push(y);for(h=0;h<p.length;h++)v=p[h],v=v.name,v=d[v],y.chain.push(v);p.length?(v=p[0],v=v.name,v=d[v],y.parent_bone_ptr=v,l.invert(v.tsr_local_rest,q),l.multiply(q,y.tsr_local_rest,
y.tsr_bone_rest),v.descend_bones_ptrs.push(y)):l.copy(y.tsr_local_rest,y.tsr_bone_rest);y.bone_index=k;y.name=g;l.multiply(y.tsr_bone_rest,y.tsr_basis,y.tsr_bone_pose)}e.render.bone_pointers=d};a.get_bone_tsr=function(a,b,f,h,t){var n=a.render,D=n.frame_factor;b=n.bone_pointers[b];var p=b.bone_index;a=b.tsr_local_rest;var g=n.trans_before,y=n.trans_after,v=n.quats_before,n=n.quats_after,u=g[4*p+1],z=g[4*p+2],H=g[4*p+3],F=y[4*p+1],L=y[4*p+2],x=y[4*p+3];k[0]=(1-D)*g[4*p]+D*y[4*p];k[1]=(1-D)*u+D*F;k[2]=
(1-D)*z+D*L;k[3]=(1-D)*H+D*x;e[0]=v[4*p];e[1]=v[4*p+1];e[2]=v[4*p+2];e[3]=v[4*p+3];m[0]=n[4*p];m[1]=n[4*p+1];m[2]=n[4*p+2];m[3]=n[4*p+3];c.slerp(e,m,D,e);D=q;l.set_transcale(k,D);l.set_quat(e,D);f?(f=d,l.translate(a,b.tail,f),l.multiply(D,f,D)):l.multiply(D,a,D);if(h){if(h=b.parent_bone_ptr)f=d,l.invert(h.tsr_local_pose,f),l.multiply(f,D,D);h=d;l.invert(b.tsr_bone_rest,h);l.multiply(h,D,D)}l.copy(D,t)};a.set_bone_tsr=function(a,b,e,c){var m=a.render;b=m.bone_pointers[b];var d=m.trans_before,k=m.quats_before;
c?l.multiply(b.tsr_bone_rest,e,b.tsr_bone_pose):l.copy(e,b.tsr_local_pose);h(b,c,d,k);m.frame_factor=0;u(a)};a.update_skinned_renders=u;a.update_bone_tsr_r=h;a.check_bone=function(a,b){return b in a.render.bone_pointers}};b4w.module.__boundings=function(a,r){function u(a,b){for(var c=a[0],d=a[1],k=a[2],f=a[0],t=a[1],l=a[2],h=3;h<a.length;h+=3)var p=a[h],g=a[h+1],n=a[h+2],c=Math.max(c,p),d=Math.max(d,g),k=Math.max(k,n),f=Math.min(f,p),t=Math.min(t,g),l=Math.min(l,n);b.max_x=c;b.max_y=d;b.max_z=k;b.min_x=f;b.min_y=t;b.min_z=l;return b}function h(a,b){b||(b=new Float32Array(24));var c=a.max_x,d=a.max_y,k=a.max_z,f=a.min_x,t=a.min_y,l=a.min_z;b[0]=f;b[1]=t;b[2]=l;b[3]=c;b[4]=t;b[5]=l;b[6]=c;b[7]=d;b[8]=l;b[9]=f;b[10]=
d;b[11]=l;b[12]=f;b[13]=t;b[14]=k;b[15]=c;b[16]=t;b[17]=k;b[18]=c;b[19]=d;b[20]=k;b[21]=f;b[22]=d;b[23]=k;return b}function b(a,b,c){f.add(b,c,a.center);f.scale(a.center,.5,a.center);a.radius=f.distance(a.center,b);return a}var l=r("__tsr"),c=r("__util"),f=r("__vec3"),n=new Float32Array(24),q=new Float32Array(3),d=new Float32Array(3),k=new Float32Array(3);a.copy_bb=function(a,b){b.min_x=a.min_x;b.max_x=a.max_x;b.min_y=a.min_y;b.max_y=a.max_y;b.min_z=a.min_z;b.max_z=a.max_z};a.big_bounding_box=function(){return{max_x:1E12,
min_x:-1E12,max_y:1E12,min_y:-1E12,max_z:1E12,min_z:-1E12}};a.zero_bounding_box=function(a){a||(a={});a.max_x=0;a.min_x=0;a.max_y=0;a.min_y=0;a.max_z=0;a.min_z=0;return a};a.expand_bounding_box=function(a,b){var c=a.max_y,d=a.max_z,k=a.min_x,f=a.min_y,t=a.min_z;a.max_x=Math.max(b.max_x,a.max_x);a.max_y=Math.max(b.max_y,c);a.max_z=Math.max(b.max_z,d);a.min_x=Math.min(b.min_x,k);a.min_y=Math.min(b.min_y,f);a.min_z=Math.min(b.min_z,t);return a};a.bb_from_coords=u;a.bounding_box_transform=function(b,
d,k){k||(k=a.zero_bounding_box());b=h(b,n);c.positions_multiply_matrix(b,d,b);return u(b,k)};a.extract_bb_corners=h;a.shrink_bounding_box=function(b,c,d){d||(d=a.zero_bounding_box());var k=c.min_x,f=c.max_x,l=c.min_y,t=c.max_y,h=c.min_z;c=c.max_z;if(k>=b.max_x||f<=b.min_x||l>=b.max_y||t<=b.min_y||h>=b.max_z||c<=b.min_z)return d.min_x=-.1,d.max_x=.1,d.min_y=-.1,d.max_y=.1,d.min_z=-.2,d.max_z=-.1,d;d.min_x=Math.max(b.min_x,k);d.max_x=Math.min(b.max_x,f);d.min_y=Math.max(b.min_y,l);d.max_y=Math.min(b.max_y,
t);d.min_z=Math.max(b.min_z,h);d.max_z=Math.min(b.max_z,c);return d};a.stretch_bounding_box=function(b,c,d){d||(d=a.zero_bounding_box());var k=b.max_x-b.min_x,f=b.max_y-b.min_y,l=b.max_z-b.min_z;d.min_x=b.min_x-.5*(c-1)*k;d.max_x=b.max_x+.5*(c-1)*k;d.min_y=b.min_y-.5*(c-1)*f;d.max_y=b.max_y+.5*(c-1)*f;d.min_z=b.min_z-.5*(c-1)*l;d.max_z=b.max_z+.5*(c-1)*l;return d};a.bounding_sphere_transform=function(b,d,k){k||(k=a.zero_bounding_sphere());f.transformMat4(b.center,d,k.center);k.radius=b.radius*c.matrix_to_scale(d);
return k};a.bounding_ellipsoid_transform=function(a,b,c){c||(c={axis_x:new Float32Array(3),axis_y:new Float32Array(3),axis_z:new Float32Array(3),center:new Float32Array([0,0,0])});l.transform_vec3(a.center,b,c.center);f.copy(a.axis_x,c.axis_x);f.copy(a.axis_y,c.axis_y);f.copy(a.axis_z,c.axis_z);l.transform_dir_vec3(c.axis_x,b,c.axis_x);l.transform_dir_vec3(c.axis_y,b,c.axis_y);l.transform_dir_vec3(c.axis_z,b,c.axis_z);return c};a.create_bounding_sphere=function(a,b){return{radius:a,center:new Float32Array(b)}};
a.zero_bounding_sphere=function(){return{center:new Float32Array([0,0,0]),radius:0}};a.create_bounding_ellipsoid=function(a,b,c,d){return{axis_x:new Float32Array(a),axis_y:new Float32Array(b),axis_z:new Float32Array(c),center:new Float32Array([d[0],d[1],d[2]])}};a.big_bounding_sphere=function(){return{center:new Float32Array([0,0,0]),radius:1E12}};a.expand_bounding_sphere=function(a,b){var c=f.subtract(b.center,a.center,f.create());0==f.length(c)&&f.set(1,0,0,c);var d=f.normalize(c,f.create()),c=
f.scale(d,a.radius,f.create());f.add(c,a.center,c);var k=f.scale(d,-a.radius,f.create());f.add(k,a.center,k);var l=f.scale(d,b.radius,f.create());f.add(l,b.center,l);var t=f.scale(d,-b.radius,f.create());f.add(t,b.center,t);c=[c,k,l,t];d=f.normalize(d,f.create());k=c[0];l=c[0];for(t=1;t<c.length;t++){var h=f.dot(c[t],d);h<f.dot(k,d)&&(k=c[t]);h>f.dot(l,d)&&(l=c[t])}d=[k,l];c=d[0];d=d[1];a.center=f.scale(f.add(c,d,f.create()),.5,f.create());a.radius=f.length(f.subtract(d,c,f.create()))/2};a.create_bounding_capsule=
function(a,b){var c=b.max_y,d=b.min_y,k=Math.max(0,c-d-2*a);return{radius:a,height:k,center:new Float32Array([0,(c+d)/2,0])}};a.create_bounding_cylinder=function(a,b){var c=b.max_y,d=b.min_y,k=Math.max(0,c-d);return{radius:a,height:k,center:new Float32Array([0,(c+d)/2,0])}};a.create_bounding_cone=function(a,b){var c=b.max_y,d=b.min_y,k=Math.max(0,c-d);return{radius:a,height:k,center:new Float32Array([0,(c+d)/2,0])}};a.check_bb_intersection=function(a,b){return a.min_x>b.max_x||a.max_x<b.min_x?!1:
a.min_y>b.max_y||a.max_y<b.min_y?!1:a.min_z>b.max_z||a.max_z<b.min_z?!1:!0};a.recalculate_mesh_boundings=function(a){for(var b=0,c=0,d=0,k=0,f=0,t=0,l=0,h=0,p=0;p<a.submeshes.length;p++){var g=a.submeshes[p];if(g.position.length){b=k=g.position[0];c=f=g.position[1];d=t=g.position[2];break}}for(p=0;p<a.submeshes.length;p++)for(var g=a.submeshes[p],g=g.position,n=0;n<g.length/3;n++)var v=g[3*n],q=g[3*n+1],z=g[3*n+2],b=Math.max(v,b),c=Math.max(q,c),d=Math.max(z,d),k=Math.min(v,k),f=Math.min(q,f),t=Math.min(z,
t),l=Math.max(Math.sqrt(v*v+q*q+z*z),l),h=Math.max(Math.sqrt(v*v+z*z),h);a.b4w_bounding_box.max_x=b;a.b4w_bounding_box.min_x=k;a.b4w_bounding_box.max_y=c;a.b4w_bounding_box.min_y=f;a.b4w_bounding_box.max_z=d;a.b4w_bounding_box.min_z=t;a.b4w_bounding_box_source.max_x=b;a.b4w_bounding_box_source.min_x=k;a.b4w_bounding_box_source.max_y=c;a.b4w_bounding_box_source.min_y=f;a.b4w_bounding_box_source.max_z=d;a.b4w_bounding_box_source.min_z=t;a.b4w_bounding_sphere_radius=l;a.b4w_bounding_cylinder_radius=
h};a.get_frustum_mec=function(e){var m=e.subarray(0,3),l=e.subarray(6,9),h=e.subarray(12,15),n=e.subarray(18,21);e=f.subtract(l,m,q);f.normalize(e,e);var w=c.get_plane_normal(m,l,h,d),w=f.cross(w,e,w);f.normalize(w,w);var t=f.create(),C=f.create();f.subtract(l,m,k);C[0]=f.dot(k,e);C[1]=f.dot(k,w);l=f.create();f.subtract(h,m,k);l[0]=f.dot(k,e);l[1]=f.dot(k,w);h=f.create();f.subtract(n,m,k);h[0]=f.dot(k,e);h[1]=f.dot(k,w);n=a.zero_bounding_sphere();h=[t,C,l,h];t=b(n,h[0],h[1]);for(n=2;n<h.length;n++)if(f.distance(t.center,
h[n])>t.radius){for(var D=t,t=h,C=h[n],l=n-1,D=b(D,C,t[0]),p=1;p<=l;p++)if(f.distance(D.center,t[p])>D.radius){for(var g=D,D=t,y=C,v=t[p],u=p-1,g=b(g,y,v),z=0;z<=u;z++)if(f.distance(g.center,D[z])>g.radius){var H=y,F=v,L=D[z],x=f.subtract(F,L,k),x=f.squaredLength(x),K=f.subtract(H,L,k),A=f.squaredLength(K),K=f.subtract(H,F,k),P=f.squaredLength(K),K=x*(A+P-x),S=A*(P+x-A),x=P*(x+A-P),A=K+S+x;f.copy(H,g.center);f.scale(g.center,K/A,g.center);f.scaleAndAdd(g.center,F,S/A,g.center);f.scaleAndAdd(g.center,
L,x/A,g.center);g.radius=f.distance(g.center,H)}D=g}t=D}n=t;e=f.scale(e,n.center[0],k);f.scaleAndAdd(e,w,n.center[1],e);f.add(e,m,n.center);return n}};b4w.module.__compat=function(a,r){function u(a){return-1<navigator.userAgent.indexOf(a)?!0:!1}function h(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}function b(){return!window.ActiveXObject&&"ActiveXObject"in window}var l=r("__config"),c=r("__extensions"),f=r("__print");
r("__util");a.detect_tegra_invalid_enum_issue=function(a){a.getError()==a.INVALID_ENUM&&f.warn("Possible Tegra invalid enum issue detected, ignoring")};a.set_hardware_defaults=function(a){var q=l.animation,d=l.defaults,k=l.context,e=l.scenes,m=l.sfx,B=l.physics;d.max_vertex_uniform_vectors=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS);d.max_texture_size=a.getParameter(a.MAX_TEXTURE_SIZE);d.max_cube_map_size=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE);var N=Boolean(c.get_depth_texture());u("Firefox/28.0")&&
(u("Linux")||u("Macintosh"))&&(f.warn("Firefox 28 detected, applying depth hack"),N=!1);u("Windows Phone")||(u("iPad")||u("iPhone")?(f.warn("iOS detected, applying alpha hack, applying vertex animation mix normals hack, applying ios depth hack and disable smaa. Disable ssao for performance. Disable video textures. Initialize WebAudio context with empty sound."),k.alpha||(d.background_color[3]=1),d.vert_anim_mix_normals_hack=!0,d.smaa=!1,d.ssao=!1,d.precision="highp",d.init_wa_context_hack=!0,d.ios_depth_hack=
!0):u("Mac OS X")&&u("Safari")&&!u("Chrome")&&(f.warn("OS X / Safari detected, force to wait complete loading. Applying playback rate hack for video textures."),m.audio_loading_hack=!0,m.clamp_playback_rate_hack=!0));u("Windows")&&(u("Chrome/40")||u("Firefox/33")||u("Firefox/34")||u("Firefox/35")||u("Firefox/36"))&&(f.warn("Windows/Chrome40 or Firefox33-36 detected. Applying clear procedural skydome hack."),d.clear_procedural_sky_hack=!0);h()&&(f.warn("Mobile detected, applying various hacks for video textures."),
d.is_mobile_device=!0,u("iPad")||u("iPhone")||u("Windows Phone")||(f.warn("Mobile (not iOS) detected, disable playback rate for video textures."),m.disable_playback_rate_hack=!0));(u("Firefox/35.0")||u("Firefox/36.0"))&&u("Windows")&&(f.warn("Windows/Firefox 35/36 detected, applying shadows slink hack"),d.firefox_shadows_slink_hack=!0);if(u("iPhone")||b()||u("Edge"))f.warn("iPhone, IE11 or Edge detected. Enable sequential video fallback for video textures."),d.seq_video_fallback=!0;10>a.getParameter(a.MAX_VARYING_VECTORS)&&
(f.warn("Not enough varyings, disable shadows on blend objects"),d.disable_blend_shadows_hack=!0);u("Windows Phone")&&(f.warn("Windows Phone detected. Disable wireframe mode, glow materials, ssao, smaa, shadows, reflections, refractions."),d.wireframe_debug=!1,d.precision="highp",d.glow_materials=!1,d.ssao=!1,d.smaa=!1,d.shadows=!1,d.reflections=!1,d.refractions=!1,d.quality_aa=!1);u("Firefox")&&d.is_mobile_device&&(f.warn("Mobile FireFox detected, applying depth hack"),N=B.use_workers=!1);if(k=c.get_renderer_info())u("Macintosh")&&
-1<a.getParameter(k.UNMASKED_RENDERER_WEBGL).indexOf("Intel HD Graphics 3000")&&(f.warn("OS X / Intel HD 3000 detected, applying depth hack"),N=!1),-1<a.getParameter(k.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(k.UNMASKED_RENDERER_WEBGL).indexOf("Mali-400")&&(f.warn("ARM Mali-400 detected, applying depth and frames blending hacks"),N=!1,q.frames_blending_hack=!0),-1<a.getParameter(k.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(k.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T604")&&
(f.warn('ARM Mali-T604 detected, set "highp" precision and disable shadows.'),d.precision="highp",d.shadows=!1),-1<a.getParameter(k.UNMASKED_VENDOR_WEBGL).indexOf("ARM")&&-1<a.getParameter(k.UNMASKED_RENDERER_WEBGL).indexOf("Mali-T760")&&(f.warn('ARM Mali-T760 detected, set "highp" precision and disable SSAO.'),d.precision="highp",d.ssao=!1),-1<a.getParameter(k.UNMASKED_VENDOR_WEBGL).indexOf("Qualcomm")&&-1<a.getParameter(k.UNMASKED_RENDERER_WEBGL).indexOf("Adreno")&&(f.warn("Qualcomm Adreno detected, applying shader constants hack."),
d.shader_constants_hack=!0,-1<a.getParameter(k.UNMASKED_RENDERER_WEBGL).indexOf("305")&&(f.warn('Qualcomm Adreno305 detected, set "highp" precision.'),d.precision="highp"),-1<a.getParameter(k.UNMASKED_RENDERER_WEBGL).indexOf("330")&&(f.warn('Qualcomm Adreno330 detected, set "highp" precision.'),d.precision="highp")),-1<a.getParameter(k.UNMASKED_VENDOR_WEBGL).indexOf("NVIDIA")&&-1<a.getParameter(k.UNMASKED_RENDERER_WEBGL).indexOf("Tegra 3")&&(f.warn("NVIDIA Tegra 3 detected, force low quality for B4W_LEVELS_OF_QUALITY nodes."),
d.force_low_quality_nodes=!0),u("Windows")&&u("Chrome")&&!u("Edge")&&a.getParameter(k.UNMASKED_RENDERER_WEBGL).match(/NVIDIA GeForce 8..0/)&&(f.warn("Chrome / Windows / NVIDIA GeForce 8000 series detected, setting max cubemap size to 256."),d.max_cube_map_size=256);0==a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS)&&(f.warn("Vertex textures are not allowed. Disabling vertex textures"),d.allow_vertex_textures=!1);d.allow_hidpi&&1<window.devicePixelRatio&&(f.log("%cENABLE HIDPI MODE","color: #00a"),
d.render_resolution_factor=1,d.smaa=!1);N||(d.foam=!1,d.parallax=!1,d.dynamic_grass=!1,d.water_dynamic=!1,d.shore_smoothing=!1,d.shore_distance=!1,d.smaa=!1);d.use_dds=Boolean(c.get_s3tc());d.depth_tex_available=N;q=a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT);a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_FLOAT);0===q.precision&&(d.precision="mediump");b()&&(f.warn("IE11 detected. Set sky cubemap texture size to 512 (power of two)."),e.cubemap_tex_size=512);if(b()&&u("Touch")||
u("Edge"))f.warn("IE11 and touchscreen or Edge detected. Behaviour of the mouse move sensor will be changed."),d.ie11_edge_touchscreen_hack=!0;128>=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS)&&(f.warn("Not enough fragment uniforms, force low quality for B4W_LEVELS_OF_QUALITY nodes."),d.force_low_quality_nodes=!0);u("Chrome")&&!u("Edge")&&(f.log("Chrome detected. Some of deprecated functions related to the Doppler effect won't be called."),d.cors_chrome_hack=!0);if(u("Chrome")&&!u("Edge")||u("Firefox"))d.disable_doppler_hack=
!0;if(b()||u("iPad"))f.warn("iPad or Internet Explorer detected. Applying alpha clip hack."),d.alpha_clip_filtering_hack=!0;h()&&u("Firefox")&&(f.log("Mobile firefox detected. Applying autoplay media hack."),d.mobile_firefox_media_hack=!0);u("Edge")&&(f.warn("Microsoft Edge detected, set up new minimal texture size."),d.edge_min_tex_size_hack=!0)};a.detect_mobile=h;a.apply_context_alpha_hack=function(){u("Firefox/35.0")&&u("Windows")&&(f.warn("Windows/Firefox 35 detected, forcing context's alpha"),
l.context.alpha=!0)};a.is_ie11=b};b4w.module.__constraints=function(a,r){function u(a){var b={};b.type=a;return b}function h(a,c){a.constraint&&a.constraint.obj_parent&&b(a.constraint.obj_parent,a);if(c.obj_parent){var d=c.obj_parent;if(-1==d.cons_descends.indexOf(a))d.cons_descends.push(a);else throw"Descendant object override is forbidden";}a.constraint=c}function b(a,b){var c=a.cons_descends.indexOf(b);if(-1!=c)a.cons_descends.splice(c,1);else throw"No descendant object";}function l(a,b,c){switch(b.type){case 1:var x=a.render.quat,
p=b.obj_parent.render.world_matrix;c=b.obj_parent.render.quat;b.rotation_offset?(k.copy(b.rotation_offset,x),k.multiply(c,x,x)):k.copy(c,x);B.transformMat4(b.offset,p,a.render.trans);a.render.scale=b.scale_offset*b.obj_parent.render.scale;break;case 9:var A=a.render.trans,x=a.render.quat,p=b.obj_parent.render.world_matrix;c=b.obj_parent.render.quat;k.multiply(k.invert(b.parent_prev_rotation,b.parent_prev_rotation),x,x);k.multiply(c,x,x);B.transformMat4(b.offset,p,A);k.copy(c,b.parent_prev_rotation);
break;case 10:A=a.render.trans;x=a.render.quat;p=b.obj_parent.render.world_matrix;c=b.obj_parent.render.quat;k.multiply(k.invert(b.parent_prev_rotation,b.parent_prev_rotation),x,x);k.multiply(c,x,x);B.transformMat4(b.offset,p,A);k.copy(c,b.parent_prev_rotation);x=a.render.quat;A=k.multiply(b.obj_parent.render.quat,b.rotation_offset,g);A=q.get_camera_angles_from_quat(A,G);c=q.get_camera_angles_from_quat(x,w);x=m.calc_returning_angle(c[0],A[0]+b.clamp_right,A[0]+b.clamp_left);A=m.calc_returning_angle(c[1],
A[1]+b.clamp_down,A[1]+b.clamp_up);q.rotate_eye_camera(a,x,A);break;case 13:var A=a.render.trans,x=a.render.quat,p=b.obj_parent.render.world_matrix,P=b.obj_parent.render.trans,l=b.softness,h=t,D=g;B.transformMat4(b.offset,p,h);m.smooth_v(h,A,c,l,A);p=t;B.sub(P,A,p);B.normalize(p,p);var C=x,A=y,P=A.subarray(0,3),h=A.subarray(3,6),u=A.subarray(6,9);B.copy(p,h);B.negate(h,h);B.normalize(h,h);Boolean(.999999<Math.abs(B.dot(p,m.AXIS_Y)))?(p=d.fromQuat(k.normalize(C,D),v),B.copy(p.subarray(0,3),P)):B.cross(m.AXIS_Y,
h,P);B.normalize(P,P);B.cross(P,h,u);B.normalize(u,u);k.fromMat3(A,D);k.normalize(D,D);m.smooth_q(D,x,c,.16*l,x);break;case 2:x=a.render.quat;c=I;N.get_bone_tsr(b.obj_parent,b.bone_name,!0,!1,c);e.multiply(b.obj_parent.render.tsr,c,c);x[0]=c[4];x[1]=c[5];x[2]=c[6];x[3]=c[7];b.rotation_offset&&(k.copy(b.rotation_offset,x),k.multiply(x,b.rotation_offset,x));a.render.scale=b.scale_offset*c[3];e.transform_vec3(b.offset,c,a.render.trans);break;case 3:A=a.render.trans;x=a.render.quat;c=b.obj_parent.render.trans;
f(A,x,c);break;case 4:A=a.render.trans;x=a.render.quat;c=b.target;f(A,x,c);break;case 5:A=a.render.trans;x=a.render.quat;c=b.obj_parent.render.trans;f(A,x,c);x=B.dist(A,c);if(x=x>b.dist_max?x-b.dist_max:x<b.dist_min?x-b.dist_min:0)B.sub(c,A,t),B.normalize(t,t),B.scale(t,x,t),B.add(A,t,A);break;case 6:A=a.render.trans;x=a.render.quat;c=b.target;f(A,x,c);x=B.dist(A,c);if(x=x>b.dist_max?x-b.dist_max:x<b.dist_min?x-b.dist_min:0)B.sub(c,A,t),B.normalize(t,t),B.scale(t,x,t),B.add(A,t,A);break;case 7:p=
b.obj_parent.render.world_matrix;B.transformMat4(b.offset,p,a.render.trans);break;case 8:P=b.obj_parent.render.trans;A=a.render.trans;B.add(P,b.offset,A);break;case 14:x=a.render.quat;p=b.obj_parent.render.world_matrix;c=b.obj_parent.render.quat;b.rotation_offset?(k.copy(b.rotation_offset,x),k.multiply(c,x,x)):k.copy(c,x);B.transformMat4(b.offset,p,a.render.trans);break;case 11:A=b.obj_parent.render;c=e.create_sep(A.trans,A.scale,A.quat,I);A=b.tsr_offset;e.multiply(c,A,c);A=a.render.trans;A[0]=c[0];
A[1]=c[1];A[2]=c[2];a.render.scale=c[3];x=a.render.quat;x[0]=c[4];x[1]=c[5];x[2]=c[6];x[3]=c[7];break;case 12:A=b.tsr_offset;c=I;N.get_bone_tsr(b.obj_parent,b.bone_name,!0,!1,c);e.multiply(b.obj_parent.render.tsr,c,c);e.multiply(c,A,c);A=a.render.trans;A[0]=c[0];A[1]=c[1];A[2]=c[2];a.render.scale=c[3];x=a.render.quat;x[0]=c[4];x[1]=c[5];x[2]=c[6];x[3]=c[7];break;case 15:c=b.obj_parent,x=q.get_first_cam(c),A=a.render.trans,l=q.get_edge(x,"TOP"),D=q.get_edge(x,"BOTTOM"),p=l-D,b.left_edge?(P=q.get_edge(x,
"LEFT"),A[0]=P+p*b.left_right_dist):(P=q.get_edge(x,"RIGHT"),A[0]=P-p*b.left_right_dist),A[2]=b.top_edge?-(l-p*b.top_bottom_dist):-(D+p*b.top_bottom_dist),q.is_ortho(x)?A[1]=-b.distance:(A[1]=-1,B.normalize(A,A),x=b.distance/Math.abs(A[1]),B.scale(A,x,A)),e.transform_dir_vec3(A,c.render.tsr,A),B.add(c.render.trans,A,A),x=a.render.quat,b.rotation_offset?(k.copy(b.rotation_offset,x),k.multiply(c.render.quat,x,x)):k.copy(c.render.quat,x)}"CAMERA"==a.render.type&&(A=m.AXIS_Y,10==b.type&&(c=b.obj_parent.render.quat,
A=B.transformQuat(A,c,z)),q.update_camera_upside_down(a),n(a,A))}function c(a,b){switch(b.type){case 1:var c=b.target.render.tsr,x=I;e.invert(a.render.tsr,x);e.multiply(x,c,x);N.set_bone_tsr(a,b.bone_name,x,!1)}a.need_update_transform=!0}function f(a,b,c){var x=t;m.quat_to_dir(b,m.AXIS_MY,x);B.normalize(x,x);var d=C;B.subtract(c,a,d);B.normalize(d,d);a=m.rotation_to_stable(x,d,p);k.multiply(a,b,b);k.normalize(b,b)}function n(a,b){var c=a.render,x=c.quat,d=m.quat_to_dir(c.quat,m.AXIS_Y,t);B.normalize(d,
d);if(.999999<Math.abs(B.dot(b,d)))d=k.identity(g);else{var A=B.cross(b,d,C);B.normalize(A,A);if(c.move_style==q.MS_TARGET_CONTROLS)c.target_cam_upside_down&&B.negate(A,A);else{var e=m.quat_to_dir(c.quat,m.AXIS_Z,D);0<B.dot(e,b)&&B.negate(A,A)}c=m.quat_to_dir(c.quat,m.AXIS_X,D);B.normalize(c,c);var e=m.clamp(B.dot(c,A),-1,1),p=Math.acos(e),d=-.999999>=e?k.setAxisAngle(d,p,g):k.rotationTo(c,A,g);k.normalize(d,d)}k.multiply(d,x,x);q.update_camera_upside_down(a)}var q=r("__camera"),d=r("__mat3"),k=r("__quat"),
e=r("__tsr"),m=r("__util"),B=r("__vec3"),N=r("__armature");a.CONS_TYPE_STIFF_OBJ=1;a.CONS_TYPE_STIFF_BONE=2;a.CONS_TYPE_TRACK_OBJ=3;a.CONS_TYPE_TRACK_POINT=4;a.CONS_TYPE_FOLLOW_OBJ=5;a.CONS_TYPE_FOLLOW_POINT=6;a.CONS_TYPE_STIFF_TRANS_OBJ=7;a.CONS_TYPE_COPY_TRANS_OBJ=8;a.CONS_TYPE_SEMI_STIFF_OBJ=9;a.CONS_TYPE_SEMI_STIFF_CAM_OBJ=10;a.CONS_TYPE_CHILD_OF=11;a.CONS_TYPE_CHILD_OF_BONE=12;a.CONS_TYPE_SEMI_SOFT_CAM_OBJ=13;a.CONS_TYPE_STIFF_TRANS_ROT_OBJ=14;a.CONS_TYPE_STIFF_VIEWPORT=15;a.BONE_CONS_TYPE_STIFF_OBJ=
1;var G=new Float32Array(2),w=new Float32Array(2),t=new Float32Array(3),C=new Float32Array(3),D=new Float32Array(3),p=new Float32Array(4),g=new Float32Array(4),y=new Float32Array(9),v=new Float32Array(9),I=new Float32Array(8),z=new Float32Array(3);a.append_stiff_obj=function(a,b,c,x,d){var A=u(1);A.obj_parent=b;A.offset=new Float32Array(c);A.rotation_offset=x?new Float32Array(x):null;A.scale_offset=d;h(a,A);l(a,A,0)};a.append_stiff_bone=function(a,b,c,x,d,A){var g=u(2);g.obj_parent=b;g.bone_name=
c;g.offset=new Float32Array(x);g.rotation_offset=d?new Float32Array(d):null;g.scale_offset=A;h(a,g);l(a,g,0)};a.append_semi_stiff_obj=function(a,b,c,x){var d=u(9),A=a.render.quat,g=b.render.quat;d.obj_parent=b;d.offset=new Float32Array(c);d.parent_prev_rotation=new Float32Array(g);x&&(k.copy(x,A),k.multiply(g,A,A));h(a,d);l(a,d,0)};a.append_semi_stiff_cam_obj=function(a,b,c,x,d,A,g,e){var p=u(10),v=a.render.quat,f=b.render.quat;p.obj_parent=b;p.offset=new Float32Array(c);p.parent_prev_rotation=new Float32Array(f);
p.clamp_left=m.angle_wrap_0_2pi(d);p.clamp_right=m.angle_wrap_0_2pi(A);p.clamp_up=m.angle_wrap_periodic(g,-Math.PI,Math.PI);p.clamp_down=m.angle_wrap_periodic(e,-Math.PI,Math.PI);x?(p.rotation_offset=new Float32Array(x),k.copy(x,v),k.multiply(f,v,v)):p.rotation_offset=k.create();h(a,p);l(a,p,0)};a.append_semi_soft_cam_obj=function(a,b,c,x){var d=u(13);d.obj_parent=b;d.offset=new Float32Array(c);d.softness=x;h(a,d);l(a,d,0)};a.append_stiff_trans_rot_obj=function(a,b,c,x,d){var A=u(14);A.obj_parent=
b;A.offset=new Float32Array(c);A.scale_offset=d||1;A.rotation_offset=x?new Float32Array(x):null;h(a,A);l(a,A,0)};a.remove_parent_descendant=b;a.append_track_obj=function(a,b){var c=u(3);c.obj_parent=b;h(a,c);l(a,c,0)};a.append_track_point=function(a,b){var c=u(4);c.target=new Float32Array(b);h(a,c);l(a,c,0)};a.append_follow_obj=function(a,b,c,x){var d=u(5);d.obj_parent=b;d.dist_min=c;d.dist_max=x;h(a,d);l(a,d,0)};a.append_follow_point=function(a,b,c,x){var d=u(6);d.target=new Float32Array(b);d.dist_min=
c;d.dist_max=x;h(a,d);l(a,d,0)};a.append_stiff_trans_obj=function(a,b,c){var x=u(7);x.obj_parent=b;x.offset=new Float32Array(c);h(a,x);l(a,x,0)};a.append_copy_trans_obj=function(a,b,c){var x=u(8);x.obj_parent=b;x.offset=new Float32Array(c);h(a,x);l(a,x,0)};a.append_child_of=function(a,b,c){var x=u(11);x.obj_parent=b;x.tsr_offset=new Float32Array(c);h(a,x);l(a,x,0)};a.append_child_of_bone=function(a,b,c,x){var d=u(12);d.obj_parent=b;d.bone_name=c;d.tsr_offset=new Float32Array(x);h(a,d);l(a,d,0)};a.append_stiff_viewport=
function(a,b,c){var x=u(15);x.obj_parent=b;if("left"in c)x.left_edge=!0,x.left_right_dist=c.left;else if("right"in c)x.left_edge=!1,x.left_right_dist=c.right;else{m_print.error("append_stiff_viewport: Wrong positioning params");return}if("top"in c)x.top_edge=!0,x.top_bottom_dist=c.top;else if("bottom"in c)x.top_edge=!1,x.top_bottom_dist=c.bottom;else{m_print.error("append_stiff_viewport: Wrong positioning params");return}"distance"in c?(x.distance=c.distance,x.rotation_offset="rotation"in c?new Float32Array(c.rotation):
null,h(a,x),l(a,x,0)):m_print.error("append_stiff_viewport: Wrong positioning params")};a.update_constraint=function(a,b){a.constraint&&l(a,a.constraint,b)};a.append_stiff_bone_to_obj=function(a,b,d,x,g,A){var e=u(1);e.bone_name=d;e.target=b;e.offset=new Float32Array(x);e.rotation_offset=g?new Float32Array(g):null;e.scale_offset=A;b=e.target;d=e.bone_name;x=a.render.bone_pointers[d];g=b.cons_armat_bone_descends;for(A=0;A<g;A++){var k=g[A];if(k[0]==a&&k[1]==d){g.splice(A,1);break}}b.cons_armat_bone_descends.push([a,
d]);x.constraint=e;c(a,e)};a.update_bone_constraint=function(a,b){var d=a.render.bone_pointers[b];d.constraint&&c(a,d.constraint)};a.rotate_to=f;a.correct_up=n;a.check_constraint=function(a){return a.constraint?!0:!1};a.remove=function(a){a.constraint.obj_parent&&b(a.constraint.obj_parent,a);a.constraint=null};a.get_type=function(a){return a.constraint?a.constraint.type:null};a.has_child_of=function(a){a=a.constraint;return!a||11!=a.type&&12!=a.type?!1:!0};a.get_child_of_parent_tsr=function(a){if((a=
a.constraint)&&11==a.type)return a.obj_parent.render.tsr;if(a&&12==a.type){var b=I;N.get_bone_tsr(a.obj_parent,a.bone_name,!0,!1,b);e.multiply(a.obj_parent.render.tsr,b,b);return b}return null};a.get_child_of_offset=function(a){a=a.constraint;return!a||11!=a.type&&12!=a.type?null:a.tsr_offset}};b4w.module.__container=function(a,r){var u,h,b,l,c;function f(a,b){u=a;h=b}function n(){var a=k.getBoundingClientRect();f(a.left,a.top)}var q=r("__print"),d=r("__util"),k=null,e=null,m=!1;l=b=0;c=1;u=h=0;a.get_canvas=function(){return k};a.get_container=function(){return e};a.init=function(a){a&&a.parentNode?(k=a,e=a.parentNode):d.panic("canvas container is not available")};a.insert_to_container=function(a,b){b=b||"LAST";switch(b){case "FIRST":e.insertBefore(a,e.firstElementChild);break;case "JUST_BEFORE_CANVAS":e.insertBefore(a,
k);break;case "JUST_AFTER_CANVAS":k.nextElementSibling?e.insertBefore(a,k.nextElementSibling):e.appendChild(a,k);break;case "LAST":e.appendChild(a,k);break;default:q.error(b+" invalid stack order")}};a.get_viewport_width=function(){return b};a.get_viewport_height=function(){return l};a.set_canvas_offsets=f;a.update_canvas_offsets=n;a.setup_viewport_dim=function(a,d,e){b=a;l=d;c=e;n()};a.force_offsets_updating=function(){m=!0};a.client_to_canvas_coords=function(a,b,c){c||(c=new Float32Array(2));var d=
c;m&&(n(),m=!1);d[0]=a-u;a=c;m&&(n(),m=!1);a[1]=b-h;return c};a.canvas_to_viewport_coords=function(a,d,e,k){e||(e=new Float32Array(2));e[0]=a*c;e[1]=d*c;k&&(a=k.width/b,e[0]*=a,e[1]*=a);return e};a.viewport_to_canvas_coords=function(a,d,e,k){e||(e=new Float32Array(2));e[0]=a/c;e[1]=d/c;k&&(a=k.width/b,e[0]/=a,e[1]/=a);return e};a.is_child=function(b){return b&&b.parentNode?b.parentNode==e?!0:a.is_child(b.parentNode):!1};a.find_script=function(a){var b=document.getElementsByTagName("script");a=d.normpath_preserve_protocol(a);
for(var c=0;c<b.length;c++)if(b[c].src==a)return b[c];return null}};b4w.module.__controls=function(a,r){function u(a){return{type:a,value:0,payload:null,do_activation:!1,key:0,collision_id:"",calc_pos_norm:!1,collision_obj:null,collision_cb:function(){},col_imp_obj:null,col_imp_cb:function(){},source_object:null,from:new Float32Array(3),to:new Float32Array(3),is_binary_value:!1,ign_src_rot:!1,ray_test_id:0,ray_test_cb:function(){},axis:"",time_last:0,trans_last:new Float32Array(3),quat_last:new Float32Array(4),threshold:0,quat_temp:new Float32Array(4),avg_linear_vel:0,
avg_angular_vel:0,rotation_threshold:0,avg_vertical_vel:0,period:0,repeat:!1,auto_release:!1,gyro_gamma_new:0,gyro_beta_new:0,gyro_alpha_new:0,gyro_gamma_last:0,gyro_beta_last:0,gyro_alpha_last:0}}function h(a,b){a.value=Number(b)}function b(a){for(var b=a.sensors,c=a.sensor_values,x=0;x<b.length;x++)c[x]=b[x].value;return a.logic_fun(c)}function l(a){a=x.indexOf(a);-1<a?x.splice(a,1):g.error("Wrong object")}function c(a,b){for(var c=0,x=0;x<b.length;x++)for(var A=b[x].sensor_manifolds_arr,d=0;d<
A.length;d++)for(var e=A[d].sensors,g=0;g<e.length;g++)e[g]===a&&c++;return c}function f(a,b){switch(a.type){case 80:y.remove_collision_test(a.collision_obj,a.collision_id,a.collision_cb);a.do_activation=!0;break;case 90:y.clear_collision_impulse_test(a.col_imp_obj);a.do_activation=!0;break;case 100:y.remove_ray_test(a.ray_test_id);a.do_activation=!0;break;case 130:a.do_activation=!0}var c=b.indexOf(a);-1<c&&b.splice(c,1)}function n(a){for(var b=0;b<K.length;b++){var c=K[b];20==c.type&&a.keyCode==
c.key&&h(c,1)}T&&a.preventDefault();ha&&ha(a)}function q(a){for(var b=0;b<K.length;b++){var c=K[b];20==c.type&&0==a.keyCode&&16==c.key&&h(c,0);20==c.type&&a.keyCode==c.key&&h(c,0)}T&&a.preventDefault();ha&&ha(a)}function d(a){var b=!1,c=null;Q=!0;aa=a.clientX;Y=a.clientY;S=a.clientX;ea=a.clientY;for(var x=0;x<K.length;x++){var A=K[x];50==A.type&&(h(A,1),A.payload=a.which);160==A.type&&(b||(b=D.client_to_canvas_coords(a.clientX,a.clientY,fa),c=p.pick_object(b[0],b[1]),b=!0),A.value=c==A.source_object?
1:0)}da&&a.preventDefault();ia&&ia(a)}function k(a){for(var b=0;b<K.length;b++){var c=K[b];50==c.type&&h(c,0);160==c.type&&c.auto_release&&(c.value=0)}Q=!1;da&&!ga&&a.preventDefault();ia&&ia(a)}function e(a){var b=a.clientX,c=a.clientY;S=b;ea=c;if(!L.ie11_edge_touchscreen_hack||Q)for(var x=b-aa,A=c-Y,d=Math.sqrt(x*x+A*A),e=0;e<K.length;e++){var g=K[e];if(40===g.type)switch(g.axis){case "X":h(g,x);g.payload=b;break;case "Y":h(g,A);g.payload=c;break;case "XY":h(g,d),g.payload[0]=b,g.payload[1]=c}}da&&
!ga&&a.preventDefault();ia&&ia(a)}function m(a){D.is_child(a.relatedTarget)||k(a)}function B(a){var b=a.wheelDelta||-40*a.detail,b=b*F.mouse_wheel_notch_multiplier;P+=b;for(b=0;b<K.length;b++){var c=K[b];30===c.type&&h(c,P)}qa&&a.preventDefault();ma&&ma(a)}function N(a){var b=a.targetTouches;if(1==b.length){for(var c=b[0],b=c.clientX,c=c.clientY,x=!1,A=null,d=0;d<K.length;d++){var e=K[d];160==e.type&&(x||(x=D.client_to_canvas_coords(b,c,fa),A=p.pick_object(x[0],x[1]),x=!0),e.value=A==e.source_object)}U[0]=
b;U[1]=-1;ba[0]=c;ba[1]=-1}else 1<b.length&&(pa=na=t(b),U[0]=b[0].clientX,U[1]=b[1].clientX,ba[0]=b[0].clientY,ba[1]=b[1].clientY);X.set(U);R.set(ba);ca&&ca(a)}function G(b){var c=b.targetTouches;if(0!==c.length){if(1===c.length){X[0]=c[0].clientX;X[1]=-1;R[0]=c[0].clientY;R[1]=-1;var c=X[0]-U[0],x=R[0]-ba[0],A=Math.sqrt(c*c+x*x);if(-1!=U[1]&&-1!=ba[1]){var d=X[0]-U[1],J=R[0]-ba[1],e=Math.sqrt(d*d+J*J);e<A&&(c=d,x=J,A=e)}for(e=0;e<K.length;e++){var g=K[e];if(60===g.type)switch(g.payload=a.PL_SINGLE_TOUCH_MOVE,
g.axis){case "X":h(g,c);break;case "Y":h(g,x);break;case "XY":h(g,A)}}}else if(1<c.length){X[0]=c[0].clientX;X[1]=c[1].clientX;R[0]=c[0].clientY;R[1]=c[1].clientY;pa=t(c);A=pa-na;d=fa;d[0]=(X[0]+X[1])/2;d[1]=(R[0]+R[1])/2;J=ja;J[0]=(U[0]+U[1])/2;J[1]=(ba[0]+ba[1])/2;var k,c=d[0],x=d[1],e=J[0],g=J[1];k=Math.sqrt((c-e)*(c-e)+(x-g)*(x-g));for(e=0;e<K.length;e++)if(g=K[e],70===g.type&&Math.abs(k)<Math.abs(A)&&(g.payload=a.PL_MULTITOUCH_MOVE_ZOOM,h(g,A)),60===g.type&&Math.abs(k)>Math.abs(A))switch(g.payload=
a.PL_MULTITOUCH_MOVE_PAN,g.axis){case "X":c=d[0]-J[0];h(g,c);break;case "Y":x=d[1]-J[1];h(g,x);break;case "XY":h(g,k)}}O&&b.preventDefault();ca&&ca(b)}}function w(a){for(var b=0;b<K.length;b++){var c=K[b];if(170==c.type||180==c.type)c.gyro_beta_new=a.beta,c.gyro_gamma_new=a.gamma,c.gyro_alpha_new=a.alpha,c.value||(c.gyro_gamma_last=a.gamma,c.gyro_beta_last=a.beta,c.gyro_alpha_last=a.alpha,h(c,1))}}function t(a){var b=a[0],c=a[1];a=b.clientX;var b=b.clientY,x=c.clientX,c=c.clientY;return Math.sqrt((a-
x)*(a-x)+(b-c)*(b-c))}var C=r("__config"),D=r("__container"),p=r("__objects"),g=r("__print"),y=r("__physics"),v=r("__quat"),I=r("__time"),z=r("__util"),H=r("__vec3"),F=C.controls,L=C.defaults,x=[],K=[],A={},P=0,S=0,ea=0,aa=0,Y=0,Q=!1,X=new Float32Array(2),R=new Float32Array(2),U=new Float32Array(2),ba=new Float32Array(2),fa=new Float32Array(2),ja=new Float32Array(2),pa=0,na=0,V=!1,E=0,T=!1,da=!1,qa=!1,O=!1,ga=!1,ha=null,ia=null,ma=null,ca=null;a.CT_CONTINUOUS=10;a.CT_TRIGGER=20;a.CT_SHOT=30;a.CT_LEVEL=
40;a.CT_CHANGE=50;a.PL_SINGLE_TOUCH_MOVE=0;a.PL_MULTITOUCH_MOVE_ZOOM=1;a.PL_MULTITOUCH_MOVE_PAN=2;a.update=function(c,d){for(var e=0;e<K.length;e++){var g=K[e],k=c,J=d;if(J)switch(g.type){case 110:var p=g.source_object,f=p.render.trans,p=p.render.quat,m=H.dist(g.trans_last,f),t=g.quat_temp;v.invert(g.quat_last,t);v.multiply(p,t,t);v.normalize(t,t);t=Math.abs(2*Math.acos(t[3]));m/=J;g.avg_linear_vel=z.smooth(m,g.avg_linear_vel,J,.3);g.payload[0]=m;m=t/J;g.avg_angular_vel=z.smooth(m,g.avg_angular_vel,
J,.3);g.payload[1]=m;g.avg_linear_vel>=g.threshold||g.avg_angular_vel>=g.rotation_threshold?h(g,1):h(g,0);H.copy(f,g.trans_last);v.copy(p,g.quat_last);g.time_last=k;break;case 120:p=g.source_object;f=p.render.trans;p=Math.abs(f[1]-g.trans_last[1])/J;g.avg_vertical_vel=z.smooth(p,g.avg_vertical_vel,J,.3);g.payload=p;g.avg_vertical_vel>=g.threshold?h(g,1):h(g,0);H.copy(f,g.trans_last);g.time_last=k;break;case 130:!g.do_activation&&0<=g.period&&k-g.time_last>=g.period&&(h(g,1),g.repeat?g.time_last=k:
g.period=-g.period);break;case 140:g.time_last||(g.time_last=k);h(g,k-g.time_last);g.time_last=k;break;case 150:h(g,k);break;case 170:g.payload[0]=Math.PI*(g.gyro_gamma_new-g.gyro_gamma_last)/180;g.payload[1]=Math.PI*(g.gyro_beta_new-g.gyro_beta_last)/180;g.payload[2]=Math.PI*(g.gyro_alpha_new-g.gyro_alpha_last)/180;g.gyro_gamma_last=g.gyro_gamma_new;g.gyro_beta_last=g.gyro_beta_new;g.gyro_alpha_last=g.gyro_alpha_new;break;case 180:g.payload[0]=Math.PI*g.gyro_gamma_new/180,g.payload[1]=Math.PI*g.gyro_beta_new/
180,g.payload[2]=Math.PI*g.gyro_alpha_new/180}}for(e=0;e<x.length;e++)for(J=x[e],g=J.sensor_manifolds_arr,k=0;k<g.length;k++)if(f=g[k],f.update_counter!=E){f.update_counter=E;t=f;p=0;switch(t.type){case a.CT_CONTINUOUS:p=t.last_pulse;(m=b(t))?(p=1,t.last_pulse=1):1==p?(p=-1,t.last_pulse=-1):p=0;break;case a.CT_TRIGGER:p=t.last_pulse;(m=b(t))&&-1==p?(p=1,t.last_pulse=1):m||1!=p?p=0:(p=-1,t.last_pulse=-1);break;case a.CT_SHOT:p=t.last_pulse;(m=b(t))&&-1==p?(p=1,t.last_pulse=1):m||1!=p?p=0:(p=0,t.last_pulse=
-1);break;case a.CT_LEVEL:m=b(t);t.last_logic_result!=m?(p=1,t.last_logic_result=m):p=0;break;case a.CT_CHANGE:for(var m=t.sensors,t=t.last_sensor_values,l=0;l<m.length;l++){var F=m[l].value;p||F==t[l]||(p=1);t[l]=F}break;default:z.panic("Wrong sensor manifold type: "+t.type)}if(p&&(m=J==A?null:J,V=!1,f.callback(m,f.id,p,f.callback_param),V)){e=-1;break}}for(e=0;e<x.length;e++)for(J=x[e],g=J.sensor_manifolds_arr,k=0;k<g.length;k++)for(f=g[k],J=f.sensors,f=0;f<J.length;f++)switch(p=J[f],p.type){case 30:h(p,
0);break;case 40:h(p,0);break;case 60:h(p,0);break;case 70:h(p,0);break;case 130:h(p,0)}P=0;aa=S;Y=ea;U.set(X);ba.set(R);na=pa;E++};a.create_custom_sensor=function(a){var b=u(10);h(b,a);return b};a.create_keyboard_sensor=function(a){var b=u(20);b.key=a;return b};a.create_collision_sensor=function(a,b,c){if(!a||!y.obj_has_physics(a))return g.error("Wrong collision object"),null;var x=u(80);x.collision_obj=a;x.collision_id=b;x.calc_pos_norm=c;x.payload={coll_obj:null,coll_pos:c?new Float32Array(3):
null,coll_norm:c?new Float32Array(3):null,coll_dist:0};x.collision_cb=function(a,b,c,A,d){h(x,a);a=x.payload;a.coll_obj=b;x.calc_pos_norm&&(a.coll_pos.set(c),a.coll_norm.set(A),a.coll_dist=d)};x.do_activation=!0;return x};a.create_collision_impulse_sensor=function(a){if(!a||!a.physics)return g.error("Wrong collision impulse object"),null;var b=u(90);b.col_imp_obj=a;b.col_imp_cb=function(a){h(b,a)};b.do_activation=!0;return b};a.create_ray_sensor=function(a,b,c,x,A,d,g){var e=u(100);e.source_object=
a;e.from=b;e.to=c;e.collision_id=x;e.is_binary_value=A;e.calc_pos_norm=d;e.ign_src_rot=g;e.payload={hit_fract:0,obj_hit:null,hit_time:0,hit_pos:new Float32Array(3),hit_norm:new Float32Array(3)};e.ray_test_cb=function(a,b,c,x,A,d){e.is_binary_value?h(e,-1==b?0:1):h(e,b);e.payload.hit_fract=b;e.payload.obj_hit=c;e.payload.hit_time=x;e.calc_pos_norm&&(e.payload.hit_pos.set(A),e.payload.hit_norm.set(d))};e.do_activation=!0;return e};a.create_mouse_click_sensor=function(){return u(50)};a.create_mouse_wheel_sensor=
function(){return u(30)};a.create_mouse_move_sensor=function(a){var b=u(40);b.axis=a||"XY";b.payload="XY"==b.axis?new Float32Array(2):0;return b};a.create_touch_move_sensor=function(a){var b=u(60);b.axis=a||"XY";b.payload=0;return b};a.create_touch_zoom_sensor=function(){var a=u(70);a.payload=0;return a};a.create_motion_sensor=function(a,b,c){if(!a)return g.error("Wrong collision object"),null;var x=u(110);x.source_object=a;var A=a.render.trans;a=a.render.quat;x.quat_temp=new Float32Array(4);x.trans_last=
new Float32Array(A);x.quat_last=new Float32Array(a);x.avg_linear_vel=0;x.avg_angular_vel=0;x.threshold=b||.1;x.rotation_threshold=c||.1;x.time_last=0;x.payload=new Float32Array([0,0]);return x};a.create_vertical_velocity_sensor=function(a,b){if(!a)return g.error("Wrong collision object"),null;var c=u(120);c.source_object=a;var x=a.render.quat;c.trans_last=new Float32Array(a.render.trans);c.quat_last=new Float32Array(x);c.avg_vertical_vel=0;c.threshold=b||1;c.time_last=0;c.payload=0;return c};a.create_timer_sensor=
function(a,b){var c=u(130);c.period=a;c.repeat=b;c.do_activation=!0;return c};a.reset_timer_sensor=function(a,b,c,x){a=a||A;a=a.sensor_manifolds;if(!a||!a[b])return g.error("reset_timer_sensor(): wrong object"),null;b=a[b].sensors[c];if(!b)return g.error("reset_timer_sensor(): sensor not found"),null;b.time_last=I.get_timeline();b.period=x};a.create_elapsed_sensor=function(){var a=u(140);a.time_last=0;return a};a.create_gyro_delta_sensor=function(){var a=u(170);a.payload=new Float32Array(3);return a};
a.create_gyro_angles_sensor=function(){var a=u(180);a.payload=new Float32Array(3);return a};a.create_timeline_sensor=function(){return u(150)};a.create_selection_sensor=function(a,b){var c=u(160);c.source_object=a;c.auto_release=b;return c};a.sensor_set_value=h;a.get_sensor_value=function(a,b,c){a=a||A;a=a.sensor_manifolds;if(!a||!a[b])return g.error("get_sensor_value(): wrong object"),null;b=a[b].sensors[c];return b?b.value:(g.error("get_sensor_value(): sensor not found"),null)};a.get_sensor_payload=
function(a,b,c){a=a||A;a=a.sensor_manifolds;if(!a||!a[b])return g.error("get_sensor_payload(): wrong object"),null;b=a[b].sensors[c];return b?b.payload:(g.error("get_sensor_payload(): sensor not found"),null)};a.cleanup=function(){x=[];K=[];A={}};a.check_sensor_manifold=function(a,b){a=a||A;if(!a.sensor_manifolds)return!1;if(b&&a.sensor_manifolds[b])return!0;if(!b)for(var c in a.sensor_manifolds)return!0;return!1};a.remove_sensor_manifold=function(a,b){a=a||A;var d=a.sensor_manifolds;if(d){var g=
a.sensor_manifolds_arr;if(b){var e=d[b];if(e){for(var J=e.sensors,k=0;k<J.length;k++)1===c(J[k],x)&&f(J[k],K);delete d[b];e=g.indexOf(e);-1<e?g.splice(e,1):z.panic("Incorrect manifolds array");Object.getOwnPropertyNames(d).length||l(a)}}else{for(b in d){e=d[b];J=e.sensors;for(k=0;k<J.length;k++)1===c(J[k],x)&&f(J[k],K);delete d[b];e=g.indexOf(e);-1<e?g.splice(e,1):z.panic("Incorrect manifolds array")}l(a);V=!0}}};a.create_sensor_manifold=function(a,b,d,g,e,J,k){a=a||A;a.sensor_manifolds_arr=a.sensor_manifolds_arr||
[];a.sensor_manifolds=a.sensor_manifolds||{};var p=a.sensor_manifolds,v=a.sensor_manifolds_arr,m=p[b];if(m){g=m.sensors;for(var t=0;t<g.length;t++)1===c(g[t],x)&&f(g[t],K);m=v.indexOf(m);-1<m?v.splice(m,1):z.panic("Incorrect manifolds array")}d={id:b,type:d,sensors:g.slice(0),logic_fun:e,sensor_values:Array(g.length),callback:J,callback_param:k,last_pulse:-1,last_logic_result:0,last_sensor_values:Array(g.length),update_counter:-1};p[b]=d;v.push(d);-1==x.indexOf(a)&&x.push(a);a=d.sensors;for(b=0;b<
a.length;b++){p=a[b];if(p.do_activation){switch(p.type){case 80:y.append_collision_test(p.collision_obj,p.collision_id,p.collision_cb,p.calc_pos_norm);break;case 90:y.apply_collision_impulse_test(p.col_imp_obj,p.col_imp_cb);break;case 100:p.ray_test_id=y.append_ray_test(p.source_object,p.from,p.to,p.collision_id,p.ray_test_cb,!1,!1,p.calc_pos_norm,p.ign_src_rot);break;case 130:p.time_last=I.get_timeline(),0>p.period&&(p.period=-p.period)}p.do_activation=!1}-1==K.indexOf(p)&&K.push(p)}V=!0};a.default_AND_logic_fun=
function(a){for(var b=0;b<a.length;b++)if(!a[b])return a[b];return a[a.length-1]};a.default_OR_logic_fun=function(a){for(var b=0;b<a.length;b++)if(a[b])return a[b];return a[a.length-1]};a.reset=function(){for(var a=0;a<x.length;a++){var b=x[a],c=b.sensor_manifolds,b=b.sensor_manifolds_arr,A;for(A in c)delete c[A];b.splice(0,b.length)}for(a=0;a<K.length;a++)f(K[a],K),a--;x.splice(0,x.length)};a.debug=function(){g.log(String(x.length)+" objects with manifolds",x);g.log(String(K.length)+" sensors",K);
for(var a=[],b=[],c=0;c<K.length;c++){var A=K[c];80==A.type&&a.push(A);100==A.type&&b.push(A)}g.log(String(a.length)+" collision sensors",a);g.log(String(b.length)+" ray sensors",b)};a.register_keyboard_events=function(a,b){a.addEventListener("keydown",n,!1);a.addEventListener("keyup",q,!1);T=b};a.register_mouse_events=function(a,b,c){if(c)var x=window;else x=a,x.addEventListener("mouseout",m,!1);a.addEventListener("mousedown",d,!1);x.addEventListener("mousemove",e,!1);x.addEventListener("mouseup",
k,!1);da=b;ga=c};a.register_wheel_events=function(a,b){a.addEventListener("mousewheel",B,!1);a.addEventListener("DOMMouseScroll",B,!1);qa=b};a.register_touch_events=function(a,b){a.addEventListener("touchstart",N,!1);a.addEventListener("touchmove",G,!1);document.addEventListener("touchstart",function(){});O=b};a.register_device_orientation=function(){window.DeviceOrientationEvent&&L.gyro_use&&window.addEventListener("deviceorientation",w,!1)};a.unregister_keyboard_events=function(a){a.removeEventListener("keydown",
n,!1);a.removeEventListener("keyup",q,!1)};a.unregister_mouse_events=function(a){a.removeEventListener("mousedown",d,!1);a.removeEventListener("mousemove",e,!1);a.removeEventListener("mouseout",m,!1);a.removeEventListener("mouseup",k,!1)};a.unregister_wheel_events=function(a){a.removeEventListener("mousewheel",B,!1);a.removeEventListener("DOMMouseScroll",B,!1)};a.unregister_touch_events=function(a){a.removeEventListener("touchstart",N,!1);a.removeEventListener("touchmove",G,!1);document.removeEventListener("touchstart",
function(){})};a.unregister_device_orientation=function(){window.DeviceOrientationEvent&&L.gyro_use&&window.removeEventListener("deviceorientation",w,!1)};a.assign_keyboard_callback=function(a){ha=a};a.assign_mouse_callback=function(a){ia=a};a.assign_wheel_callback=function(a){ma=a};a.assign_touch_callback=function(a){ca=a}};b4w.module.__curve=function(a,r){function u(a,b,l,h,d){var k=h.length;d||(d=new Float32Array(k));for(var e=k+a,m=new Float32Array(e),B=1;B<=e-1;B++)m[B-1]=b>=l[B-1]&&b<l[B+1-1]?1:0;for(var u=2;u<=a;u++)for(B=1;B<=e-u;B++)m[B-1]=(0!=m[B-1]?(b-l[B-1])*m[B-1]/(l[B+u-1-1]-l[B-1]):0)+(0!=m[B+1-1]?(l[B+u-1]-b)*m[B+1-1]/(l[B+u-1]-l[B+1-1]):0);b==l[e-1]&&(m[k-1]=1);a=0;for(B=1;B<=k;B++)a+=m[B-1]*h[B-1];for(B=1;B<=k;B++)d[B-1]=0!=a?m[B-1]*h[B-1]/a:0;return d}function h(a){a=a.knot;return a[a.length-1]}function b(a){a=
a.cumulative_length;return a[a.length-1]}r("__print");var l=r("__util");a.create_spline=function(a){var b={},l=a.data;a=l.splines[0];if(!a||"NURBS"!=a.type||!a.use_endpoint_u)return null;var h=a.order_u;b.order=h;a=a.points;var d=a.length/5,k=[],e=d+h,d=d+2;k[0]=0;for(var m=2;m<=e;m++)k[m-1]=m>h&&m<d?k[m-2]+1:k[m-2];b.knot=k;if("2D"==l.dimensions)b.is_3d=!1;else if("3D"==l.dimensions)b.is_3d=!0;else throw"Wrong curve dimensions";h=[];k=[];for(l=0;l<a.length;l+=5)h.push(a[l]),h.push(a[l+1]),h.push(a[l+
2]),b.is_3d&&h.push(a[l+3]),k.push(a[l+4]);b.cpoints=h;b.weights=k;a=[];for(var l=b.cpoints,h=b.is_3d?4:3,k=b.weights,e=b.knot,d=b.order,m=l.length/h,B=m+d,r=0,G=e[B-1]/999,w=0;1E3>w;w++){5E-6>e[B-1]-r&&(r=e[B-1]);for(var t=u(d,r,e,k),C=0;C<h;C++)for(var D=a[h*w+C]=0;D<m;D++)a[h*w+C]+=t[D]*l[h*D+C];r+=G}h=b.is_3d?4:3;k=new Float32Array(1E3);k[0]=0;for(l=1;1E3>l;l+=1)e=a[(l-1)*h],d=a[(l-1)*h+1],m=a[(l-1)*h+2],B=a[l*h],r=a[l*h+1],G=a[l*h+2],e=Math.sqrt((B-e)*(B-e)+(r-d)*(r-d)+(G-m)*(G-m)),k[l]=k[l-
1]+e;b.cumulative_length=k;return b};a.spline_point=function(a,b,l){l||(l=[]);var q=b,d=Math.max(q,0),d=h(a);b=d=Math.min(q,d);var q=a.cpoints,d=a.is_3d?4:3,k=a.weights,e=a.knot,m=a.order;a=q.length/d;var B=a+m;5E-6>e[B-1]-b&&(b=e[B-1]);B=new Float32Array(a);u(m,b,e,k,B);for(b=0;b<d;b++)for(k=l[b]=0;k<a;k++)l[b]+=B[k]*q[d*k+b];return l};a.spline_derivative=function(a,b,l){l||(l=[]);var h=a.cpoints,d=a.is_3d?4:3,k=a.weights,e=a.knot,m=a.order;a=h.length/d;var B=a+m;5E-6>e[B-1]-b&&(b=e[B-1]);var B=
new Float32Array(a),u=b;b=B;var r=k.length;b||(b=new Float32Array(r));var w=new Float32Array(r),t=new Float32Array(r),C=w,D=t;C||(C=new Float32Array(r));D||(D=new Float32Array(r));for(var p=r+m,g=new Float32Array(p),y=new Float32Array(p),v=1;v<=p-1;v++)g[v-1]=u>=e[v-1]&&u<e[v+1-1]?1:0;u==e[p-1]&&(g[r-1]=1);for(var I=2;I<=m;I++)for(v=1;v<=p-I;v++){var z=0!=g[v-1]?g[v-1]/(e[v+I-1-1]-e[v-1]):0,H=0!=g[v+1-1]?-g[v+1-1]/(e[v+I-1]-e[v+1-1]):0,F=0!=y[v-1]?(u-e[v-1])*y[v-1]/(e[v+I-1-1]-e[v-1]):0,L=0!=y[v+
1-1]?(e[v+I-1]-u)*y[v+1-1]/(e[v+I-1]-e[v+1-1]):0;g[v-1]=(0!=g[v-1]?(u-e[v-1])*g[v-1]/(e[v+I-1-1]-e[v-1]):0)+(0!=g[v+1-1]?(e[v+I-1]-u)*g[v+1-1]/(e[v+I-1]-e[v+1-1]):0);y[v-1]=z+H+F+L}for(v=1;v<=r;v++)C[v-1]=g[v-1],D[v-1]=y[v-1];e=0;for(m=1;m<=r;m++)e+=w[m-1]*k[m-1];u=0;for(m=1;m<=r;m++)u+=t[m-1]*k[m-1];for(m=1;m<=r;m++)b[m-1]=0!=e?t[m-1]*k[m-1]/e+w[m-1]*k[m-1]*u/(e*e):0;for(k=0;k<d;k++)for(e=l[k]=0;e<a;e++)l[k]+=B[e]*h[d*e+k];return l};a.spline_max_t=h;a.spline_length=b;a.spline_len_to_t=function(a,
f){if(0>=f)return 0;var n=h(a);if(f>=b(a))return n;var q=a.cumulative_length,d=l.binary_search_max(q,f,0,q.length-1);return n*(d+(f-q[d])/(q[d+1]-q[d]))/1E3}};b4w.module.__dds=function(a,r){function u(a,b,c,d){var f=new Uint16Array(4),l=new Uint16Array(c*d),h=0,t=0,n=0,D=t=h=0,p=0,g=0,y=0,v=c/4;d/=4;for(var q=0;q<d;q++)for(var z=0;z<v;z++)n=b+4*(q*v+z),f[0]=a[n],f[1]=a[n+1],h=f[0]&31,t=f[0]&2016,D=f[0]&63488,p=f[1]&31,g=f[1]&2016,y=f[1]&63488,f[2]=5*h+3*p>>3|5*t+3*g>>3&2016|5*D+3*y>>3&63488,f[3]=5*p+3*h>>3|5*g+3*t>>3&2016|5*y+3*D>>3&63488,h=a[n+2],t=4*q*c+4*z,l[t]=f[h&3],l[t+1]=f[h>>2&3],l[t+2]=f[h>>4&3],l[t+3]=f[h>>6&3],t+=c,l[t]=f[h>>8&3],l[t+1]=f[h>>
10&3],l[t+2]=f[h>>12&3],l[t+3]=f[h>>14],h=a[n+3],t+=c,l[t]=f[h&3],l[t+1]=f[h>>2&3],l[t+2]=f[h>>4&3],l[t+3]=f[h>>6&3],t+=c,l[t]=f[h>>8&3],l[t+1]=f[h>>10&3],l[t+2]=f[h>>12&3],l[t+3]=f[h>>14];return l}function h(a,b,m,l){var h=new Int32Array(m,0,31),r,w,t,C,D,p;if(542327876!=h[0])return f.error("Invalid magic number in DDS header"),0;if(!h[20]&4)return f.error("Unsupported format, must contain a FourCC code"),0;r=h[21];switch(r){case n:w=8;t=b?b.COMPRESSED_RGB_S3TC_DXT1_EXT:null;break;case q:w=16;t=
b?b.COMPRESSED_RGBA_S3TC_DXT3_EXT:null;break;case d:w=16;t=b?b.COMPRESSED_RGBA_S3TC_DXT5_EXT:null;break;default:return f.error("Unsupported FourCC code:",c(r)),null}p=1;h[2]&131072&&!1!==l&&(p=Math.max(1,h[7]));C=h[4];D=h[3];h=h[1]+4;if(b)for(r=0;r<p;++r)l=Math.max(4,C)/4*Math.max(4,D)/4*w,b=new Uint8Array(m,h,l),a.compressedTexImage2D(a.TEXTURE_2D,r,t,C,D,0,b),h+=l,C=Math.max(.5*C,1),D=Math.max(.5*D,1);else if(r==n)Math.max(4,C),Math.max(4,D),b=new Uint16Array(m),m=u(b,h/2,C,D),a.texImage2D(a.TEXTURE_2D,
0,a.RGB,C,D,0,a.RGB,a.UNSIGNED_SHORT_5_6_5,m),l&&a.generateMipmap(a.TEXTURE_2D);else return f.error("No manual decoder for",c(r),"and no native support"),0;return p}function b(a,b,c,d,f,l){var n=new XMLHttpRequest;n.open("GET",c,!0);n.responseType="arraybuffer";n.onload=function(){if(200==n.status){a.bindTexture(a.TEXTURE_2D,d);var c=h(a,b,n.response,f);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,1<c?a.LINEAR_MIPMAP_LINEAR:a.LINEAR)}l&&
l(d)};n.send(null);return d}function l(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function c(a){return String.fromCharCode(a&255,a>>8&255,a>>16&255,a>>24&255)}var f=r("__print"),n=l("DXT1"),q=l("DXT3"),d=l("DXT5");a.dxt_to_rgb_565=u;a.upload_dds_levels=h;a.get_width_height=function(a){a=new Int32Array(a,0,31);return{width:a[4],height:a[3]}};a.get_compress_ratio=function(a){var b=1;a=(new Int32Array(a,0,31))[21];switch(a){case n:b=6;break;case q:case d:b=
4;break;default:f.error("Unsupported FourCC code:",c(a))}return b};a.load_dds_texture_ex=b;a.load_dds_texture=function(a,c,d,f){var l=a.createTexture();b(a,c,d,l,!0,f);return l}};b4w.module.__debug=function(a,r){function u(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+" "+a[b];return a=a.join("\n")}function h(a,b){typeof a!=typeof b&&n.panic("Structure assertion failed: incompatible types");if(null!==a&&null!==b&&"object"==typeof a){for(var c in a)c in b||n.panic("Structure assertion failed: missing key in the first object: "+c);for(c in b)c in a||n.panic("Structure assertion failed: missing key in the second object: "+c),typeof a[c]!=typeof b[c]&&n.panic("Structure assertion failed: incompatible types for key "+
c)}}var b=r("__extensions"),l=r("__print"),c=r("__textures"),f=r("__time"),n=r("__util"),q=null,d={},k=!1,e={},m=[],B=-1,N=null,G=!1;a.WM_NONE=0;a.WM_OPAQUE_WIREFRAME=1;a.WM_TRANSPARENT_WIREFRAME=2;a.WM_FRONT_BACK_VIEW=3;a.WM_DEBUG_SPHERES=4;a.setup_context=function(a){var b="INVALID_ENUM INVALID_VALUE INVALID_OPERATION OUT_OF_MEMORY INVALID_FRAMEBUFFER_OPERATION CONTEXT_LOST_WEBGL".split(" "),c;for(c in b){var e=b[c];e in a&&(d[a[e]]=e)}q=a};a.check_gl=function(a){if(k){var b=q.getError();b!=q.NO_ERROR&&
(b in d?n.panic("GL Error: "+b+", gl."+d[b]+" ("+a+")"):n.panic("Unknown GL error: "+b+" ("+a+")"))}};a.check_bound_fb=function(){if(!k)return!0;switch(q.checkFramebufferStatus(q.FRAMEBUFFER)){case q.FRAMEBUFFER_COMPLETE:return!0;case q.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return l.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT"),!1;case q.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return l.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT"),!1;case q.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return l.error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS"),
!1;case q.FRAMEBUFFER_UNSUPPORTED:return l.error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED"),!1;default:return l.error("FRAMEBUFFER CHECK FAILED"),!1}};a.check_depth_only_issue=function(){if(-1!=B)return B;var a=q.createFramebuffer();q.bindFramebuffer(q.FRAMEBUFFER,a);a=c.create_texture("DEBUG",c.TT_DEPTH);c.resize(a,1,1);q.framebufferTexture2D(q.FRAMEBUFFER,q.DEPTH_ATTACHMENT,a.w_target,a.w_texture,0);q.checkFramebufferStatus(q.FRAMEBUFFER)!=q.FRAMEBUFFER_COMPLETE?(B=!0,l.warn("depth-only issue was found")):
B=!1;q.bindFramebuffer(q.FRAMEBUFFER,null);return B};a.check_shader_compiling=function(a,b,c){if(k&&!q.getShaderParameter(a,q.COMPILE_STATUS))throw c=u(c),l.error("shader compilation failed:\n"+c+"\n"+q.getShaderInfoLog(a)+" ("+b+")"),"Engine failed: see above for error messages";};a.check_shader_linking=function(a,c,d,e,g,f){if(k&&!q.getProgramParameter(a,q.LINK_STATUS)){var v=b.get_debug_shaders();v&&(g=v.getTranslatedShaderSource(d),f=v.getTranslatedShaderSource(e));g=u(g);f=u(f);l.error("shader linking failed:\n"+
g+"\n\n\n"+f+"\n"+q.getProgramInfoLog(a)+" ("+c+")");throw"Engine failed: see above for error messages";}};a.set_check_gl_errors=function(a){k=a};a.exec_count=function(a){e[a]=a in e?e[a]+1:1};a.update=function(){for(var a in e)l.log(a,e[a]),e[a]=0};a.fbmsg=function(){for(var a=[performance.now()],b=0;b<arguments.length;b++){var c=arguments[b];if(n.is_vector(c))for(var d=0;d<c.length;d++)a.push(c[d]);else a.push(arguments[b])}m.push(a)};a.msg=function(){for(var a=1,b=0;b<m.length;b++){var c=m[b];
c[1]==arguments[0]&&a++}c=[a];for(b=0;b<arguments.length;b++)if(a=arguments[b],n.is_vector(a))for(var d=0;d<a.length;d++)c.push(a[d]);else c.push(arguments[b]);m.push(c)};var w=["color: #3366FF","color: #CC33FF","color: #FF3366","color: #33FF66","color: #FFCC33"];a.print_telemetry=function(a){a||(a=1);for(var b=0,c={},d=Math.max(0,performance.now()-1E3*a),g=0;g<m.length;g++){var e=m[g];a=e[0];if(!(a<d)){var k=String(e[1]);c[k]||(c[k]=w[b++%w.length]);var f=c[k];a=["%c"+(a/1E3).toFixed(6),f,k];for(k=
2;k<e.length;k++)a.push(e[k]);l.log.apply(this,a)}}m.splice(0)};a.plot_telemetry=function(a){a||(a=1);for(var b={},c=Math.max(0,performance.now()-1E3*a),d=0;d<m.length;d++){var g=m[d];a=g[0];if(!(a<c))for(var e=2;e<g.length;e++){var k=String(g[1]);3<g.length&&(k+="_"+String(e-2));b[k]||(b[k]=k+"\n");b[k]+=String(a)+" "+g[e]+"\n"}}a="";for(k in b)a+=b[k]+"\n\n";l.log(a);m.splice(0)};a.check_browser=function(a){var b=navigator.userAgent.toLowerCase(),c=function(a){return-1<b.indexOf(a)?!0:!1};switch(a.toLowerCase()){case "chrome":return c("mozilla")&&
c("applewebkit")&&c("chrome");case "firefox":return c("mozilla")&&c("gecko")&&c("firefox");case "msie":return c("mozilla")&&c("trident")&&c("msie");case "opera":return c("opera")&&c("presto");case "safari":return c("mozilla")&&c("applewebkit")&&c("safari")&&!c("chrome");default:return!1}};a.check_finite=function(a){if(n.is_vector(a)){for(var b=0;b<a.length;b++)if(!isFinite(a[b]))return!1;return Boolean(a.length)}return isFinite(a)?!0:!1};a.assert_cons=function(a,b){a.constructor!=b&&n.panic("Type assertion failed: value <"+
a+"> has type <"+a.constructor+">, required <"+b+">")};a.assert_structure=h;a.assert_structure_seq=function(a){G?h(a,N):G=!0;N=a};a.fake_load=function(a,b,c,d,g){(a=a||null)||n.panic("Stage load callback is undefined");b=b||5E3;c=c||0;d=d||100;100<d&&n.panic("Max percentage must be less than 100");0>c&&n.panic("Min percentage must be greater than 0");c>d&&n.panic("Max percentage must be greater than min percentage");var e=f.animate(c,d,b,function(b){b=b.toFixed();a(b);100==b&&(f.clear_animation(e),
g&&g())})}};b4w.module.__extensions=function(a,r){function u(a){if(a in l)return l[a];var f=b.getExtension(a)||null;l[a]=f;h.log("%cGET EXTENSION","color: #"+(f?"0a0":"a00"),a);return f}var h=r("__print"),b=null,l={};a.setup_context=function(a){b=a};a.get_s3tc=function(){return u("WEBGL_compressed_texture_s3tc")||u("WEBKIT_WEBGL_compressed_texture_s3tc")||u("MOZ_WEBGL_compressed_texture_s3tc")};a.get_depth_texture=function(){return u("WEBGL_depth_texture")||u("WEBKIT_WEBGL_depth_texture")||u("MOZ_WEBGL_depth_texture")};
a.get_aniso=function(){return u("EXT_texture_filter_anisotropic")||u("WEBKIT_EXT_texture_filter_anisotropic")||u("MOZ_EXT_texture_filter_anisotropic")};a.get_debug_shaders=function(){return u("WEBGL_debug_shaders")};a.get_renderer_info=function(){return u("WEBGL_debug_renderer_info")};a.get_elem_index_uint=function(){return u("OES_element_index_uint")};a.get_standard_derivatives=function(){return u("OES_standard_derivatives")};a.cleanup=function(){l={}}};b4w.module.__graph=function(a,r){function u(a,b,c){c||(c=null);if(h(a,b))throw"Graph already has node with given ID";a.nodes.push(b,c)}function h(a,b){for(var c=a.nodes,d=0;d<c.length;d+=2)if(c[d]==b)return!0;return!1}function b(a,b,c,d){d||(d=null);if(h(a,b)&&h(a,c))a.edges.push(b,c,d);else throw"Wrong node IDs";}function l(a,b){if(!h(a,b))throw"Node not found";for(var c=a.nodes,d=0;d<c.length;d+=2)c[d]==b&&(c.splice(d,2),d-=2)}function c(a,b,c,d){if(!v(a,b,c))throw"Edge not found";a=a.edges;for(var g=
0,e=0;e<a.length;e+=3)if(a[e]==b&&a[e+1]==c){if(-1==d)a.splice(e,3);else{if(d==g){a.splice(e,3);break}g++}e-=3}}function f(a){a=a.nodes;for(var b=-1,c=0;c<a.length;c+=2)b=Math.max(b,a[c]);return++b}function n(a,b){for(var c=a.nodes,d=0;d<c.length;d+=2)if(c[d+1]==b)return c[d];return-1}function q(a){var b=[],c={};d(a,c);for(var g=a.nodes,e=0;e<g.length;e+=2)0==p(a,g[e])&&k(a,g[e],c,b);return{nodes:b,edges:a.edges.slice(0)}}function d(a,b){for(var c=a.nodes,d=0;d<c.length;d+=2)b[c[d]]=!1}function k(a,
b,c,d){if(!c[b]){c[b]=!0;for(var e=0;e<D(a,b);e++){var p=g(a,b,e);k(a,p,c,d)}d.unshift(b,C(a,b))}}function e(a,b,c,d){if(!c[b]){c[b]=!0;if(10==d||30==d)for(var k=0;k<D(a,b);k++){var f=g(a,b,k);e(a,f,c,d)}if(20==d||30==d)for(k=0;k<p(a,b);k++)f=y(a,b,k),e(a,f,c,d)}}function m(a){for(var b=[],c=a.nodes,d=0;d<c.length;d+=2){var g=c[d];D(a,g)||b.push(g)}return b}function B(a){var b=a.nodes;a=a.edges;for(var c=[],d=[],g=[],e=0;e<b.length;e++)g[b[2*e]]=e,c.push(e,b[2*e+1]);for(e=0;e<a.length;e+=3)d.push(g[a[e]],
g[a[e+1]],a[e+2]);return{nodes:c,edges:d}}function N(a,b,c){if(c.core_len==c.n1){for(var d=0,e=0;d<c.n1;d++)-1!=c.core_1[d]&&(a[e]=d,b[e]=c.core_1[d],e++);return!0}if(c.n1>c.n2||c.t1both_len>c.t2both_len||c.t1out_len>c.t2out_len||c.t1in_len>c.t2in_len)return!1;for(var e=d=-1,k=!1;!k&&G(c,L,d,e);)if(d=L[0],e=L[1],w(c,d,e)){var f;f=c;k={};k.g1=f.g1;k.g2=f.g2;k.node_comp=f.node_comp;k.edge_comp=f.edge_comp;k.n1=f.n1;k.n2=f.n2;k.order=f.order;k.core_len=k.orig_core_len=f.core_len;k.t1in_len=f.t1in_len;
k.t1out_len=f.t1out_len;k.t1both_len=f.t1both_len;k.t2in_len=f.t2in_len;k.t2out_len=f.t2out_len;k.t2both_len=f.t2both_len;k.added_node1=-1;k.core_1=f.core_1;k.core_2=f.core_2;k.in_1=f.in_1;k.in_2=f.in_2;k.out_1=f.out_1;k.out_2=f.out_2;k.share_count=f.share_count;f.share_count[0]+=1;var k=f=k,m=d,v=e,l=k.g1,z=k.g2,h=k.n1,F=k.n2,B=k.core_1,n=k.core_2,H=k.in_1,q=k.in_2,C=k.out_1,E=k.out_2;t(m<h);t(v<F);t(k.core_len<h);t(k.core_len<F);h=++k.core_len;k.added_node1=m;H[m]||(H[m]=h,k.t1in_len++,C[m]&&k.t1both_len++);
C[m]||(C[m]=h,k.t1out_len++,H[m]&&k.t1both_len++);q[v]||(q[v]=h,k.t2in_len++,E[v]&&k.t2both_len++);E[v]||(E[v]=h,k.t2out_len++,q[v]&&k.t2both_len++);B[m]=v;n[v]=m;for(B=0;B<p(l,m);B++)n=y(l,m,B),H[n]||(H[n]=h,k.t1in_len++,C[n]&&k.t1both_len++);for(B=0;B<D(l,m);B++)n=g(l,m,B),C[n]||(C[n]=h,k.t1out_len++,H[n]&&k.t1both_len++);for(B=0;B<p(z,v);B++)n=y(z,v,B),q[n]||(q[n]=h,k.t2in_len++,E[n]&&k.t2both_len++);for(B=0;B<D(z,v);B++)n=g(z,v,B),E[n]||(E[n]=h,k.t2out_len++,q[n]&&k.t2both_len++);k=N(a,b,f);t(1>=
f.core_len-f.orig_core_len);t(-1!=f.added_node1);n=f.g1;m=f.g2;v=f.core_len;l=f.added_node1;z=f.core_1;H=f.core_2;h=f.in_1;q=f.in_2;F=f.out_1;C=f.out_2;if(f.orig_core_len<v){h[l]==v&&(h[l]=0);for(E=0;E<p(n,l);E++)B=y(n,l,E),h[B]==v&&(h[B]=0);F[l]==v&&(F[l]=0);for(E=0;E<D(n,l);E++)B=g(n,l,E),F[B]==v&&(F[B]=0);n=z[l];q[n]==v&&(q[n]=0);for(E=0;E<p(m,n);E++)B=y(m,n,E),q[B]==v&&(q[B]=0);C[n]==v&&(C[n]=0);for(E=0;E<D(m,n);E++)B=g(m,n,E),C[B]==v&&(C[B]=0);z[l]=-1;H[n]=-1;f.core_len=f.orig_core_len;f.added_node1=
-1}}return k}function G(a,b,c,d){-1==c&&(c=0);-1==d?d=0:d++;var g=a.t1both_len,e=a.t2both_len,k=a.t1out_len,p=a.t2out_len,f=a.t1in_len,m=a.t2in_len,v=a.core_len,l=a.n1,h=a.n2,z=a.core_1,F=a.core_2,t=a.in_1,L=a.in_2,B=a.out_1,E=a.out_2;if(g>v&&e>v)for(;c<l&&(-1!=z[c]||0==B[c]||0==t[c]);)c++,d=0;else if(k>v&&p>v)for(;c<l&&(-1!=z[c]||0==B[c]);)c++,d=0;else if(f>v&&m>v)for(;c<l&&(-1!=z[c]||0==t[c]);)c++,d=0;else if(0==c&&0!=a.order){for(t=0;t<l&&-1!=z[c=a.order[t]];)t++;t==l&&(c=l)}else for(;c<l&&-1!=
z[c];)c++,d=0;if(g>v&&e>v)for(;d<h&&(-1!=F[d]||0==E[d]||0==L[d]);)d++;else if(k>v&&p>v)for(;d<h&&(-1!=F[d]||0==E[d]);)d++;else if(f>v&&m>v)for(;d<h&&(-1!=F[d]||0==L[d]);)d++;else for(;d<h&&-1!=F[d];)d++;return c<l&&d<h?(b[0]=c,b[1]=d,!0):!1}function w(a,b,c){var d=a.g1,e=a.g2,k=a.n2,f=a.core_1,m=a.core_2,l=a.in_1,h=a.in_2,z=a.out_1,F=a.out_2;t(b<a.n1);t(c<k);t(-1==f[b]);t(-1==m[c]);k=(0,a.node_comp)(C(d,b),C(e,c))?!0:!1;if(!k)return!1;for(var L=k=0,B=0,n=0,H=0,q=0,w=0;w<D(d,b);w++){var E=g(d,b,w);
if(-1!=f[E]){var T=f[E];if(!v(e,c,T)||!I(a.edge_comp,d,b,E,e,c,T))return!1}else l[E]&&B++,z[E]&&k++,l[E]||z[E]||H++}for(w=0;w<p(d,b);w++)if(E=y(d,b,w),-1!=f[E]){if(T=f[E],!v(e,T,c)||!I(a.edge_comp,d,E,b,e,T,c))return!1}else l[E]&&B++,z[E]&&k++,l[E]||z[E]||H++;for(w=0;w<D(e,c);w++)if(T=g(e,c,w),-1!=m[T]){if(E=m[T],!v(d,b,E))return!1}else h[T]&&n++,F[T]&&L++,h[T]||F[T]||q++;for(w=0;w<p(e,c);w++)if(T=y(e,c,w),-1!=m[T]){if(E=m[T],!v(d,E,b))return!1}else h[T]&&n++,F[T]&&L++,h[T]||F[T]||q++;return B<=n&&
k<=L&&H<=q}function t(a){if(!a)throw"Assertion failed";}function C(a,b){for(var c=a.nodes,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function D(a,b){for(var c=a.edges,d=0,g=0;g<c.length;g+=3)c[g]==b&&d++;return d}function p(a,b){for(var c=a.edges,d=0,g=0;g<c.length;g+=3)c[g+1]==b&&d++;return d}function g(a,b,c){a=a.edges;for(var d=0,g=0;g<a.length;g+=3)if(a[g]==b){if(d==c)return a[g+1];d++}return-1}function y(a,b,c){a=a.edges;for(var d=0,g=0;g<a.length;g+=3)if(a[g+1]==b){if(d==c)return a[g];
d++}return-1}function v(a,b,c){a=a.edges;for(var d=0;d<a.length;d+=3)if(a[d]==b&&a[d+1]==c)return!0;return!1}function I(a,b,c,d,g,e,k){for(var p=z(b,c,d),f=z(g,e,k),v=0;v<p;v++){for(var m=!1,l=0;l<f;l++)if(a(H(b,c,d,v),H(g,e,k,l))){m=!0;break}if(!m)return!1}return!0}function z(a,b,c){var d=0;a=a.edges;for(var g=0;g<a.length;g+=3)a[g]==b&&a[g+1]==c&&d++;return d}function H(a,b,c,d){a=a.edges;for(var g=0,e=0;e<a.length;e+=3)if(a[e]==b&&a[e+1]==c){if(g==d)return a[e+2];g++}return null}r("__print");var F=
r("__util"),L=[-1,-1];a.NULL_NODE=-1;a.FORWARD_DIR=10;a.BACKWARD_DIR=20;a.TWO_WAY=30;a.create=function(){for(var a=arguments,b=[],c=[],d=0;d<a.length;d++){var g=a[d];switch(g.length){case 2:b.push(g[0],g[1]);break;case 3:c.push(g[0],g[1],g[2]);break;default:throw"Wrong graph constructor params";}}return{nodes:b,edges:c}};a.clone=function(a,b,c){if(b)for(var d=Array(a.nodes.length),g=0;g<a.nodes.length;g+=2)d[g]=a.nodes[g],d[g+1]=b(a.nodes[g+1]);else d=F.clone_object_r(a.nodes);if(c)for(b=Array(a.edges.length),
g=0;g<a.edges.length;g+=3)b[g]=a.edges[g],b[g+1]=a.edges[g+1],b[g+2]=c(a.edges[g+2]);else b=F.clone_object_r(a.edges);return a={nodes:d,edges:b}};a.create_node_edge_arr=function(a,b){for(var c=[],d=[],g=0;g<a.length;g++)c.push(a[g][0],a[g][1]);for(g=0;g<b.length;g++)d.push(b[g][0],b[g][1],b[g][2]);return{nodes:c,edges:d}};a.append_node=u;a.has_node=h;a.append_edge=b;a.remove_node=l;a.remove_edge=c;a.remove_edge_by_attr=function(a,b,c,d){if(!v(a,b,c))throw"Edge not found";a=a.edges;for(var g=0;g<a.length;g+=
3)if(a[g]==b&&a[g+1]==c&&a[g+2][0]==d[0]&&a[g+2][1]==d[1]){a.splice(g,3);break}};a.append_node_attr=function(a,b){if(-1==n(a,b)){var c=f(a);u(a,c,b);return c}throw"Non-unique attribute";};a.replace_edge_attr=function(a,b,c,d,g){a=a.edges;for(var e=0;e<a.length;e+=3)a[e]==b&&a[e+1]==c&&a[e+2]==d&&(a[e+2]=g)};a.gen_node_id=f;a.node_by_attr=n;a.append_edge_attr=function(a,c,d,g){c=n(a,c);d=n(a,d);if(-1!=c&&-1!=d)b(a,c,d,g);else throw"Attributes not found";};a.traverse=function(a,b){for(var c=a.nodes,
d=0;d<c.length&&!b(c[d],c[d+1]);d+=2);};a.traverse_edges=function(a,b){for(var c=a.edges,d=0;d<c.length&&!b(c[d],c[d+1],c[d+2]);d+=3);};a.traverse_inputs=function(a,b,c){for(var d=a.edges,g=0;g<d.length;g+=3)if(d[g+1]==b){var e=d[g];if(c(e,C(a,e),d[g+2]))break}};a.traverse_outputs=function(a,b,c){for(var d=a.edges,g=0;g<d.length;g+=3)if(d[g]==b){var e=d[g+1];if(c(e,C(a,e),d[g+2]))break}};a.topsort=q;a.topsort_attr=function(a){a=q(a).nodes;for(var b=[],c=0;c<a.length;c+=2)b.push(a[c+1]);return b};
a.is_connected=function(a){};a.subgraph_node_conn=function(a,b,c){if(!h(a,b))throw"No such node";var g={};d(a,g);e(a,b,g,c);b=[];for(var k in g)g[k]&&(k=Number(k),b.push(k,C(a,k)));a={nodes:b,edges:a.edges.slice(0)};g=a.edges;for(k=0;k<g.length;k+=3)b=g[k+1],h(a,g[k])&&h(a,b)||(g.splice(k,3),k-=3);return a};a.get_source_nodes=function(a){for(var b=[],c=a.nodes,d=0;d<c.length;d+=2){var g=c[d];p(a,g)||b.push(g)}return b};a.get_sink_nodes=m;a.match=function(a,b,c,d){var g={};g.g1=B(a);g.g2=B(b);g.node_comp=
c||function(a,b){return a==b};g.edge_comp=d||function(a,b){return a==b};d=a.nodes.length/2;var e=b.nodes.length/2;g.n1=d;g.n2=e;g.order=0;g.core_len=g.orig_core_len=0;g.t1both_len=g.t1in_len=g.t1out_len=0;g.t2both_len=g.t2in_len=g.t2out_len=0;g.added_node1=-1;g.core_1=Array(d);g.core_2=Array(e);g.in_1=Array(d);g.in_2=Array(e);g.out_1=Array(d);g.out_2=Array(e);g.share_count=[1];for(c=0;c<d;c++)g.core_1[c]=-1,g.in_1[c]=0,g.out_1[c]=0;for(c=0;c<e;c++)g.core_2[c]=-1,g.in_2[c]=0,g.out_2[c]=0;e=Array(d);
d=Array(d);if(N(e,d,g)){for(c=0;c<e.length;c++)e[c]=a.nodes[2*e[c]],d[c]=b.nodes[2*d[c]];return[e,d]}return null};a.get_node_attr=C;a.out_edge_count=D;a.in_edge_count=p;a.get_out_edge=g;a.get_in_edge=y;a.get_edge_count=z;a.get_edge_attr=H;a.replace=function(a,b,c){for(var d=a.edges,g=f(a),e=0;e<b.length;e++){var k=b[e];l(a,k);for(var p=0;p<d.length;p+=3)d[p]==k&&(d[p]=g),d[p+1]==k&&(d[p+1]=g),d[p]==d[p+1]&&(d.splice(p,3),p-=3)}u(a,g,c)};a.reconnect_edges=function(a,b,c,d,g){if(!v(a,b,c))throw"Edge not found";
a=a.edges;for(var e=0;e<a.length;e+=3)a[e]==b&&a[e+1]==c&&(a[e]=d,a[e+1]=g)};a.enforce_acyclic=function(a,b){function d(a,b){if(-1!=f.indexOf(a)){var c=f.slice(f.indexOf(a));if(-1!=e[c[c.length-1]].indexOf(c[0])){v.push([a,c[c.length-1]]);return}}f.push(a);for(c=0;c<b.length;c++)b[c]in e&&d(b[c],e[b[c]])}b||(b=m(a)[0]);var g=a.edges;if(!g.length)return a;for(var e={},k=0,p=0;p<g.length;p+=3)g[p+1]in e?e[g[p+1]].push(g[p]):e[g[p+1]]=[g[p]],k++;var f=[],v=[];d(b,e[b]);for(p=0;p<v.length;p++)for(var l=
k=0;l<g.length;l+=3)v[p][1]==g[l+1]&&v[p][0]==g[l]&&c(a,g[l],g[l+1],k),k++;return a};a.debug_dot=function(a,b,c){var d=a.nodes;a=a.edges;var g;g="digraph debug {\n    node [shape=box];\n";for(var e=0;e<d.length;e+=2){var k=d[e],p=d[e+1],p=b?b(k,p):String(k);g+="    ";g+=String(k)+' [label="'+p.replace(/\"/g,'\\"')+'"];\n'}for(e=0;e<a.length;e+=3)b=a[e],d=a[e+1],p=a[e+2],g+="    ",g+=String(b)+" -> "+String(d),c&&(g+=' [label="'+c(b,d,p)+'"]'),g+=";\n";return g+="}"}};b4w.module.__ipc=function(a,r){function u(a,b,c){for(var d=0;d<e.length;d+=2)e[d+1]==a&&(k[d+Number(!b)]=c)}function h(a){for(var b=0;b<a.length;b++){var c=a[b],d=0,e;for(e in c){var k=c[e];switch(k.constructor){case Float32Array:d+=k.length;break;case Number:d+=1}}--d;c.len=d}}a.IN_LOADED=0;var b=a.IN_COLLISION=1,l=a.IN_COLLISION_POS_NORM=2;a.IN_COLLISION_IMPULSE=3;a.IN_ERROR=4;a.IN_FBMSG=5;a.IN_FLOATER_BOB_TRANSFORM=6;a.IN_LOG=7;var c=a.IN_PROP_OFFSET=8,f=a.IN_RAY_HIT=9,n=a.IN_RAY_HIT_POS_NORM=
10;a.IN_REMOVE_RAY_TEST=11;var q=a.IN_TRANSFORM=12;a.IN_VEHICLE_SPEED=13;a.IN_PING=14;a.IN_FPS=15;a.IN_DEBUG_STATS=16;a.OUT_INIT=100;a.OUT_ACTIVATE=101;a.OUT_ADD_BOAT_BOB=102;a.OUT_ADD_CAR_WHEEL=103;a.OUT_ADD_FLOATER_BOB=104;a.OUT_APPEND_BOUNDING_BODY=105;a.OUT_APPEND_BOAT=106;a.OUT_APPEND_CAR=107;a.OUT_APPEND_CHARACTER=108;a.OUT_APPEND_COLLISION_TEST=109;a.OUT_APPEND_CONSTRAINT=110;a.OUT_APPEND_FLOATER=111;a.OUT_APPEND_GHOST_MESH_BODY=112;a.OUT_APPEND_STATIC_MESH_BODY=113;a.OUT_APPEND_WATER=114;
a.OUT_REMOVE_BODY=115;a.OUT_APPLY_CENTRAL_FORCE=116;a.OUT_APPLY_COLLISION_IMPULSE_TEST=117;a.OUT_APPLY_TORQUE=118;a.OUT_CHARACTER_JUMP=119;a.OUT_CHARACTER_ROTATION_INCREMENT=120;a.OUT_CLEAR_COLLISION_IMPULSE_TEST=121;a.OUT_DISABLE_SIMULATION=122;a.OUT_ENABLE_SIMULATION=123;a.OUT_PAUSE=124;a.OUT_APPEND_RAY_TEST=125;a.OUT_REMOVE_RAY_TEST=126;a.OUT_CHANGE_RAY_TEST_FROM_TO=127;a.OUT_REMOVE_COLLISION_TEST=128;a.OUT_REMOVE_CONSTRAINT=129;a.OUT_RESUME=130;a.OUT_SET_CHARACTER_FLY_VELOCITY=131;a.OUT_SET_CHARACTER_HOR_ROTATION=
132;a.OUT_SET_CHARACTER_MOVE_DIR=133;a.OUT_SET_CHARACTER_MOVE_TYPE=134;a.OUT_SET_CHARACTER_ROTATION=135;a.OUT_SET_CHARACTER_RUN_VELOCITY=136;a.OUT_SET_CHARACTER_VERT_ROTATION=137;a.OUT_SET_CHARACTER_WALK_VELOCITY=138;a.OUT_SET_GRAVITY=139;a.OUT_SET_LINEAR_VELOCITY=140;var d=a.OUT_SET_TRANSFORM=141;a.OUT_SET_WATER_TIME=142;a.OUT_ADD_WATER_WRAPPER=143;a.OUT_UPDATE_BOAT_CONTROLS=144;a.OUT_UPDATE_CAR_CONTROLS=145;a.OUT_PING=146;a.OUT_DEBUG=147;a.OUT_UPDATE_WORLD=148;var k=b4w.worker_listeners,e=b4w.worker_namespaces,
m={msg_id:q,body_id:0,time:0,trans:new Float32Array(3),quat:new Float32Array(4),linvel:new Float32Array(3),angvel:new Float32Array(3),len:0},B={msg_id:c,chassis_hull_body_id:0,prop_ind:0,trans:new Float32Array(3),quat:new Float32Array(4),len:0},N={msg_id:f,id:0,body_id_hit:0,hit_fract:0,hit_time:0,len:0},G={msg_id:n,id:0,body_id_hit:0,hit_fract:0,hit_time:0,hit_pos:new Float32Array(3),hit_norm:new Float32Array(3),len:0},w={msg_id:b,body_id_a:0,body_id_b:0,result:0,len:0},t={msg_id:l,body_id_a:0,body_id_b:0,
result:0,coll_point:new Float32Array(3),coll_norm:new Float32Array(3),coll_dist:0,len:0},C={msg_id:d,body_id:0,trans:new Float32Array(3),quat:new Float32Array(4),len:0},D=[m,B,N,G,w,t,C];a.create_worker=function(a,b){var c={is_main:a?!0:!1,web_worker:null,buf_arr:[],fb_worker_ns:""};if(b)if(c.web_worker={addEventListener:function(a,b,d){"message"!=a&&panic("Wrong web worker event");u(c.fb_worker_ns,c.is_main,b)},removeEventListener:function(a,b,d){"message"!=a&&panic("Wrong web worker event");u(c.fb_worker_ns,
c.is_main,null)},postMessage:function(a,b){var d;a:{for(d=0;d<e.length;d+=2)if(e[d+1]==c.fb_worker_ns){d=k[d+Number(!!c.is_main)];break a}d=null}d({data:a})},terminate:function(){for(var a=0;a<e.length;a+=2)if(e[a+1]==c.fb_worker_ns){k.splice(a,2);e.splice(a,2);break}}},c.is_main){var d=r("__util"),f=r("__container"),m=b4w.get_namespace(r),d=d.unique_name(m+"_worker");e.push(m);e.push(d);k.push(null);k.push(null);c.fb_worker_ns=d;f.find_script(a)?(f=f.find_script(a),f.addEventListener("load",function(){b4w.require("__bindings",
c.fb_worker_ns)},!1)):(f=document.createElement("script"),f.src=a,f.defer="defer",f.async="async",f.addEventListener("load",function(){b4w.require("__bindings",c.fb_worker_ns)},!1),document.head.appendChild(f))}else c.fb_worker_ns=b4w.get_namespace(r);else c.web_worker=a?new Worker(a):self;return c};a.attach_handler=function(a,g){h(D);var e=function(k){if(k.constructor==ArrayBuffer)k=new Float32Array(k);else if(k[0].constructor==ArrayBuffer){for(var h=0;h<k.length;h++)e(k[h]);return}h=k[0]|0;switch(h){case q:var z=
m;z.body_id=k[1]|0;z.time=k[2];z.trans[0]=k[3];z.trans[1]=k[4];z.trans[2]=k[5];z.quat[0]=k[6];z.quat[1]=k[7];z.quat[2]=k[8];z.quat[3]=k[9];z.linvel[0]=k[10];z.linvel[1]=k[11];z.linvel[2]=k[12];z.angvel[0]=k[13];z.angvel[1]=k[14];z.angvel[2]=k[15];break;case c:z=B;z.chassis_hull_body_id=k[1]|0;z.prop_ind=k[2]|0;z.trans[0]=k[3];z.trans[1]=k[4];z.trans[2]=k[5];z.quat[0]=k[6];z.quat[1]=k[7];z.quat[2]=k[8];z.quat[3]=k[9];break;case f:z=N;z.id=k[1]|0;z.body_id_hit=k[2]|0;z.hit_fract=k[3];z.hit_time=k[4];
break;case n:z=G;z.id=k[1]|0;z.body_id_hit=k[2]|0;z.hit_fract=k[3];z.hit_time=k[4];z.hit_pos[0]=k[5];z.hit_pos[1]=k[6];z.hit_pos[2]=k[7];z.hit_norm[0]=k[8];z.hit_norm[1]=k[9];z.hit_norm[2]=k[10];break;case b:z=w;z.body_id_a=k[1]|0;z.body_id_b=k[2]|0;z.result=!!k[3];break;case l:z=t;z.body_id_a=k[1]|0;z.body_id_b=k[2]|0;z.result=!!k[3];z.coll_point[0]=k[4];z.coll_point[1]=k[5];z.coll_point[2]=k[6];z.coll_norm[0]=k[7];z.coll_norm[1]=k[8];z.coll_norm[2]=k[9];z.coll_dist=k[10];break;case d:z=C;z.body_id=
k[1]|0;z.trans[0]=k[2];z.trans[1]=k[3];z.trans[2]=k[4];z.quat[0]=k[5];z.quat[1]=k[6];z.quat[2]=k[7];z.quat[3]=k[8];break;default:z=k}g(a,h,z)};a.web_worker.addEventListener("message",function(a){e(a.data)},!1)};a.cleanup=function(){};a.post_msg=function(a,g){if(a)switch(g){case q:var e=m,k=new Float32Array(e.len);k[0]=e.msg_id;k[1]=e.body_id;k[2]=e.time;k[3]=e.trans[0];k[4]=e.trans[1];k[5]=e.trans[2];k[6]=e.quat[0];k[7]=e.quat[1];k[8]=e.quat[2];k[9]=e.quat[3];k[10]=e.linvel[0];k[11]=e.linvel[1];k[12]=
e.linvel[2];k[13]=e.angvel[0];k[14]=e.angvel[1];k[15]=e.angvel[2];a.buf_arr.push(k.buffer);break;case c:e=B;k=new Float32Array(e.len);k[0]=e.msg_id;k[1]=e.chassis_hull_body_id;k[2]=e.prop_ind;k[3]=e.trans[0];k[4]=e.trans[1];k[5]=e.trans[2];k[6]=e.quat[0];k[7]=e.quat[1];k[8]=e.quat[2];k[9]=e.quat[3];a.buf_arr.push(k.buffer);break;case f:e=N;k=new Float32Array(e.len);k[0]=e.msg_id;k[1]=e.id;k[2]=e.body_id_hit;k[3]=e.hit_fract;k[4]=e.hit_time;a.buf_arr.push(k.buffer);break;case n:e=G;k=new Float32Array(e.len);
k[0]=e.msg_id;k[1]=e.id;k[2]=e.body_id_hit;k[3]=e.hit_fract;k[4]=e.hit_time;k[5]=e.hit_pos[0];k[6]=e.hit_pos[1];k[7]=e.hit_pos[2];k[8]=e.hit_norm[0];k[9]=e.hit_norm[1];k[10]=e.hit_norm[2];a.buf_arr.push(k.buffer);break;case b:e=w;k=new Float32Array(e.len);k[0]=e.msg_id;k[1]=e.body_id_a;k[2]=e.body_id_b;k[3]=e.result;a.buf_arr.push(k.buffer);break;case l:e=t;k=new Float32Array(e.len);k[0]=e.msg_id;k[1]=e.body_id_a;k[2]=e.body_id_b;k[3]=e.result;k[4]=e.coll_point[0];k[5]=e.coll_point[1];k[6]=e.coll_point[2];
k[7]=e.coll_norm[0];k[8]=e.coll_norm[1];k[9]=e.coll_norm[2];k[10]=e.coll_dist;a.buf_arr.push(k.buffer);break;case d:e=C;k=new Float32Array(e.len);k[0]=e.msg_id;k[1]=e.body_id;k[2]=e.trans[0];k[3]=e.trans[1];k[4]=e.trans[2];k[5]=e.quat[0];k[6]=e.quat[1];k[7]=e.quat[2];k[8]=e.quat[3];a.buf_arr.push(k.buffer);break;default:k=[];for(e=1;e<arguments.length;e++)k.push(arguments[e]);a.web_worker.postMessage(k)}};a.post_msg_arr=function(a){a&&a.buf_arr.length&&(a.web_worker.postMessage(a.buf_arr),a.buf_arr.length=
0)};a.get_msg_cache=function(a){switch(a){case q:return m;case c:return B;case f:return N;case n:return G;case b:return w;case l:return t;case d:return C;default:return null}};a.terminate=function(a){a.web_worker.terminate();a.web_worker=null};a.is_active=function(a){return!!a.web_worker};a.is_fallback=function(a){return!!a.fb_worker_ns}};b4w.module.__hud=function(a,r){function u(a){a.font="bold 15px Courier";a.textBaseline="middle";a.shadowBlur=0;a.shadowColor=null}function h(a){b(' SCENE "'+a.name+'"');if(a._render){var c=0,d=0;q.traverse(a._render.graph,function(a,e){if("SINK"==e.type)b(" (F)",e.type);else{var k=e.type,f=Math.round(e.camera.width)+"x"+Math.round(e.camera.height),m=e.bundles.length,p=e.debug_render_calls;"MAIN_CUBE_REFLECT"==e.type&&(m*=6);var g=e.enqueue&&e.do_render;g?b(" (A)",k,e.num_lights,f,p,"of",m):b(" (P)",
k,e.num_lights,f,p,"of",m);e.debug_render_calls=0;g&&(c+=m,d+=p)}});return[c,d]}b("No INFO")}function b(){for(var a=80+20*e[0],b=arguments[0],c=1;c<arguments.length;c++){for(var f=d[c]-String(arguments[c]).length,l="",h=0;h<f;h++)l+=" ";b+=l+arguments[c]}e[0]++;k.fillText(b,30,a)}function l(a,b,c,d,e){e.x=a;e.y=b;e.w=c;e.h=d;return e}function c(a,b,c){b*=a.w;c.x=a.x+b;c.y=a.y;c.w=a.w-2*b;c.h=a.h;return c}function f(a){return a.x+a.w/2}function n(a){var b=k,d={x:0,y:0,w:0,h:0};l(0,0,b.canvas.width,
b.canvas.height,d);c(d,.01,d);b=.02*d.h;d.x=d.x;d.y+=b;d.w=d.w;d.h-=2*b;b=d.w/8;d.x+=b*a;d.y=d.y;d.w=b;d.h=d.h;c(d,.02,d);return d}var q=r("__graph");r("__print");var d=[5,19,3,10,4,3,5],k=null,e=[0,0];a.init=function(a){a=a.getContext("2d");u(a);return k=a};a.update_dim=function(){k&&u(k)};a.reset=function(){var a=k;a&&(a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="rgba(0,0,0,0.5)",a.fillRect(0,0,a.canvas.width,a.canvas.height),e[0]=0,e[1]=0)};a.show_debug_info=function(a,c){var d=
k;if(d){d.textAlign="left";d.fillStyle="rgba(0,255,0,255)";b(" FPS",(1/c).toFixed(2));e[0]++;for(var f=d=0,l=0;l<a.length;l++){var t=h(a[l]),d=d+t[0],f=f+t[1];e[0]++}b(" -----------------------------------------------");b("    ","TOTAL ACTIVE","","",f,"of",d)}};a.print=function(){var a=k;a&&(a.textAlign="left",a.fillStyle="rgba(0,255,0,255)",b.apply(Math,arguments))};a.plot_array=function(a,b,c,d,e,l,h){var q=k;if(q){b=n(b);var p=b.h/5;b.x=b.x;b.y+=4*p;b.w=b.w;b.h=p;q.textAlign="center";q.fillStyle=
"#00FF00";k.fillText(a,f(b),b.y-10);q.strokeStyle="#00FF00";q.lineWidth=.5;q.beginPath();q.moveTo(b.x,b.y);q.lineTo(b.x+b.w,b.y);q.lineTo(b.x+b.w,b.y+b.h);q.lineTo(b.x,b.y+b.h);q.closePath();q.stroke();if(!l&&!h)for(l=1E6,h=-1E6,a=0;a<c.length;a++)l=Math.min(l,c[a]),h=Math.max(h,c[a]);q.textAlign="right";k.fillText(String(l),b.x-10,b.y+b.h);k.fillText(String(h),b.x-10,b.y);q.textAlign="center";k.fillText(String(d),b.x,b.y+b.h+15);k.fillText(String(e),b.x+b.w,b.y+b.h+15);q.strokeStyle="#FF0000";q.lineWidth=
1.5;q.beginPath();d=b.w/(c.length-1);h=b.h/(h-l);for(a=0;a<c.length;a++)e=b.x+d*a,p=b.y+b.h-(c[a]-l)*h,0==a?q.moveTo(e,p):q.lineTo(e,p);q.stroke()}};a.draw_mixer_strip=function(a,b,c,d,e,h,q){var D=k;if(D)for(D.textAlign="center",D.fillStyle="#00FF00",D.font="bold 12px Courier",c=n(c),k.fillText(b?"["+a+"]":a,f(c),c.y),0<=h&&k.fillText(h?"[M]":"[ ]",f(c)-15,c.y+30),0<=q&&k.fillText(q?"[S]":"[ ]",f(c)+15,c.y+30),a={x:0,y:0,w:0,h:0},b=0;b<d.length;b++){var p=d[b];(q="VOLUME"==p[0])?l(c.x,c.y+350,c.w,
250,a):l(c.x,c.y+10+50*b,c.w,c.h,a);h=D;var g=a,y=b==e,v=p[0],u=p[1],z=p[2],H=p[3],F=p[5],p=(H-z)/p[4],p=1>p?Math.floor(1/p-1E-5).toFixed(0).length:0,F=F?Math.log(u/z)/Math.log(H/z):(u-z)/(H-z);h.textAlign="center";y?h.fillText("["+v+"]",f(g),g.y):h.fillText(v,f(g),g.y);h.strokeStyle="#00FF00";h.lineWidth=q?3:1;q?(h.textAlign="right",h.fillText(H.toFixed(p),f(g)-10,g.y+15),h.textAlign="right",h.fillText(z.toFixed(p),f(g)-10,g.y+g.h-15)):(h.textAlign="right",h.fillText(z.toFixed(p),g.x+28,g.y+15),
h.textAlign="left",h.fillText(H.toFixed(p),g.x+g.w-28,g.y+15));h.beginPath();if(q){var L=g.y+15+(g.h-30)*(1-F);h.moveTo(f(g),g.y+15);h.lineTo(f(g),g.y+g.h-15);h.moveTo(f(g)-5,g.y+15);h.lineTo(f(g)+5,g.y+15);h.moveTo(f(g)-5,g.y+g.h-15);h.lineTo(f(g)+5,g.y+g.h-15);h.moveTo(f(g)-5,L);h.lineTo(f(g)+5,L)}else{var x=g.x+30+(g.w-60)*F;h.moveTo(g.x+30,g.y+15);h.lineTo(g.x+g.w-30,g.y+15);h.moveTo(g.x+30,g.y+15-5);h.lineTo(g.x+30,g.y+15+5);h.moveTo(g.x+g.w-30,g.y+15-5);h.lineTo(g.x+g.w-30,g.y+15+5);h.moveTo(x,
g.y+15-5);h.lineTo(x,g.y+15+5)}h.stroke();"EQ_Q"==v?(y=u,y=1+1/(2*y*y)+Math.sqrt((2+1/(y*y))*(2+1/(y*y))/4-1),y=Math.log(y)/Math.log(2),q?(h.textAlign="left",h.fillText(u.toFixed(p),f(g)+10,L),h.textAlign="left",h.fillText("("+y.toFixed(p+1)+")",f(g)+10,L+10)):(h.textAlign="right",h.fillText(u.toFixed(p),x,g.y+30),h.textAlign="left",h.fillText("("+y.toFixed(p+1)+")",x,g.y+30))):q?(h.textAlign="left",h.fillText(u.toFixed(p),f(g)+10,L)):(h.textAlign="center",h.fillText(u.toFixed(p),x,g.y+30))}}};b4w.module.__renderer=function(a,r){function u(a){for(var c=a.camera,d=a.bundles,k=0;k<d.length;k++){var f=d[k];if(f.do_render){var h=a,m=c,n=f.obj_render,F=f.batch,L=F.shader;t.useProgram(L.program);for(var f=F.bufs_data,x=F.attribute_setters,B=L.transient_uniform_setters,A=B.length;A--;){var q=B[A];q.fun(t,q.loc,h,n,F,m)}m=F.color_mask;t.colorMask(m,m,m,m);t.depthMask(F.depth_mask);F.use_backface_culling?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE);m=F.textures;for(F=0;F<m.length;F++)B=m[F],t.activeTexture(t.TEXTURE0+
F),t.bindTexture(B.w_target,B.w_texture);if("SKY"==h.type){m=h;L=L.uniforms;F=m.camera.color_attachment.w_texture;B=m.cube_view_matrices;for(A=0;6>A;A++)if(q=l(A),e.clear_procedural_sky_hack?(t.bindTexture(t.TEXTURE_CUBE_MAP,F),t.texImage2D(q,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,w)):(t.uniformMatrix4fv(L.u_cube_view_matrix,!1,B[A]),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,q,F,0),b(f,x,n.va_frame)),m.need_fog_update&&3!=A){var q=m,u=A,r=C;e.clear_procedural_sky_hack?r.set(w):(t.readPixels(191,
191,1,1,t.RGBA,t.UNSIGNED_BYTE,r),255!=r[0]&&255!=r[1]&&255!=r[2]||t.readPixels(191,220,1,1,t.RGBA,t.UNSIGNED_BYTE,r));var G=r[0],N=r[1],r=r[2],G=G/255,N=N/255,r=r/255;2===u?(q.cube_fog[3]=G,q.cube_fog[7]=N,q.cube_fog[11]=r):2>u?(q.cube_fog[4*u]=G,q.cube_fog[4*u+1]=N,q.cube_fog[4*u+2]=r):(q.cube_fog[4*(u-2)]=G,q.cube_fog[4*(u-2)+1]=N,q.cube_fog[4*(u-2)+2]=r)}h.debug_render_calls+=6}else b(f,x,n.va_frame),h.debug_render_calls++}}}function h(a){if(a){var b=(a.clear_color?t.COLOR_BUFFER_BIT:0)|(a.clear_depth?
t.DEPTH_BUFFER_BIT:0);if(!b)return;switch(a.type){case "MAIN_GLOW":a=G;break;case "SHADOW_CAST":a=m;break;case "DEPTH":a=B;break;case "COLOR_PICKING":case "COLOR_PICKING_XRAY":case "ANCHOR_VISIBILITY":a=N;break;case "OUTLINE_MASK":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_EDGE_DETECTION":a=G;break;default:a=e.background_color}}else b=t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT,a=e.background_color;t.colorMask(!0,!0,!0,!0);t.depthMask(!0);t.clearColor(a[0],a[1],a[2],a[3]);t.clear(b)}function b(a,
b,c,d){t.bindBuffer(t.ARRAY_BUFFER,a.vbo);for(d=0;d<b.length;d++){var e=b[d];t.enableVertexAttribArray(e.loc);t.vertexAttribPointer(e.loc,e.num_comp,t.FLOAT,!1,0,e.base_offset+e.frame_length*c)}a.ibo?(t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a.ibo),t.drawElements(a.mode,a.count,a.ibo_type,0)):t.drawArrays(a.mode,0,a.count);for(d=0;d<b.length;d++)e=b[d],t.disableVertexAttribArray(e.loc)}function l(a){switch(a){case 0:return t.TEXTURE_CUBE_MAP_POSITIVE_X;case 1:return t.TEXTURE_CUBE_MAP_NEGATIVE_X;case 2:return t.TEXTURE_CUBE_MAP_POSITIVE_Y;
case 3:return t.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 4:return t.TEXTURE_CUBE_MAP_POSITIVE_Z;case 5:return t.TEXTURE_CUBE_MAP_NEGATIVE_Z}}function c(a){var b=a.uniforms,c=[],d=[],e={},k;for(k in b){var f=!1;switch(k){case "u_proj_matrix":var h=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.proj_matrix)},f=!0;break;case "u_view_matrix":case "u_view_matrix_frag":h=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.view_matrix)};f=!0;break;case "u_shadow_cast_billboard_view_matrix":h=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,
!1,g.shadow_cast_billboard_view_matrix)};f=!0;break;case "u_view_proj_prev":h=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.prev_view_proj_matrix)};f=!0;break;case "u_view_proj_inverse":h=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.view_proj_inv_matrix)};f=!0;break;case "u_sky_vp_inverse":h=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,g.sky_vp_inv_matrix)};f=!0;break;case "u_camera_eye":case "u_camera_eye_frag":h=function(a,b,c,d,e,g){a.uniform3fv(b,g.eye)};f=!0;break;case "u_camera_eye_last":h=
function(a,b,c,d,e,g){a.uniform3fv(b,g.eye_last)};f=!0;break;case "u_camera_quat":h=function(a,b,c,d,e,g){a.uniform4fv(b,g.quat)};f=!0;break;case "u_view_max_depth":h=function(a,b,c,d,e,g){a.uniform1f(b,g.far)};f=!0;break;case "u_camera_range":h=function(a,b,c,d,e,g){a.uniform2f(b,g.near,g.far)};break;case "u_csm_center_dists":h=function(a,b,c,d,e,g){a.uniform4fv(b,g.csm_center_dists)};break;case "u_cam_water_depth":h=function(a,b,c,d,e,g){a.uniform1f(b,c.cam_water_depth)};f=!0;break;case "u_waves_height":h=
function(a,b,c,d,e,g){a.uniform1f(b,c.water_waves_height)};break;case "u_waves_length":h=function(a,b,c,d,e,g){a.uniform1f(b,c.water_waves_length)};break;case "u_fog_color_density":h=function(a,b,c,d,e,g){a.uniform4fv(b,c.fog_color_density)};break;case "u_fog_params":h=function(a,b,c,d,e,g){a.uniform4fv(b,c.fog_params)};break;case "u_underwater_fog_color_density":h=function(a,b,c,d,e,g){a.uniform4fv(b,c.water_fog_color_density)};break;case "u_bloom_key":h=function(a,b,c,d,e,g){a.uniform1f(b,c.bloom_key)};
break;case "u_bloom_edge_lum":h=function(a,b,c,d,e,g){a.uniform1f(b,c.bloom_edge_lum)};break;case "u_time":h=function(a,b,c,d,e,g){a.uniform1f(b,c.time)};f=!0;break;case "u_wind":h=function(a,b,c,d,e,g){a.uniform3fv(b,c.wind)};f=!0;break;case "u_sky_tex_dvar":h=function(a,b,c,d,e,g){a.uniform1f(b,c.sky_tex_default_value)};break;case "u_sky_tex_fac":h=function(a,b,c,d,e,g){a.uniform4fv(b,c.sky_tex_fac)};break;case "u_sky_tex_color":h=function(a,b,c,d,e,g){a.uniform3fv(b,c.sky_tex_color)};break;case "u_horizon_color":h=
function(a,b,c,d,e,g){a.uniform3fv(b,c.horizon_color)};break;case "u_zenith_color":h=function(a,b,c,d,e,g){a.uniform3fv(b,c.zenith_color)};break;case "u_environment_energy":h=function(a,b,c,d,e,g){a.uniform1f(b,c.environment_energy)};break;case "u_sky_color":h=function(a,b,c,d,e,g){a.uniform3fv(b,c.sky_color)};break;case "u_rayleigh_brightness":h=function(a,b,c,d,e,g){a.uniform1f(b,c.rayleigh_brightness)};break;case "u_mie_brightness":h=function(a,b,c,d,e,g){a.uniform1f(b,c.mie_brightness)};break;
case "u_spot_brightness":h=function(a,b,c,d,e,g){a.uniform1f(b,c.spot_brightness)};break;case "u_scatter_strength":h=function(a,b,c,d,e,g){a.uniform1f(b,c.scatter_strength)};break;case "u_rayleigh_strength":h=function(a,b,c,d,e,g){a.uniform1f(b,c.rayleigh_strength)};break;case "u_mie_strength":h=function(a,b,c,d,e,g){a.uniform1f(b,c.mie_strength)};break;case "u_rayleigh_collection_power":h=function(a,b,c,d,e,g){a.uniform1f(b,c.rayleigh_collection_power)};break;case "u_mie_collection_power":h=function(a,
b,c,d,e,g){a.uniform1f(b,c.mie_collection_power)};break;case "u_mie_distribution":h=function(a,b,c,d,e,g){a.uniform1f(b,c.mie_distribution)};break;case "u_light_positions":h=function(a,b,c,d,e,g){a.uniform3fv(b,c.light_positions)};break;case "u_light_directions":h=function(a,b,c,d,e,g){a.uniform3fv(b,c.light_directions)};break;case "u_light_color_intensities":h=function(a,b,c,d,e,g){a.uniform3fv(b,c.light_color_intensities)};break;case "u_light_factors":h=function(a,b,c,d,e,g){a.uniform4fv(b,c.light_factors)};
break;case "u_sun_quaternion":h=function(a,b,c,d,e,g){a.uniform4fv(b,c.sun_quaternion)};break;case "u_sun_intensity":h=function(a,b,c,d,e,g){a.uniform3fv(b,c.sun_intensity)};break;case "u_sun_direction":h=function(a,b,c,d,e,g){a.uniform3fv(b,c.sun_direction)};break;case "u_height":h=function(a,b,c,d,e,g){a.uniform1f(b,g.height)};f=!0;break;case "u_model_matrix":h=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,d.world_matrix)};f=!0;break;case "u_transb":h=function(a,b,c,d,e,g){a.uniform4fv(b,d.trans_before)};
f=!0;break;case "u_transa":h=function(a,b,c,d,e,g){a.uniform4fv(b,d.trans_after)};f=!0;break;case "u_arm_rel_trans":h=function(a,b,c,d,e,g){a.uniform4fv(b,d.arm_rel_trans)};f=!0;break;case "u_arm_rel_quat":h=function(a,b,c,d,e,g){a.uniform4fv(b,d.arm_rel_quat)};f=!0;break;case "u_quat":h=function(a,b,c,d,e,g){a.uniform4fv(b,d.quat)};f=!0;break;case "u_quatsb":h=function(a,b,c,d,e,g){a.uniform4fv(b,d.quats_before)};f=!0;break;case "u_quatsa":h=function(a,b,c,d,e,g){a.uniform4fv(b,d.quats_after)};f=
!0;break;case "u_frame_factor":h=function(a,b,c,d,e,g){a.uniform1f(b,d.frame_factor)};f=!0;break;case "au_center_pos":h=function(a,b,c,d,e,g){};f=!0;break;case "au_wind_bending_amp":h=function(a,b,c,d,e,g){a.uniform1f(b,d.wind_bending_amp)};f=!0;break;case "au_wind_bending_freq":h=function(a,b,c,d,e,g){a.uniform1f(b,d.wind_bending_freq)};f=!0;break;case "au_detail_bending_freq":h=function(a,b,c,d,e,g){a.uniform1f(b,d.detail_bending_freq)};f=!0;break;case "au_detail_bending_amp":h=function(a,b,c,d,
e,g){a.uniform1f(b,d.detail_bending_amp)};f=!0;break;case "au_branch_bending_amp":h=function(a,b,c,d,e,g){a.uniform1f(b,d.branch_bending_amp)};f=!0;break;case "u_node_values":h=function(a,b,c,d,e,g){a.uniform1fv(b,d.mats_values)};f=!0;break;case "u_node_rgbs":h=function(a,b,c,d,e,g){a.uniform3fv(b,d.mats_rgbs)};f=!0;break;case "u_diffuse_color":h=function(a,b,c,d,e,g){a.uniform4fv(b,e.diffuse_color)};f=!0;break;case "u_diffuse_intensity":h=function(a,b,c,d,e,g){a.uniform1f(b,e.diffuse_intensity)};
f=!0;break;case "u_diffuse_params":h=function(a,b,c,d,e,g){a.uniform2fv(b,e.diffuse_params)};f=!0;break;case "u_emit":h=function(a,b,c,d,e,g){a.uniform1f(b,e.emit)};f=!0;break;case "u_ambient":h=function(a,b,c,d,e,g){a.uniform1f(b,e.ambient)};f=!0;break;case "u_specular_color":h=function(a,b,c,d,e,g){a.uniform3fv(b,e.specular_color)};f=!0;break;case "u_specular_alpha":h=function(a,b,c,d,e,g){a.uniform1f(b,e.specular_alpha)};f=!0;break;case "u_specular_params":h=function(a,b,c,d,e,g){a.uniform3fv(b,
e.specular_params)};f=!0;break;case "u_reflect_factor":h=function(a,b,c,d,e,g){a.uniform1f(b,e.reflect_factor)};f=!0;break;case "u_mirror_factor":h=function(a,b,c,d,e,g){a.uniform1f(b,e.mirror_factor)};f=!0;break;case "u_grass_map_dim":h=function(a,b,c,d,e,g){a.uniform3fv(b,e.grass_map_dim)};f=!0;break;case "u_grass_size":h=function(a,b,c,d,e,g){a.uniform1f(b,e.grass_size)};f=!0;break;case "u_scale_threshold":h=function(a,b,c,d,e,g){a.uniform1f(b,e.grass_scale_threshold)};f=!0;break;case "u_cube_fog":h=
function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,e.cube_fog)};break;case "u_jitter_amp":h=function(a,b,c,d,e,g){a.uniform1f(b,e.jitter_amp)};f=!0;break;case "u_jitter_freq":h=function(a,b,c,d,e,g){a.uniform1f(b,e.jitter_freq)};f=!0;break;case "u_wireframe_mode":h=function(a,b,c,d,e,g){a.uniform1i(b,e.wireframe_mode)};break;case "u_wireframe_edge_color":h=function(a,b,c,d,e,g){a.uniform3fv(b,e.wireframe_edge_color)};break;case "u_subpixel_jitter":h=function(a,b,c,d,e,g){a.uniform2fv(b,c.jitter_projection_space)};
f=!0;break;case "u_subsample_indices":h=function(a,b,c,d,e,g){a.uniform4fv(b,c.jitter_subsample_ind)};f=!0;break;case "u_refr_bump":h=function(a,b,c,d,e,g){a.uniform1f(b,e.refr_bump)};f=!0;break;case "u_lamp_light_positions":h=function(a,b,c,d,e,g){a.uniform3fv(b,e.lamp_light_positions)};break;case "u_lamp_light_directions":h=function(a,b,c,d,e,g){a.uniform3fv(b,e.lamp_light_directions)};break;case "u_lamp_light_color_intensities":h=function(a,b,c,d,e,g){a.uniform3fv(b,e.lamp_light_color_intensities)};
break;case "u_lamp_light_factors":h=function(a,b,c,d,e,g){a.uniform4fv(b,e.lamp_light_factors)};break;case "u_halo_size":h=function(a,b,c,d,e,g){a.uniform1f(b,e.halo_size)};f=!0;break;case "u_halo_hardness":h=function(a,b,c,d,e,g){a.uniform1f(b,e.halo_hardness)};f=!0;break;case "u_halo_rings_color":h=function(a,b,c,d,e,g){a.uniform3fv(b,e.halo_rings_color)};f=!0;break;case "u_halo_lines_color":h=function(a,b,c,d,e,g){a.uniform3fv(b,e.halo_lines_color)};f=!0;break;case "u_halo_stars_blend":h=function(a,
b,c,d,e,g){a.uniform1f(b,e.halo_stars_blend)};f=!0;break;case "u_halo_stars_height":h=function(a,b,c,d,e,g){a.uniform1f(b,e.halo_stars_height)};f=!0;break;case "u_fresnel_params":h=function(a,b,c,d,e,g){a.uniform4fv(b,e.fresnel_params)};f=!0;break;case "u_texture_scale":h=function(a,b,c,d,e,g){a.uniform3fv(b,e.texture_scale)};f=!0;break;case "u_parallax_scale":h=function(a,b,c,d,e,g){a.uniform1f(b,e.parallax_scale)};f=!0;break;case "u_color_id":h=function(a,b,c,d,e,g){a.uniform3fv(b,d.color_id)};
f=!0;break;case "u_line_points":h=function(a,b,c,d,e,g){a.uniform3fv(b,e.line_points)};f=!0;break;case "u_diffuse_color_factor":h=function(a,b,c,d,e,g){a.uniform1f(b,e.diffuse_color_factor)};f=!0;break;case "u_alpha_factor":h=function(a,b,c,d,e,g){a.uniform1f(b,e.alpha_factor)};f=!0;break;case "u_specular_color_factor":h=function(a,b,c,d,e,g){a.uniform1f(b,e.specular_color_factor)};f=!0;break;case "u_normal_factor":h=function(a,b,c,d,e,g){a.uniform1f(b,e.normal_factor)};f=!0;break;case "u_normalmap0_scale":h=
function(a,b,c,d,e,g){a.uniform2fv(b,e.normalmap_scales[0])};f=!0;break;case "u_normalmap1_scale":h=function(a,b,c,d,e,g){a.uniform2fv(b,e.normalmap_scales[1])};f=!0;break;case "u_normalmap2_scale":h=function(a,b,c,d,e,g){a.uniform2fv(b,e.normalmap_scales[2])};f=!0;break;case "u_normalmap3_scale":h=function(a,b,c,d,e,g){a.uniform2fv(b,e.normalmap_scales[3])};f=!0;break;case "u_foam_factor":h=function(a,b,c,d,e,g){a.uniform1f(b,e.foam_factor)};f=!0;break;case "u_foam_uv_freq":h=function(a,b,c,d,e,
g){a.uniform2fv(b,e.foam_uv_freq)};f=!0;break;case "u_foam_mag":h=function(a,b,c,d,e,g){a.uniform2fv(b,e.foam_mag)};f=!0;break;case "u_foam_scale":h=function(a,b,c,d,e,g){a.uniform2fv(b,e.foam_scale)};f=!0;break;case "u_water_norm_uv_velocity":h=function(a,b,c,d,e,g){a.uniform1f(b,e.water_norm_uv_velocity)};f=!0;break;case "u_shallow_water_col":h=function(a,b,c,d,e,g){a.uniform3fv(b,e.shallow_water_col)};f=!0;break;case "u_shore_water_col":h=function(a,b,c,d,e,g){a.uniform3fv(b,e.shore_water_col)};
f=!0;break;case "u_water_shallow_col_fac":h=function(a,b,c,d,e,g){a.uniform1f(b,e.shallow_water_col_fac)};f=!0;break;case "u_water_shore_col_fac":h=function(a,b,c,d,e,g){a.uniform1f(b,e.shore_water_col_fac)};f=!0;break;case "u_p_length":h=function(a,b,c,d,e,g){a.uniform1f(b,e.particles_data.time_length)};f=!0;break;case "u_p_cyclic":h=function(a,b,c,d,e,g){a.uniform1i(b,e.particles_data.cyclic)};f=!0;break;case "u_p_max_lifetime":h=function(a,b,c,d,e,g){a.uniform1f(b,e.particles_data.lifetime)};f=
!0;break;case "u_p_fade_in":h=function(a,b,c,d,e,g){a.uniform1f(b,e.particles_data.fade_in)};f=!0;break;case "u_p_fade_out":h=function(a,b,c,d,e,g){a.uniform1f(b,e.particles_data.fade_out)};f=!0;break;case "u_p_size":h=function(a,b,c,d,e,g){a.uniform1f(b,e.particles_data.size)};f=!0;break;case "u_p_alpha_start":h=function(a,b,c,d,e,g){a.uniform1f(b,e.particles_data.alpha_start)};f=!0;break;case "u_p_alpha_end":h=function(a,b,c,d,e,g){a.uniform1f(b,e.particles_data.alpha_end)};f=!0;break;case "u_p_nfactor":h=
function(a,b,c,d,e,g){a.uniform1f(b,e.particles_data.nfactor)};f=!0;break;case "u_p_gravity":h=function(a,b,c,d,e,g){a.uniform1f(b,e.particles_data.gravity)};f=!0;break;case "u_p_mass":h=function(a,b,c,d,e,g){a.uniform1f(b,e.particles_data.mass)};f=!0;break;case "u_p_size_ramp":h=function(a,b,c,d,e,g){a.uniform2fv(b,e.particles_data.size_ramp)};f=!0;break;case "u_p_color_ramp":h=function(a,b,c,d,e,g){a.uniform4fv(b,e.particles_data.color_ramp)};f=!0;break;case "u_p_wind_fac":h=function(a,b,c,d,e,
g){a.uniform1f(b,e.particles_data.wind_factor)};f=!0;break;case "u_texel_size":h=function(a,b,c,d,e,g){a.uniform2fv(b,c.texel_size)};f=!0;break;case "u_p_time":h=function(a,b,c,d,e,g){a.uniform1f(b,e.particles_data.time)};f=!0;break;case "u_position":h=function(a,b,c,d,e,g){a.uniform3fv(b,e.positions)};f=!0;break;case "u_va_frame_factor":h=function(a,b,c,d,e,g){a.uniform1f(b,d.va_frame_factor)};f=!0;break;case "u_perspective_cast_far_bound":h=function(a,b,c,d,e,g){a.uniform1f(b,c.perspective_cast_far_bound)};
break;case "u_normal_offset":h=function(a,b,c,d,e,g){a.uniform1f(b,c.self_shadow_normal_offset)};break;case "u_pcf_blur_radii":h=function(a,b,c,d,e,g){a.uniform4fv(b,g.pcf_blur_radii)};break;case "u_v_light_matrix":h=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,c.v_light_matrix)};f=!0;break;case "u_b_light_matrix":h=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,c.b_light_matrix)};break;case "u_p_light_matrix0":h=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,c.p_light_matrix[0])};f=!0;break;case "u_p_light_matrix1":h=
function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,c.p_light_matrix[1])};f=!0;break;case "u_p_light_matrix2":h=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,c.p_light_matrix[2])};f=!0;break;case "u_p_light_matrix3":h=function(a,b,c,d,e,g){a.uniformMatrix4fv(b,!1,c.p_light_matrix[3])};f=!0;break;case "u_motion_blur_exp":h=function(a,b,c,d,e,g){a.uniform1f(b,c.motion_blur_exp)};f=!0;break;case "u_motion_blur_decay_threshold":h=function(a,b,c,d,e,g){a.uniform1f(b,c.mb_decay_threshold)};f=!0;break;case "u_refl_plane":h=
function(a,b,c,d,e,g){a.uniform4fv(b,d.reflection_plane)};f=!0;break;case "u_radial_blur_step":h=function(a,b,c,d,e,g){a.uniform1f(b,c.radial_blur_step)};break;case "u_god_rays_intensity":h=function(a,b,c,d,e,g){a.uniform1f(b,c.god_rays_intensity)};break;case "u_ssao_radius_increase":h=function(a,b,c,d,e,g){a.uniform1f(b,c.ssao_radius_increase)};break;case "u_ssao_blur_discard_value":h=function(a,b,c,d,e,g){a.uniform1f(b,c.ssao_blur_discard_value)};f=!0;break;case "u_ssao_influence":h=function(a,
b,c,d,e,g){a.uniform1f(b,c.ssao_influence)};break;case "u_ssao_dist_factor":h=function(a,b,c,d,e,g){a.uniform1f(b,c.ssao_dist_factor)};break;case "u_dof_dist":h=function(a,b,c,d,e,g){a.uniform1f(b,g.dof_distance)};f=!0;break;case "u_dof_front":h=function(a,b,c,d,e,g){a.uniform1f(b,g.dof_front)};f=!0;break;case "u_dof_rear":h=function(a,b,c,d,e,g){a.uniform1f(b,g.dof_rear)};f=!0;break;case "u_outline_intensity":h=function(a,b,c,d,e,g){a.uniform1f(b,d.outline_intensity)};f=!0;break;case "u_outline_color":h=
function(a,b,c,d,e,g){a.uniform3fv(b,c.outline_color)};break;case "u_draw_outline":h=function(a,b,c,d,e,g){a.uniform1f(b,c.draw_outline_flag)};f=!0;break;case "u_glow_mask_small_coeff":h=function(a,b,c,d,e,g){a.uniform1f(b,c.small_glow_mask_coeff)};f=!0;break;case "u_glow_mask_large_coeff":h=function(a,b,c,d,e,g){a.uniform1f(b,c.large_glow_mask_coeff)};f=!0;break;case "u_brightness":h=function(a,b,c,d,e,g){a.uniform1f(b,c.brightness)};break;case "u_contrast":h=function(a,b,c,d,e,g){a.uniform1f(b,
c.contrast)};break;case "u_exposure":h=function(a,b,c,d,e,g){a.uniform1f(b,c.exposure)};break;case "u_saturation":h=function(a,b,c,d,e,g){a.uniform1f(b,c.saturation)};break;default:h=null}h&&(h={name:k,fun:h,loc:b[k]},f?c.push(h):(d.push(h),e[k]=h))}a.transient_uniform_setters=c;a.permanent_uniform_setters=d;a.permanent_uniform_setters_table=e}var f=r("__camera"),n=r("__config"),q=r("__debug"),d=r("__textures"),k=r("__util"),e=n.defaults,m=[1,1,1,1],B=[1,1,1,1],N=[0,0,0,1],G=[0,0,0,0],w=new Uint8Array([91.8,
142.8,.96*255,255]);new Float32Array([.25,-.25]);new Float32Array([-.25,.25]);new Float32Array([1,1,1,0]);new Float32Array([2,2,2,0]);var t=null,C=new Uint8Array(4);a.setup_context=function(a){var b=e.background_color;a.clearColor(b[0],b[1],b[2],b[3]);a.clearDepth(1);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.enable(a.CULL_FACE);a.frontFace(a.CCW);a.cullFace(a.BACK);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);t=a};a.draw=function(a){if(a.do_render){var b=a.camera;t.bindFramebuffer(t.FRAMEBUFFER,
b.framebuffer);if(a.assign_texture){var d=b.color_attachment;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,d.w_target,d.w_texture,0)}t.viewport(0,0,b.width,b.height);"MAIN_CUBE_REFLECT"!=a.type&&h(a);a.blend?t.enable(t.BLEND):t.disable(t.BLEND);a.depth_test?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST);if(a.need_perm_uniforms_update){for(var b=a.camera,d=a.bundles,k=0;k<d.length;k++){var m=d[k],n=m.batch,z=n.shader;t.useProgram(z.program);m=m.obj_render;z.permanent_uniform_setters.length||
c(z);for(var z=z.permanent_uniform_setters,B=z.length;B--;){var F=z[B];F.fun(t,F.loc,a,m,n,b)}}a.need_perm_uniforms_update=!1}switch(a.type){case "DEPTH":e.ios_depth_hack?(t.enable(t.POLYGON_OFFSET_FILL),t.polygonOffset(5,5)):t.disable(t.POLYGON_OFFSET_FILL);t.cullFace(t.BACK);break;case "SHADOW_CAST":t.enable(t.POLYGON_OFFSET_FILL);t.polygonOffset(a.self_shadow_polygon_offset,a.self_shadow_polygon_offset);t.cullFace(t.BACK);break;case "MAIN_PLANE_REFLECT":t.disable(t.POLYGON_OFFSET_FILL);t.cullFace(t.FRONT);
break;default:t.disable(t.POLYGON_OFFSET_FILL),t.cullFace(t.BACK)}if("MAIN_CUBE_REFLECT"==a.type)for(b=a.camera,d=b.color_attachment.w_texture,k=0;6>k;k++){n=l(k);b.view_matrix=a.cube_view_matrices[k];f.calc_sky_vp_inverse(b);t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,n,d,0);h(a);n=a.bundles;for(m=0;m<n.length;m++)n[m].do_render=n[m].do_render_cube[k];u(a)}else u(a);q.check_gl("draw subscene: "+a.type);t.bindFramebuffer(t.FRAMEBUFFER,null)}};a.clear=function(a){t.bindFramebuffer(t.FRAMEBUFFER,
a.camera.framebuffer);h(a)};a.assign_attribute_setters=function(a){var b=a.attribute_setters;b.length=0;var c=a.bufs_data;a=a.shader;c&&a||k.panic("Incomplete batch");c=c.pointers;a=a.attributes;for(var d in a){var e=c[d];b.push({loc:a[d],base_offset:4*e.offset,frame_length:1<e.frames?4*e.length:0,num_comp:e.num_comp})}};a.assign_uniform_setters=c;a.assign_texture_uniforms=function(a){var b=a.shader,c=a.textures;a=a.texture_names;t.useProgram(b.program);for(var d=0;d<c.length;d++)t.uniform1i(b.uniforms[a[d]],
d)};a.read_pixels=function(a,b,c,d,e,f){d||(d=1);e||(e=1);f||(f=new Uint8Array(4*d*e));f.length!=4*d*e&&k.panic("read_pixels(): Wrong storage");t.bindFramebuffer(t.FRAMEBUFFER,a);t.readPixels(b,c,d,e,t.RGBA,t.UNSIGNED_BYTE,f);t.bindFramebuffer(t.FRAMEBUFFER,null);return f};a.update_batch_permanent_uniform=function(a,b){var d=a.shader;t.useProgram(d.program);d.permanent_uniform_setters.length||c(d);d=d.permanent_uniform_setters_table[b];d.fun(t,d.loc,null,null,a,null)};a.render_target_create=function(a,
b){var c=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,c);if(a){var e=a,k=e.w_texture,e=e.w_target==t.TEXTURE_CUBE_MAP?t.TEXTURE_CUBE_MAP_NEGATIVE_Z:e.w_target;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,e,k,0)}d.is_renderbuffer(b)?t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,b.w_renderbuffer):d.is_texture(b)&&(e=b,k=e.w_texture,e=e.w_target,t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,e,k,0));q.check_bound_fb();t.bindFramebuffer(t.FRAMEBUFFER,
null);return c};a.render_target_cleanup=function(a,b,c,e,k){null==a?(t.bindFramebuffer(t.FRAMEBUFFER,a),t.viewport(0,0,e,k),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)):(d.is_texture(b)&&t.deleteTexture(b.w_texture),d.is_renderbuffer(c)?t.deleteRenderbuffer(c.w_renderbuffer):d.is_texture(c)&&t.deleteTexture(c.w_texture),t.deleteFramebuffer(a))};a.increment_subpixel_index=function(){};a.cleanup=function(){}};b4w.module.__shaders=function(a,r){function u(a,b,c){var d=a.directives;"string"==typeof c&&(a=h(a,c))&&(c=a[1]);for(a=0;a<d.length;a++)if(d[a][0]==b){d[a][1]=c;return}d.push([b,c])}function h(a,b){for(var c=a.directives,d=0;d<c.length;d++)if(c[d][0]==b)return c[d];return!1}function b(a,b){var c=a+b;if(t[c])return t[c];if(C){var d=C[b];if(!d)return null;d=r("__gpp_parser").parser.parse(d)}else if(d=r("shader_texts")[b],!d)return null;return t[c]=d}function l(a,d,e){function g(d){d=d.parts;for(var e=
0;e<d.length;e++){var m=d[e];switch(m.type){case "condition":a:for(var m=m.parts,z=0;z<m.length;z++){var y=m[z];switch(y.type){case "if":case "elif":if(k(y.expression)){g(y.group);break a}break;case "else":g(y.group);break a;case "ifdef":y.name in l&&g(y.group);break;case "ifndef":y.name in l||g(y.group)}}break;case "include":m=b(G.shaders_dir,G.shaders_include_dir+m.file);g(m);break;case "var":case "export":case "import":break;case "define":z=m.name;l[z]=m.tokens;m.params&&(t[z]=m.params);break;
case "error":throw"Shader error: #error "+m.tokens.join(" ");case "line":break;case "pragma":p.push("#pragma "+m.name+" "+m.tokens.join(" "));break;case "undef":m=m.name;delete l[m];delete t[m];break;case "warning":B.warn("Shader warning: #warning "+m.tokens.join(" "));break;case "extension":m=c(m.tokens,l,t,!1);p.push("#extension "+m.join(" "));break;case "#":break;case "node":n[m.name]=m;break;case "nodes_global":m=h;for(z=0;z<m.length;z++){var y=m[z],P=n[y.id];if(P)for(var u=0,E=0;E<P.declarations.length;E++){var T=
P.declarations[E];"node_param"==T.type&&(T=T.qualifier.join(" ")+" ","vert"==a?T+=y.vparams[u]:"frag"==a&&(T+=y.params[u],null!==y.param_values[u]&&(T+=" = "+y.param_values[u])),T+=";",p.push(T),u++)}}break;case "nodes_main":m=h;for(z=0;z<m.length;z++)if(y=m[z],P=n[y.id]){u={};E={};for(T=0;T<y.dirs.length;T++)E[y.dirs[T][0]]=[y.dirs[T][1]];w=D=C=0;for(var T=y,da=P.declarations,r=u,O=E,N=0;N<da.length;N++){var I=da[N];switch(I.type){case "node_in":var Y=T.inputs[C];if(null!==T.input_values[C]){if(("MATERIAL_BEGIN"==
T.id&&3===C||!O.MATERIAL_EXT&&("MATERIAL_BEGIN"==T.id&&4===C||"MATERIAL_END"==T.id&&3===C||"MATERIAL_END"==T.id&&4===C||"MATERIAL_END"==T.id&&5===C)||"TEXTURE_COLOR"==T.id||"TEXTURE_NORMAL"==T.id)&&I.is_optional){r[I.name]=T.input_values[C];C++;continue}var ma=I.qualifier.join(" ")+" ",ma=ma+Y,ma=ma+(" = "+T.input_values[C]),ma=ma+";";p.push(ma)}r[I.name]=Y;C++;break;case "node_out":Y=T.outputs[D];if(!I.is_optional||-1<q.indexOf(Y))ma=I.qualifier.join(" ")+" ",ma+=Y,ma+=";",p.push(ma),r[I.name]=Y;
-1<q.indexOf(Y)&&(O["USE_OUT_"+I.name]=[1]);D++;break;case "node_param":"vert"==a?Y=T.vparams[w]:"frag"==a&&(Y=T.params[w]),r[I.name]=Y,w++}}p.push("{");f(y,P.statements,u,E);p.push("}")}break;case "textline":m=c(m.tokens,l,t,!1);p.push(m.join(" "));break;default:throw"Unknown element type: "+m.type;}}}function k(a,b){var d;d=c(a,l,t,!0,b);for(var e=[],g=0;g<d.length;g++)if(d[g]instanceof Object)switch(d[g].type){case "conditional_expr":var f=e.pop(),h=e.pop();e.pop()?e.push(h):e.push(f);break;case "logical_or_expr":f=
e.pop();for(h=0;h<d[g].places-1;h++)p=e.pop(),f=f||p;e.push(f);break;case "logical_and_expr":f=e.pop();for(h=0;h<d[g].places-1;h++)p=e.pop(),f=f&&p;e.push(f);break;case "logical_bitor_expr":f=e.pop();for(h=0;h<d[g].places-1;h++)f|=e.pop();e.push(f);break;case "logical_bitxor_expr":f=e.pop();for(h=0;h<d[g].places-1;h++)f^=e.pop();e.push(f);break;case "logical_bitand_expr":f=e.pop();for(h=0;h<d[g].places-1;h++)f&=e.pop();e.push(f);break;case "equal_expr":f=e.pop();h=e.pop();e.push(h==f);break;case "non_equal_expr":f=
e.pop();h=e.pop();e.push(h!=f);break;case "le_expr":f=e.pop();h=e.pop();e.push(h<=f);break;case "ge_expr":f=e.pop();h=e.pop();e.push(h>=f);break;case "l_expr":f=e.pop();h=e.pop();e.push(h<f);break;case "g_expr":f=e.pop();h=e.pop();e.push(h>f);break;case "left_shift_expr":h=e.pop();f=e.pop();e.push(h<<f);break;case "right_shift_expr":h=e.pop();f=e.pop();e.push(h>>f);break;case "add_expr":h=e.pop();f=e.pop();e.push(h+f);break;case "sub_expr":h=e.pop();f=e.pop();e.push(h-f);break;case "mul_expr":h=e.pop();
f=e.pop();e.push(h*f);break;case "div_expr":h=e.pop();f=e.pop();e.push(h/f);break;case "mod_expr":h=e.pop();f=e.pop();e.push(h%f);break;case "pre_inc_expr":case "post_inc_expr":p=e.pop();e.push(++p);break;case "pre_dec_expr":case "post_dec_expr":p=e.pop();e.push(--p);break;case "positive_expr":p=e.pop();e.push(+p);break;case "negative_expr":p=e.pop();e.push(-p);break;case "one_compl_expr":p=e.pop();e.push(~p);break;case "logic_negative_expr":p=e.pop();e.push(!p);break;default:N.panic("Unknown operation type: "+
d[g].type)}else{var p=d[g];/^[a-zA-Z_$][a-zA-Z_$0-9]*$/.test(p)?e.push(0):e.push(parseFloat(d[g]))}1==e.length?d=e[0]:(N.panic("Incorrect expression: "+d.join(" ")),d=void 0);return d}function f(a,b,d,e){for(var g=0;g<b.length;g++){var h=b[g];switch(h.type){case "node_condition":a:for(var m=a,h=h.parts,x=d,z=e,v=0;v<h.length;v++){var n=h[v];switch(n.type){case "node_if":case "node_elif":if(k(n.expression,z)){f(m,n.statements,x,z);break a}break;case "node_else":f(m,n.statements,x,z);break a;case "node_ifdef":(n.name in
l||n.name in z)&&f(m,n.statements,x,z);break;case "node_ifndef":n.name in l||n.name in z||f(m,n.statements,x,z)}}break;case "textline":m=[];for(x=0;x<h.tokens.length;x++)z=h.tokens[x],z in d?m.push(d[z]):m.push(z);m=c(m,l,t,!0,e);p.push(m.join(" "))}}}var h=e.node_elements;e=e.directives||[];for(var p=[],l={},m=0;m<e.length;m++)l[e[m][0]]=[e[m][1]];for(m=0;m<h.length;m++)l["USE_NODE_"+h[m].id]=[1];var t={},n={},q=[];for(m in h)for(var y in h[m].inputs)q.push(h[m].inputs[y]);g(d);var C=0,D=0,w=0;return p.join("\n")}
function c(a,b,c,d,e){var g=[];f(a,b,c,d,g,e);return g}function f(a,b,c,d,e,g){for(var k=0;k<a.length;k++){var h=a[k];h in b||g&&h in g?(h=g&&g[h]||b[h],0==h.length&&d?e.push(0):f(h,b,c,d,e,g)):e.push(h)}}function n(a,b,c,d,e){d=a.createShader(d);a.shaderSource(d,c);a.compileShader(d);m.check_shader_compiling(d,b,c);return d}function q(a,b){!b&&a.length?b=a.length:b||(b=1);switch(b){case 1:return d(a);case 2:return"vec2("+d(a[0])+","+d(a[1])+")";case 3:return"vec3("+d(a[0])+","+d(a[1])+","+d(a[2])+
")";case 4:return"vec4("+d(a[0])+","+d(a[1])+","+d(a[2])+","+d(a[3])+")";case 9:return"mat3("+d(a[0])+","+d(a[1])+","+d(a[2])+","+d(a[3])+","+d(a[4])+","+d(a[5])+","+d(a[6])+","+d(a[7])+","+d(a[8])+")";case 16:return"mat4("+d(a[0])+","+d(a[1])+","+d(a[2])+","+d(a[3])+","+d(a[4])+","+d(a[5])+","+d(a[6])+","+d(a[7])+","+d(a[8])+","+d(a[9])+","+d(a[10])+","+d(a[11])+","+d(a[12])+","+d(a[13])+","+d(a[14])+","+d(a[15])+")";default:throw"Wrong glsl value dimension";}}function d(a){return a%1?String(a):
String(a)+".0"}var k=r("__assets"),e=r("__config"),m=r("__debug"),B=r("__print"),N=r("__util"),G=e.paths,w={},t={},C=null,D="anchors.glslf anchors.glslv color_id.glslf color_id.glslv depth.glslf depth.glslv grass_map.glslf grass_map.glslv halo.glslf halo.glslv main.glslf main.glslv main_stack.glslf main_stack.glslv particles_color.glslf particles_color.glslv particles_texture.glslf particles_texture.glslv procedural_skydome.glslf procedural_skydome.glslv special_lens_flares.glslf special_lens_flares.glslv special_skydome.glslf special_skydome.glslv special_water.glslf special_water.glslv wireframe.glslf wireframe.glslv postprocessing/anaglyph.glslf postprocessing/antialiasing.glslf postprocessing/bloom_combine.glslf postprocessing/compositing.glslf postprocessing/depth_pack.glslf postprocessing/dof.glslf postprocessing/glow.glslf postprocessing/bloom_blur.glslf postprocessing/god_rays.glslf postprocessing/god_rays.glslv postprocessing/god_rays_combine.glslf postprocessing/luminance.glslf postprocessing/luminance_av.glslf postprocessing/luminance_trunced.glslf postprocessing/luminance_trunced.glslv postprocessing/motion_blur.glslf postprocessing/outline.glslf postprocessing/postprocessing.glslf postprocessing/postprocessing.glslv postprocessing/smaa.glslf postprocessing/smaa.glslv postprocessing/ssao.glslf postprocessing/ssao_blur.glslf include/blending.glslf include/caustics.glslf include/depth_fetch.glslf include/dynamic_grass.glslv include/environment.glslf include/fog.glslf include/gamma.glslf include/lighting_nodes.glslf include/math.glslv include/mirror.glslf include/nodes.glslf include/nodes.glslv include/pack.glslf include/particles.glslv include/precision_statement.glslf include/procedural.glslf include/refraction.glslf include/scale_texcoord.glslv include/shadow.glslf include/shadow.glslv include/skin.glslv include/std_enums.glsl include/to_world.glslv include/wind_bending.glslv".split(" "),
p=[],g=null,y=!1;a.setup_context=function(a){g=a};a.set_directive=u;a.get_directive=h;a.is_enabled=function(a,b){for(var c=a.directives,d=0;d<c.length;d++)if(c[d][0]==b&&1==c[d][1])return!0;return!1};a.set_default_directives=function(a){a.directives=[];for(var b="ALPHA ALPHA_CLIP BEND_CENTER_ONLY BILLBOARD_PRES_GLOB_ORIENTATION CAUSTICS CSM_BLEND_BETWEEEN_CASCADES CSM_FADE_LAST_CASCADE CSM_SECTION0 CSM_SECTION1 CSM_SECTION2 CSM_SECTION3 DEBUG_SPHERE DEBUG_SPHERE_DYNAMIC DEPTH_RGBA DISABLE_FOG DOUBLE_SIDED_LIGHTING DYNAMIC DYNAMIC_GRASS DYNAMIC_GRASS_COLOR DYNAMIC_GRASS_SIZE FOAM FRAMES_BLENDING BILLBOARD_JITTERED BILLBOARD_SPHERICAL HAIR_BILLBOARD SHADOW_TEX_RES MAIN_BEND_COL MAX_BONES NODES_GLOW NUM_NORMALMAPS PARALLAX PARALLAX_STEPS PERSPECTIVE_SHADOW_CAST PROCEDURAL_FOG PROCEDURAL_SKYDOME REFLECTION REFLECTION_PASS REFLECTION_TYPE REFRACTIVE USE_REFRACTION USE_REFRACTION_CORRECTION SHORE_SMOOTHING SKINNED SKY_COLOR SKY_TEXTURE SSAO_HEMISPHERE SSAO_BLUR_DEPTH SSAO_ONLY SSAO_WHITE STATIC_BATCH TEXTURE_COLOR TEXTURE_NORM TEXTURE_SPEC TEXTURE_STENCIL_ALPHA_MASK VERTEX_ANIM VERTEX_ANIM_MIX_NORMALS_FACTOR VERTEX_COLOR WATER_EFFECTS WIND_BEND DETAIL_BEND SHORE_PARAMS ALPHA_AS_SPEC DEPTH_RGBA MTEX_NEGATIVE MTEX_RGBTOINT NUM_LIGHTS NUM_LFACTORS NUM_LAMP_LIGHTS MAX_STEPS BILLBOARD_ALIGN SHADOW_USAGE POST_EFFECT SSAO_QUALITY TEXTURE_BLEND_TYPE TEXTURE_COORDS AA_METHOD AU_QUALIFIER BILLBOARD BILLBOARD_RANDOM PRECISION EPSILON USE_ENVIRONMENT_LIGHT USE_FOG WO_SKYBLEND WO_SKYPAPER WO_SKYREAL WO_SKYTEX WOMAP_BLEND WOMAP_HORIZ WOMAP_ZENUP WOMAP_ZENDOWN WIREFRAME_QUALITY SIZE_RAMP_LENGTH COLOR_RAMP_LENGTH PARTICLES_SHADELESS".split(" "),
c=0;c<b.length;c++){var d=b[c],g;switch(d){case "ALPHA":case "ALPHA_CLIP":case "BILLBOARD_PRES_GLOB_ORIENTATION":case "CAUSTICS":case "CSM_SECTION0":case "CSM_SECTION1":case "CSM_SECTION2":case "CSM_SECTION3":case "DEBUG_SPHERE":case "DEBUG_SPHERE_DYNAMIC":case "DEPTH_RGBA":case "DISABLE_FOG":case "DOUBLE_SIDED_LIGHTING":case "DYNAMIC":case "DYNAMIC_GRASS":case "DYNAMIC_GRASS_COLOR":case "DYNAMIC_GRASS_SIZE":case "FOAM":case "FRAMES_BLENDING":case "BILLBOARD_JITTERED":case "MAIN_BEND_COL":case "MAX_BONES":case "MTEX_NEGATIVE":case "MTEX_RGBTOINT":case "NODES_GLOW":case "NUM_LIGHTS":case "NUM_LFACTORS":case "NUM_NORMALMAPS":case "PARALLAX":case "PARALLAX_STEPS":case "PERSPECTIVE_SHADOW_CAST":case "PROCEDURAL_FOG":case "PROCEDURAL_SKYDOME":case "REFLECTION":case "REFLECTION_PASS":case "REFLECTION_TYPE":case "REFRACTIVE":case "USE_REFRACTION":case "USE_REFRACTION_CORRECTION":case "SHORE_SMOOTHING":case "SKINNED":case "SKY_COLOR":case "SKY_TEXTURE":case "SSAO_HEMISPHERE":case "SSAO_BLUR_DEPTH":case "SSAO_ONLY":case "SSAO_WHITE":case "STATIC_BATCH":case "TEXTURE_COLOR":case "TEXTURE_NORM":case "TEXTURE_SPEC":case "TEXTURE_STENCIL_ALPHA_MASK":case "VERTEX_ANIM":case "VERTEX_COLOR":case "WATER_EFFECTS":case "WIND_BEND":case "DETAIL_BEND":case "SHORE_PARAMS":case "BILLBOARD":case "BILLBOARD_RANDOM":case "HAIR_BILLBOARD":case "USE_ENVIRONMENT_LIGHT":case "USE_FOG":case "WO_SKYBLEND":case "WO_SKYPAPER":case "WO_SKYREAL":case "WO_SKYTEX":case "WOMAP_BLEND":case "WOMAP_HORIZ":case "WOMAP_ZENUP":case "WOMAP_ZENDOWN":case "WIREFRAME_QUALITY":case "SIZE_RAMP_LENGTH":case "COLOR_RAMP_LENGTH":case "PARTICLES_SHADELESS":case "SMAA_JITTER":g=
0;break;case "ALPHA_AS_SPEC":case "BEND_CENTER_ONLY":case "CSM_BLEND_BETWEEEN_CASCADES":case "CSM_FADE_LAST_CASCADE":case "DEPTH_RGBA":case "BILLBOARD_SPHERICAL":case "NUM_LAMP_LIGHTS":case "MAX_STEPS":g=1;break;case "SHADOW_TEX_RES":g=q(2048);break;case "AA_METHOD":g="AA_METHOD_FXAA_QUALITY";break;case "AU_QUALIFIER":g="NOT_ASSIGNED";break;case "BILLBOARD_ALIGN":g="BILLBOARD_ALIGN_VIEW";break;case "POST_EFFECT":g="POST_EFFECT_NONE";break;case "SHADOW_USAGE":g="NO_SHADOWS";break;case "SSAO_QUALITY":g=
"SSAO_QUALITY_32";break;case "TEXTURE_BLEND_TYPE":g="TEXTURE_BLEND_TYPE_MIX";break;case "TEXTURE_COORDS":g="TEXTURE_COORDS_UV_ORCO";break;case "PRECISION":g=e.defaults.precision;break;case "EPSILON":g="highp"==e.defaults.precision?1E-6:1E-4;break;case "VERTEX_ANIM_MIX_NORMALS_FACTOR":g="u_va_frame_factor";break;default:B.error("Unknown directive ("+a.vert+", "+a.frag+"): "+d)}u(a,d,g)}};a.get_vname=function(a){return a.vert};a.get_fname=function(a){return a.frag};a.inherit_directives=function(a,b){for(var c=
b.directives,d=0;d<c.length;d++){var e=c[d][0],g=c[d][1];h(a,e)&&u(a,e,g)}};a.get_compiled_shader=function(a){var c=JSON.stringify(a),d=w[c];if(d)return d;var e=a.frag,d=b(G.shaders_dir,a.vert),e=b(G.shaders_dir,e);if(!d||!e)return null;var k=l("vert",d,a),f=l("frag",e,a),d=g,h=n(d,c,k,d.VERTEX_SHADER,a),p=n(d,c,f,d.FRAGMENT_SHADER,a),e=d.createProgram();d.attachShader(e,h);d.attachShader(e,p);d.linkProgram(e);d.validateProgram(e);d.getProgramParameter(e,d.VALIDATE_STATUS)==d.FALSE&&B.error("shader program is not valid",
c);m.check_shader_linking(e,c,h,p,k,f);a={vshader:h,fshader:p,program:e,attributes:{},uniforms:{},permanent_uniform_setters:[],permanent_uniform_setters_table:{},transient_uniform_setters:[],shaders_info:a};f=d.getProgramParameter(e,d.ACTIVE_ATTRIBUTES);for(k=0;k<f;k++)h=d.getActiveAttrib(e,k).name,p=d.getAttribLocation(e,h),a.attributes[h]=p;f=d.getProgramParameter(e,d.ACTIVE_UNIFORMS);for(k=0;k<f;k++)h=d.getActiveUniform(e,k).name.split("[0]").join(""),p=d.getUniformLocation(e,h),a.uniforms[h]=
p;return w[c]=d=a};a.load_shaders=function(){y=!1;if(b4w.module_check("shader_texts"))y=!0;else{for(var a=[],b=k.AT_TEXT,c=0;c<D.length;c++){var d=N.normpath_preserve_protocol(G.shaders_dir+D[c]);a.push([D[c],b,d])}b=function(a,b,c,d){C||(C={});C[b]=a};a.length?k.enqueue(a,b,function(){y=!0}):B.error("Shaders have not been found.")}};a.check_shaders_loaded=function(){return y};a.debug_get_compilation_stats=function(){return p};a.get_compiled_shaders=function(){return w};a.cleanup=function(){for(var a in w){var b=
w[a];g.deleteProgram(b.program);g.deleteShader(b.vshader);g.deleteShader(b.fshader);delete w[a]}for(var c in t)delete t[c];for(var d in p)delete p[d]};a.debug_shaders_info=function(a){var b=a.directives;B.log("Shader: "+a.vert+" "+a.frag+", "+String(b.length)+" directives: ");for(a=0;a<b.length;a++)B.log("  "+b[a][0],b[a][1])};a.glsl_value=q;a.check_uniform=function(a,b){return b in a.uniforms?!0:!1};a.get_varyings_count=function(a){return(g.getShaderSource(a).match(/(?:^|\s)varying(?=\s)/g)||[]).length}};b4w.module.__geometry=function(a,r){function u(a){return 65536<a.base_length?p.get_elem_index_uint()?!1:!0:!1}function h(a){return 0<a.indices.length?!0:!1}function b(a,b,c){if(!h(a))return a;c||g.log('%cDEBUG max vertices exceeded for indexed submesh "'+a.name+'": '+a.base_length*(b||1)+", will use drawArrays","color: #aa0");b=a.indices;c=a.base_length;var d=a.va_common,e=a.va_frames,k;for(k in d){var f=d[k],p=B(f,c);d[k]=l(b,f,p)}for(d=0;d<e.length;d++){var m=e[d];for(k in m)f=m[k],p=B(f,c),m[k]=
l(b,f,p)}for(d=0;d<a.shape_keys.length;d++){k=a.shape_keys[d].geometry;for(var t in k)f=k[t],p=B(f,c),k[t]=l(b,f,p)}a.base_length=b.length;a.indices=new Uint16Array(0);return a}function l(a,b,c){if(0==b.length)return new Float32Array(0);for(var d=new Float32Array(a.length*c),e=0;e<a.length;e++)for(var g=a[e],k=0;k<c;k++)d[c*e+k]=b[c*g+k];return d}function c(a,b){var c=a.vbo_array,d=a.pointers[b];if(d)return c.subarray(d.offset,d.offset+d.length);throw"extract_array() failed; invalid name: "+b;}function f(b,
c){var d,e;switch(c){case a.DM_DEFAULT:case a.DM_TRIANGLES:d=L.TRIANGLES;e=L.STATIC_DRAW;break;case a.DM_POINTS:d=L.POINTS;e=L.STATIC_DRAW;break;case a.DM_DYNAMIC_TRIANGLES:d=L.TRIANGLES;e=L.DYNAMIC_DRAW;break;case a.DM_DYNAMIC_POINTS:d=L.POINTS;e=L.DYNAMIC_DRAW;break;case a.DM_LINES:d=L.LINES;e=L.STATIC_DRAW;break;default:throw"Wrong draw_mode";}b.mode=d;b.usage=e}function n(a){a.ibo_array?(a.ibo||(a.ibo=L.createBuffer()),L.bindBuffer(L.ELEMENT_ARRAY_BUFFER,a.ibo),L.bufferData(L.ELEMENT_ARRAY_BUFFER,
a.ibo_array,a.usage),a.debug_ibo_bytes=a.ibo_array.byteLength):a.debug_ibo_bytes=0;a.vbo||(a.vbo=L.createBuffer());L.bindBuffer(L.ARRAY_BUFFER,a.vbo);L.bufferData(L.ARRAY_BUFFER,a.vbo_array,a.usage);a.debug_vbo_bytes=a.vbo_array.byteLength}function q(a){for(var b=v.create_empty_submesh("JOIN_"+a.length+"_SUBMESHES"),c=0,d=0;d<a.length;d++)c+=a[d].indices.length;b.indices=new Uint32Array(c);var e=c=0,g=0;if(0<a[0].shape_keys.length)for(var k=0;k<a[0].shape_keys.length;k++){for(d=0;d<a.length;d++)c+=
a[d].shape_keys[k].geometry.a_position.length,e+=a[d].shape_keys[k].geometry.a_normal.length,g+=a[d].shape_keys[k].geometry.a_tangent.length;d={a_position:new Float32Array(c),a_normal:new Float32Array(e),a_tangent:new Float32Array(g)};b.shape_keys.push({init_value:a[0].shape_keys[k].init_value,geometry:d})}for(d=c=0;d<a.length;d++)c+=a[d].base_length;b.base_length=c;var e=a[0],f;for(f in e.va_common){for(d=c=0;d<a.length;d++)c+=a[d].va_common[f].length;b.va_common[f]=new Float32Array(c)}for(f in e.va_frames[0]){for(d=
c=0;d<a.length;d++)c+=a[d].va_frames[0][f].length;for(d=0;d<e.va_frames.length;d++)b.va_frames[d]=b.va_frames[d]||{},b.va_frames[d][f]=new Float32Array(c)}for(f=e=c=0;f<a.length;f++){for(var g=a[f],h=g.indices,k=g.base_length,p=g.va_common,d=0;d<h.length;d++)b.indices[c+d]=h[d]+e;var c=c+h.length,m;for(m in p){var h=p[m],l=e*B(h,k);b.va_common[m].set(h,l)}for(d=0;d<g.va_frames.length;d++){var p=g.va_frames[d],t=b.va_frames[d];for(m in p)h=p[m],l=e*B(h,k),t[m].set(h,l)}e+=k}if(0<b.shape_keys.length)for(f=
0;f<b.shape_keys.length;f++)for(m=b.shape_keys[f].geometry,d=g=e=c=0;d<a.length;d++)k=a[d].shape_keys[f].geometry,m.a_position.set(k.a_position,c),m.a_normal.set(k.a_normal,e),m.a_tangent.set(k.a_tangent,g),c+=k.a_position.length,e+=k.a_normal.length,g+=k.a_tangent.length;return b}function d(a,c,d,f,h,p){var l=v.create_empty_submesh("SUBMESH_"+a.name+"_"+c),z=a.submeshes[c],n=z.base_length,B=a.materials[c];l.base_length=n;var q=!1;if(e(d,"a_texcoord")){var y=null,F=a.materials[c];c=a.submeshes[c];
if(F.texture_slots.length)switch(F=F.texture_slots[0],F.texture_coords){case "UV":F=a.uv_textures.indexOf(F.uv_layer);0==F?y=new Float32Array(c.texcoord):1==F&&(y=new Float32Array(c.texcoord2));break;case "ORCO":for(var C=a.b4w_bounding_box_source,y=new Float32Array(2*c.base_length),F=(C.max_x+C.min_x)/2,D=(C.max_z+C.min_z)/2,w=C.max_x-C.min_x,C=C.max_z-C.min_z,H=0,L=0;L<c.position.length;L+=3)y[H++]=(c.position[L]-F)/w+.5,y[H++]=(D-c.position[L+2])/C+.5}null===y&&(y=new Float32Array(2*c.base_length));
c=y}else c=new Float32Array(0);if(e(d,"a_orco_tex_coord")){y=a.b4w_bounding_box_source;F=new Float32Array(3*z.base_length);D=y.max_x-y.min_x;w=y.max_y-y.min_y;C=y.max_z-y.min_z;for(L=H=0;L<z.position.length;L+=3)0==D?F[H++]=.5:F[H++]=v.clamp(parseFloat(((z.position[L]-y.min_x)/D).toFixed(5)),0,1),0==C?F[H++]=.5:F[H++]=v.clamp(parseFloat(((y.max_z-z.position[L+2])/C).toFixed(5)),0,1),0==w?F[H++]=.5:F[H++]=v.clamp(parseFloat(((z.position[L+1]-y.min_y)/w).toFixed(5)),0,1);y=F}else y=new Float32Array(0);
var E,F=z.group;if(e(d,"a_influence")&&f){D=new Float32Array(4*n);w=F.length/n;C=new Float32Array(w);for(H=0;H<w;H++)for(E in C[H]=-1,f)if(L=f[E],L.vgroup_index===H){C[H]=L.deform_bone_index;break}var T=3<w?w:4;f=new Float32Array(T);E=new Uint32Array(T);for(var H=new Float32Array(4),L=new Float32Array(T),T=new Uint32Array(T),da=new Float32Array(4),u=0;u<n;u++)f.set(L),E.set(T),H.set(da),D.set(m(F,w,u,n,C,f,E,H),4*u)}else D=new Float32Array(0);E=D;f=h?v.clone_object_r(h):{};f.a_color={generate_buffer:!0};
e(d,"a_color")&&a.active_vcol_name?f.a_color.src=[{name:a.active_vcol_name,mask:7}]:f.a_color.src=[];h={a_texcoord:c,a_influence:E,a_orco_tex_coord:y};E=z.vertex_colors;c=z.color;y=a.name;F=[];for(D=0;D<E.length;D++)F.push(E[D].name);for(var r in f)if(D=f[r].src,D.length){for(C=w=0;C<D.length;C++)w+=v.rgb_mask_get_channels_count(D[C].mask);h[r]=new Float32Array(w*n);for(C=H=0;C<D.length;C++){var G=D[C].name,L=D[C].mask,T=v.rgb_mask_get_channels_presence(L),N=F.indexOf(G);-1==N&&v.panic('vertex color "'+
G+'" for mesh "'+y+'" not found.');da=E[N].mask;u=v.rgb_mask_get_channels_count(da);(L&da)!==L&&g.error("Wrong color extraction from "+G+" to "+r+".");for(var G=E,I=n,ma=0,ca=0;ca<N;ca++)ma+=v.rgb_mask_get_channels_count(G[ca].mask);G=ma*I;for(N=0;N<n;N++)for(I=0;3>I;I++)T[I]&&(ma=H+v.rgb_mask_get_channel_presence_index(L,I),ca=v.rgb_mask_get_channel_presence_index(da,I),h[r][N*w+ma]=c[G+N*u+ca]);H+=u}}else h[r]=new Float32Array(0);r=a.uv_textures;f=z.texcoord;E=z.texcoord2;if(p)for(var Z in p){c=
r.indexOf(Z);if(0==c)var ta=new Float32Array(f);else 1==c&&(ta=new Float32Array(E));h[p[Z]]=ta}l.va_common=h;l.indices=new Uint32Array(z.indices);p=z.position.length/n/3;ta=(Z=e(d,"a_normal")&&z.normal.length?!0:!1)&&e(d,"a_tangent")&&z.tangent.length?!0:!1;r=B.texture_slots[0];r=Z&&B.texture_slots.length&&e(d,"a_tangent")&&"ORCO"==r.texture_coords&&r.use_map_normal?!0:!1;0<a.b4w_shape_keys.length&&(q=!0);for(h=0;h<p;h++){B=k(l,z,d,n,Z,ta,r,h,a.name);if(q)if(f={},f.name=a.b4w_shape_keys[h].name,l.shape_keys.push(f),
0!=h){f.geometry=B;f.init_value=a.b4w_shape_keys[h].value;continue}else f.geometry=k(l,z,d,n,Z,ta,r,h,a.name),f.init_value=1;l.va_frames.push(B)}if(1<p&&!q){a=l.va_frames[0];var B={},M;for(M in a)B[M]=new Float32Array(a[M]);l.va_frames.push(B)}e(d,"a_polyindex")&&(b(l,1,!0),l.va_common.a_polyindex=t(l));return l}function k(a,b,c,d,k,f,h,p,m){a={};var l=new Float32Array(3*d),t=new Float32Array(k?3*d:0),n=new Float32Array(f||h?4*d:0),B=p*d*3;l.set(b.position.subarray(B,B+3*d),0);k&&(B=p*d*3,t.set(b.normal.subarray(B,
B+3*d),0));if(f)B=p*d*4,n.set(b.tangent.subarray(B,B+4*d),0);else if(h)for(b=n,g.warn('Not precise tangents calculation for normalmap using GENERATED texture coordinates in mesh: "'+m+'". Please add a UV-map.'),m=0;m<d;m++)c=z,k=H,c[0]=t[3*m],c[1]=t[3*m+1],c[2]=t[3*m+2],I.cross(c,v.AXIS_Z,k),0==I.length(k)&&I.cross(c,v.AXIS_X,k),I.normalize(k,k),b[4*m]=k[0],b[4*m+1]=k[1],b[4*m+2]=k[2],b[4*m+3]=1;else if(k&&e(c,"a_tangent"))for(n=new Float32Array(4*d),d=0;d<n.length;d++)n[d]=1;a.a_position=l;a.a_normal=
t;a.a_tangent=n;return a}function e(a,b){return-1<a.indexOf(b)?!0:!1}function m(b,c,d,e,g,k,f,h){for(var p=!0,m=0;m<c;m++){var l=b[m*e+d];if(-1!==l){var t=g[m];-1!==t&&(k[m]=l,f[m]=t,p=!1)}}if(p)return h;N(k,f,a.SORT_NUMERIC,!1);for(m=b=0;4>m;m++)b+=k[m];if(.01>b)return h;for(m=0;4>m;m++)k[m]/=b;if(.01>Math.abs(k[0]-1))h[0]=f[0]+1;else for(m=0;4>m;m++)h[m]=f[m]+k[m];return h}function B(a,b){if(0==b)return 0;var c=a.length,d=c/b;if(d!=Math.floor(d))throw"Array size mismatch during geometry calculation: array length="+
c+", base length="+b;return d}function N(b,c,d,e){for(var g=b.length,k=g,f=!1,h=e?-1:1;1<k||f;){1<k&&(k=Math.floor(k/1.247330950103979));for(var f=!1,m=0;k+m<g;m++)if(d==a.SORT_NUMERIC?0>h*(b[m]-b[m+k]):b[m]<b[m+k]&&e)f=b[m],b[m]=b[m+k],b[m+k]=f,f=c[m],c[m]=c[m+k],c[m+k]=f,f=!0}}function G(a,b,c){var d=[],e=[];I.subtract(b,a,d);I.subtract(c,a,e);I.normalize(d,d);I.normalize(e,e);return Math.acos(I.dot(d,e))}function w(a,b,c){b||(b=[]);c=c?a.va_frames[0].a_normal:a.va_frames[0].a_position;if(h(a)){a=
a.indices;for(var d=a.length/3,e=0;e<d;e++){var g=new Float32Array(9),k=a[3*e];g[0]=c[3*k];g[1]=c[3*k+1];g[2]=c[3*k+2];k=a[3*e+1];g[3]=c[3*k];g[4]=c[3*k+1];g[5]=c[3*k+2];k=a[3*e+2];g[6]=c[3*k];g[7]=c[3*k+1];g[8]=c[3*k+2];b[e]=g}}else for(e=0;e<c.length;e++)g=new Float32Array(9),g[0]=c[9*e],g[1]=c[9*e+1],g[2]=c[9*e+2],g[3]=c[9*e+3],g[4]=c[9*e+4],g[5]=c[9*e+5],g[6]=c[9*e+6],g[7]=c[9*e+7],g[8]=c[9*e+8],b[e]=g;return b}function t(a){for(var b=new Float32Array(a.base_length),c=0;c<a.base_length;c++)b[c]=
c%3;return b}function C(a,b,c){var d=I.dist(a,b);a=I.dist(a,c);b=I.dist(b,c);c=(d+a+b)/2;return c*(c-d)*(c-a)*(c-b)}function D(a,b,c,d,e){c-=b;for(var g=0;g<c;g+=d)g%d==e&&vec3.normalize(a.subarray(g+b-e,g+b+1),a.subarray(g+b-e,g+b+1))}var p=r("__extensions"),g=r("__print"),y=r("__tsr"),v=r("__util"),I=r("__vec3"),z=new Float32Array(3),H=new Float32Array(3),F=new Float32Array(3);a.ZSORT_DISABLED=10;a.ZSORT_BACK_TO_FRONT=20;a.ZSORT_FRONT_TO_BACK=30;a.DM_TRIANGLES=10;a.DM_POINTS=20;a.DM_DYNAMIC_TRIANGLES=
30;a.DM_DYNAMIC_POINTS=40;a.DM_LINES=50;a.SORT_NUMERIC=0;a.SORT_STRING=1;a.DM_DEFAULT=a.DM_TRIANGLES;var L=null;a.setup_context=function(a){L=a};a.delete_buffers=function(a){var b=_buffers[a];L.deleteBuffer(b.ibo);L.deleteBuffer(b.vbo);delete _buffers[a]};a.submesh_to_bufs_data=function(c,d,e,g){u(c)&&b(c);var k=c.indices,m=c.base_length,p=c.va_frames,l={},t;for(t in c.va_common)t in g&&!g[t].generate_buffer||(l[t]=c.va_common[t]);g={ibo_array:null,vbo_array:null,ibo_type:0,count:0,pointers:{},mode:0,
usage:0,debug_ibo_bytes:0,debug_vbo_bytes:0,vbo:null,ibo:null,info_for_z_sort_updates:null,shape_keys:null};if(0<c.shape_keys.length){t=p[0];for(var z=1;z<c.shape_keys.length;z++){for(var v=c.shape_keys[z].geometry,q=v.a_position,y=v.a_normal,F=t.a_position,C=t.a_normal,D=q.length,w=c.shape_keys[z].init_value,H=0;H<D;H++)F[H]+=w*q[H],C[H]+=w*y[H];v=v.a_tangent;q=t.a_tangent;y=v.length;for(H=0;H<y;H++)q[H]+=w*v[H]}}if(k.length)if(t=k.length,65536>=m)var z=new Uint16Array(k),E=L.UNSIGNED_SHORT;else z=
new Uint32Array(k),E=L.UNSIGNED_INT;else t=m,z=null;var w=0,H=p.length,T;for(T in p[0])v=p[0][T],w+=v.length*H;for(T in l)v=l[T],w+=v.length;T=new Float32Array(w);var w=0,H={},da;for(da in l)if(q=l[da],v=q.length)T.set(q,w),H[da]={attribute_name:da,num_comp:B(q,m),offset:w,frames:1,length:v},w+=v;l=p.length;for(da in p[0])if(q=p[0][da],v=q.length,q=B(q,m),v)for(H[da]={num_comp:q,offset:w,frames:l,length:v},1<l&&(H[da+"_next"]={num_comp:q,offset:w+v,frames:l,length:v}),y=0;y<l;y++)q=p[y][da],T.set(q,
w),w+=v;g.count=t;g.ibo_array=z;g.vbo_array=T;g.ibo_type=E;g.pointers=H;f(g,e);n(g);d!=a.ZSORT_DISABLED&&h(c)&&(g.info_for_z_sort_updates={median_cache:new Float32Array(k.length),median_world_cache:new Float32Array(k.length),dist_cache:new Float32Array(k.length/3),type:d});g.shape_keys=c.shape_keys;return g};a.is_long_submesh=u;a.is_indexed=h;a.submesh_drop_indices=b;a.update_bufs_data_index_array=function(a,b,c){f(a,b);a.count=c.length;a.ibo_array=c;a.ibo_type=c instanceof Uint16Array?L.UNSIGNED_SHORT:
L.UNSIGNED_INT;return a};a.update_bufs_data_array=function(a,b,c,d){var e=a.vbo_array,g=a.pointers,k=g[b];k?(c&&k.num_comp!=c&&v.panic('invalid num_comp for "'+b+'"'),e.set(d,k.offset)):(e=e.length,k=new Float32Array(e+d.length),k.set(a.vbo_array),k.set(d,e),a.vbo_array=k,g[b]={num_comp:c,offset:e});n(a);return a};a.extract_array=c;a.make_static=function(a){a.usage=L.STATIC_DRAW};a.make_dynamic=function(a){a.usage=L.DYNAMIC_DRAW};a.update_gl_buffers=n;a.cleanup_bufs_data=function(a){a.ibo&&L.deleteBuffer(a.ibo);
a.vbo&&L.deleteBuffer(a.vbo)};a.has_empty_submesh=function(a,b){return a.submeshes[b].base_length?!1:!0};a.submesh_apply_transform=function(a,b){for(var c=0;c<a.va_frames.length;c++){var d=a.va_frames[c].a_position;y.transform_vectors(d,b,d,0);d=a.va_frames[c].a_normal;0<d.length&&y.transform_dir_vectors(d,b,d,0);d=a.va_frames[c].a_tangent;0<d.length&&y.transform_tangents(d,b,d,0)}(c=a.va_common.au_center_pos)&&c.length&&y.transform_vectors(c,b,c,0);return a};a.submesh_apply_particle_transform=function(a,
b){var c=a.va_common.au_center_pos;if(c&&c.length){var d=new Float32Array(c);y.transform_vectors(d,b,d,0);for(var e=0;e<a.va_frames.length;e++)for(var g=0;g<d.length;g++)a.va_frames[e].a_position[g]+=d[g]-c[g];c.set(d)}else throw'Attribute "au_center_pos" is missing in particle submesh';return a};a.submesh_apply_params=function(a,b){var c=a.base_length,d;for(d in b){var e=b[d].length;a.va_common[d]=new Float32Array(e*c);for(var g=0;g<c;g++)for(var k=0;k<e;k++)a.va_common[d][g*e+k]=b[d][k]}return a};
a.submesh_list_join=q;a.make_clone_submesh=function(a,c,d){if(!a.base_length)return v.create_empty_submesh("EMPTY");var e=d.length;65536<a.base_length*e&&!p.get_elem_index_uint()&&b(a,e);var g=a.indices,k=a.base_length,f=a.va_common;a=a.va_frames;for(var h in c){var m=c[h].length,l=m*k;f[h]=new Float32Array(l);for(var t=0;t<k;t++)for(l=0;l<m;l++)f[h][t*m+l]=c[h][l]}c=v.create_empty_submesh("CLONE_"+e+"_SUBMESHES");c.base_length=k*e;c.indices=new Uint32Array(g.length*e);for(t=0;t<e;t++)for(m=g.length*
t,h=k*t,l=0;l<g.length;l++)c.indices[m+l]=g[l]+h;for(var z in f)for(g=f[z],l=g.length*e,m=B(g,k),c.va_common[z]=new Float32Array(l),t=0;t<e;t++)h=k*m*t,c.va_common[z].set(g,h);for(z in a[0])for(t=0;t<a.length;t++)for(g=a[t][z],l=g.length*e,m=B(g,k),c.va_frames[t]=c.va_frames[t]||{},c.va_frames[t][z]=new Float32Array(l),l=0;l<e;l++)switch(f=d[l],h=k*m*l,z){case "a_position":y.transform_vectors(g,f,c.va_frames[t][z],h);break;case "a_normal":y.transform_dir_vectors(g,f,c.va_frames[t][z],h);break;case "a_tangent":y.transform_tangents(g,
f,c.va_frames[t][z],h);break;default:throw"Wrong attribute name: "+z;}return c};a.extract_submesh=d;a.extract_halo_submesh=function(a){var b=a.base_length,c=a.va_frames[0].a_position,d=new Float32Array(12*b),e=new Float32Array(8*b);a=new Uint16Array(4*a.indices.length);for(var g=0;g<b;g++)d[12*g]=c[3*g],d[12*g+1]=c[3*g+1],d[12*g+2]=c[3*g+2],d[12*g+3]=c[3*g],d[12*g+4]=c[3*g+1],d[12*g+5]=c[3*g+2],d[12*g+6]=c[3*g],d[12*g+7]=c[3*g+1],d[12*g+8]=c[3*g+2],d[12*g+9]=c[3*g],d[12*g+10]=c[3*g+1],d[12*g+11]=
c[3*g+2],e[8*g]=-.5,e[8*g+1]=-.5,e[8*g+2]=-.5,e[8*g+3]=.5,e[8*g+4]=.5,e[8*g+5]=.5,e[8*g+6]=.5,e[8*g+7]=-.5,a[6*g]=4*g+2,a[6*g+1]=4*g+1,a[6*g+2]=4*g,a[6*g+3]=4*g+2,a[6*g+4]=4*g,a[6*g+5]=4*g+3;c=v.create_empty_submesh("HALO");c.va_frames=[];c.va_frames[0]={};c.base_length=4*b;c.va_frames[0].a_position=d;c.va_common.a_halo_bb_vertex=e;c.indices=a;return c};a.has_attr=e;a.extract_submesh_all_mats=function(a,b,c){for(var e=[],g=0;g<a.submeshes.length;g++){var k=d(a,g,b,null,c,null);k.base_length&&e.push(k)}return 0==
e.length?v.create_empty_submesh("EMPTY"):1==e.length?e[0]:q(e)};a.update_buffers_movable=function(a,b,d){for(var e=a.ibo_array,g=c(a,"a_position"),k=a.info_for_z_sort_updates,f=k.median_cache,h=k.median_world_cache,k=k.dist_cache,m=e,p=m.length/3,l=0;l<p;l++){var t=m[3*l],z=m[3*l+1],n=m[3*l+2],B=g[3*t+1],q=g[3*t+2],y=g[3*z+1],F=g[3*z+2],E=g[3*n+1],T=g[3*n+2];f[3*l]=(g[3*t]+g[3*z]+g[3*n])/3;f[3*l+1]=(B+y+E)/3;f[3*l+2]=(q+F+T)/3}v.positions_multiply_matrix(f,b,h);b=h.length/3;for(g=0;g<b;g++)f=h[3*
g]-d[0],m=h[3*g+1]-d[1],p=h[3*g+2]-d[2],k[g]=f*f+m*m+p*p;d=e;e=k.length;if(!(2>e))for(h=e,g=!1;1<h||g;)for(1<h&&(h=Math.floor(h/1.247330950103979)),g=!1,b=0;h+b<e;b++)0>k[b]-k[b+h]&&(g=k[b],k[b]=k[b+h],k[b+h]=g,g=d,f=b,m=b+h,p=g[3*f],l=g[3*f+1],t=g[3*f+2],g[3*f]=g[3*m],g[3*f+1]=g[3*m+1],g[3*f+2]=g[3*m+2],g[3*m]=p,g[3*m+1]=l,g[3*m+2]=t,g=!0);e=d;L.bindBuffer(L.ELEMENT_ARRAY_BUFFER,a.ibo);L.bufferData(L.ELEMENT_ARRAY_BUFFER,e,L.DYNAMIC_DRAW)};a.sort_two_arrays=N;a.calc_normals=function(a,b,c){for(var d=
b.length/3,e=a.length/3,g=[],k=Array(3),f=Array(3),h=Array(3),m=0;m<e;m++){for(var p=a[3*m],l=a[3*m+1],t=a[3*m+2],z=0;3>z;z++)k[z]=b[3*p+z],f[z]=b[3*l+z],h[z]=b[3*t+z];if(c)var z=G(k,f,h),n=G(f,h,k),v=Math.PI-z-n;else v=n=z=1;var B=g,q;q=k;var E=h,y=[],F=[],C=[];I.subtract(f,q,y);I.subtract(E,q,F);I.cross(y,F,C);I.normalize(C,C);q=C;for(E=0;3>E;E++)y=3*l+E,F=3*t+E,B[3*p+E]=z*q[E],B[y]=n*q[E],B[F]=v*q[E]}if(c)for(var D in c)for(m=c[D],a=0;3>a;a++){b=3*m[0]+a;for(e=1;e<m.length;e++)k=3*m[e]+a,g[b]+=
g[k];for(e=1;e<m.length;e++)k=3*m[e]+a,g[k]=g[b]}for(m=0;m<d;m++){c=m;D=g;a=new Float32Array(3);for(b=0;3>b;b++)e=3*c+b,a[b]=D[e];I.normalize(a,a);for(b=0;3>b;b++)e=3*c+b,D[e]=a[b]}return g};a.calc_shared_indices=function(a,b,c){for(var d={},e=b.length/3,g=0;g<e;g++){var k=String(b[3*g])+String(b[3*g+1])+String(b[3*g+2]);d[k]=[]}e=a.length;for(g=0;g<e;g++)b=a[g],k=String(c[3*b])+String(c[3*b+1])+String(c[3*b+2]),k in d&&d[k].push(b);return d};a.geometry_random_points=function(a,b,c,d){var e=w(a,null,
!1);if(c)var g=w(a,null,!0);var k=e.length,f=new Float32Array(k),h=z,m=H;for(a=0;a<k;a++){var p=e[a];h.set(p.subarray(0,3));m.set(p.subarray(3,6));F.set(p.subarray(6));f[a]=Math.sqrt(C(h,m,F))}h=new Float32Array(k);h[0]=f[0];for(a=1;a<k;a++)h[a]=h[a-1]+f[a];k=h[f.length-1];f=[];for(a=0;a<b;a++){var m=k*v.rand_r(d),m=v.binary_search_max(h,m,0,h.length-1),p=c?g[m]:e[m],m=a,l=p,t=d,p=void 0,p=new Float32Array(3),n=l[0],q=l[1],B=l[2],y=l[3],D=l[4],E=l[5],T=l[6],da=l[7],L=l[8],l=v.rand_r(t),t=v.rand_r(t);
1<l+t&&(l=1-l,t=1-t);var u=1-l-t,q=u*q+l*D+t*da,B=u*B+l*E+t*L;p[0]=u*n+l*y+t*T;p[1]=q;p[2]=B;f[m]=p}return f};a.extract_triangles=w;a.extract_polyindices=t;a.triangle_area_squared=C;a.scale_submesh_xyz=function(a,b,c){a=a.va_frames[0].a_position;for(var d=0;d<a.length;d+=3)a[d]=(a[d]-c[0])*b[0]+c[0],a[d+1]=(a[d+1]-c[1])*b[1]+c[1],a[d+2]=(a[d+2]-c[2])*b[2]+c[2]};a.apply_shape_key=function(a,b,c){var d=a.scenes_data[0].batches;a=a.render.shape_keys_values;for(var e=1;e<a.length;e++)a[e].name==b&&(a[e].value=
c);for(e=0;e<d.length;e++)if(!d[e].forked_batch&&d[e].use_shape_keys&&!d[e].debug_sphere){c=d[e].bufs_data.pointers;b=d[e].bufs_data.vbo_array;L.bindBuffer(L.ARRAY_BUFFER,d[e].bufs_data.vbo);var g=c.a_position,k=d[e],f=b,h=a;if(g){for(var m=g.offset,g=g.length+m,p=k.bufs_data.shape_keys[0].geometry.a_position,l=m;l<g;l++)f[l]=p[l-m];for(l=1;l<k.bufs_data.shape_keys.length;l++){var p=k.bufs_data.shape_keys[l].geometry.a_position,t=h[l].value;if(t)for(var z=m;z<g;z++)f[z]+=t*p[z-m]}L.bufferSubData(L.ARRAY_BUFFER,
4*m,f.subarray(m))}g=c.a_normal;k=d[e];f=b;h=a;if(g){m=g.offset;g=g.length+m;p=k.bufs_data.shape_keys[0].geometry.a_normal;for(l=m;l<g;l++)f[l]=p[l-m];for(l=1;l<k.bufs_data.shape_keys.length;l++)if(p=k.bufs_data.shape_keys[l].geometry.a_normal,t=h[l].value)for(z=m;z<g;z++)f[z]+=t*p[z-m];D(f,m,g,3,2);L.bufferSubData(L.ARRAY_BUFFER,4*m,f.subarray(m))}h=c.a_tangent;c=d[e];k=a;if(h){f=h.offset;h=h.length+f;g=c.bufs_data.shape_keys[0].geometry.a_tangent;for(m=f;m<h;m++)b[m]=g[m-f];for(m=1;m<c.bufs_data.shape_keys.length;m++)if(g=
c.bufs_data.shape_keys[m].geometry.a_tangent,l=k[m].value)for(p=f;p<h;p++)b[p]+=l*g[p-f];D(b,f,h,4,3);L.bufferSubData(L.ARRAY_BUFFER,4*f,b.subarray(f))}}};a.check_shape_keys=function(a){return a.render.use_shape_keys};a.get_shape_keys_names=function(a){var b=[];if(a.render)for(var c=1;c<a.render.shape_keys_values.length;c++)b.push(a.render.shape_keys_values[c].name);return b};a.get_shape_key_value=function(a,b){if(a.render)for(var c=1;c<a.render.shape_keys_values.length;c++)if(b==a.render.shape_keys_values[c].name)return a.render.shape_keys_values[c].value;
return 0};a.has_shape_key=function(a,b){var c=a.render.shape_keys_values;if(c)for(var d=1;d<c.length;d++)if(c[d].name==b)return!0;return!1};a.has_dyn_geom=function(a){return a&&a.render&&a.render.dynamic_geometry?!0:!1}};b4w.module.__objects=function(a,r){function u(a){a.render.outline_intensity=0;a=ja.indexOf(a);-1!=a&&ja.splice(a,1)}function h(a){if(a.field)for(var b=a.scenes_data,c=0;c<b.length;c++)K.update_force_scene(b[c].scene,a)}function b(a,b){for(var c=a.scenes_data,d=b.scenes_data,e=0;e<c.length;e++){for(var g=!1,k=0;k<d.length;k++)if(c[e].scene==d[k].scene){g=!0;break}g||l(b,c[e].scene)&&I.append_scene_data(b,c[e].scene)}}function l(a,b){return!b._is_main&&"SPEAKER"==a.type||!b._is_primary_thread&&("LAMP"==
a.type||"CAMERA"==a.type)?!1:!0}function c(a,b){if(a.dg_parent&&a.dg_parent._is_dynamic||a.parent&&a.parent._is_dynamic)return!0;switch(a.type){case "MESH":var c=G.bpy_obj_is_animatable(a,b),d=a.b4w_do_not_batch,e=a.b4w_collision,g=a.b4w_vehicle,k=a.b4w_floating,f=a.b4w_character,h=z.has_dynamic_grass_particles(a),m=v.bpy_obj_has_nla(a),l=0<a.data.b4w_shape_keys.length,p=a.b4w_dynamic_geometry;if(!(c=c||d||e||g||l||k))a:{c=a.data;for(d=0;d<c.materials.length;d++)if("LENS_FLARES"===c.materials[d].name){c=
!0;break a}c=!1}return c||h||f||m||p;case "EMPTY":return f=G.bpy_obj_is_animatable(a,b),h=v.bpy_obj_has_nla(a),m=a.b4w_do_not_batch,f||h||m;default:return!0}}function f(a,b,c,d,e,g,k,h,m){for(var l=0;l<a.nodes.length;l++){var p=a.nodes[l];if("VALUE"==p.type){var t=q(b,p.name);d.push(p.outputs[0].default_value);e.push(t,e.length/2)}else if("RGB"==p.type)t=q(b,p.name),p=p.outputs[0].default_value.slice(0,3),k.push(p[0],p[1],p[2]),h.push(t,h.length/2);else if("GROUP"==p.type){var t=p.node_group.node_tree,
z=t.animation_data,p=q(b,p.name);f(t,p,z,d,e,g,k,h,m)}}if(c)for((a=c.action)&&a._render.type==G.AT_MATERIAL&&n(a,b,g,e,m,h),c=c.nla_tracks,d=0;d<c.length;d++)for(k=c[d].strips,l=0;l<c[d].strips.length;l++)(a=k[l].action)&&a._render.type==G.AT_MATERIAL&&n(a,b,g,e,m,h)}function n(a,b,c,e,g,k){var f=a._render.params,h;for(h in f){var m=q(b,h.match(/"(.*?)"/)[1]),f=d(e,m);null!=f?(m=q(a.name,h),c.push(m,f)):(f=d(k,m),null!=f&&(m=q(a.name,h),g.push(m,f)))}}function q(a,b){return a+"%join%"+b}function d(a,
b){for(var c=0;c<a.length;c+=2)if(a[c]==b)return a[c+1];return null}function k(a,b){for(var c=a.render.mats_value_inds,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function e(a,b){for(var c=a.render.mats_rgb_inds,d=0;d<c.length;d+=2)if(c[d]==b)return c[d+1];return null}function m(a,b,c){b=R[b]||[];for(var d=[],e=0;e<b.length;e++){var g=b[e];if(g.render.data_id==c||-1==c)for(var k=g.scenes_data,f=0;f<k.length;f++)k[f].scene==a&&d.push(g)}return d}function B(a,b,c,d){for(var e=null,g=0;g<
b.length;g++){var k=b[g];if((c?k.origin_name:k.name)==a&&(k.render.data_id==d||-1==d)&&(e=k,!I.get_dg_parent(e)))break}return e}function N(a){R.ALL.push(a);R[a.type]||(R[a.type]=[]);R[a.type].push(a);var b=a.render.plane_reflection_id;if(null!=b)for(var c=0;c<fa.length;c++){var d=fa[c];d.render.plane_reflection_id==b&&d.reflective_objs.push(a)}}var G=r("__animation"),w=r("__batch"),t=r("__boundings"),C=r("__camera"),D=r("__config"),p=r("__constraints"),g=r("__geometry"),y=r("__lights"),v=r("__nla"),
I=r("__obj_util"),z=r("__particles"),H=r("__physics"),F=r("__print"),L=r("__primitives"),x=r("__quat"),K=r("__scenes"),A=r("__sfx"),P=r("__transform"),S=r("__tsr"),ea=r("__util"),aa=r("__vec3"),Y=r("__armature"),Q=D.defaults,X=D.outlining,R={ALL:[]},U=0,ba=0,fa=[],ja=[],pa=new Float32Array(3),na=new Float32Array(4);a.GET_OBJECT_BY_NAME=0;a.GET_OBJECT_BY_DUPLI_NAME=1;a.GET_OBJECT_BY_DUPLI_NAME_LIST=2;a.DATA_ID_ALL=-1;a.update=function(a,b){for(var c=R.ALL,d=R.ARMATURE,e=0;e<c.length;e++)for(var g=
c[e],k=g.scenes_data,f=0;f<k.length;f++){var h=k[f].scene;if(h._render.outline){if(-1!=ja.indexOf(g)){var m=g,p=a,l=0,t=m.outline_animation;0==t.time_start&&(t.time_start=p);p-=t.time_start;if(t.relapses&&p/t.period>=t.relapses)u(m);else{p%=t.period;if(p<t.outline_time)switch(t=p/(t.outline_time/5),p=Math.floor(t),p){case 0:l=(t-p)/2;break;case 1:l=(t-p)/2+.5;break;case 2:l=1;break;case 3:l=1-(t-p)/2;break;case 4:l=.5-(t-p)/2}m.render.outline_intensity=l}}g.render.outline_intensity&&K.request_outline(h)}}if(d)for(e=
0;e<d.length;e++)c=d[e],c.need_update_transform&&(P.update_transform(c),c.need_update_transform=!1)};a.apply_outline_anim=function(a,b,c,d){var e=a.outline_animation;e.time_start=0;e.outline_time=b;e.period=c;e.relapses=d;-1==ja.indexOf(a)&&ja.push(a)};a.clear_outline_anim=u;a.update_object=function(a,b){var d=a.animation_data,e=a.data.animation_data;d&&d.action&&(d=d.action,(d._render.type==G.AT_OBJECT||d._render.type==G.AT_ARMATURE&&"ARMATURE"==b.type)&&b.actions.push(d));e&&e.action&&"SPEAKER"==
b.type&&b.actions.push(e.action);"MESH"==b.type&&b.actions.push.apply(b.actions,G.get_bpy_material_actions(a));a._is_dynamic=b.is_dynamic=c(a,b);a._is_updated=!0;b.is_vehicle=a.b4w_vehicle;b.is_character=a.b4w_character;b.is_floating=a.b4w_floating;b.use_obj_physics=a.b4w_collision;e=a.game;b.physics_settings={physics_type:e.physics_type,use_ghost:e.use_ghost,use_sleep:e.use_sleep,mass:e.mass,velocity_min:e.velocity_min,velocity_max:e.velocity_max,damping:e.damping,rotation_damping:e.rotation_damping,
lock_location_x:e.lock_location_x,lock_location_y:e.lock_location_y,lock_location_z:e.lock_location_z,lock_rotation_x:e.lock_rotation_x,lock_rotation_y:e.lock_rotation_y,lock_rotation_z:e.lock_rotation_z,collision_margin:e.collision_margin,collision_group:e.collision_group,collision_mask:e.collision_mask,use_collision_bounds:e.use_collision_bounds,collision_bounds_type:e.collision_bounds_type,use_collision_compound:e.use_collision_compound};if(e=a.b4w_vehicle_settings)b.vehicle_settings={name:e.name,
part:e.part,suspension_rest_length:e.suspension_rest_length,suspension_compression:e.suspension_compression,suspension_stiffness:e.suspension_stiffness,suspension_damping:e.suspension_damping,wheel_friction:e.wheel_friction,roll_influence:e.roll_influence,max_suspension_travel_cm:e.max_suspension_travel_cm,force_max:e.force_max,brake_max:e.brake_max,steering_max:e.steering_max,max_speed_angle:e.max_speed_angle,delta_tach_angle:e.delta_tach_angle,speed_ratio:e.speed_ratio,steering_ratio:e.steering_ratio,
inverse_control:e.inverse_control,floating_factor:e.floating_factor,water_lin_damp:e.water_lin_damp,water_rot_damp:e.water_rot_damp,synchronize_position:e.synchronize_position};if(e=a.b4w_floating_settings)b.floating_settings={name:e.name,part:e.part,floating_factor:e.floating_factor,water_lin_damp:e.water_lin_damp,water_rot_damp:e.water_rot_damp,synchronize_position:e.synchronize_position};if(e=a.b4w_character_settings)b.character_settings={walk_speed:e.walk_speed,run_speed:e.run_speed,step_height:e.step_height,
jump_strength:e.jump_strength,waterline:e.waterline};for(e=0;e<a.constraints.length;e++)d=a.constraints[e],"RIGID_BODY_JOINT"==d.type&&b.physics_constraints.push({target:d.target._object,pivot_type:d.pivot_type,pivot_x:d.pivot_x,pivot_y:d.pivot_y,pivot_z:d.pivot_z,axis_x:d.axis_x,axis_y:d.axis_y,axis_z:d.axis_z,use_limit_x:d.use_limit_x,use_limit_y:d.use_limit_y,use_limit_z:d.use_limit_z,use_angular_limit_x:d.use_angular_limit_x,use_angular_limit_y:d.use_angular_limit_y,use_angular_limit_z:d.use_angular_limit_z,
limit_max_x:d.limit_max_x,limit_max_y:d.limit_max_y,limit_max_z:d.limit_max_z,limit_min_x:d.limit_min_x,limit_min_y:d.limit_min_y,limit_min_z:d.limit_min_z,limit_angle_max_x:d.limit_angle_max_x,limit_angle_max_y:d.limit_angle_max_y,limit_angle_max_z:d.limit_angle_max_z,limit_angle_min_x:d.limit_angle_min_x,limit_angle_min_y:d.limit_angle_min_y,limit_angle_min_z:d.limit_angle_min_z});e=b.render=I.create_render("MESH"===b.type?b.is_dynamic?"DYNAMIC":"STATIC":b.type);a.parent?(b.parent=a.parent._object,
"BONE"==a.parent_type&&"ARMATURE"==a.parent.type&&(b.parent_bone=a.parent_bone)):a.dg_parent&&(b.parent=a.dg_parent._object,b.parent_is_dupli=!0);var d=a.location,g=a.scale[0];ea.quat_bpy_b4w(a.rotation_quaternion,na);P.set_translation(b,d);P.set_rotation(b,na);P.set_scale(b,g);b.use_default_animation=a.b4w_use_default_animation;b.anim_behavior_def=G.anim_behavior_bpy_b4w(a.b4w_anim_behavior);a.b4w_object_tags&&(b.metatags={title:a.b4w_object_tags.title,description:a.b4w_object_tags.description,category:a.b4w_object_tags.category});
switch(a.type){case "ARMATURE":Y.update_object(a,b);var d=e.bone_pointers,k=G.calc_pose_data(d);a.b4w_animation_mixing?(e.quats_before=new Float32Array(k.quats),e.quats_after=new Float32Array(k.quats),e.trans_before=new Float32Array(k.trans),e.trans_after=new Float32Array(k.trans)):(e.quats_before=k.quats,e.quats_after=k.quats,e.trans_before=k.trans,e.trans_after=k.trans);for(var h in d)g=d[h],1==g.chain.length&&Y.update_bone_tsr_r(g,!0,k.trans,k.quats);e.pose_data=k;e.frame_factor=0;e.anim_mixing=
a.b4w_animation_mixing;break;case "MESH":e.do_not_render=a.b4w_do_not_render;e.bb_original=w.bb_bpy_to_b4w(a.data.b4w_bounding_box);e.selectable=X.outlining_overview_mode||a.b4w_selectable;e.origin_selectable=a.b4w_selectable;e.outlining=X.outlining_overview_mode||a.b4w_outlining;e.origin_outlining=a.b4w_outlining;e.outline_on_select=X.outlining_overview_mode||a.b4w_outline_on_select;e.billboard=a.b4w_billboard;e.billboard_pres_glob_orientation=a.b4w_pres_glob_orientation;e.billboard_type="BASIC";
e.billboard_spherical="SPHERICAL"==a.b4w_billboard_geometry;h=e.outline_anim_settings_default;h.outline_duration=a.b4w_outline_settings.outline_duration;h.outline_period=a.b4w_outline_settings.outline_period;h.outline_relapses=a.b4w_outline_settings.outline_relapses;e.selectable&&(e.color_id=ea.gen_color_id(U),U++);for(h=0;h<a.data.b4w_vertex_anim.length;h++)d=a.data.b4w_vertex_anim[h],b.vertex_anim.push({name:d.name,frame_start:d.frame_start,frame_end:d.frame_end,averaging:d.averaging,averaging_interval:d.averaging_interval,
allow_nla:d.allow_nla});b.render.vertex_anim=b.vertex_anim.length?!0:!1;if("MESH"!=a.type)throw"Wrong object type: "+a.name;h=b.render;if(a.data.b4w_shape_keys.length)for(h.use_shape_keys=!0,d=0;d<a.data.b4w_shape_keys.length;d++)g={},g.value=a.data.b4w_shape_keys[d].value,g.name=a.data.b4w_shape_keys[d].name,h.shape_keys_values.push(g);else h.use_shape_keys=!1;if(h=G.get_bpy_armobj(a)){var m=h._object,d=m.render.pose_data;var g=b.render,p=a.data;b.armobj=m;p=p.vertex_groups;if(p.length){var m=m.render.bone_pointers,
l=0,z={};for(k in m){var n=ea.keysearch("name",k,p);n&&(z[k]={vgroup_index:n.index,bone_index:m[k].bone_index,deform_bone_index:l++})}g.bone_skinning_info=z;k=l;p=G.get_max_bones();g.max_bones=k;k>2*p?(g.is_skinning=!1,F.error('too many bones for "'+a.name+'" / '+g.max_bones+" bones (max "+p+" with blending, "+2*p+" without blending). Skinning will be disabled.")):g.is_skinning=!0}k=G.extract_skinned_pose_data(d.trans,d.quats,e.bone_skinning_info);h.b4w_animation_mixing?(e.quats_before=new Float32Array(k.quats),
e.quats_after=new Float32Array(k.quats),e.trans_before=new Float32Array(k.trans),e.trans_after=new Float32Array(k.trans)):(e.quats_before=k.quats,e.quats_after=k.quats,e.trans_before=k.trans,e.trans_after=k.trans);e.arm_rel_trans=new Float32Array(4);e.arm_rel_quat=x.create();e.pose_data=k;e.frame_factor=0}k=b.render;h=a.data.materials;d=[];g=[];p=[];m=[];l=[];z=[];for(n=0;n<h.length;n++){var v=h[n],q=v.node_tree;q&&f(q,v.name,q.animation_data,d,g,p,m,l,z)}k.mats_values=d;k.mats_value_inds=g;k.mats_anim_inds=
p;k.mats_rgbs=m;k.mats_rgb_inds=l;k.mats_rgb_anim_inds=z;e.shadow_cast=a.b4w_shadow_cast;e.shadow_receive=a.b4w_shadow_receive;e.shadow_cast_only=a.b4w_shadow_cast_only&&e.shadow_cast;e.reflexible=a.b4w_reflexible;e.reflexible_only=a.b4w_reflexible_only&&e.reflexible;e.reflective=a.b4w_reflective;e.reflection_type=a.b4w_reflection_type;e.caustics=a.b4w_caustics;e.wind_bending=a.b4w_wind_bending;e.wind_bending_angle=a.b4w_wind_bending_angle;k=w.wb_angle_to_amp(a.b4w_wind_bending_angle,e.bb_original,
a.scale[0]);e.wind_bending_amp=k;e.wind_bending_freq=a.b4w_wind_bending_freq;e.detail_bending_freq=a.b4w_detail_bending_freq;e.detail_bending_amp=a.b4w_detail_bending_amp;e.branch_bending_amp=a.b4w_branch_bending_amp;e.hide=!1;e.main_bend_col=a.b4w_main_bend_stiffness_col;k=a.b4w_detail_bend_colors;e.detail_bend_col={};e.detail_bend_col.leaves_stiffness=k.leaves_stiffness_col;e.detail_bend_col.leaves_phase=k.leaves_phase_col;e.detail_bend_col.overall_stiffness=k.overall_stiffness_col;e.do_not_cull=
a.b4w_do_not_cull;e.disable_fogging=a.b4w_disable_fogging;e.dynamic_geometry=a.b4w_dynamic_geometry;if("MESH"!==a.type)throw"Wrong object";k=a.data.materials[0];e.friction=k.physics.friction;e.elasticity=k.physics.elasticity;e.lod_dist_min=0;e.lod_dist_max=1E4;e.lod_transition_ratio=a.b4w_lod_transition;e.last_lod=!0;break;case "CAMERA":C.camera_object_to_camera(a,b);C.assign_boundings(b);break;case "LAMP":y.lamp_to_light(a,b);break;case "SPEAKER":b.sfx=A.create_sfx();e=!1;for(k=0;k<b.scenes_data.length;k++)if(b.scenes_data[k].scene.b4w_enable_audio){e=
!0;break}e&&A.update_object(a,b);break;case "EMPTY":k=t.zero_bounding_box(),e.bb_local=k,k=t.zero_bounding_sphere(),e.bs_local=k,a.field&&(b.field={type:a.field.type,strength:a.field.strength}),a.b4w_anchor&&(b.anchor={type:a.b4w_anchor.type,detect_visibility:a.b4w_anchor.detect_visibility,element_id:a.b4w_anchor.element_id,max_width:a.b4w_anchor.max_width})}N(b)};a.update_object_relations=function(a){var c=a.render;if(a.parent){var d=c.trans,e=c.quat,g=c.scale;!a.parent_is_dupli&&a.physics_settings.use_collision_compound&&
a.parent.physics_settings.use_collision_compound&&(a.use_obj_physics=!1);var k=a.physics_settings;a.is_vehicle||a.is_floating||H.is_character(a)||a.use_obj_physics&&!k.use_ghost&&0<k.mass&&("DYNAMIC"==k.physics_type||"RIGID_BODY"==k.physics_type)?(d=a.parent_is_dupli?S.create_sep(d,g,e):c.tsr,S.multiply(a.parent.render.tsr,d,c.tsr),P.set_translation(a,S.get_trans_view(c.tsr)),P.set_scale(a,S.get_scale(c.tsr)),P.set_rotation(a,S.get_quat_view(c.tsr))):a.parent_is_dupli||!a.parent_bone?(d=S.create_sep(d,
g,e),p.append_child_of(a,a.parent,d)):(d=S.create_sep(d,g,e),p.append_child_of_bone(a,a.parent,a.parent_bone,d))}if("ARMATURE"==a.type)for(d=a.temp_bpy_obj.pose.bones,e=0;e<d.length;e++)if(g=d[e],k=g.constraints)for(var f=0;f<k.length;f++){var h=k[f];"COPY_TRANSFORMS"!=h.type||h.subtarget||h.mute||p.append_stiff_bone_to_obj(a,h.target._object,g.name,ea.VEC3_IDENT,ea.QUAT4_IDENT,1)}if("MESH"==a.type&&c.reflective)if(c=a.render,"CUBE"==c.reflection_type)c.cube_reflection_id=ba++;else if("PLANE"==c.reflection_type){a:{d=
a.temp_bpy_obj.constraints;for(e=0;e<d.length;e++)if(g=d[e],"LOCKED_TRACK"==g.type&&"REFLECTION PLANE"==g.name){d=g.target._object;break a}d=null}d||(d=ea.unique_name("%reflection%"),d=I.create_object(d,"EMPTY"),e=I.create_render("EMPTY"),d.render=e,b(a,d),p.append_stiff_obj(d,a,[0,0,0],null,1),N(d));e=null;for(g=0;g<fa.length;g++)if(fa[g]==d){e=g;break}null==e&&(e=fa.length,fa.push(d));d.render.plane_reflection_id=e;c.plane_reflection_id=e;d.reflective_objs.push(a)}};a.update_force=h;a.copy_scene_data=
b;a.check_bpy_obj_scene_compatibility=l;a.update_objects_dynamics=function(a){for(var b=0;b<a.length;b++){var c=a[b];!c.render||"DYNAMIC"!=c.render.type&&"CAMERA"!=c.render.type||P.update_transform(c);c.use_default_animation&&G.obj_is_animatable(c)&&(G.apply_def(c),c.anim_slots.length&&G.play(c,null,G.SLOT_ALL))}};a.get_meta_tags=function(a){return ea.clone_object_r(a.metatags)};a.cleanup=function(){ba=U=0;fa=[];ja.length=0;R={ALL:[]}};a.copy=function(a,c,d){var e=c,k=I.get_dg_parent(a);c=k?I.gen_dupli_name(k.name,
c):c;if(B(c,R.ALL,!1,-1)){for(var k=1,f;;){f="."+(3>String(k).length?("000"+String(k)).slice(-3):String(k));if(!B(c+f,R.ALL,!1,-1))break;k++}F.error('Object "'+c+'" already exists. Name was replaced by "'+c+f+'".');e+=f;c+=f}e=I.create_object(c,a.type,e);e.is_dynamic=a.is_dynamic;e.is_hair_dupli=a.is_hair_dupli;e.use_default_animation=a.use_default_animation;e.render=I.copy_object_props_by_value(a.render);e.metatags=I.copy_object_props_by_value(a.metatags);b(a,e);e.action_anim_cache=I.copy_bpy_object_props_by_link(a.action_anim_cache);
e.parent=I.copy_bpy_object_props_by_link(a.parent);e.parent_is_dupli=a.parent_is_dupli;e.parent_bone=a.parent_bone;e.temp_bpy_obj=a.temp_bpy_obj;!a.physics||a.is_vehicle||a.is_character||a.is_floating||(e.use_obj_physics=a.use_obj_physics,e.physics=I.copy_object_props_by_value(a.physics));e.physics_settings=I.copy_object_props_by_value(a.physics_settings);c=[];k=ea.gen_uuid();for(f=0;f<a.scenes_data.length;f++){var h=e.scenes_data[f],m=a.scenes_data[f].batches;if(d){for(var h=h.batches,p=0;p<m.length;p++)m[p].forked_batch||
(h.push(I.copy_object_props_by_value(m[p])),c.push(m[p].bufs_data));for(p=0;p<m.length;p++)if(m[p].forked_batch){var l=I.copy_object_props_by_value(m[p]);h.push(l);for(var t=0;t<c.length;t++)c[t]==m[p].bufs_data&&(l.bufs_data=h[t].bufs_data)}for(p=0;p<h.length;p++)h[p].bufs_data&&g.update_gl_buffers(h[p].bufs_data),h[p].odd_id_prop=k,w.update_batch_id(h[p],w.calculate_render_id(e.render))}else h.batches=I.copy_bpy_object_props_by_link(m)}I.scene_data_set_active(e,!1);N(e);e.render.is_copied=!0;e.render.color_id=
ea.gen_color_id(U);U++;return e};a.get_value_node_ind_by_id=k;a.get_rgb_node_ind_by_id=e;a.update_boundings=function(a){for(var b=a.render,c=a.scenes_data[0].batches,d,e,k,f,h,m,p=0;p<c.length;p++){var l=c[p];if("MAIN"==l.type){var l=l.bufs_data.vbo_array,z=c[p].bufs_data.pointers,n=z.a_position.offset,z=z.a_position.length+n;d=f=l[n];e=h=l[n+1];k=m=l[n+2];for(var v=n;v<z;v+=3){var n=l[v],q=l[v+1],B=l[v+2];d=Math.max(n,d);e=Math.max(q,e);k=Math.max(B,k);f=Math.min(n,f);h=Math.min(q,h);m=Math.min(B,
m)}}}var J={max_x:parseFloat(d.toFixed(3)),max_y:parseFloat(e.toFixed(3)),max_z:parseFloat(k.toFixed(3)),min_x:parseFloat(f.toFixed(3)),min_y:parseFloat(h.toFixed(3)),min_z:parseFloat(m.toFixed(3))},A=d-f,x=e-h,y=k-m;f=.5*(d+f);var F=.5*(e+h),C=.5*(k+m),ya=f,D=C;h=Math.max(A,Math.max(x,y))/2;m=Math.max(A,y)/2;var H=[f/(A?A:1),F/(x?x:1),C/(y?y:1)],xa=.5;if(b.billboard)n=Math.max(Math.abs(J.max_x),Math.abs(J.min_x)),q=Math.max(Math.abs(J.max_y),Math.abs(J.min_y)),B=Math.max(Math.abs(J.max_z),Math.abs(J.min_z)),
h=Math.sqrt(n*n+q*q+B*B),m=Math.sqrt(n*n+q*q),J.max_x=J.max_y=J.max_z=h,J.min_x=J.min_y=J.min_z=-h,f=new Float32Array([0,0,0]),y=new Float32Array([h,h,h]),x=new Float32Array([0,0,0]);else{for(p=0;p<c.length;p++)if(l=c[p],"MAIN"==l.type)for(l=l.bufs_data.vbo_array,z=c[p].bufs_data.pointers,n=z.a_position.offset,z=z.a_position.length+n,v=n;v<z;v+=3){var n=l[v],q=l[v+1],B=l[v+2],u=Math.sqrt((f-n)*(f-n)+(F-q)*(F-q)+(C-B)*(C-B));if(u>h){var r=f-h*(n-f)/u,K=F-h*(q-F)/u,u=C-h*(B-C)/u;f=(r+n)/2;F=(K+q)/2;
C=(u+B)/2;h=Math.sqrt((f-n)*(f-n)+(F-q)*(F-q)+(C-B)*(C-B))}K=Math.sqrt((ya-n)*(ya-n)+(D-B)*(D-B));K>m&&(r=ya-m*(n-ya)/K,u=D-m*(B-D)/K,ya=(r+n)/2,D=(u+B)/2,m=Math.sqrt((ya-n)*(ya-n)+(D-B)*(D-B)));n/=A?A:1;q/=x?x:1;B/=y?y:1;u=Math.sqrt((H[0]-n)*(H[0]-n)+(H[1]-q)*(H[1]-q)+(H[2]-B)*(H[2]-B));u>xa&&(r=H[0]-xa*(n-H[0])/u,K=H[1]-xa*(q-H[1])/u,u=H[2]-xa*(B-H[2])/u,H[0]=(r+n)/2,H[1]=(K+q)/2,H[2]=(u+B)/2,xa=Math.sqrt((H[0]-n)*(H[0]-n)+(H[1]-q)*(H[1]-q)+(H[2]-B)*(H[2]-B)))}p=A?A*H[0]:d;e=x?x*H[1]:e;k=y?y*H[2]:
k;A*=xa;x*=xa;y*=xa;f=new Float32Array([f,F,C]);y=new Float32Array([A,x,y]);x=new Float32Array([p,e,k]);m=parseFloat(m.toFixed(3))}b.bb_local=J;w.set_local_cylinder_capsule(b,m,m,J);J=t.create_bounding_sphere(h,f);b.bs_local=J;J=t.create_bounding_ellipsoid([y[0],0,0],[0,y[1],0],[0,0,y[2]],x);b.be_local=J;P.update_transform(a);if(Q.wireframe_debug)for(p=0;p<c.length;p++)if("WIREFRAME"===c[p].type&&c[p].debug_sphere){a=L.generate_uv_sphere(16,8,1,J.center,!1,!1);g.scale_submesh_xyz(a,[J.axis_x[0],J.axis_y[1],
J.axis_z[2]],J.center);g.submesh_drop_indices(a,1,!0);a.va_common.a_polyindex=g.extract_polyindices(a);w.update_batch_geometry(c[p],a);break}};a.get_scene_objs=m;a.get_scene_objs_derived=function(a,b,c){b=R[b]||[];for(var d=[],e=0;e<b.length;e++){var g=b[e];if((g.render.data_id==c||-1==c)&&g.temp_bpy_obj)for(var k=g.scenes_data,f=0;f<k.length;f++)k[f].scene==a&&d.push(g)}return d};a.get_all_objects=function(a){var b=R.ALL;if(-1==a)return b;for(var c=[],d=0;d<b.length;d++){var e=b[d];e.render.data_id==
a&&c.push(e)}return c};a.sort_lamps=function(a){var b=m(a,"LAMP",-1);if(b.length==a._render.num_lamps_added){for(var c=[],d=0;d<b.length;d++){var e=b[d],e=I.get_scene_data(e,a);c[e.light_index]=d}for(d=0;d<c.length-1;d++)for(e=d+1;e<c.length;e++){var g;g=b[c[d]].light;var k=b[c[e]].light;g=!k.use_diffuse||!k.use_specular||g.use_diffuse&&g.use_specular?!g.use_diffuse&&(k.use_diffuse||!g.use_specular&&k.use_specular)?!0:!1:!0;g&&(g=c[d],c[d]=c[e],c[e]=g)}for(d=0;d<c.length;d++)e=b[c[d]],I.get_scene_data(e,
a).light_index=d,K.update_lamp_scene(b[c[d]],a)}};a.update_all_mesh_shaders=function(a){for(var b=m(a,"LAMP",-1),c=m(a,"MESH",-1),d=0;d<c.length;d++)for(var e=I.get_scene_data(c[d],a).batches,g=0;g<e.length;g++){var k=e[g];"MAIN"==k.type&&(w.update_batch_lights(k,b,a),w.update_shader(k))}};a.get_selectable_objects=function(a){a=[];for(var b=R.MESH,c=0;c<b.length;c++){var d=b[c];d.render.selectable&&a.push(d)}return a};a.get_object=function(b,c,d,e){var g=null,k=R.ALL;switch(b){case a.GET_OBJECT_BY_NAME:g=
B(c,k,!0,d);break;case a.GET_OBJECT_BY_DUPLI_NAME:a:{for(b=0;b<k.length;b++)if(g=k[b],g.origin_name==d&&(g.render.data_id==e||-1==e)){var f=I.get_dg_parent(g);if(f&&f.origin_name==c)break a}g=null}break;case a.GET_OBJECT_BY_DUPLI_NAME_LIST:a:{for(e=0;e<k.length;e++){b=k[e];for(var g=c.length-1,f=b,h=!0;0<=g&&h;)h=f&&f.origin_name==c[g]&&(f.render.data_id==d||-1==d),f&&(f=I.get_dg_parent(f)),g--;if(h&&!f){g=b;break a}}g=null}}return g};a.pick_object=function(b,c){var d=K.get_main();if(!d)return F.error("No active scene"),
null;var e=K.pick_color(d,b,c);if(!e)return null;for(var d=m(d,"MESH",-1),g=0;g<d.length;g++){var k=d[g].render,f=k.color_id;if(f&&3>Math.abs(255*f[0]-e[0])&&3>Math.abs(255*f[1]-e[1])&&3>Math.abs(255*f[2]-e[2]))return k.outlining&&k.outline_on_select&&(X.outlining_overview_mode?a.apply_outline_anim(d[g],X.outline_duration,X.outline_period,X.outline_relapses):(e=k.outline_anim_settings_default,a.apply_outline_anim(d[g],e.outline_duration,e.outline_period,e.outline_relapses))),d[g]}return null};a.set_wind_params=
function(a,b){for(var c=m(a,"EMPTY",-1),d=0;d<c.length;d++){var e=c[d];if(e.field&&"WIND"===e.field.type)var g=e}if(!g)return F.error("There is no wind on the scene"),0;"number"==typeof b.wind_dir&&(aa.set(-Math.PI/2,b.wind_dir/180*Math.PI,0,pa),ea.euler_to_quat(pa,na),P.set_rotation(g,na),h(g));"number"==typeof b.wind_strength&&(g.field.strength=b.wind_strength,h(g));K.update_scene_permanent_uniforms(a)};a.remove_object=function(a){p.check_constraint(a)&&p.remove(a);var b=R.ALL,c=R[a.type],d=b.indexOf(a);
a=c.indexOf(a);-1!=d&&b.splice(d,1);-1!=a&&c.splice(a,1)};a.objects_storage_add=N;a.objects_storage_check=function(a){return R[a.type]&&-1<R[a.type].indexOf(a)};a.set_nodemat_rgb=function(a,b,c,d,g){b=b.join("%join%");var k=e(a,b);null!=k?(a.render.mats_rgbs[3*k]=c,a.render.mats_rgbs[3*k+1]=d,a.render.mats_rgbs[3*k+2]=g):F.error('The RGB node "'+b+'" was not found in the object "'+a.name+'".')};a.set_nodemat_value=function(a,b,c){b=b.join("%join%");var d=k(a,b);null!=d?a.render.mats_values[d]=c:F.error('The Value node "'+
b+'" was not found in the object "'+a.name+'".')}};b4w.module.__obj_util=function(a,r){function u(a,b,c){c||(c=a);return{name:a,origin_name:c,type:b,is_meta:!1,is_dynamic:!1,is_hair_dupli:!1,use_default_animation:!1,render:null,constraint:null,sfx:null,light:null,armobj:null,anchor:null,field:null,metatags:null,scenes_data:[],vertex_anim:[],cons_descends:[],cons_armat_bone_descends:[],anim_slots:[],reflective_objs:[],nla_events:[],action_anim_cache:[],sensor_manifolds:null,sensor_manifolds_arr:[],parent:null,parent_is_dupli:!1,parent_bone:"",use_obj_physics:!1,
is_vehicle:!1,is_character:!1,is_floating:!1,physics:null,vehicle:null,floater:null,vehicle_settings:null,floating_settings:null,character_settings:null,physics_constraints:[],physics_settings:{physics_type:"NO_COLLISION",use_ghost:!1,use_sleep:!1,mass:0,velocity_min:0,velocity_max:0,damping:0,rotation_damping:0,lock_location_x:!1,lock_location_y:!1,lock_location_z:!1,lock_rotation_x:!1,lock_rotation_y:!1,lock_rotation_z:!1,collision_margin:0,collision_group:0,collision_mask:0,use_collision_bounds:!1,
collision_bounds_type:"BOX",use_collision_compound:!1},outline_animation:{time_start:0,outline_time:0,period:0,relapses:0},anim_behavior_def:0,actions:[],need_update_transform:!1,temp_bpy_obj:null}}function h(a){if(!(a instanceof Object))return a;var b=null,c=null,f=null;a.textures&&(b=a.textures,a.textures=null);a.texture_names&&(c=a.texture_names,a.texture_names=null);a.shape_keys&&(f=a.shape_keys,a.shape_keys=null);var l;l=a.constructor;switch(l){case Float32Array:case Uint32Array:case Uint16Array:l=
new l(a);break;case Array:l=new l(a.length);for(var n=0;n<a.length;n++)l[n]=h(a[n]);break;case WebGLUniformLocation:case WebGLProgram:case WebGLShader:l=a;break;case WebGLFramebuffer:case WebGLTexture:case WebGLBuffer:l=null;break;case Function:l=a;break;default:for(n in l=new l,a)l[n]=h(a[n])}b&&(l.textures=b,a.textures=b);c&&(l.texture_names=c,a.texture_names=c);f&&(l.shape_keys=f,a.shape_keys=f);return l}function b(a,b){for(var c=a.scenes_data,f=0;f<c.length;f++){var h=c[f];if(h.scene==b)return h}return null}
function l(a){return a.parent_is_dupli?a.parent:a.parent?l(a.parent):null}var c=r("__mat4");r("__print");var f=r("__quat"),n=r("__tsr"),q=r("__vec4");new Float32Array(4);new Float32Array(4);new Float32Array(4);new Float32Array(8);new Float32Array(8);a.create_render=function(a){a={type:a,data_id:0,grid_id:[0,0],trans:new Float32Array(3),quat:new Float32Array(4),tsr:new Float32Array(8),world_matrix:new Float32Array(16),inv_world_matrix:new Float32Array(16),pivot:new Float32Array(3),hover_pivot:new Float32Array(3),
init_dist:0,init_top:0,is_copied:!1,color_id:null,outline_intensity:0,target_cam_upside_down:!1,use_panning:!1,move_style:0,velocity_trans:1,velocity_rot:1,velocity_zoom:1,dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,dof_object:null,underwater:!1,distance_min:0,distance_max:0,use_distance_limits:!1,horizontal_limits:null,vertical_limits:null,hover_angle_limits:null,enable_hover_hor_rotation:!0,cameras:null,outline_anim_settings_default:{outline_duration:1,outline_period:1,outline_relapses:0},
cube_reflection_id:null,plane_reflection_id:null,reflection_plane:new Float32Array(4),friction:0,elasticity:0,lod_dist_min:0,lod_transition_ratio:0,do_not_render:!1,shadow_cast:!1,shadow_receive:!1,shadow_cast_only:!1,reflexible:!1,reflexible_only:!1,reflective:!1,reflection_type:"",caustics:!1,wind_bending:!1,disable_fogging:!1,dynamic_geometry:!1,dynamic_grass:!1,do_not_cull:!1,hide:!1,last_lod:!1,selectable:!1,origin_selectable:!1,outlining:!1,origin_outlining:!1,outline_on_select:!1,is_hair_particles:!1,
is_visible:!1,force_zsort:!1,wind_bending_angle:0,wind_bending_amp:0,wind_bending_freq:0,detail_bending_freq:0,detail_bending_amp:0,branch_bending_amp:0,main_bend_col:"",detail_bend_col:null,bend_center_only:!1,billboard:!1,billboard_pres_glob_orientation:!1,billboard_type:"",billboard_spherical:!1,frame_factor:0,time:0,va_frame:0,va_frame_factor:0,max_bones:0,frames_blending:!1,vertex_anim:!1,use_shape_keys:!1,shape_keys_values:[],is_skinning:!1,anim_mixing:!1,anim_mix_factor:1,anim_mix_factor_change_speed:0,
anim_destination_mix_factor:1,two_last_skeletal_slots:new Int8Array([-1,-1]),skinned_renders:[],mesh_to_arm_bone_maps:[],skinning_data_cache:[],quats_before:null,quats_after:null,trans_before:null,trans_after:null,bone_pointers:null,bone_skinning_info:null,pose_data:null,arm_rel_trans:null,arm_rel_quat:null,mats_values:null,mats_value_inds:null,mats_anim_inds:null,mats_rgbs:null,mats_rgb_inds:null,mats_rgb_anim_inds:null,bb_original:null,bb_local:null,bcyl_local:null,bcap_local:null,bcon_local:null,
bb_world:null,bs_local:null,bs_world:null,be_local:null,be_world:null,scale:1,lod_dist_max:1E4};f.identity(a.quat);n.identity(a.tsr);c.identity(a.world_matrix);c.identity(a.inv_world_matrix);return a};a.create_object=u;a.create_meta_object=function(a,b){var c=u(a,b);c.is_meta=!0;return c};a.copy_bpy_object_props_by_link=function(a){return a instanceof Array?a.slice():a};a.copy_object_props_by_value=h;a.is_dynamic=function(a){return a.is_dynamic};a.is_dynamic_mesh=function(a){return"MESH"==a.type&&
a.is_dynamic};a.append_scene_data=function(a,b){a.scenes_data.push({scene:b,is_active:!1,batches:[],plane_refl_subs:null,cube_refl_subs:null,shadow_subscenes:[],light_index:0,obj_has_nla_on_scene:!1})};a.append_batch=function(a,c,e){b(a,c).batches.push(e)};a.remove_scene_data=function(a,b){for(var c=a.scenes_data,f=0;f<c.length;f++)if(c[f].scene==b){c.splice(f,1);break}};a.get_scene_data=b;a.update_refl_objects=function(a,b){for(var c=0;c<a.length;c++)q.copy(b,a[c].render.reflection_plane)};a.scene_data_set_active=
function(a,b,c){for(var f=0;f<a.scenes_data.length;f++){var h=a.scenes_data[f];c&&h.scene!=c||(h.is_active=b)}};a.get_first_lamp_with_shadows=function(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.light.generate_shadows)return c}return null};a.gen_dupli_name=function(a,b){return a+"*"+b};a.get_parent=function(a){return a.parent_is_dupli?null:a.parent};a.get_dg_parent=l;a.get_dg_objects=function(a,b){for(var c=[],f=0;f<b.length;f++){var h=b[f];l(h)==a&&c.push(h)}return c};a.is_mesh=function(a){return"MESH"===
a.type};a.is_armature=function(a){return"ARMATURE"===a.type};a.is_speaker=function(a){return"SPEAKER"===a.type};a.is_camera=function(a){return"CAMERA"===a.type};a.is_lamp=function(a){return"LAMP"===a.type};a.is_empty=function(a){return"EMPTY"===a.type}};b4w.module.__particles=function(a,r){function u(a,b,k,f,h,l,t){var n=a.delay_attrs,D=a.emitter_tsr_snapshots,p=a.time;a=a.prev_time;for(var g=b?4:1,y=0;y<n.length;y+=g){var v=n[y];if(p>a&&p>=v&&v>a||p<a&&(v>a||p>=v))for(v=0;8>v;v++)D[8*y+v]=h[v];for(v=0;8>v;v++)q[v]=D[8*y+v];v=d;v[0]=k[3*y];v[1]=k[3*y+1];v[2]=k[3*y+2];c.transform_vec3(v,q,v);l[3*y]=v[0];l[3*y+1]=v[1];l[3*y+2]=v[2];var u=d;u[0]=f[3*y];u[1]=f[3*y+1];u[2]=f[3*y+2];c.transform_dir_vec3(u,q,u);t[3*y]=u[0];t[3*y+1]=u[1];t[3*y+2]=u[2];if(b)for(v=
1;4>v;v++)l[3*(y+v)]=l[3*y],l[3*(y+v)+1]=l[3*y+1],l[3*(y+v)+2]=l[3*y+2],t[3*(y+v)]=u[0],t[3*(y+v)+1]=u[1],t[3*(y+v)+2]=u[2]}}function h(a){a?(f.srand(a),k=function(){return f.rand()}):k=function(){return Math.random()}}r("__config");var b=r("__geometry");r("__scenes");var l=r("__time"),c=r("__tsr"),f=r("__util"),n=r("__vec3"),q=new Float32Array(8),d=new Float32Array(3),k=function(){throw"_rand() undefined";};a.obj_has_particles=function(a){a=a.scenes_data;for(var b=0;b<a.length;b++)for(var c=a[b].batches,
d=0;d<c.length;d++)if(c[d].particles_data)return!0;return!1};a.obj_has_anim_particles=function(a){a=a.scenes_data;for(var b=0;b<a.length;b++)for(var c=a[b].batches,d=0;d<c.length;d++){var k=c[d].particles_data;if(k&&"EMITTER"==k.p_type)return!0}return!1};a.bpy_obj_has_particles=function(a){return 0<a.particle_systems.length};a.bpy_obj_has_anim_particles=function(a){for(var b=0;b<a.particle_systems.length;b++)if("EMITTER"==a.particle_systems[b].settings.type)return!0;return!1};a.has_dynamic_grass_particles=
function(a){for(var b=0;b<a.particle_systems.length;b++){var c=a.particle_systems[b].settings;if("HAIR"==c.type&&c.b4w_dynamic_grass)return!0}return!1};a.init_particles_data=function(a,b,c){var d={name:b.name,p_type:b.settings.type,time:0,prev_time:-1,use_world_space:!1,frame_start:0,frame_end:0,time_length:0,lifetime_frames:0,lifetime:0,cyclic:!1,mass:0,nfactor:0,gravity:0,fade_in:0,fade_out:0,wind_factor:0,size:0,alpha_start:0,alpha_end:0,size_ramp_length:0,color_ramp_length:0,size_ramp:new Float32Array(8),
color_ramp:new Float32Array(16),positions:null,positions_cache:null,normals:null,normals_cache:null,delay_attrs:null,delay_attrs_masked:null,emitter_tsr_snapshots:null},d=a.particles_data=d;d.frame_start=b.settings.frame_start;d.frame_end=b.settings.frame_end;d.time_length=(d.frame_end-d.frame_start)/l.get_framerate();d.lifetime_frames=b.settings.lifetime;d.lifetime=d.lifetime_frames/l.get_framerate();d.cyclic=b.settings.b4w_cyclic?1:0;d.mass=b.settings.mass;d.nfactor=b.settings.normal_factor;d.gravity=
9.81*b.settings.effector_weights.gravity;d.fade_in=b.settings.b4w_fade_in/l.get_framerate();d.fade_out=b.settings.b4w_fade_out/l.get_framerate();d.wind_factor=b.settings.effector_weights.wind;d.use_world_space="WORLD"==b.settings.b4w_coordinate_system?!0:!1;var k,f;a.halo_particles?(a=c.halo.size,k=c.halo.hardness,30>k?(k=.5,f=.9):40>k?(k=.1,f=1):50>k?(k=0,f=.8):(k=0,f=.5)):(a=b.settings.particle_size,f=k=1);d.size=a;d.alpha_start=k;d.alpha_end=f;a=b.settings.texture_slots;b=[-1,0,-1,0,-1,0,-1,0];
if(a[0]&&a[0].use_map_size&&a[0].texture&&"BLEND"==a[0].texture.type&&a[0].texture.use_color_ramp){a=a[0].texture.color_ramp.elements;k=Math.min(2*a.length,b.length);for(f=0;f<k;f+=2){var h=a[f/2];b[f]=h.position;b[f+1]=(h.color[0]+h.color[1]+h.color[2])/3}d.size_ramp_length=a.length}d.size_ramp.set(b);b=c.texture_slots;c=[-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0];if(b[0]&&"STRAND"==b[0].texture_coords&&b[0].texture&&"BLEND"==b[0].texture.type&&b[0].texture.use_color_ramp){a=b[0].texture.color_ramp.elements;
k=Math.min(4*a.length,c.length);for(f=0;f<k;f+=4)h=a[f/4],c[f]=h.position,c[f+1]=h.color[0],c[f+2]=h.color[1],c[f+3]=h.color[2];d.color_ramp_length=a.length}d.color_ramp.set(c)};a.generate_emitter_particles_submesh=function(a,c,d,q){var r=a.particles_data,w=d.settings.count,t=d.settings.frame_start/l.get_framerate(),C=d.settings.frame_end/l.get_framerate(),D=d.settings.lifetime/l.get_framerate(),p=d.settings.lifetime_random,g=d.settings.emit_from,y=d.settings.factor_random,v=d.settings.angular_velocity_mode,
I=d.settings.angular_velocity_factor,z=d.settings.b4w_randomize_emission,H=d.settings.b4w_cyclic,F=!a.halo_particles;h(d.seed);c=b.extract_submesh_all_mats(c,["a_position","a_normal"],null);switch(g){case "VERT":d=c.va_frames[0].a_position;c=c.va_frames[0].a_normal;for(var L=d.length/3,g=[],x=0;x<w;x++){var K=Math.round((L-1)*k());g.push(K);F&&(g.push(K),g.push(K),g.push(K))}L=[];for(x=0;x<g.length;x++)L.push(d[3*g[x]]),L.push(d[3*g[x]+1]),L.push(d[3*g[x]+2]);d=new Float32Array(L);L=[];for(x=0;x<
g.length;x++)L.push(c[3*g[x]]),L.push(c[3*g[x]+1]),L.push(c[3*g[x]+2]);g=new Float32Array(L);break;case "FACE":d=[];g=[];x=[];f.init_rand_r_seed(0,x);L=b.geometry_random_points(c,w,!1,x);f.init_rand_r_seed(0,x);c=b.geometry_random_points(c,w,!0,x);for(x=0;x<L.length;x++)d.push(L[x][0],L[x][1],L[x][2]),F&&(d.push(L[x][0],L[x][1],L[x][2]),d.push(L[x][0],L[x][1],L[x][2]),d.push(L[x][0],L[x][1],L[x][2])),g.push(c[x][0],c[x][1],c[x][2]),F&&(g.push(c[x][0],c[x][1],c[x][2]),g.push(c[x][0],c[x][1],c[x][2]),
g.push(c[x][0],c[x][1],c[x][2]));d=new Float32Array(d);g=new Float32Array(g);break;case "VOLUME":throw"Particle emission from volume is not supported";default:throw"Wrong emit from option";}g=[d,g];c=g[0];g=g[1];r.positions=new Float32Array(c);r.normals=new Float32Array(g);r.positions_cache=new Float32Array(c.length);r.normals_cache=new Float32Array(g.length);d=[];C=(C-t)/w;for(L=0;L<w;L++)x=z?C*L+10*C*(.5-k()):C*L,H||(x+=t),d.push(x),F&&(d.push(x),d.push(x),d.push(x));t=new Float32Array(d);r.delay_attrs=
new Float32Array(t);r.delay_attrs_masked=new Float32Array(t);r.emitter_tsr_snapshots=new Float32Array(8*t.length);for(z=0;z<8*t.length;z++)for(H=0;8>H;H++)r.emitter_tsr_snapshots[8*z+H]=q[H];r.use_world_space&&u(r,F,c,g,q,c,g);q=f.create_empty_submesh("EMITTER_PARTICLES");r=f.create_empty_va_frame();r.a_position=c;r.a_normal=g;q.va_frames[0]=r;if(F){a.draw_mode=b.DM_DYNAMIC_TRIANGLES;a=[];for(r=0;r<w;r++)a.push(4*r,4*r+2,4*r+1,4*r,4*r+3,4*r+2);a=new Uint16Array(a);q.indices=a;a=q.va_common;r=[];for(z=
0;z<w;z++)r.push(-.5,-.5,-.5,.5,.5,.5,.5,-.5);r=new Float32Array(r);a.a_p_bb_vertex=r}else a.draw_mode=b.DM_DYNAMIC_POINTS,q.indices=new Uint16Array(0);q.base_length=c.length/3;q.va_common.a_p_delay=t;a=q.va_common;r=[];p*=D;for(t=0;t<w;t++)z=p*k(),r.push(D-z),F&&(r.push(D-z),r.push(D-z),r.push(D-z));D=new Float32Array(r);a.a_p_lifetime=D;D=q.va_common;p=[];for(a=0;a<w;a++){r=[k()-.5,k()-.5,k()-.5];n.normalize(r,r);p.push(y*r[0]);p.push(y*r[1]);p.push(y*r[2]);switch(v){case "NONE":p.push(0);break;
case "SPIN":case "VELOCITY":p.push(I);break;case "RAND":p.push(2*I*(k()-.5));break;default:throw"Undefined velocity factor";}if(F)for(r=p.slice(-4),t=0;12>t;t++)p.push(r[t%4])}w=new Float32Array(p);D.a_p_vels=w;return q};a.update_emitter_transform=function(a,c){for(var d=0;d<c.length;d++){var k=c[d],f=c[d].particles_data;if(f){var h=k.bufs_data;if(!f.use_world_space)break;var l=f.positions_cache,n=f.normals_cache;u(f,!k.halo_particles,f.positions,f.normals,a.render.tsr,l,n);b.make_dynamic(h);b.update_bufs_data_array(h,
"a_position",3,l);b.update_bufs_data_array(h,"a_normal",3,n)}}};a.set_time=function(a,b,c){a=a.scenes_data;for(var d=0;d<a.length;d++)for(var k=a[d].batches,f=0;f<k.length;f++){var h=k[f].particles_data;h&&h.name==b&&(h.prev_time=h.time,h.time=c)}};a.prepare_lens_flares=function(a){for(var b=a.base_length,c=a.va_frames[0].a_position,d=a.va_common.a_texcoord,k=[],f=[],h=0;h<b;h++)f.push(c[3*h]),f.push(c[3*h+1]),k.push(c[3*h+2]);k=new Float32Array(k);f=new Float32Array(f);a.va_common.a_lf_dist=k;a.va_common.a_lf_bb_vertex=
f;a.va_common.a_texcoord=d;return a};a.set_size=function(a,b,c){a=a.scenes_data;for(var d=0;d<a.length;d++)for(var k=a[d].batches,f=0;f<k.length;f++){var h=k[f].particles_data;h&&h.name==b&&(h.size=c)}};a.set_normal_factor=function(a,b,c){a=a.scenes_data;for(var d=0;d<a.length;d++)for(var k=a[d].batches,f=0;f<k.length;f++){var h=k[f].particles_data;h&&h.name==b&&(h.nfactor=c)}};a.set_factor=function(a,c,d){a=a.scenes_data;for(var k=0;k<a.length;k++)for(var f=a[k].batches,h=0;h<f.length;h++){var l=
f[h],n=l.particles_data;if(n&&n.name==c){var q=n.delay_attrs;if(1==d)n=q;else if(0==d)for(var p=!l.halo_particles,g=p?4:1,n=n.delay_attrs_masked,y=0;y<n.length;y+=g)n[y]=1E4,p&&(n[y+1]=n[y],n[y+2]=n[y],n[y+3]=n[y]);else for(var v=1/d,n=n.delay_attrs_masked,g=(p=!l.halo_particles)?4:1,u=0,y=0;y<n.length;y+=g)y>=u?(n[y]=q[y],u+=v):n[y]=1E4,p&&(n[y+1]=n[y],n[y+2]=n[y],n[y+3]=n[y]);b.update_bufs_data_array(l.bufs_data,"a_p_delay",1,n)}}};a.update_start_pos=function(a,b,c){a=a.scenes_data;for(var d=0;d<
a.length;d++)for(var k=a[d].batches,f=0;f<k.length;f++){var h=k[f].particles_data;if(h)for(var l=0;l<8*h.delay_attrs.length;l++)h.emitter_tsr_snapshots[8*l]=b[0],h.emitter_tsr_snapshots[8*l+1]=b[1],h.emitter_tsr_snapshots[8*l+2]=b[2],h.emitter_tsr_snapshots[8*l+3]=b[3],h.emitter_tsr_snapshots[8*l+4]=c[0],h.emitter_tsr_snapshots[8*l+5]=c[1],h.emitter_tsr_snapshots[8*l+6]=c[2],h.emitter_tsr_snapshots[8*l+7]=c[3]}}};b4w.module.__primitives=function(a,r){function u(a,b,c,f){for(var h=[],l=[],q=[],u=[],t=2*c/(a-1),C=2*f/(b-1),D=0;D<a;D++)for(var p=-c+D*t,g=0;g<b;g++)if(l.push(p,0,-f+g*C),q.push(0,1,0),u.push(D/(a-1),g/(b-1)),D&&g){var y=D*b+g,v=y-1,r=(D-1)*b+g,z=r-1;h.push(y,v,r);h.push(v,z,r)}a=n.create_empty_va_frame();a.a_position=new Float32Array(l);a.a_normal=new Float32Array(q);q=n.create_empty_submesh("GRID_PLANE");q.va_frames[0]=a;q.va_common.a_texcoord=new Float32Array(u);q.indices=new Uint32Array(h);
q.base_length=l.length/3;return q}function h(a){var b=a.length;if(b%4)throw"Wrong array";for(var c=[],f=[],h=0;h<b;h+=4){var q=a[h+1],u=a[h+2],r=a[h+3];l(a[h],f);l(q,f);l(u,f);l(r,f);c.push(h,h+1,h+2);c.push(h,h+2,h+3)}a=n.create_empty_va_frame();a.a_position=new Float32Array(f);b=n.create_empty_submesh("FROM_QUADS");b.va_frames[0]=a;b.indices=new Uint32Array(c);b.base_length=f.length/3;return b}function b(a,b){var c=3*b;return[a[c],a[c+1],a[c+2]]}function l(a,b){b.push(a[0],a[1],a[2])}var c=r("__config"),
f=r("__geometry");r("__print");var n=r("__util"),q=c.defaults;a.generate_lines=function(a){for(var b=n.create_empty_submesh("LINE"),c=[],f=0;f<2*a;f++)c.push(f);f=n.create_empty_va_frame();f.a_point=new Float32Array(c);b.va_frames[0]=f;b.indices=new Uint32Array(c);b.base_length=2*a;return b};a.generate_plane=function(a,b){var c=u(2,2,a,b);c.name="PLANE";return c};a.generate_grid=u;a.generate_multigrid=function(a,b,c){function h(a,b){return 1==a%2&&(0==b||b==w-1)||1==b%2&&(0==a||a==r-1)?!0:!1}var l=
c/=Math.pow(2,a-1),u=c,r=b+1,w=b+1;b=[];c=[];for(var t=0,C=0,D=-1,p=[],g=0;g<a;g++){for(var y=2*l/(r-1),v=2*u/(w-1),I=[],z=[],H=0,F=0;F<r;F++){for(var L=-l+F*y,x=[],K=0;K<w;K++){var A=-u+K*v;if(L>-t&&L<t&&A>-C&&A<C)x.push(-1),H++;else{for(var P=null,S=0;S<p.length;S+=3)if(L==p[S]&&A==p[S+1]){P=p[S+2];break}S=null!==P?P:D+1;h(F,K)?(x.push(-2),H++):(null==P&&(0==K||K==w-1||0==F||F==r-1?(P=g==a-1?y:2*y,I.push(L,A,S)):P=y,c.push(L,P,A),D++),x.push(S));if(F&&K)if(1==F)if(h(F-1,K)){if(1<K){var A=S-1,P=
z[F-1][K+1],ea=P-1;b.push(S,A,ea)}else P=z[F-1][K+1],ea=P-1;b.push(S,ea,P)}else h(F,K)||(A=S-1,P=z[F-1][K],b.push(S,A,P));else if(F==r-1){if(!h(F,K))if(K==w-1)A=S-1,P=z[F-1][K-1],ea=z[F-2][K],b.push(S,A,P),b.push(S,P,ea);else{var A=S-1,P=z[F-1][K],ea=P-1,aa=P+1;b.push(S,A,ea);b.push(S,ea,P);b.push(S,P,aa);2==K&&(aa=z[F-2][K-2],b.push(A,aa,ea))}}else 1==K?h(F,K-1)?(A=z[F-1][K],P=z[F-1][K-1],b.push(S,P,A)):(A=x[K-1],P=z[F-1][K],ea=z[F-2][K-1],b.push(S,A,P),b.push(A,ea,P)):K==w-1?h(F,K)||(A=x[K-1],P=
z[F-1][K-1],ea=z[F-2][K],b.push(S,A,P),b.push(S,P,ea)):-1!=z[F-1][K]&&-1!=z[F-1][K-1]&&-1!=x[K-1]?(A=x[K-1],P=z[F-1][K],ea=z[F-1][K-1],b.push(S,A,P),b.push(A,ea,P),K==w-2&&h(F,K+1)&&(aa=z[F-1][K+1],b.push(S,P,aa))):K==w-2&&h(F,K+1)&&(P=z[F-1][K],aa=z[F-1][K+1],b.push(S,P,aa))}}z.push(x)}p=I;t=l;C=u;l*=2;u*=2}2E4>t&&(a=-(2*t)/(r-1),c.push(-2E4,a,-2E4),c.push(-2E4,a,2E4),c.push(-t,a,-C),c.push(-t,a,C),c.push(2E4,a,-2E4),c.push(2E4,a,2E4),c.push(t,a,-C),c.push(t,a,C),S=D+1,b.push(S+3,S+2,S+1,S+2,S+0,
S+1,S+6,S+4,S+2,S+4,S+0,S+2,S+5,S+7,S+1,S+7,S+3,S+1,S+5,S+4,S+7,S+7,S+4,S+6));a=n.create_empty_va_frame();a.a_position=new Float32Array(c);l=n.create_empty_submesh("multigrid_plane");l.va_frames[0]=a;l.indices=new Uint32Array(b);l.base_length=c.length/3;q.water_wireframe_debug&&(f.submesh_drop_indices(l,1,!0),a.a_polyindex=f.extract_polyindices(l));return l};a.generate_from_triangles=function(a){var b=a.length;if(b%3)throw"Wrong array";for(var c=[],f=[],h=0;h<b;h+=3){var q=a[h+1],u=a[h+2];l(a[h],
f);l(q,f);l(u,f);c.push(h,h+1,h+2)}a=n.create_empty_va_frame();a.a_position=new Float32Array(f);b=n.create_empty_submesh("FROM_TRIANGLES");b.va_frames[0]=a;b.indices=new Uint32Array(c);b.base_length=f.length/3;return b};a.generate_from_quads=h;a.generate_frustum=function(a){a=n.vectorize(a,[]);var b=[];b.push(a[0],a[1],a[2],a[3]);b.push(a[0],a[3],a[5],a[4]);b.push(a[3],a[2],a[6],a[5]);b.push(a[1],a[7],a[6],a[2]);b.push(a[0],a[4],a[7],a[1]);b.push(a[4],a[5],a[6],a[7]);a=h(b);a.name="FRUSTUM";return a};
a.generate_fullscreen_tri=function(){var a=n.create_empty_submesh("FULLSCREEN_TRI"),b=n.create_empty_va_frame();b.a_position=new Float32Array([0,0,1,0,0,1]);a.va_frames[0]=b;a.indices=new Uint32Array([0,1,2]);a.base_length=3;return a};a.generate_fullscreen_quad=function(){var a=n.create_empty_submesh("FULLSCREEN_QUAD"),b=n.create_empty_va_frame();b.a_position=new Float32Array([-1,1,1,1,-1,-1,1,-1]);a.va_frames[0]=b;a.indices=new Uint32Array([0,2,1,1,2,3]);a.base_length=4;return a};a.generate_billboard=
function(){var a=n.create_empty_submesh("BILLBOARD"),b=n.create_empty_va_frame();b.a_bb_vertex=new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]);a.va_frames[0]=b;a.indices=new Uint32Array([0,2,1,0,3,2]);a.base_length=4;return a};a.generate_cube=function(){var a=n.create_empty_submesh("CUBEMAP_BOARD"),b=n.create_empty_va_frame();b.a_position=new Float32Array([-1,-1,-1,1,1,1,1,-1]);a.va_frames[0]=b;a.indices=new Uint32Array([0,2,1,0,3,2]);a.base_length=4;return a};a.generate_uv_sphere=function(a,c,e,
h,q,u){var r=n.create_empty_submesh("UV_SPHERE"),w,t,C=[],D=[],p=[];for(t=0;t<=c;t++)for(w=0;w<=a;w++){var g=w/a,y=t/c,v=-e*Math.cos(2*g*Math.PI)*Math.sin(y*Math.PI),I=e*Math.cos(y*Math.PI),g=e*Math.sin(2*g*Math.PI)*Math.sin(y*Math.PI);q&&(v=1E-5>Math.abs(v)?0:v,I=1E-5>Math.abs(I)?0:I,g=1E-5>Math.abs(g)?0:g);D.push(v+h[0],I+h[1],g+h[2])}for(t=q=0;t<c;t++)for(w=0;w<a;w++)v=b(D,(a+1)*t+w+1),I=b(D,(a+1)*t+w),g=b(D,(a+1)*(t+1)+w),y=b(D,(a+1)*(t+1)+w+1),Math.abs(v[1])==e+h[1]?(l(v,C),l(g,C),l(y,C),u?p.push(q,
q+1,q+1,q+2,q+2,q):p.push(q,q+1,q+2),q+=3):Math.abs(g[1])==e+h[1]?(l(v,C),l(I,C),l(g,C),u?p.push(q,q+1,q+1,q+2,q+2,q):p.push(q,q+1,q+2),q+=3):(l(v,C),l(I,C),l(g,C),l(y,C),u?(p.push(q,q+1),p.push(q+1,q+2),p.push(q+2,q+3),p.push(q+3,q)):(p.push(q,q+1,q+2),p.push(q,q+2,q+3)),q+=4);a={};a.a_position=C;u?a.a_normal=[]:(u=f.calc_shared_indices(p,D,C),a.a_normal=f.calc_normals(p,C,u));a.a_tangent=[];r.va_common.a_influence=[];r.va_common.a_color=[];r.va_common.a_texcoord=[];r.va_frames[0]=a;r.indices=p;
r.base_length=C.length/3;return r};a.generate_index=function(a){var b=n.create_empty_submesh("INDEX"),c=n.create_empty_va_frame();c.a_index=new Float32Array(a);for(var f=0;f<a;f++)c.a_index[f]=f;b.va_frames[0]=c;b.indices=new Uint16Array(0);b.base_length=a;return b}};b4w.module.__prerender=function(a,r){function u(a,c){var d=a.obj_render,h=c.camera;d.is_visible=!1;if(!d||d.hide)return!1;var l=h.eye,n=d.bs_world.center,q=d.lod_dist_min,t=d.lod_dist_max,l=Math.sqrt((n[0]-l[0])*(n[0]-l[0])+(n[1]-l[1])*(n[1]-l[1])+(n[2]-l[2])*(n[2]-l[2])),n=d.lod_transition_ratio*d.bs_world.radius;if(!(l>=q&&l<t+n))return!1;d.is_visible=!0;if("OUTLINE_MASK"==c.type&&!Boolean(d.outline_intensity))return!1;h=h.frustum_planes;d.do_not_cull?d=!1:"STATIC"===d.type?(q=d.bs_world,d=q.center,
d=f.sphere_is_out_of_frustum(d,h,q.radius)):(q=d.be_world,d=q.center,d=f.ellipsoid_is_out_of_frustum(d,h,q.axis_x,q.axis_y,q.axis_z));return d?!1:"WIREFRAME"==c.type?a.batch.wireframe_mode==b.WM_DEBUG_SPHERES?a.batch.debug_sphere:!a.batch.debug_sphere:!0}var h=r("__config"),b=r("__debug"),l=r("__geometry"),c=r("__renderer"),f=r("__util"),n=r("__vec3"),q=h.defaults,d="MAIN_OPAQUE MAIN_BLEND MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT MAIN_GLOW SHADOW_CAST DEPTH OUTLINE_MASK WIREFRAME COLOR_PICKING MAIN_XRAY COLOR_PICKING_XRAY".split(" ");
a.prerender_subs=function(a){if(-1<d.indexOf(a.type)){for(var b=!1,f=a.bundles,h=0;h<f.length;h++){var r=f[h];if("MAIN_CUBE_REFLECT"==a.type)for(var G=0;6>G;G++)a.camera.frustum_planes=a.cube_cam_frustums[G],r.do_render_cube[G]=u(r,a),r.do_render_cube[G]&&(b=!0);else r.do_render=u(r,a),r.do_render&&(b=!0)}switch(a.type){case "WIREFRAME":break;default:"MAIN_OPAQUE"===a.type||"DEPTH"===a.type||b?a.do_render=!0:(a.do_render&&c.clear(a),a.do_render=!1)}}if("MAIN_BLEND"==a.type&&q.alpha_sort&&a.bundles){b=
a.camera.eye;f=n.dist(b,a.zsort_eye_last)>q.alpha_sort_threshold;for(h=0;h<a.bundles.length;h++)if(G=a.bundles[h],r=G.obj_render,r.force_zsort||f){var w=G.batch;if(w&&w.blend&&w.zsort_type!=l.ZSORT_DISABLED){w=w.bufs_data;if(!w||!G.do_render)continue;(G=w.info_for_z_sort_updates)&&G.type==l.ZSORT_BACK_TO_FRONT&&l.update_buffers_movable(w,r.world_matrix,b)}r.force_zsort=!1}f&&n.copy(b,a.zsort_eye_last)}}};b4w.module.__print=function(a,r){function u(a,b){var h=[];-1<a[0].indexOf("%c")?h.push(a[0].replace("%c","%c"+b+": ")):h.push(b+": "+a[0]);for(var l=1;l<a.length;l++)h.push(a[l]);return h}var h=!1,b=0,l=0;a.set_verbose=function(a){h=a};a.log_raw=function(){console.log.apply(console,arguments)};a.log=function(){if(h){var a=u(arguments,"B4W LOG");console.log.apply(console,a)}};a.error=function(){b++;var a=u(arguments,"B4W ERROR");console.error.apply(console,a)};a.warn=function(){l++;var a=u(arguments,
"B4W WARN");console.warn.apply(console,a)};a.info=function(){var a=u(arguments,"B4W INFO");console.info.apply(console,a)};a.export_error=function(){b++;var a=u(arguments,"B4W EXPORT ERROR");console.error.apply(console,a)};a.export_warn=function(){l++;var a=u(arguments,"B4W EXPORT WARNING");console.warn.apply(console,a)};a.time=function(){h&&console.time.apply(console,arguments)};a.timeEnd=function(){h&&console.timeEnd.apply(console,arguments)};a.group=function(){h&&console.group.apply(console,arguments)};
a.groupCollapsed=function(){h&&console.groupCollapsed.apply(console,arguments)};a.groupEnd=function(){h&&console.groupEnd.apply(console,arguments)};a.clear=function(){"function"==typeof console.clear&&console.clear.apply(console,arguments)};a.get_warning_count=function(){return l};a.get_error_count=function(){return b};a.clear_errors_warnings=function(){b=l=0}};b4w.module.print=b4w.module.__print;b4w.module.__reformer=function(a,r){function u(a){switch(a.type){case "MAPPING":a.vector_type||(a.vector_type="POINT",b("node Mapping",a,"vector_type"));break;case "MATERIAL":case "MATERIAL_EXT":"alpha"in a||(a.alpha=1,b("node material",a,"alpha"));"darkness"in a||(a.darkness=1,b("node material",a,"darkness"));"diffuse_toon_size"in a||(a.diffuse_toon_size=.5,b("node material",a,"diffuse_toon_size"));"diffuse_toon_smooth"in a||(a.diffuse_toon_smooth=.1,b("node material",a,"diffuse_toon_smooth"));"diffuse_intensity"in
a||(a.diffuse_intensity=1,b("node material",a,"diffuse_intensity"));"specular_shader"in a||(a.specular_shader="COOKTORR",b("node material",a,"specular_shader"));"specular_ior"in a||(a.specular_ior=4,b("node material",a,"specular_ior"));"specular_hardness"in a||(a.specular_hardness=50,b("node material",a,"specular_hardness"));"specular_slope"in a||(a.specular_slope=.1,b("node material",a,"specular_slope"));"specular_toon_size"in a||(a.specular_toon_size=.5,b("node material",a,"specular_toon_size"));
"specular_toon_smooth"in a||(a.specular_toon_smooth=.1,b("node material",a,"specular_toon_smooth"));"specular_intensity"in a||(a.specular_intensity=.5,b("node material",a,"specular_intensity"));"diffuse_shader"in a||(a.diffuse_shader="LAMBERT",b("node material",a,"diffuse_shader"));"roughness"in a||(a.roughness=.5,b("node material",a,"roughness"));"diffuse_fresnel"in a||(a.diffuse_fresnel=.1,b("node material",a,"diffuse_fresnel"));"diffuse_fresnel_factor"in a||(a.diffuse_fresnel_factor=.5,b("node material",
a,"diffuse_fresnel_factor"));break;case "MATH":case "MIX_RGB":"use_clamp"in a||(a.use_clamp=!1,b("node "+a.type,a,"use_clamp"));break;case "GROUP":switch(a.node_tree_name=a.node_tree_name.replace(/\.[0-9]{3,}$/g,""),a.node_tree_name){case "CLAMP":case "LEVELS_OF_QUALITY":case "LINEAR_TO_SRGB":case "NORMAL_VIEW":case "PARALLAX":case "REFLECT":case "REFRACTION":case "REPLACE":case "SMOOTHSTEP":case "SRGB_TO_LINEAR":case "TIME":case "TRANSLUCENCY":case "VECTOR_VIEW":a.node_tree_name="B4W_"+a.node_tree_name}}}
function h(a){if(a=a.nla_tracks)for(var c=0;c<a.length;c++)for(var d=a[c],e=0;e<d.strips.length;e++){var f=d.strips[e];"action"in f||(f.action=null,b("strip",f,"action"));"action_frame_start"in f||(f.action_frame_start=0,b("strip",f,"action_frame_start"));"action_frame_end"in f||(f.action_frame_end=f.frame_end-f.frame_start,b("strip",f,"action_frame_end"));"repeat"in f||(f.repeat=1,b("strip",f,"repeat"));"use_reverse"in f||(f.use_reverse=!1,b("strip",f,"use_reverse"));"scale"in f||(f.scale=1,b("strip",
f,"scale"))}}function b(a,b,c){c=c+">>"+a;c in G||(G[c]={storage:[],report_type:"undefined",type:a});G[c].storage.push(b.name)}function l(a,b,c){c=c+">>"+a;c in G||(G[c]={storage:[],report_type:"deprecated",type:a});G[c].storage.push(b.name)}function c(a,b){b||(b=a.name+"_COPY");var c=a.materials,d=a.submeshes;a.materials=null;a.submeshes=null;var f=e.clone_object_json(a);a.materials=c;a.submeshes=d;f.name=b;f.materials=a.materials.slice(0);f.submeshes=[];for(c=0;c<d.length;c++){var g=e.clone_object_nr(d[c]);
f.submeshes.push(g)}return f}var f=r("__boundings"),n=r("__curve"),q=r("__mat4"),d=r("__print"),k=r("__quat"),e=r("__util"),m=r("__vec3"),B=r("__vec4"),N=[5,4],G={};a.check_particles_bin_format=function(a){return-1!=e.version_cmp(a,N)};a.check_bpy_data=function(a){G={};var c=a.worlds;if(0==c.length){d.warn('WARNING Datablock world is missing, reexport "'+a.b4w_filepath_blend+'" scene');var f={name:"DEFAULT",horizon_color:new Float32Array([0,0,0]),zenith_color:new Float32Array([0,0,0]),light_settings:{use_environment_light:!1,
environment_energy:1,environment_color:"PLAIN"},fog_settings:{use_fog:!1,intensity:0,depth:25,start:5,height:0,falloff:"INVERSE_QUADRATIC",use_custom_color:!0,color:[.5,.5,.5]},use_sky_paper:!1,use_sky_blend:!1,use_sky_real:!1,texture_slots:[]};c.push(f)}for(var c=a.worlds,k=0;k<c.length;k++){f=c[k];"use_sky_blend"in f||(b("world",f,"use_sky_blend"),f.use_sky_blend=!1);"use_sky_paper"in f||(b("world",f,"use_sky_paper"),f.use_sky_paper=!1);"use_sky_real"in f||(b("world",f,"use_sky_real"),f.use_sky_real=
!1);"b4w_sky_settings"in f&&"rayleigh_brightness"in f.b4w_sky_settings||(b("world",f,"rayleigh_brightness"),f.b4w_sky_settings={render_sky:!1,procedural_skydome:!1,use_as_enviroment_map:!1,color:[.24,.43,.75],rayleigh_brightness:3.3,mie_brightness:.1,spot_brightness:10,scatter_strength:.2,rayleigh_strength:.2,mie_strength:.006,rayleigh_collection_power:.5,mie_collection_power:.5,mie_distribution:.4});"fog_settings"in f||(b("world",f,"fog_settings"),f.fog_settings={use_fog:!1,intensity:0,depth:25,
start:0,height:0,falloff:"QUADRATIC",use_custom_color:!0,color:[.5,.5,.5]},"b4w_fog_color"in f&&(f.fog_settings.use_custom_color=!0,f.fog_settings.color=f.b4w_fog_color),"b4w_fog_density"in f&&0<f.b4w_fog_density&&(f.fog_settings.depth=1/f.b4w_fog_density));"render_sky"in f.b4w_sky_settings||(b("world",f,"render_sky"),f.b4w_sky_settings.render_sky=!1);for(var p=f.texture_slots,f=0;f<p.length;f++){var g=p[f];"blend_type"in g||(g.blend_type="MIX",b("world_texture_slot",g,"blend_type"));"use_map_blend"in
g||(g.use_map_blend=!1,b("world_texture_slot",g,"use_map_blend"));"use_map_horizon"in g||(g.use_map_horizon=!0,b("world_texture_slot",g,"use_map_horizon"));"use_map_zenith_up"in g||(g.use_map_zenith_up=!1,b("world_texture_slot",g,"use_map_zenith_up"));"use_rgb_to_intensity"in g||(g.use_rgb_to_intensity=!1,b("world_texture_slot",g,"use_rgb_to_intensity"));"invert"in g||(g.invert=!1,b("world_texture_slot",g,"invert"));"color"in g||(g.color=[1,0,1],b("world_texture_slot",g,"color"));"blend_factor"in
g||(g.blend_factor=0,b("world_texture_slot",g,"blend_factor"));"horizon_factor"in g||(g.horizon_factor=1,b("world_texture_slot",g,"horizon_factor"));"zenith_up_factor"in g||(g.zenith_up_factor=0,b("world_texture_slot",g,"zenith_up_factor"));"zenith_down_factor"in g||(g.zenith_down_factor=0,b("world_texture_slot",g,"zenith_down_factor"));"default_value"in g||(g.default_value=1,b("world_texture_slot",g,"default_value"))}}f=a.scenes;for(k=0;k<f.length;k++)p=f[k],g=p.world,"timeline_markers"in p||(p.timeline_markers=
null,b("scene",p,"timeline_markers")),"b4w_reflection_quality"in p||(p.b4w_reflection_quality="MEDIUM",b("scene",p,"b4w_reflection_quality")),"b4w_use_nla"in p||(p.b4w_use_nla=!1,b("scene",p,"b4w_use_nla")),"fps"in p||(p.fps=24,b("scene",p,"fps")),"b4w_nla_cyclic"in p||(p.b4w_nla_cyclic=!1,b("scene",p,"b4w_nla_cyclic")),"b4w_logic_nodes"in p||(p.b4w_logic_nodes=[],b("scene",p,"b4w_logic_nodes")),"b4w_detect_collisions"in p&&(l("scene",p,"b4w_detect_collisions"),delete p.b4w_detect_collisions),"audio_doppler_speed"in
p||(p.audio_doppler_speed=343.3),"audio_doppler_factor"in p||(p.audio_doppler_factor=1),"b4w_dynamic_compressor_settings"in p||(p.b4w_dynamic_compressor_settings={threshold:-24,knee:30,ratio:12,attack:.003,release:.25},b("scene",p,"b4w_dynamic_compressor_settings")),"b4w_enable_convolution_engine"in p||(p.b4w_enable_convolution_engine=!1),"b4w_enable_bloom"in p||(p.b4w_enable_bloom=!1,b("scene",p,"b4w_enable_bloom")),"b4w_enable_motion_blur"in p||(p.b4w_enable_motion_blur=!1,b("scene",p,"b4w_enable_motion_blur")),
"b4w_enable_color_correction"in p||(p.b4w_enable_color_correction=!1,b("scene",p,"b4w_enable_color_correction")),"b4w_enable_antialiasing"in p||(p.b4w_enable_antialiasing=!0,b("scene",p,"b4w_enable_antialiasing")),"b4w_tags"in p||(p.b4w_tags={title:"",description:""},b("scene",p,"b4w_tags")),"b4w_enable_object_selection"in p||(p.b4w_enable_object_selection="AUTO",b("scene",p,"b4w_enable_object_selection")),"b4w_enable_outlining"in p||(p.b4w_enable_outlining="AUTO",b("scene",p,"b4w_enable_outlining")),
"b4w_enable_glow_materials"in p||(p.b4w_enable_glow_materials="AUTO",b("scene",p,"b4w_enable_glow_materials")),"b4w_enable_anchors_visibility"in p||(p.b4w_enable_anchors_visibility="AUTO",b("scene",p,"b4w_enable_anchors_visibility")),"b4w_outline_color"in p||(p.b4w_outline_color=[1,1,1],b("scene",p,"b4w_outline_color")),"b4w_outline_factor"in p||(p.b4w_outline_factor="b4w_glow_factor"in p?p.b4w_glow_factor:1,b("scene",p,"b4w_outline_factor")),"b4w_shadow_settings"in p||(b("scene",p,"b4w_shadow_settings"),
c=g.b4w_shadow_settings,p.b4w_shadow_settings=c?c:{csm_resolution:2048,self_shadow_polygon_offset:1,b4w_enable_csm:!1,csm_num:1,csm_first_cascade_border:10,first_cascade_blur_radius:3,csm_last_cascade_border:100,last_cascade_blur_radius:1.5,fade_last_cascade:!0,blend_between_cascades:!0}),c=p.b4w_shadow_settings,"csm_resolution"in c||(b("scene",p,"b4w_shadow_settings.csm_resolution"),c.csm_resolution=2048),"self_shadow_polygon_offset"in c||(b("scene",p,"b4w_shadow_settings.self_shadow_polygon_offset"),
c.self_shadow_polygon_offset=1),"self_shadow_normal_offset"in c||(b("scene",p,"b4w_shadow_settings.self_shadow_normal_offset"),c.self_shadow_normal_offset=.01),"b4w_enable_csm"in c||(b("scene",p,"b4w_shadow_settings.b4w_enable_csm"),c.b4w_enable_csm=!1),"csm_num"in c||(b("scene",p,"b4w_shadow_settings.csm_num"),c.csm_num=1),"csm_first_cascade_border"in c||(b("scene",p,"b4w_shadow_settings.csm_first_cascade_border"),c.csm_first_cascade_border=10),"first_cascade_blur_radius"in c||(b("scene",p,"b4w_shadow_settings.first_cascade_blur_radius"),
c.first_cascade_blur_radius=3),"csm_last_cascade_border"in c||(b("scene",p,"b4w_shadow_settings.csm_last_cascade_border"),c.csm_last_cascade_border=100),"last_cascade_blur_radius"in c||(b("scene",p,"b4w_shadow_settings.last_cascade_blur_radius"),c.last_cascade_blur_radius=1.5),"fade_last_cascade"in c||(b("scene",p,"b4w_shadow_settings.fade_last_cascade"),c.fade_last_cascade=!0),"blend_between_cascades"in c||(b("scene",p,"b4w_shadow_settings.blend_between_cascades"),c.blend_between_cascades=!0),"b4w_ssao_settings"in
p||(b("scene",p,"b4w_ssao_settings"),c=g.b4w_ssao_settings,p.b4w_ssao_settings=c?c:{dist_factor:0,samples:16,hemisphere:!1,blur_depth:!1,blur_discard_value:1}),c=p.b4w_ssao_settings,"dist_factor"in c||(b("scene",p,"b4w_ssao_settings.dist_factor"),c.dist_factor=0),"samples"in c||(b("scene",p,"b4w_ssao_settings.samples"),c.samples=16),"hemisphere"in c||(b("scene",p,"b4w_ssao_settings.hemisphere"),c.hemisphere=!1),"blur_depth"in c||(b("scene",p,"b4w_ssao_settings.blur_depth"),c.blur_depth=!1),"blur_discard_value"in
c||(b("scene",p,"b4w_ssao_settings.blur_discard_value"),c.blur_discard_value=1),"b4w_bloom_settings"in p||(b("scene",p,"b4w_bloom_settings"),c=g.b4w_bloom_settings,p.b4w_bloom_settings=c?c:{key:.2,blur:4,edge_lum:1}),"key"in p.b4w_bloom_settings||(b("scene",p,"b4w_bloom_settings.key"),p.b4w_bloom_settings.key=.2),"blur"in p.b4w_bloom_settings||(b("scene",p,"b4w_bloom_settings.blur"),p.b4w_bloom_settings.blur=4),"edge_lum"in p.b4w_bloom_settings||(b("scene",p,"b4w_bloom_settings.edge_lum"),p.b4w_bloom_settings.edge_lum=
1),"b4w_motion_blur_settings"in p||(b("scene",p,"b4w_motion_blur_settings"),c=g.b4w_motion_blur_settings,p.b4w_motion_blur_settings=c?c:{motion_blur_factor:.01,motion_blur_decay_threshold:.01}),"motion_blur_factor"in p.b4w_motion_blur_settings||(b("scene",p,"b4w_motion_blur_settings.motion_blur_factor"),p.b4w_motion_blur_settings.motion_blur_factor=.01),"motion_blur_decay_threshold"in p.b4w_motion_blur_settings||(b("scene",p,"b4w_motion_blur_settings.motion_blur_decay_threshold"),p.b4w_motion_blur_settings.motion_blur_decay_threshold=
.01),"b4w_color_correction_settings"in p||(b("scene",p,"b4w_color_correction_settings"),c=g.b4w_color_correction_settings,p.b4w_color_correction_settings=c?c:{brightness:0,contrast:0,exposure:1,saturation:1}),"b4w_god_rays_settings"in p||(b("scene",p,"b4w_god_rays_settings"),c=g.b4w_god_rays_settings,p.b4w_god_rays_settings=c?c:{intensity:.7,max_ray_length:1,steps_per_pass:10}),"steps_per_pass"in p.b4w_god_rays_settings||(b("scene",p,"b4w_god_rays_settings.steps_per_pass"),p.b4w_god_rays_settings.steps_per_pass=
10),"b4w_glow_settings"in p||(b("scene",p,"b4w_glow_settings"),p.b4w_glow_settings={render_glow_over_blend:!1,small_glow_mask_coeff:2,large_glow_mask_coeff:2,small_glow_mask_width:2,large_glow_mask_width:6},c=p.b4w_glow_settings,"b4w_render_glow_over_blend"in g&&(c.render_glow_over_blend=g.b4w_render_glow_over_blend),"b4w_small_glow_mask_coeff"in g&&(c.small_glow_mask_coeff=g.b4w_small_glow_mask_coeff),"b4w_large_glow_mask_coeff"in g&&(c.large_glow_mask_coeff=g.b4w_large_glow_mask_coeff),"b4w_small_glow_mask_width"in
g&&(c.small_glow_mask_width=g.b4w_small_glow_mask_width),"b4w_large_glow_mask_width"in g&&(c.large_glow_mask_width=g.b4w_large_glow_mask_width)),g=p.b4w_render_shadows,"AUTO"!=g&&"OFF"!=g&&"ON"!=g&&(p.b4w_render_shadows=g?"ON":"OFF"),g=p.b4w_render_reflections,"OFF"!=g&&"ON"!=g&&(p.b4w_render_reflections=g?"ON":"OFF"),g=p.b4w_render_refractions,"AUTO"!=g&&"OFF"!=g&&"ON"!=g&&(p.b4w_render_refractions=g?"ON":"OFF"),p.b4w_nla_script&&l("scene",p,"b4w_nla_script");p=a.meshes;for(k=0;k<p.length;k++){g=
p[k];g.b4w_bounding_box||(b("mesh",g,"b4w_bounding_box"),g.b4w_bounding_box={max_x:0,max_y:0,max_z:0,min_x:0,min_y:0,min_z:0});g.b4w_bounding_box_source||(b("mesh",g,"b4w_bounding_box_source"),g.b4w_bounding_box_source=g.b4w_bounding_box);g.uv_textures||(b("mesh",g,"uv_textures"),g.uv_textures=[]);g.b4w_bounding_sphere_center||(g.b4w_bounding_sphere_center=[0,0,0]);g.b4w_bounding_cylinder_center||(g.b4w_bounding_cylinder_center=[0,0,0]);g.b4w_bounding_ellipsoid_center||(g.b4w_bounding_ellipsoid_center=
[0,0,0]);g.b4w_bounding_ellipsoid_axes||(f=g.b4w_bounding_box,g.b4w_bounding_ellipsoid_axes=[(f.max_x-f.min_x)/2,(f.max_y-f.min_y)/2,(f.max_z-f.min_z)/2]);"b4w_shape_keys"in g||(g.b4w_shape_keys=[],b("mesh",g,"b4w_shape_keys"));for(var f=g,c=["b4w_apply_scale","b4w_apply_modifiers","b4w_export_edited_normals","b4w_loc_export_vertex_anim","b4w_shape_keys"],m=null,n=0;n<c.length;n++)f[c[n]]&&(m?(f[c[n]]=!1,d.warn('WARNING property "'+c[n]+'" of object "'+f.name+'" has been set to "false". Foreground property "'+
m+'" already exists.')):m=c[n]);for(f=0;f<g.b4w_vertex_anim.length;f++)c=g.b4w_vertex_anim[f],"allow_nla"in c||(b('mesh["b4w_vertex_anim"]',g,"allow_nla"),c.allow_nla=!0)}f=a.cameras;for(k=0;k<f.length;k++)p=f[k],p.type||(p.type="PERSP",b("camera",p,"type")),"b4w_eye_target_dist"in p&&(delete p.b4w_eye_target_dist,l("camera",p,"b4w_eye_target_dist")),"b4w_hover_zero_level"in p||(p.b4w_hover_zero_level=0,b("camera",p,"b4w_hover_zero_level")),"b4w_trans_velocity"in p||(p.b4w_trans_velocity=1,b("camera",
p,"b4w_trans_velocity")),"b4w_rot_velocity"in p||(p.b4w_rot_velocity=1,b("camera",p,"b4w_rot_velocity")),"b4w_zoom_velocity"in p||(p.b4w_zoom_velocity=.1,b("camera",p,"b4w_zoom_velocity")),"b4w_use_distance_limits"in p||(p.b4w_use_distance_limits=!1,b("camera",p,"b4w_use_distance_limits")),"b4w_distance_min"in p||(p.b4w_distance_min=1,b("camera",p,"b4w_distance_min")),"b4w_distance_max"in p||(p.b4w_distance_max=100,b("camera",p,"b4w_distance_max")),"b4w_horizontal_translation_min"in p||(p.b4w_horizontal_translation_min=
-100,b("camera",p,"b4w_horizontal_translation_min")),"b4w_horizontal_translation_max"in p||(p.b4w_horizontal_translation_max=100,b("camera",p,"b4w_horizontal_translation_max")),"b4w_vertical_translation_min"in p||(p.b4w_vertical_translation_min=-100,b("camera",p,"b4w_vertical_translation_min")),"b4w_vertical_translation_max"in p||(p.b4w_vertical_translation_max=100,b("camera",p,"b4w_vertical_translation_max")),"b4w_use_horizontal_clamping"in p||(p.b4w_use_horizontal_clamping=!1,b("camera",p,"b4w_use_horizontal_clamping")),
"b4w_rotation_left_limit"in p||(p.b4w_rotation_left_limit=-Math.PI,b("camera",p,"b4w_rotation_left_limit")),"b4w_rotation_right_limit"in p||(p.b4w_rotation_right_limit=Math.PI,b("camera",p,"b4w_rotation_right_limit")),"b4w_horizontal_clamping_type"in p||(p.b4w_horizontal_clamping_type="LOCAL",b("camera",p,"b4w_horizontal_clamping_type")),"b4w_use_vertical_clamping"in p||(p.b4w_use_vertical_clamping=!1,b("camera",p,"b4w_use_vertical_clamping")),"b4w_rotation_down_limit"in p||(p.b4w_rotation_down_limit=
-Math.PI/2,b("camera",p,"b4w_rotation_down_limit")),"b4w_rotation_up_limit"in p||(p.b4w_rotation_up_limit=Math.PI/2,b("camera",p,"b4w_rotation_up_limit")),"b4w_vertical_clamping_type"in p||(p.b4w_vertical_clamping_type="LOCAL",b("camera",p,"b4w_vertical_clamping_type")),"b4w_hover_angle_min"in p||(p.b4w_hover_angle_min=Math.PI/6,b("camera",p,"b4w_hover_angle_min")),"b4w_hover_angle_max"in p||(p.b4w_hover_angle_max=Math.PI/6,b("camera",p,"b4w_hover_angle_max")),"b4w_enable_hover_hor_rotation"in p||
(p.b4w_enable_hover_hor_rotation=!0,b("camera",p,"b4w_enable_hover_hor_rotation")),"b4w_use_panning"in p||(p.b4w_use_panning=!0,b("camera",p,"b4w_use_panning"));f=a.lamps;for(k=0;k<f.length;k++)p=f[k],"b4w_generate_shadows"in p||(p.b4w_generate_shadows=!1,b("lamp",p,"b4w_generate_shadows")),"b4w_dynamic_intensity"in p||(p.b4w_dynamic_intensity=!1,b("lamp",p,"b4w_dynamic_intensity")),"use_diffuse"in p||(p.use_diffuse=!0,b("lamp",p,"use_diffuse")),"use_specular"in p||(p.use_specular=!0,b("lamp",p,"use_specular"));
f=a.speakers;for(k=0;k<f.length;k++)p=f[k],"b4w_behavior"in p||(p.b4w_behavior=p.b4w_background_music?"BACKGROUND_SOUND":"POSITIONAL"),"b4w_disable_doppler"in p||(p.b4w_disable_doppler=!1),"b4w_delay"in p||(p.b4w_delay=0),"b4w_delay_random"in p||(p.b4w_delay_random=0),"b4w_volume_random"in p||(p.b4w_volume_random=0),"b4w_pitch_random"in p||(p.b4w_pitch_random=0),"b4w_fade_in"in p||(p.b4w_fade_in=0),"b4w_fade_out"in p||(p.b4w_fade_out=0),"b4w_loop"in p||(p.b4w_loop=!1),"b4w_loop_count"in p||(p.b4w_loop_count=
0),"b4w_loop_count_random"in p||(p.b4w_loop_count_random=0),"b4w_playlist_id"in p||(p.b4w_playlist_id=""),p.animation_data&&h(p.animation_data);f=a.textures;for(k=0;k<f.length;k++)p=f[k],"b4w_anisotropic_filtering"in p||(p.b4w_anisotropic_filtering="OFF",b("texture",p,"b4w_anisotropic_filtering")),"b4w_water_foam"in p||(p.b4w_water_foam=!1,b("texture",p,"b4w_water_foam")),"b4w_foam_uv_freq"in p||(p.b4w_foam_uv_freq=[1,1],b("texture",p,"b4w_foam_uv_freq")),"b4w_foam_uv_magnitude"in p||(p.b4w_foam_uv_magnitude=
[1,1],b("texture",p,"b4w_foam_uv_magnitude")),"b4w_parallax_steps"in p||(p.b4w_parallax_steps=5,b("material",p,"b4w_parallax_steps")),"b4w_parallax_lod_dist"in p||(p.b4w_parallax_lod_dist=10,b("material",p,"b4w_parallax_lod_dist")),"b4w_shore_dist_map"in p||(p.b4w_shore_dist_map=!1,b("texture",p,"b4w_shore_dist_map")),"b4w_shore_boundings"in p||(p.b4w_shore_boundings=new Float32Array(4),p.b4w_shore_boundings=[1E3,-1E3,1E3,-1E3],b("texture",p,"b4w_shore_boundings")),"b4w_max_shore_dist"in p||(p.b4w_max_shore_dist=
100,b("texture",p,"b4w_max_shore_dist")),"b4w_disable_compression"in p||(p.b4w_disable_compression=!1,b("texture",p,"b4w_disable_compression")),"b4w_source_type"in p||(p.b4w_source_type="",b("texture",p,"b4w_source_type")),"b4w_source_id"in p||(p.b4w_source_id="",b("texture",p,"b4w_source_id")),"b4w_source_size"in p||(p.b4w_source_size=1024,b("texture",p,"b4w_source_size")),"b4w_enable_canvas_mipmapping"in p||(p.b4w_enable_canvas_mipmapping=!0,b("texture",p,"b4w_enable_canvas_mipmapping")),"b4w_nla_video"in
p||(p.b4w_nla_video=!1,b("texture",p,"b4w_nla_video"));c=a.materials;for(k=0;k<c.length;k++){m=c[k];"b4w_node_mat_type"in m&&l("material",m,"b4w_node_mat_type");"b4w_skydome"in m&&l("material",m,"b4w_skydome");"b4w_procedural_skydome"in m&&l("material",m,"b4w_procedural_skydome");m.b4w_water&&("b4w_water_shore_smoothing"in m||(m.b4w_water_shore_smoothing=!1,b("material",m,"b4w_water_shore_smoothing")),"b4w_water_dynamic"in m||(m.b4w_water_dynamic=!1,b("material",m,"b4w_water_dynamic")),"b4w_waves_height"in
m||(m.b4w_waves_height=1,b("material",m,"b4w_waves_height")),"b4w_waves_length"in m||(m.b4w_waves_length=1,b("material",m,"b4w_waves_length")),"b4w_water_dst_noise_scale0"in m||(m.b4w_water_dst_noise_scale0=.05,b("material",m,"b4w_water_dst_noise_scale0")),"b4w_water_dst_noise_scale1"in m||(m.b4w_water_dst_noise_scale1=.03,b("material",m,"b4w_water_dst_noise_scale1")),"b4w_water_dst_noise_freq0"in m||(m.b4w_water_dst_noise_freq0=1.3,b("material",m,"b4w_water_dst_noise_freq0")),"b4w_water_dst_noise_freq1"in
m||(m.b4w_water_dst_noise_freq1=1,b("material",m,"b4w_water_dst_noise_freq1")),"b4w_water_dir_min_shore_fac"in m||(m.b4w_water_dir_min_shore_fac=.4,b("material",m,"b4w_water_dir_min_shore_fac")),"b4w_water_dir_freq"in m||(m.b4w_water_dir_freq=.5,b("material",m,"b4w_water_dir_freq")),"b4w_water_dir_noise_scale"in m||(m.b4w_water_dir_noise_scale=.05,b("material",m,"b4w_water_dir_noise_scale")),"b4w_water_dir_noise_freq"in m||(m.b4w_water_dir_noise_freq=.07,b("material",m,"b4w_water_dir_noise_freq")),
"b4w_water_dir_min_noise_fac"in m||(m.b4w_water_dir_min_noise_fac=.5,b("material",m,"b4w_water_dir_min_noise_fac")),"b4w_water_dst_min_fac"in m||(m.b4w_water_dst_min_fac=.2,b("material",m,"b4w_water_dst_min_fac")),"b4w_water_waves_hor_fac"in m||(m.b4w_water_waves_hor_fac=5,b("material",m,"b4w_water_waves_hor_fac")),"b4w_water_absorb_factor"in m||(m.b4w_water_absorb_factor=6,b("material",m,"b4w_water_absorb_factor")),"b4w_water_fog_color"in m||(m.b4w_water_fog_color=new Float32Array(3),m.b4w_water_fog_color=
[.5,.7,.7],b("material",m,"b4w_water_fog_color")),"b4w_foam_factor"in m||(m.b4w_foam_factor=5,b("material",m,"b4w_foam_factor")),"b4w_generated_mesh"in m||(m.b4w_generated_mesh=!1,b("material",m,"b4w_generated_mesh")),"b4w_water_num_cascads"in m||(m.b4w_water_num_cascads=5,b("material",m,"b4w_water_num_cascads")),"b4w_water_subdivs"in m||(m.b4w_water_subdivs=64,b("material",m,"b4w_water_subdivs")),"b4w_water_detailed_dist"in m||(m.b4w_water_detailed_dist=1E3,b("material",m,"b4w_water_detailed_dist")),
"b4w_water_enable_caust"in m||(m.b4w_water_enable_caust=!1,b("material",m,"b4w_water_enable_caust")),"b4w_water_caust_scale"in m||(m.b4w_water_caust_scale=.25,b("material",m,"b4w_water_caust_scale")),"b4w_water_caust_brightness"in m||(m.b4w_water_caust_brightness=.5,b("material",m,"b4w_water_caust_brightness")));"b4w_dynamic_grass_size"in m||(m.b4w_dynamic_grass_size="");"b4w_dynamic_grass_color"in m||(m.b4w_dynamic_grass_color="");"diffuse_intensity"in m||(m.diffuse_intensity=1,b("material",m,"diffuse_intensity"));
"b4w_use_ghost"in m||(m.b4w_use_ghost=!1);"b4w_collision_margin"in m||(m.b4w_collision_margin=.04,b("material",m,"b4w_collision_margin"));"b4w_collision_group"in m||(m.b4w_collision_group=128,b("material",m,"b4w_collision_group"));"b4w_collision_mask"in m||(m.b4w_collision_mask=127,b("material",m,"b4w_collision_mask"));"b4w_do_not_render"in m||(m.b4w_do_not_render=!1,b("material",m,"b4w_do_not_render"));"HALO"!=m.type||"b4w_halo_sky_stars"in m||(m.b4w_halo_sky_stars=!1,b("material",m,"b4w_halo_sky_stars"));
"HALO"!=m.type||"b4w_halo_stars_blend_height"in m||(m.b4w_halo_stars_blend_height=10,b("material",m,"b4w_halo_stars_blend_height"));"HALO"!=m.type||"b4w_halo_stars_min_height"in m||(m.b4w_halo_stars_min_height=0,b("material",m,"b4w_halo_stars_min_height"));"specular_shader"in m||(m.specular_shader="COOKTORR",b("material",m,"specular_shader"));"diffuse_shader"in m||(m.diffuse_shader="LAMBERT",b("material",m,"diffuse_shader"));"roughness"in m||(m.roughness=.5,b("material",m,"roughness"));"diffuse_fresnel"in
m||(m.diffuse_fresnel=.1,b("material",m,"diffuse_fresnel"));"diffuse_fresnel_factor"in m||(m.diffuse_fresnel_factor=.5,b("material",m,"diffuse_fresnel_factor"));"specular_slope"in m||(m.specular_slope=.2,b("material",m,"specular_slope"));"specular_toon_size"in m||(m.specular_toon_size=.5,b("material",m,"specular_toon_size"));"specular_toon_smooth"in m||(m.specular_toon_smooth=.1,b("material",m,"specular_toon_smooth"));"specular_alpha"in m||(m.specular_alpha=1,b("material",m,"specular_alpha"));"b4w_wettable"in
m||(m.b4w_wettable=!1,b("material",m,"b4w_wettable"));"b4w_refractive"in m||(m.b4w_refractive=!1,b("material",m,"b4w_refractive"));"b4w_refr_bump"in m||(m.b4w_refr_bump=0,b("material",m,"b4w_refr_bump"));"b4w_shallow_water_col"in m||(m.b4w_shallow_water_col=[0,.8,.3],b("material",m,"b4w_shallow_water_col"));"b4w_shore_water_col"in m||(m.b4w_shore_water_col=[0,.9,.2],b("material",m,"b4w_shore_water_col"));"b4w_shallow_water_col_fac"in m||(m.b4w_shallow_water_col_fac=1,b("material",m,"b4w_shallow_water_col_fac"));
"b4w_shore_water_col_fac"in m||(m.b4w_shore_water_col_fac=.5,b("material",m,"b4w_shore_water_col_fac"));"b4w_water_sss_strength"in m||(m.b4w_water_sss_strength=5.9,b("material",m,"b4w_water_sss_strength"));"b4w_water_sss_width"in m||(m.b4w_water_sss_width=.45,b("material",m,"b4w_water_sss_width"));"b4w_render_above_all"in m||(m.b4w_render_above_all=!1,b("material",m,"b4w_render_above_all"));"b4w_water_norm_uv_velocity"in m||(m.b4w_water_norm_uv_velocity=.05,b("material",m,"b4w_water_norm_uv_velocity"));
"specular_ior"in m||(m.specular_ior=1,b("material",m,"specular_ior"));"darkness"in m||(m.darkness=0,b("material",m,"darkness"));"diffuse_toon_size"in m||(m.diffuse_toon_size=0,b("material",m,"diffuse_toon_size"));"diffuse_toon_smooth"in m||(m.diffuse_toon_smooth=0,b("material",m,"diffuse_toon_smooth"));p=m.texture_slots;for(f=0;f<p.length;f++)g=p[f],"blend_type"in g||(g.blend_type="MIX",b("texture_slot",g,"blend_type"));if(m.node_tree){p=m.node_tree.nodes;for(f=0;f<p.length;f++)u(p[f]);m.node_tree.animation_data&&
h(m.node_tree.animation_data)}}g=a.node_groups;for(k=0;k<g.length;k++)for(p=g[k].node_tree.nodes,f=0;f<p.length;f++)u(p[f]);p=a.objects;for(k=0;k<p.length;k++){g=p[k];switch(g.type){case "MESH":"b4w_dynamic_geometry"in g||(g.b4w_dynamic_geometry=!1);"b4w_reflexible"in g||(g.b4w_reflexible=!1);"b4w_reflexible_only"in g||(g.b4w_reflexible_only=!1);"b4w_reflective"in g||(g.b4w_reflective=!1);"b4w_reflection_type"in g||(g.b4w_reflection_type="PLANE",b("object",g,"b4w_reflection_type"));"b4w_wind_bending"in
g||(g.b4w_wind_bending=!1,b("object",g,"b4w_wind_bending"));"b4w_wind_bending_angle"in g||(g.b4w_wind_bending_angle=10,g.b4w_wind_bending_freq=.25,b("object",g,"wind bending params"));"b4w_detail_bending_amp"in g||(g.b4w_detail_bending_amp=.1,g.b4w_branch_bending_amp=.3,b("object",g,"detail bending params"));"b4w_detail_bending_freq"in g||(g.b4w_detail_bending_freq=1,b("object",g,"b4w_detail_bending_freq"));"b4w_main_bend_stiffness_col"in g||(g.b4w_main_bend_stiffness_col="",b("object",g,"b4w_main_bend_stiffness_col"));
"b4w_detail_bend_colors"in g||(g.b4w_detail_bend_colors={leaves_stiffness_col:"",leaves_phase_col:"",overall_stiffness_col:""},b("object",g,"b4w_detail_bend_colors"));"b4w_caustics"in g||(g.b4w_caustics=!1);"vertex_groups"in g&&g.vertex_groups.length&&g.data&&0==g.data.vertex_groups.length&&(g.data.vertex_groups=g.vertex_groups,delete g.vertex_groups,b("object",g,"vertex_groups"));"b4w_vertex_anim"in g&&g.b4w_vertex_anim.length&&g.data&&0==g.data.b4w_vertex_anim.length&&(g.data.b4w_vertex_anim=g.b4w_vertex_anim,
delete g.b4w_vertex_anim,b("object",g,"b4w_vertex_anim"));"b4w_do_not_render"in g||(g.b4w_do_not_render=!1);"use_ghost"in g.game||(g.game.use_ghost=!1);"use_sleep"in g.game||(g.game.use_sleep=!1);"velocity_min"in g.game||(g.game.velocity_min=0);"velocity_max"in g.game||(g.game.velocity_max=0);"collision_group"in g.game||(g.game.collision_group=1);"collision_mask"in g.game||(g.game.collision_mask=255);"b4w_vehicle_settings"in g?g.b4w_vehicle_settings&&("steering_ratio"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.steering_ratio=
10),"steering_max"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.steering_max=1),"inverse_control"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.inverse_control=!1),"force_max"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.force_max=1500),"brake_max"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.brake_max=100),"speed_ratio"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.speed_ratio=.027),"max_speed_angle"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.max_speed_angle=Math.PI),
"delta_tach_angle"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.delta_tach_angle=4.43),"suspension_compression"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.suspension_compression=4.4),"suspension_stiffness"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.suspension_stiffness=20),"suspension_damping"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.suspension_damping=2.3),"wheel_friction"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.wheel_friction=1E3),"roll_influence"in g.b4w_vehicle_settings||
(g.b4w_vehicle_settings.roll_influence=.1),"max_suspension_travel_cm"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.max_suspension_travel_cm=30),"floating_factor"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.floating_factor=3),"floating_factor"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.floating_factor=3),"water_lin_damp"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.water_lin_damp=.9),"water_rot_damp"in g.b4w_vehicle_settings||(g.b4w_vehicle_settings.water_rot_damp=.9)):(g.b4w_vehicle_settings=
null,b("object",g,"b4w_vehicle_settings"));"b4w_floating_settings"in g?g.b4w_floating_settings&&("floating_factor"in g.b4w_floating_settings||(g.b4w_floating_settings.floating_factor=3),"water_lin_damp"in g.b4w_floating_settings||(g.b4w_floating_settings.water_lin_damp=.8),"water_rot_damp"in g.b4w_floating_settings||(g.b4w_floating_settings.water_rot_damp=.8)):(g.b4w_floating_settings=null,b("object",g,"b4w_floating_settings"));"b4w_character_settings"in g?g.b4w_character_settings&&("walk_speed"in
g.b4w_character_settings||(g.b4w_character_settings.walk_speed=4),"run_speed"in g.b4w_character_settings||(g.b4w_character_settings.run_speed=8),"step_height"in g.b4w_character_settings||(g.b4w_character_settings.step_height=.25),"jump_strength"in g.b4w_character_settings||(g.b4w_character_settings.jump_strength=5),"waterline"in g.b4w_character_settings||(g.b4w_character_settings.waterline=0)):(g.b4w_character_settings=null,b("object",g,"b4w_character_settings"));"b4w_selectable"in g||(g.b4w_selectable=
!1,b("object",g,"b4w_selectable"));"b4w_outlining"in g||(g.b4w_outlining=!1,b("object",g,"b4w_outlining"));"b4w_outline_on_select"in g||(g.b4w_outline_on_select=!1,b("object",g,"b4w_outline_on_select"));"b4w_billboard"in g||(g.b4w_billboard=!1,b("object",g,"b4w_billboard"));"b4w_billboard_geometry"in g||(g.b4w_billboard_geometry="SPHERICAL",b("object",g,"b4w_billboard_geometry"));"b4w_pres_glob_orientation"in g||(g.b4w_pres_glob_orientation=!1,b("object",g,"b4w_pres_glob_orientation"));"b4w_outline_settings"in
g||("b4w_glow_settings"in g?g.b4w_outline_settings=g.b4w_glow_settings:(g.b4w_outline_settings={},g.b4w_outline_settings.outline_duration=1,g.b4w_outline_settings.outline_period=1,g.b4w_outline_settings.outline_relapses=0),b("object",g,"b4w_outline_settings"));"b4w_lod_transition"in g||(g.b4w_lod_transition=.01,b("object",g,"b4w_lod_transition"));"lod_levels"in g||(g.lod_levels=[],b("object",g,"lod_levels"));"b4w_animation_mixing"in g||(g.b4w_animation_mixing=!1,b("object",g,"b4w_animation_mixing"));
break;case "EMPTY":"b4w_anchor"in g||(g.b4w_anchor=null,b("object",g,"b4w_anchor")),!g.b4w_anchor||"max_width"in g.b4w_anchor||(g.b4w_anchor.max_width=250)}"collision_margin"in g.game||(g.game.collision_margin=.04,b("object",g,"collision_margin"));"b4w_anim_behavior"in g||(g.b4w_anim_behavior=g.b4w_cyclic_animation?"CYCLIC":"FINISH_STOP",b("object",g,"b4w_anim_behavior"));if(!("rotation_quaternion"in g)){f=[0,0,0,1];e.euler_to_quat(g.rotation_euler,f);var c=f,m=f[0],n=f[1],q=f[2];c[0]=f[3];c[1]=m;
c[2]=n;c[3]=q;g.rotation_quaternion=f;b("object",g,"rotation_quaternion")}"webgl_do_not_batch"in g&&(g.b4w_do_not_batch=g.webgl_do_not_batch)&&l("object",g,"webgl_do_not_batch");"b4w_shadow_cast_only"in g||(g.b4w_shadow_cast_only=!1,b("object",g,"b4w_shadow_cast_only"));"b4w_correct_bounding_offset"in g||(g.b4w_correct_bounding_offset="AUTO",b("object",g,"b4w_correct_bounding_offset"));c=g.particle_systems;for(f=0;f<c.length;f++)m=c[f],n=m.settings,"use_rotation_dupli"in n||(n.use_rotation_dupli=
!1,b("object",n,"use_rotation_dupli")),"use_whole_group"in n||(n.use_whole_group=!1,b("object",n,"use_whole_group")),m.transforms||(m.transforms=new Float32Array,b("particle_system",m,"transforms")),"b4w_billboard_align"in n||(n.b4w_billboard_align="VIEW",b("particle_settings",n,"b4w_billboard_align")),"b4w_dynamic_grass"in n||(n.b4w_dynamic_grass=!1,b("object",n,"b4w_dynamic_grass")),"b4w_dynamic_grass_scale_threshold"in n||(n.b4w_dynamic_grass_scale_threshold=.01,b("object",n,"b4w_dynamic_grass_scale_threshold")),
"b4w_initial_rand_rotation"in n||(n.b4w_initial_rand_rotation=!1,b("particle_settings",n,"b4w_initial_rand_rotation")),"b4w_rotation_type"in n||(n.b4w_rotation_type="Z",b("particle_settings",n,"b4w_rotation_type")),"b4w_rand_rotation_strength"in n||(n.b4w_rand_rotation_strength=1,b("particle_settings",n,"b4w_rand_rotation_strength")),"b4w_hair_billboard"in n||(n.b4w_hair_billboard=!1,b("particle_settings",n,"b4w_hair_billboard")),"b4w_hair_billboard_type"in n||(n.b4w_hair_billboard_type="BASIC",b("particle_settings",
n,"b4w_hair_billboard_type")),"b4w_hair_billboard_jitter_amp"in n||(n.b4w_hair_billboard_jitter_amp=0,b("particle_settings",n,"b4w_hair_billboard_jitter_amp")),"b4w_hair_billboard_jitter_freq"in n||(n.b4w_hair_billboard_jitter_freq=0,b("particle_settings",n,"b4w_hair_billboard_jitter_freq")),"b4w_hair_billboard_geometry"in n||(n.b4w_hair_billboard_geometry="SPHERICAL",b("particle_settings",n,"b4w_hair_billboard_geometry")),"b4w_wind_bend_inheritance"in n||(n.b4w_wind_bend_inheritance="PARENT",b("particle_settings",
n,"b4w_wind_bend_inheritance")),"b4w_shadow_inheritance"in n||(n.b4w_shadow_inheritance="PARENT",b("particle_settings",n,"b4w_shadow_inheritance")),"b4w_reflection_inheritance"in n||(n.b4w_reflection_inheritance="PARENT",b("particle_settings",n,"b4w_reflection_inheritance")),"b4w_vcol_from_name"in n||(n.b4w_vcol_from_name="",b("particle_settings",n,"b4w_vcol_from_name")),"b4w_vcol_to_name"in n||(n.b4w_vcol_to_name="",b("particle_settings",n,"b4w_vcol_to_name")),"b4w_coordinate_system"in n||(n.b4w_coordinate_system=
"LOCAL",b("particle_settings",n,"b4w_coordinate_system")),"b4w_allow_nla"in n||(n.b4w_allow_nla=!0,b("particle_settings",n,"b4w_allow_nla")),"b4w_enable_soft_particles"in n||(n.b4w_enable_soft_particles=!1,b("particle_settings",n,"b4w_enable_soft_particles")),"b4w_particles_softness"in n||(n.b4w_particles_softness=1,b("particle_settings",n,"b4w_particles_softness"));"constraints"in g||(g.constraints=[],b("object",g,"constraints"));c=g.modifiers;for(f=0;f<c.length;f++){a:{m=c[f];switch(m.type){case "ARRAY":if(!("fit_type"in
m)){d.error("WARNING Incomplete modifier "+String(m.type)+' for "'+g.name+'", reexport "'+a.b4w_filepath_blend+'" scene');m=!1;break a}}m=!0}m||(c.splice(f,1),f--)}"animation_data"in g||(g.animation_data={action:null,nla_tracks:[]},b("object",g,"animation_data"));g.animation_data&&("action"in g.animation_data||(g.animation_data.action=null,d.warn("no action in animation data "+g.name)),"nla_tracks"in g.animation_data||(g.animation_data.nla_tracks=[],d.warn("no NLA in animation data "+g.name)),h(g.animation_data));
"b4w_collision_id"in g||(g.b4w_collision_id="",b("material",g,"b4w_collision_id"));if(0>g.scale[0]||0>g.scale[1]||0>g.scale[2])d.warn("negative scale for object "+g.name+", using positive scale instead"),g.scale[0]=Math.abs(g.scale[0]),g.scale[1]=Math.abs(g.scale[1]),g.scale[2]=Math.abs(g.scale[2]);c=g.scale;0==c[0]&&0==c[1]&&0==c[2]?f=!0:(f=Math.abs((c[0]-c[1])/c[0]),c=Math.abs((c[1]-c[2])/c[1]),f=.005>f&&.005>c);f||d.warn("non-uniform scale for object "+g.name)}for(var z in G)k=G[z],f=z.match(/.*?(?=>>|$)/i)[0],
d.warn('Property "'+String(f)+'" is '+k.report_type+' for "'+k.type+'". To fix this, reexport '+a.b4w_filepath_blend)};a.check_anim_fcurve_completeness=function(a,b){"num_channels"in a||(a.num_channels=1,d.warn('B4W Warning: no channels number in animation fcurve for "'+b.name+'" action, reexport scene'))};a.apply_mesh_modifiers=function(a){var b;a:{b=a.modifiers;for(var d=0;d<b.length;d++){var h=b[d].type;if("ARRAY"==h||"CURVE"==h){b=!0;break a}}b=!1}if(!b)return null;b=c(a.data,a.data.name+"_MOD");
a=a.modifiers;for(d=0;d<a.length;d++){var l=a[d];switch(l.type){case "ARRAY":for(var h=b,g=l,u=0,v=0,r=0,z=new Float32Array(16),l=[],H=1;H<g.count;H++){g.use_constant_offset&&(u+=g.constant_offset_displace[0],v+=g.constant_offset_displace[1],r+=g.constant_offset_displace[2]);if(g.use_relative_offset)var F=h.b4w_bounding_box,u=u+(F.max_x-F.min_x)*g.relative_offset_displace[0],v=v+(F.max_y-F.min_y)*g.relative_offset_displace[1],r=r+(F.max_z-F.min_z)*g.relative_offset_displace[2];e.trans_matrix(u,v,
r,z);for(var L=F=c(h),x=z,K=0;K<L.submeshes.length;K++){var A=L.submeshes[K];e.positions_multiply_matrix(A.position,x,A.position,0);e.vectors_multiply_matrix(A.normal,x,A.normal,0);e.tangents_multiply_matrix(A.tangent,x,A.tangent,0)}l.push(F)}for(H=0;H<l.length;H++)for(g=h,u=l[H],v=0;v<g.submeshes.length;v++){r=g.submeshes[v];z=u.submeshes[v];F=r.base_length;L=r.indices.length;r.base_length+=z.base_length;for(var P in r)if("base_length"!=P)if("indices"==P)for(r[P]=e.uint32_concat(r[P],z[P]),x=L;x<
r.indices.length;x++)r.indices[x]+=F;else"vertex_colors"!=P&&(r[P]=e.float32_concat(r[P],z[P]))}break;case "CURVE":for(var h=b,H=n.create_spline(l.object),g=new Float32Array(16),v=H.is_3d?4:3,u=new Float32Array(v),v=new Float32Array(v),r=new Float32Array(3),z=new Float32Array(4),F=new Float32Array(4),L=new Float32Array(3),x=new Float32Array(3),K=new Float32Array(3),A=new Float32Array(4),S=new Float32Array(4),G=0;G<h.submeshes.length;G++){var N=h.submeshes[G],Y=N.position,Q=N.normal,N=N.tangent,X;
a:switch(X=l.deform_axis,X){case "POS_X":case "NEG_X":X=0;break a;case "POS_Y":case "NEG_Y":X=1;break a;case "POS_Z":case "NEG_Z":X=2;break a;default:throw"Wrong deform axis value "+X;}L[0]=0;L[1]=0;L[2]=0;L[X]=1;for(var R=n.spline_length(H),U=0;U<Y.length/3;U++){K[0]=Y[3*U];K[1]=Y[3*U+1];K[2]=Y[3*U+2];var ba=K[X],fa=n.spline_len_to_t(H,ba);n.spline_point(H,fa,u);r[0]=u[0];r[1]=u[1];r[2]=u[2];n.spline_derivative(H,fa,v);x[0]=v[0];x[1]=0;x[2]=v[2];m.normalize(x,x);k.rotationTo(L,x,z);0>ba?(u[0]=x[0],
u[1]=x[1],u[2]=x[2],m.scale(u,ba,u),m.add(r,u,r)):ba>R&&(u[0]=x[0],u[1]=x[1],u[2]=x[2],m.scale(u,ba-R,u),m.add(r,u,r));q.fromRotationTranslation(z,r,g);H.is_3d&&(k.setAxisAngle(L,u[3],F),m.transformQuat(K,F,K));K[X]=0;m.transformMat4(K,g,K);Y[3*U]=K[0];Y[3*U+1]=K[1];Y[3*U+2]=K[2];Q.length&&(A[0]=Q[3*U],A[1]=Q[3*U+1],A[2]=Q[3*U+2],A[3]=0,B.transformMat4(A,g,A),Q[3*U]=A[0],Q[3*U+1]=A[1],Q[3*U+2]=A[2]);N.length&&(S[0]=N[3*U],S[1]=N[3*U+1],S[2]=N[3*U+2],S[3]=0,B.transformMat4(S,g,S),N[3*U]=S[0],N[3*U+
1]=S[1],N[3*U+2]=S[2])}}}f.recalculate_mesh_boundings(b)}return b};a.create_material=function(a){return{name:a,use_nodes:!1,diffuse_shader:"LAMBERT",diffuse_color:[.8,.8,.8],diffuse_intensity:1,alpha:1,raytrace_transparency:{fresnel:0,fresnel_factor:1.25},raytrace_mirror:{reflect_factor:0,fresnel:0,fresnel_factor:1.25},specular_color:[1,1,1],specular_intensity:.5,specular_shader:"COOKTORR",specular_hardness:50,specular_slope:.2,emit:0,ambient:1,use_vertex_color_paint:!1,b4w_water:!1,b4w_water_shore_smoothing:!1,
b4w_water_dynamic:!1,b4w_generated_mesh:!1,b4w_waves_height:1,b4w_water_fog_color:[.5,.5,.5],b4w_water_fog_density:.06,b4w_water_num_cascads:5,b4w_water_subdivs:64,b4w_water_detailed_dist:1E3,b4w_terrain:!1,b4w_collision:!1,b4w_collision_id:"",b4w_double_sided_lighting:!1,b4w_water_enable_caust:!1,b4w_water_caust_scale:.25,b4w_water_caust_brightness:.5,physics:{friction:.5,elasticity:0},type:"SURFACE",use_transparency:!1,use_shadeless:!1,offset_z:0,b4w_render_above_all:!1,game_settings:{alpha_blend:"OPAQUE",
use_backface_culling:!0},halo:{size:.5,hardness:50,b4w_halo_rings_color:[1,1,1],b4w_halo_lines_color:[1,1,1],b4w_halo_stars_blend_height:10,b4w_halo_stars_min_height:0},node_tree:null,texture_slots:[]}};a.assign_logic_nodes_object_params=function(a,b){for(var c=b.b4w_logic_nodes,e=0;e<c.length;e++)for(var f=c[e],g=0;g<f.length;g++){var k=f[g],h={register1:"variable1",register2:"variable2",registerd:"variabled"},l;for(l in h)l in k&&(k[h[l]]=k[l]);switch(k.type){case "SELECT":for(h=0;h<a.length;h++){var m=
a[h];m.name==k.object&&(m.b4w_selectable=!0)}k.bools||(k.bools={});k.bools.not_wait||(k.bools.not_wait=!1);break;case "SELECT_PLAY":d.warn('Logic nodes type "SELECT_PLAY" is deprecated, node will be muted. To fix this, reexport scene "'+b.name+'"');k.object.mute=!0;break;case "SHOW":case "HIDE":case "PLAY_ANIM":case "SET_SHADER_NODE_PARAM":for(h=0;h<a.length;h++)m=a[h],m.name==k.object&&(m.b4w_do_not_batch=!0)}}}};b4w.module.__scenegraph=function(a,r){function u(a){a=la.copy_object_props_by_value(a);a.framebuffer=null;a.color_attachment=null;a.depth_attachment=null;return a}function h(a,c){var d=[];M.traverse_edges(a,function(b,c,e){-1<d.indexOf(e)?M.replace_edge_attr(a,b,c,e,l(e)):d.push(e)});M.traverse(a,function(b,e){for(var g=0;g<e.slinks_internal.length;g++){var f=e.slinks_internal[g];c||"MAIN_PLANE_REFLECT"!=e.type&&"MAIN_CUBE_REFLECT"!=e.type&&"MAIN_XRAY"!=e.type||(f.use_renderbuffer=!0);-1<d.indexOf(f)?
e.slinks_internal[g]=l(f):d.push(f)}"ANTIALIASING"==e.type&&M.traverse_inputs(a,b,function(a,b,c){if("MOTION_BLUR"==b.type)for(a=0;a<b.slinks_internal.length;a++)c=b.slinks_internal[a],c.min_filter=J.TF_LINEAR,c.mag_filter=J.TF_LINEAR});c||M.traverse_inputs(a,b,function(a,b,c){"DEPTH"==c.from&&(c.use_renderbuffer=!0)})});M.traverse(a,function(c,d){var e={};b(a,c,e);for(var g in e){for(var f=e[g],k=f[0],h=0;h<f.length;h++)if(f[h].min_filter==J.TF_LINEAR){k=f[h];break}for(var m=f[0],h=0;h<f.length;h++)if(f[h].mag_filter==
J.TF_LINEAR){m=f[h];break}for(var l=f[0],h=0;h<f.length;h++)if(!f[h].use_renderbuffer){l=f[h];break}for(h=0;h<f.length;h++)f[h].min_filter=k.min_filter,f[h].mag_filter=m.mag_filter,f[h].use_renderbuffer=l.use_renderbuffer}})}function b(a,c,d){M.traverse_inputs(a,c,function(c,e,g){g.active&&g.from==g.to&&(d[g.from]=d[g.from]||[],-1==d[g.from].indexOf(g)&&d[g.from].push(g),b(a,c,d))});M.traverse_outputs(a,c,function(a,b,c){c.active&&(d[c.from]=d[c.from]||[],-1==d[c.from].indexOf(c)&&d[c.from].push(c))});
c=M.get_node_attr(a,c);if("MOTION_BLUR"==c.type)for(var e=0;e<c.slinks_internal.length;e++){var g=c.slinks_internal[e];d[g.from].push(g)}}function l(a){if(a.texture)throw"Failed to clone slink with attached texture";return Ua.clone_object_json(a)}function c(a){var b=M.topsort(a),c=[];M.traverse(b,function(a,e){switch(e.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_PLANE_REFLECT":var g=[];break;default:g=c}for(var f=0;f<e.slinks_internal.length;f++){var h=
e.slinks_internal[f],m=k(g,h,n(h));h.texture=m;e.textures_internal[f]=m}for(f=0;f<e.textures_internal.length;f++)m=e.textures_internal[f],d(g,m);switch(e.type){case "MOTION_BLUR":case "SMAA_RESOLVE":case "SMAA_NEIGHBORHOOD_BLENDING":case "MAIN_PLANE_REFLECT":g=[]}M.traverse_outputs(b,a,function(c,d,e){if(!e.texture){if((c=q(b,a,e.from))&&e.active&&!e.texture){d=g;for(var f=c,h=0;h<d.length;h++){var m=d[h];m.tex===f&&m.ref++}}else c=k(g,e,n(e));e.texture=c}});M.traverse_inputs(b,a,function(a,b,c){d(g,
c.texture)});M.traverse_outputs(b,a,function(a,b,c){c.texture&&"NONE"==c.to&&d(g,c.texture)})})}function f(a){m(a,function(b,c,d,e){b.update_dim&&(qa(a,d,"SMAA_NEIGHBORHOOD_BLENDING")&&"SMAA_NEIGHBORHOOD_BLENDING"!=d.type||qa(a,d,"ANTIALIASING")||"ANCHOR_VISIBILITY"==d.type)&&(b.size_mult*=va.render_resolution_factor)})}function n(a){a=Ua.clone_object_json(a);delete a.to;delete a.active;delete a.texture;return JSON.stringify(a)}function q(a,b,c){var d=null;M.traverse_inputs(a,b,function(a,b,e){if(e.active&&
e.from==e.to&&e.from==c&&e.texture)return d=e.texture,!0});M.traverse_outputs(a,b,function(a,b,e){if(e.active&&e.from==c&&e.texture)return d=e.texture,!0});return d}function d(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.tex===b&&d.ref&&d.ref--}}function k(a,b,c){for(var d=null,g=0;g<a.length;g++){var f=a[g];if(f.id==c&&0===f.ref){d=f;break}}if(d&&!va.macos_tex_reuse_hack)return d.ref++,d.tex;b=e(b);a.push({id:c,ref:1,tex:b});return b}function e(a){var b=a.size_mult*a.size;switch(a.from){case "COLOR":var c=
J.create_texture("COLOR",J.TT_RGBA_INT);J.resize(c,b,b);J.set_filters(c,a.min_filter,a.mag_filter);return c;case "DEPTH":return a.use_renderbuffer?(c=J.create_texture("DEPTH_RBUF",J.TT_RENDERBUFFER),J.resize(c,b,b)):(c=J.create_texture("DEPTH_TEX",J.TT_DEPTH),J.resize(c,b,b),J.set_filters(c,a.min_filter,a.mag_filter)),c;case "CUBEMAP":return c=J.create_cubemap_texture("CUBEMAP",b);case "SCREEN":return null;default:throw"Wrong slink param: "+a.from;}}function m(a,b){var c=!1;M.traverse_edges(a,function(d,
e,g){if(g&&(d=M.get_node_attr(a,d),e=M.get_node_attr(a,e),b(g,!1,d,e)))return c=!0});c||M.traverse(a,function(a,c){for(var d=0;d<c.slinks_internal.length;d++)if(b(c.slinks_internal[d],!0,c,null))return!0})}function B(a){M.traverse(a,function(b,c){if("SINK"!=c.type){var d=c.camera;M.traverse_outputs(a,b,function(a,b,c){c.active&&c.texture&&(ca.set_attachment(d,c.from,c.texture),c.from==c.to&&b.camera&&ca.set_attachment(b.camera,c.from,c.texture))});for(var e=0;e<c.slinks_internal.length;e++){var g=
c.slinks_internal[e];g.active&&g.from==g.to&&ca.set_attachment(d,g.from,c.textures_internal[e])}!d.color_attachment&&!d.depth_attachment||d.framebuffer||(d.framebuffer=oa.render_target_create(d.color_attachment,d.depth_attachment))}})}function N(a){var b=null,c=0;M.traverse(a,function(a,d){if(d.type==Ea.subs_type){if(c==Ea.subs_number)return b=d,!0;c++}});return b}function G(a,b){var c=M.node_by_attr(a,b),d=y("NONE"),e=M.append_node_attr(a,d),g=M.get_sink_nodes(a)[0];M.traverse_edges(a,function(b,
c,d){c==g&&M.reconnect_edges(a,b,g,b,e)});M.traverse_edges(a,function(e,g,f){if(e==c)return M.append_edge_attr(a,b,d,D(Ea.slink_type,"u_color",f.size,f.size_mult,f.update_dim)),!0});M.append_edge(a,e,g,D("SCREEN","NONE",.5,.5,!0))}function w(a,b){a.num_lights=b;a.light_directions=new Float32Array(3*b);a.light_positions=new Float32Array(3*b);a.light_color_intensities=new Float32Array(3*b);a.light_factors=new Float32Array(0==b%2?2*b:2*b+2)}function t(a,b,c){var d=C("SHADOW_CAST");d.csm_index=a;d.self_shadow_polygon_offset=
b.self_shadow_polygon_offset;switch(b.lamp_type){case "SPOT":case "POINT":d.camera=ca.create_camera(ca.TYPE_PERSP);ca.set_frustum(d.camera,180*b.spot_size/Math.PI,.1,2*b.distance);break;default:d.camera=ca.create_camera(ca.TYPE_ORTHO_ASYMMETRIC)}w(d,c);return d}function C(a){a={type:a,subtype:"",blend:!1,pack:!1,assign_texture:!1,need_fog_update:!1,debug_render_calls:0,time:0,camera:null,cube_view_matrices:null,cube_cam_frustums:[],bundles:[],slinks_internal:[],textures_internal:[],wind:new Float32Array(3),
zsort_eye_last:new Float32Array(3),grass_map_dim:new Float32Array(3),fog_color_density:new Float32Array(4),fog_params:new Float32Array(4),cube_fog:new Float32Array(16),sky_tex_default_value:0,environment_energy:0,num_lights:0,light_directions:null,light_positions:null,light_color_intensities:null,light_factors:null,horizon_color:new Float32Array(3),zenith_color:new Float32Array(3),sky_tex_fac:new Float32Array(4),sun_intensity:new Float32Array([0,0,0]),sun_direction:new Float32Array(3),sun_quaternion:new Float32Array(4),
sky_tex_color:new Float32Array(3),outline_factor:0,draw_outline_flag:0,is_for_outline:!1,outline_color:new Float32Array(3),water:0,water_params:null,use_shoremap:!1,shoremap_center:new Float32Array(2),shoremap_size:new Float32Array(2),shoremap_tex_size:0,max_shore_dist:0,cam_water_depth:0,water_fog_color_density:null,water_waves_height:0,water_waves_length:0,water_level:0,caustics:!1,caust_scale:0,caust_speed:new Float32Array(2),caust_brightness:0,procedural_skydome:!1,use_as_environment_lighting:!1,
mie_brightness:0,rayleigh_brightness:0,spot_brightness:0,mie_strength:0,rayleigh_strength:0,scatter_strength:0,mie_collection_power:0,rayleigh_collection_power:0,mie_distribution:0,sky_color:new Float32Array(3),ssao_hemisphere:0,ssao_blur_depth:0,ssao_blur_discard_value:0,ssao_radius_increase:0,ssao_influence:0,ssao_dist_factor:0,ssao_samples:0,ssao_only:0,ssao_white:0,brightness:0,contrast:0,exposure:0,saturation:0,god_rays_intensity:0,max_ray_length:0,radial_blur_step:0,steps_per_pass:0,csm_index:0,
self_shadow_polygon_offset:0,self_shadow_normal_offset:0,v_light_matrix:null,b_light_matrix:null,p_light_matrix:null,bloom_key:0,bloom_blur:0,bloom_edge_lum:0,blur_texel_size_mult:0,ext_texel_size_mult:0,mb_decay_threshold:0,mb_factor:0,motion_blur_exp:0,pp_effect:"",jitter_projection_space:new Float32Array(2),small_glow_mask_width:0,large_glow_mask_width:0,small_glow_mask_coeff:0,large_glow_mask_coeff:0,texel_size:new Float32Array(2),texel_mask:new Float32Array(2),do_render:!0,enqueue:!0,clear_color:!0,
clear_depth:!0,depth_test:!0,need_perm_uniforms_update:!0,texel_size_multiplier:1};a.texel_mask[0]=1;a.texel_mask[1]=1;return a}function D(a,b,c,d,e){return{from:a,to:b,size:c,size_mult:d,update_dim:e,active:!0,texture:null,use_renderbuffer:!1,min_filter:J.TF_NEAREST,mag_filter:J.TF_NEAREST}}function p(a,b){for(var c=0,d=ga(a,b),e=0;e<d.length;e++){var g=d[e];"SHADOW_CAST"==g.type&&(g=g.camera,b.perspective_cast_far_bound=g.far/(g.far-g.near),b.v_light_matrix=g.view_matrix,b.b_light_matrix=new Float32Array([.5,
0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1]),b.p_light_matrix=b.p_light_matrix||[],b.p_light_matrix[c]=g.proj_matrix,c++)}}function g(){var a=C("GRASS_MAP");a.camera=ca.create_camera(ca.TYPE_ORTHO_ASPECT);return a}function y(a){var b=C("POSTPROCESSING");b.clear_color=!1;b.clear_depth=!1;b.depth_test=!1;b.camera=ca.create_camera(ca.TYPE_NONE);b.pp_effect=a;switch(a){case "NONE":b.texel_mask[0]=1;b.texel_mask[1]=1;break;case "GRAYSCALE":b.texel_mask[0]=1;b.texel_mask[1]=1;break;case "X_BLUR":b.texel_mask[0]=
1;b.texel_mask[1]=0;break;case "Y_BLUR":b.texel_mask[0]=0;b.texel_mask[1]=1;break;case "X_GLOW_BLUR":b.texel_mask[0]=1;b.texel_mask[1]=0;break;case "Y_GLOW_BLUR":b.texel_mask[0]=0;b.texel_mask[1]=1;break;case "X_EXTEND":b.texel_mask[0]=1;b.texel_mask[1]=0;break;case "Y_EXTEND":b.texel_mask[0]=0;b.texel_mask[1]=1;break;default:throw"Wrong postprocessing effect: "+a;}return b}function v(a,b,c){a=C("BLOOM_BLUR");a.clear_color=!1;a.clear_depth=!1;a.depth_test=!1;a.camera=ca.create_camera(ca.TYPE_NONE);
a.pp_effect=c;switch(c){case "X_BLUR":a.texel_mask[0]=1;a.texel_mask[1]=0;break;case "Y_BLUR":a.texel_mask[0]=0;a.texel_mask[1]=1;break;default:throw"Wrong postprocessing effect for bloom blur: "+c;}return a}function I(a,b){var c=C("GLOW_COMBINE");c.clear_color=!1;c.clear_depth=!1;c.depth_test=!1;c.small_glow_mask_coeff=b.glow_params.small_glow_mask_coeff;c.large_glow_mask_coeff=b.glow_params.large_glow_mask_coeff;c.small_glow_mask_width=b.glow_params.small_glow_mask_width;c.large_glow_mask_width=
b.glow_params.large_glow_mask_width;c.camera=a;return c}function z(a,b,c,d,e,g,f,k,h){var m=C("MAIN_"+a);if("OPAQUE"===a)m.clear_color=!0,m.clear_depth=c,m.blend=!1;else if("BLEND"===a)m.clear_color=!1,m.clear_depth=!1,m.blend=!0;else if("XRAY"===a)m.clear_color=!1,m.clear_depth=!0,m.blend=!0;else if("PLANE_REFLECT"===a||"CUBE_REFLECT"===a)m.clear_color=!0,m.clear_depth=!0,m.blend=!1;else if("GLOW"===a)m.clear_color=!0,m.clear_depth=!1,m.blend=!1;else throw"wrong main subscene type";m.blend&&k&&(m.self_shadow_normal_offset=
k.self_shadow_normal_offset);m.camera=b;if(a=f.sky_texture_param)m.sky_tex_fac.set([a.blend_factor,a.horizon_factor,a.zenith_up_factor,a.zenith_down_factor]),m.sky_tex_color.set(a.color),m.sky_tex_default_value=a.default_value;m.horizon_color.set(f.horizon_color);m.zenith_color.set(f.zenith_color);m.environment_energy=f.environment_energy;m.fog_color_density=g.fog_color_density;m.fog_params=g.fog_params;d&&(m.water_params=d,d.fog_color_density&&(m.water_fog_color_density=new Float32Array(d.fog_color_density)),
m.water_waves_height=d.waves_height,m.water_waves_length=d.waves_length,m.water_level=d.water_level,d.caustics&&h&&(m.caustics=!0,m.caust_scale=d.caustic_scale,m.caust_speed.set(d.caustic_speed),m.caust_brightness=d.caustic_brightness),d.shoremap_image&&(m.use_shoremap=!0,g=d.shore_boundings,m.shoremap_center[0]=(g[0]+g[1])/2,m.shoremap_center[1]=(g[2]+g[3])/2,m.shoremap_size[0]=g[0]-g[1],m.shoremap_size[1]=g[2]-g[3],m.shoremap_tex_size=d.shoremap_tex_size,m.max_shore_dist=d.max_shore_dist));w(m,
e);return m}function H(a,b,c){var d=C("COLOR_PICKING");b&&(d.type+="_XRAY",d.clear_color=!1,d.clear_depth=!0);d.enqueue=!1;d.camera=a;w(d,c);return d}function F(a){var b=C("WIREFRAME");b.do_render=!1;b.clear_color=!1;b.clear_depth=!1;b.camera=a;return b}function L(a){var b=C("ANCHOR_VISIBILITY");b.clear_color=!0;b.clear_depth=!1;b.camera=a;return b}function x(a,b,c){a=C("DEPTH");a.camera=b;w(a,c);return a}function K(a,b,c){var d=C("SSAO");d.clear_color=!1;d.clear_depth=!1;d.depth_test=!1;d.camera=
a;d.fog_color_density=b.fog_color_density;d.water_fog_color_density=new Float32Array(b.fog_color_density);d.ssao_radius_increase=c.radius_increase;d.ssao_hemisphere=c.hemisphere;d.ssao_influence=c.influence;d.ssao_dist_factor=c.dist_factor;d.ssao_samples=c.samples;return d}function A(a,b){var c=C("SSAO_BLUR");c.clear_color=!1;c.clear_depth=!1;c.depth_test=!1;c.camera=a;c.ssao_blur_depth=b.blur_depth;c.ssao_blur_discard_value=b.blur_discard_value;return c}function P(){var a=C("ANTIALIASING");a.clear_color=
!1;a.clear_depth=!1;a.depth_test=!1;a.texel_size_multiplier=1/va.render_resolution_factor;a.camera=ca.create_camera(ca.TYPE_NONE);return a}function S(a){var b=C(a);b.clear_color="SMAA_BLENDING_WEIGHT_CALCULATION"==a||"SMAA_EDGE_DETECTION"==a?!0:!1;b.clear_depth=!1;b.depth_test=!1;b.texel_size_multiplier=1/va.render_resolution_factor;b.camera=ca.create_camera(ca.TYPE_NONE);"SMAA_BLENDING_WEIGHT_CALCULATION"==a&&(b.jitter_subsample_ind=new Float32Array(4));return b}function ea(a,b,c,d){var e=C("COMPOSITING");
e.clear_color=!1;e.clear_depth=!1;e.depth_test=!1;e.camera=ca.create_camera(ca.TYPE_NONE);e.brightness=a;e.contrast=b;e.exposure=c;e.saturation=d;return e}function aa(a,b){var c=C("MOTION_BLUR");c.clear_color=!1;c.clear_depth=!1;c.depth_test=!1;c.camera=ca.create_camera(ca.TYPE_NONE);c.assign_texture=!0;c.mb_decay_threshold=a;c.mb_factor=b;return c}function Y(a){var b=C("DOF");b.clear_color=!1;b.clear_depth=!1;b.depth_test=!1;b.camera=a;b.texel_size_multiplier=b.camera.dof_power;return b}function Q(a,
b){var c=C("OUTLINE_MASK");c.depth_test=!1;c.camera=a;w(c,b);return c}function X(a){var b=C("OUTLINE");ua.outlining_overview_mode?b.outline_color.set(ua.outline_color):b.outline_color.set(a.outline_color);b.outline_factor=a.outline_factor;b.ext_texel_size_mult=5;b.blur_texel_size_mult=3;b.depth_test=!1;b.camera=ca.create_camera(ca.TYPE_NONE);return b}function R(){var a=C("REFRACT");a.clear_color=!1;a.clear_depth=!1;a.depth_test=!1;a.camera=ca.create_camera(ca.TYPE_NONE);return a}function U(a,b,c,
d,e,g,f){var k=C("GOD_RAYS");k.clear_color=!1;k.clear_depth=!1;k.depth_test=!1;k.horizon_color=new Float32Array([1,1,1]);k.zenith_color=new Float32Array([1,1,1]);k.environment_energy=1;k.pack=d;k.water=b;k.radial_blur_step=e;k.max_ray_length=c;k.steps_per_pass=f;k.camera=a;w(k,g);return k}function ba(a,b){var c=C("GOD_RAYS_COMBINE");c.clear_color=!1;c.clear_depth=!1;c.depth_test=!1;c.camera=ca.create_camera(ca.TYPE_NONE);c.god_rays_intensity=a;w(c,b);return c}function fa(a,b){var c=C("SKY");c.enqueue=
!1;c.clear_color=!1;c.clear_depth=!1;c.depth_test=!1;var d=ca.create_camera(ca.TYPE_NONE);d.width=Fa.cubemap_tex_size;d.height=Fa.cubemap_tex_size;c.camera=d;c.cube_view_matrices=Ua.generate_cubemap_matrices();w(c,a);c.horizon_color=new Float32Array([1,1,1]);c.zenith_color=new Float32Array([1,1,1]);c.environment_energy=1;c.sky_color.set(b.sky_color);c.procedural_skydome=b.procedural_skydome;c.use_as_environment_lighting=b.use_as_environment_lighting;c.rayleigh_brightness=b.rayleigh_brightness;c.mie_brightness=
b.mie_brightness;c.spot_brightness=b.spot_brightness;c.scatter_strength=b.scatter_strength;c.rayleigh_strength=b.rayleigh_strength;c.mie_strength=b.mie_strength;c.rayleigh_collection_power=b.rayleigh_collection_power;c.mie_collection_power=b.mie_collection_power;c.mie_distribution=b.mie_distribution;return c}function ja(){var a=C("COPY");a.clear_color=!1;a.clear_depth=!1;a.camera=ca.create_camera(ca.TYPE_NONE);return a}function pa(){var a=C("ANAGLYPH");a.clear_color=!1;a.clear_depth=!1;a.camera=ca.create_camera(ca.TYPE_NONE);
return a}function na(){var a=C("LUMINANCE");a.clear_color=!1;a.clear_depth=!1;a.camera=ca.create_camera(ca.TYPE_NONE);return a}function V(){var a=C("AVERAGE_LUMINANCE");a.clear_color=!1;a.clear_depth=!1;a.camera=ca.create_camera(ca.TYPE_NONE);return a}function E(a,b,c,d){var e=C("LUMINANCE_TRUNCED");e.clear_color=!1;e.clear_depth=!1;e.bloom_key=a;e.bloom_edge_lum=b;e.camera=d;w(e,c);return e}function T(a){var b=C("BLOOM");b.clear_color=!1;b.clear_depth=!1;b.camera=ca.create_camera(ca.TYPE_NONE);b.bloom_blur=
a;return b}function da(){var a=C("SINK");a.enqueue=!1;return a}function qa(a,b,c){if(b.type===c)return!0;b=ha(a,b);for(var d=0;d<b.length;d++)if(qa(a,b[d],c))return!0;return!1}function O(a,b,c){if(b.type===c)return!0;b=ga(a,b);for(var d=0;d<b.length;d++)if(O(a,b[d],c))return!0;return!1}function ga(a,b){var c=M.node_by_attr(a,b);if(c==M.NULL_NODE)throw"Subscene not in graph";for(var d=[],e=M.in_edge_count(a,c),g=0;g<e;g++){var f=M.get_in_edge(a,c,g);f!=c&&d.push(M.get_node_attr(a,f))}return d}function ha(a,
b){var c=M.node_by_attr(a,b);if(c==M.NULL_NODE)throw"Subscene not in graph";for(var d=[],e=M.out_edge_count(a,c),g=0;g<e;g++){var f=M.get_out_edge(a,c,g);f!=c&&d.push(M.get_node_attr(a,f))}return d}function ia(a){var b=[],c=[];m(a,function(a,d,e,g){a.texture&&-1==b.indexOf(a.texture)&&(b.push(a.texture),c.push(a.texture,b.length-1))});return c}function ma(a,b,c,d){b=""+(a.from+"\\n");b+="NONE"!=a.to?a.to+"\\n":"";b+="(";a.update_dim?(c=a.size_mult,Math.round(c)!=c&&(c=c.toFixed(2)),c=(1==c?"":c)+
"S",b+=c+"x"+c):b+=a.size+"x"+a.size;if("SCREEN"!=a.from){b+=" ";if(a.use_renderbuffer)b+="RR";else{c=a.min_filter;var e=a.mag_filter,g="";c==J.TF_LINEAR?g+="L":c==J.TF_NEAREST&&(g+="N");e==J.TF_LINEAR?g+="L":e==J.TF_NEAREST&&(g+="N");b+=g}for(c=0;c<d.length;c+=2)d[c]==a.texture&&(b+=" "+d[c+1])}return b+")\\n"}var ca=r("__camera"),Z=r("__config"),ta=r("__debug"),M=r("__graph"),la=r("__obj_util"),oa=r("__renderer"),J=r("__textures"),Ua=r("__util"),Ea=Z.debug_subs,va=Z.defaults,ua=Z.outlining,Fa=Z.scenes;
a.check_slink_tex_conn=function(a){switch(a.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "SCREEN":case "OFFSCREEN":case "NONE":return!1;default:return!0}};a.traverse_slinks=m;a.create_rendering_graph=function(a,b,d){var e=M.create(),k=[],m=[],l=[],n=[],q=[],r=[],ua=[],w=[],ma=[],O=[],qa=[],la=[],Z=[],ga=a.lamps_number,oa=a.water_params,ha=a.shore_smoothing,ia=a.soft_particles,Bb=a.ssao,Za=a.god_rays,Tb=a.materials_params,ac=a.reflection_params,nc=a.bloom_params,Fc=a.motion_blur,bd=a.compositing,
Gc=a.antialiasing,bc=a.world_light_set,hc=a.world_fog_set,pb=a.shadow_params,Hc=a.mb_params,ic=a.cc_params,oc=a.god_rays_params,gd=a.outline_params,Mc=a.dof,pc=a.depth_tex,hd=a.refractions,Va=Boolean(d.length),Ca=[];if(a.anaglyph_use&&!Va){var jc=b.cameras[0],yb=u(jc);ca.make_stereo(jc,ca.TYPE_STEREO_LEFT);ca.make_stereo(yb,ca.TYPE_STEREO_RIGHT);Ca.push(jc,yb);b.cameras.push(yb)}else{var za=b.cameras[0];Ca.push(za)}if(pb){ca.update_camera_shadows(Ca[0],pb);for(var qc=pb.csm_num,W=0;W<qc;W++){var qb=
t(W,pb,ga);M.append_node_attr(e,qb);O.push(qb);var Ka=pb.csm_resolution,za=qb.camera;za.width=Ka;za.height=Ka;qb.clear_color=!1;qa.push(D("DEPTH","u_shadow_map"+W,Ka,1,!1));(ta.check_depth_only_issue()||va.firefox_shadows_slink_hack)&&qb.slinks_internal.push(D("COLOR","COLOR",Ka,1,!1))}}if(ac&&ac.num_cube_refl&&!Va)for(W=0;W<ac.num_cube_refl;W++){za=ca.create_camera(ca.TYPE_PERSP);za.width=a.cubemap_refl_size;za.height=a.cubemap_refl_size;ca.set_frustum(za,90,.1,100);ca.set_projection(za,za.aspect);
var sa=z("CUBE_REFLECT",za,!1,oa,ga,hc,bc,null,a.sun_exist);sa.cube_view_matrices=Ua.generate_inv_cubemap_matrices();for(var Aa=0;6>Aa;Aa++)sa.cube_cam_frustums.push(ca.create_frustum_planes());M.append_node_attr(e,sa);var Ha=D("CUBEMAP","u_cube_reflection",a.cubemap_refl_size,1,!1);Ha.min_filter=J.TF_LINEAR;Ha.mag_filter=J.TF_LINEAR;var Ub=D("DEPTH","DEPTH",a.cubemap_refl_size,1,!1);Z.push(Ha);sa.slinks_internal.push(Ub);la.push(sa);ac.cube_refl_subs.push(sa)}if(ac&&0<ac.refl_plane_objs.length&&
!Va)for(W=0;W<Ca.length;W++)for(Aa=0;Aa<ac.refl_plane_objs.length;Aa++)za=u(Ca[W]),za.reflection_plane=new Float32Array(4),b.cameras.push(za),sa=z("PLANE_REFLECT",za,!1,oa,ga,hc,bc,null,a.sun_exist),M.append_node_attr(e,sa),Ha=D("COLOR","u_plane_reflection",1,a.plane_refl_size,!0),Ha.min_filter=J.TF_LINEAR,Ha.mag_filter=J.TF_LINEAR,Ub=D("DEPTH","DEPTH",1,a.plane_refl_size,!0),ua.push(Ha),sa.slinks_internal.push(Ub),r.push(sa),ac.plane_refl_subs.push(sa);k=[];m=[];if(a.dynamic_grass){var bb=g();M.append_node_attr(e,
bb);Ka=Fa.grass_tex_size;bb.camera.width=Ka;bb.camera.height=Ka;var gb=D("DEPTH","u_grass_map_depth",Ka,1,!1);gb.min_filter=J.TF_LINEAR;gb.mag_filter=J.TF_LINEAR;var Ib=D("COLOR","u_grass_map_color",Ka,1,!1);Ib.min_filter=J.TF_LINEAR;Ib.mag_filter=J.TF_LINEAR}else Ib=gb=bb=null;for(var ub=[],rc=[],sc=[],cc=[],W=0;W<Ca.length;W++){var za=Ca[W],Qa={},Cb=D("DEPTH","DEPTH",1,1,!0);q.push(Cb);if(pc){var Vb=u(za);b.cameras.push(Vb);Qa=x(e,Vb,ga);sc.push(Qa);M.append_node_attr(e,Qa);if(pb){Qa.self_shadow_normal_offset=
pb.self_shadow_normal_offset;for(Aa=0;Aa<O.length;Aa++)qb=O[Aa],M.append_edge_attr(e,qb,Qa,qa[Aa]);var Nc=D("COLOR","u_color",1,1,!0),Jb=D("DEPTH","u_depth",1,1,!0);if(Bb){var rb=u(za);b.cameras.push(rb);var Db=a.ssao_params,Ma=K(rb,hc,Db);M.append_node_attr(e,Ma);var hb=D("COLOR","u_ssao_mask",1,1,!0);M.append_edge_attr(e,Qa,Ma,Nc);M.append_edge_attr(e,Qa,Ma,Jb);var Kb=u(za);b.cameras.push(Kb);var vb=A(Kb,Db);M.append_node_attr(e,vb);var tc=D("COLOR","u_shadow_mask",1,1,!0);M.append_edge_attr(e,
Ma,vb,hb);M.append_edge_attr(e,Qa,vb,Jb)}}else ta.check_depth_only_issue()&&Qa.slinks_internal.push(D("COLOR","COLOR",1,1,!0));bb&&(M.append_edge_attr(e,bb,Qa,gb),M.append_edge_attr(e,bb,Qa,Ib))}sa=z("OPAQUE",za,!pc,oa,ga,hc,bc,null,a.sun_exist);M.append_node_attr(e,sa);m.push(sa);rc.push(sa);pc&&(M.append_edge_attr(e,Qa,sa,q[W]),hb?M.append_edge_attr(e,vb,sa,tc):pb&&M.append_edge_attr(e,Qa,sa,D("COLOR","u_shadow_mask",1,1,!0)));var Eb=D("COLOR","u_color",1,1,!0),Lb=D("COLOR","COLOR",1,1,!0);n.push(Lb);
bb&&(M.append_edge_attr(e,bb,sa,gb),M.append_edge_attr(e,bb,sa,Ib));if(r.length)for(var kc=r.length/Ca.length,Aa=0;Aa<kc;Aa++){var uc=kc*W+Aa;M.append_edge_attr(e,r[uc],sa,ua[uc])}if(la.length)for(Aa=0;Aa<la.length;Aa++)M.append_edge_attr(e,la[Aa],sa,Z[Aa])}k=m;m=[];if(!Va&&a.color_picking){za=u(k[0].camera);b.cameras.push(za);var Da=H(za,!1,ga);M.append_node_attr(e,Da);if(a.xray){za=u(k[0].camera);b.cameras.push(za);var sb=H(za,!0,ga);M.append_node_attr(e,sb);var cb=D("COLOR","COLOR",1,1,!0);M.append_edge_attr(e,
Da,sb,cb);var Pb=D("DEPTH","DEPTH",1,1,!0);M.append_edge_attr(e,Da,sb,Pb)}}else Da=null;if(Tb.refractions&&!Va)for(W=0;W<Ca.length;W++){var La=R();M.append_node_attr(e,La);M.append_edge_attr(e,k[W],La,Eb);w.push(La);ma.push(D("COLOR","u_refractmap",1,1,!0))}var ib=function(c,d){var g=u(Ca[d]);b.cameras.push(g);g=z(c,g,!1,oa,ga,hc,bc,pb,a.sun_exist);m.push(g);M.append_node_attr(e,g);M.append_edge_attr(e,k[d],g,n[d]);if("XRAY"==c){var f=D("DEPTH","DEPTH",1,1,!0);g.slinks_internal.push(f)}else M.append_edge_attr(e,
k[d],g,q[d]);bb&&(M.append_edge_attr(e,bb,g,gb),M.append_edge_attr(e,bb,g,Ib));if(pc){for(f=0;f<O.length;f++)M.append_edge_attr(e,O[f],g,qa[f]);if(Tb.refractions&&hd||ha||ia){var f=sc[d],h=u(f.camera);b.cameras.push(h);var l=C("DEPTH_PACK");l.clear_color=!1;l.clear_depth=!1;l.camera=h;M.append_node_attr(e,l);var h=D("DEPTH","u_depth",1,1,!0),p=D("COLOR","u_scene_depth",1,1,!0);p.min_filter=J.TF_NEAREST;p.mag_filter=J.TF_NEAREST;M.append_edge_attr(e,f,l,h);M.append_edge_attr(e,l,g,p)}}if(r.length)for(l=
r.length/Ca.length,f=0;f<l;f++)h=l*d+f,M.append_edge_attr(e,r[h],g,ua[h]);if(la.length)for(f=0;f<la.length;f++)M.append_edge_attr(e,la[f],g,Z[f]);w.length&&M.append_edge_attr(e,w[d],g,ma[d]);return g};if(a.glow_over_blend){for(W=0;W<Ca.length;W++)sa=ib("BLEND",W),ub.push(sa);k=m;m=[]}if(a.glow_materials){for(W=0;W<Ca.length;W++){var dc=u(Ca[W]);b.cameras.push(dc);var wa=z("GLOW",dc,!1,oa,ga,hc,bc);M.append_node_attr(e,wa);M.append_edge_attr(e,rc[W],wa,q[W]);var db=y("X_GLOW_BLUR");db.subtype="GLOW_MASK_SMALL";
db.texel_size_multiplier=a.glow_params.small_glow_mask_width;var Xa=D("COLOR","u_color",1,1,!0);Xa.min_filter=J.TF_LINEAR;Xa.mag_filter=J.TF_LINEAR;M.append_node_attr(e,db);M.append_edge_attr(e,wa,db,Xa);var jb=y("Y_GLOW_BLUR");jb.subtype="GLOW_MASK_SMALL";jb.texel_size_multiplier=a.glow_params.small_glow_mask_width;var Na=D("COLOR","u_color",1,.5,!0);Na.min_filter=J.TF_LINEAR;Na.mag_filter=J.TF_LINEAR;M.append_node_attr(e,jb);M.append_edge_attr(e,db,jb,Na);var lb=y("X_GLOW_BLUR");lb.subtype="GLOW_MASK_LARGE";
lb.texel_size_multiplier=a.glow_params.large_glow_mask_width;var zc=D("COLOR","u_color",1,.5,!0);zc.min_filter=J.TF_LINEAR;zc.mag_filter=J.TF_LINEAR;M.append_node_attr(e,lb);M.append_edge_attr(e,jb,lb,zc);var Wb=y("Y_GLOW_BLUR");Wb.subtype="GLOW_MASK_LARGE";Wb.texel_size_multiplier=a.glow_params.large_glow_mask_width;var wb=D("COLOR","u_color",1,.25,!0);wb.min_filter=J.TF_LINEAR;wb.mag_filter=J.TF_LINEAR;M.append_node_attr(e,Wb);M.append_edge_attr(e,lb,Wb,wb);var Ac=u(Ca[W]);b.cameras.push(Ac);var Ya=
I(Ac,a);M.append_node_attr(e,Ya);a.glow_over_blend?M.append_edge_attr(e,ub[W],Ya,D("COLOR","u_src_color",1,1,!0)):M.append_edge_attr(e,rc[W],Ya,D("COLOR","u_src_color",1,1,!0));var Qb=D("COLOR","u_glow_mask_small",1,.5,!0);Qb.min_filter=J.TF_LINEAR;Qb.mag_filter=J.TF_LINEAR;M.append_edge_attr(e,jb,Ya,Qb);var Fb=D("COLOR","u_glow_mask_large",1,.25,!0);Fb.min_filter=J.TF_LINEAR;Fb.mag_filter=J.TF_LINEAR;M.append_edge_attr(e,Wb,Ya,Fb);l.push(Ya)}k=l;m=[]}if(!a.glow_over_blend){for(W=0;W<Ca.length;W++)sa=
ib("BLEND",W),ub.push(sa);k=m;m=[]}if(a.xray){for(W=0;W<Ca.length;W++){var tb=ib("XRAY",W);cc.push(tb)}k=m;m=[]}if(va.wireframe_debug){for(W=0;W<Ca.length;W++){za=u(Ca[W]);b.cameras.push(za);var Ra=F(za);m.push(Ra);M.append_node_attr(e,Ra);M.append_edge_attr(e,k[W],Ra,n[W]);M.append_edge_attr(e,k[W],Ra,q[W]);bb&&(M.append_edge_attr(e,bb,Ra,gb),M.append_edge_attr(e,bb,Ra,Ib))}k=m;m=[]}if(!Va&&a.anchor_visibility){za=u(Ca[0]);b.cameras.push(za);var mb=L(za);M.append_node_attr(e,mb);M.append_edge_attr(e,
k[0],mb,q[0])}if(Za&&pc&&!Va){for(W=0;W<Ca.length;W++){var Mb=oc.max_ray_length,Oc=oc.intensity,eb=oc.steps_per_pass,Pa=k[W],Gb=oa?1:0,Nb=D("DEPTH","u_input",1,1,!0);Nb.min_filter=J.TF_LINEAR;Nb.mag_filter=J.TF_LINEAR;var Sa=D("COLOR","u_input",1,.25,!0);Sa.min_filter=J.TF_LINEAR;Sa.mag_filter=J.TF_LINEAR;var zb=Mb/eb,nb=u(Ca[W]);b.cameras.push(nb);var Hb=U(nb,Gb,Mb,!0,zb,ga,eb);M.append_node_attr(e,Hb);M.append_edge_attr(e,Pa,Hb,Nb);var zb=Mb/eb*.5,Ab=u(Ca[W]);b.cameras.push(Ab);var vc=U(Ab,Gb,Mb,
!1,zb,ga,eb);M.append_node_attr(e,vc);M.append_edge_attr(e,Hb,vc,Sa);var zb=Mb/eb*.25,Bc=u(Ca[W]);b.cameras.push(Bc);var wc=U(Bc,Gb,Mb,!1,zb,ga,eb);M.append_node_attr(e,wc);M.append_edge_attr(e,vc,wc,Sa);var ec=ba(Oc,ga);m.push(ec);M.append_node_attr(e,ec);M.append_edge_attr(e,Pa,ec,D("COLOR","u_main",1,1,!0));M.append_edge_attr(e,wc,ec,D("COLOR","u_god_rays",1,1,!0))}k=m;m=[]}if(nc&&!Va){for(W=0;W<Ca.length;W++){var Pa=k[W],Rb=na();M.append_node_attr(e,Rb);M.append_edge_attr(e,Pa,Rb,D("COLOR","u_input",
1,1,!0));var Xb=V();M.append_node_attr(e,Xb);Xb.camera.width=va.edge_min_tex_size_hack?2:1;Xb.camera.height=va.edge_min_tex_size_hack?2:1;var xc=D("COLOR","u_input",1,.25,!0);xc.min_filter=J.TF_LINEAR;xc.mag_filter=J.TF_LINEAR;var Ta=D("COLOR","u_luminance",1,.25,!0);Ta.min_filter=J.TF_LINEAR;Ta.mag_filter=J.TF_LINEAR;M.append_edge_attr(e,Rb,Xb,xc);var $a=nc.key,fc=nc.edge_lum,Cc=u(Ca[W]);b.cameras.push(Cc);var Yb=E($a,fc,ga,Cc);M.append_node_attr(e,Yb);M.append_edge_attr(e,Pa,Yb,D("COLOR","u_main",
1,1,!0));M.append_edge_attr(e,Rb,Yb,Ta);M.append_edge_attr(e,Xb,Yb,D("COLOR","u_average_lum",1,1,!1));var yc=D("COLOR","u_color",1,.25,!0);yc.min_filter=J.TF_LINEAR;yc.mag_filter=J.TF_LINEAR;db=v(e,Rb,"X_BLUR",!0);M.append_node_attr(e,db);M.append_edge_attr(e,Yb,db,yc);jb=v(e,db,"Y_BLUR",!0);M.append_node_attr(e,jb);M.append_edge_attr(e,db,jb,yc);var Wc=T(nc.blur);M.append_node_attr(e,Wc);var Sc=D("COLOR","u_bloom",1,.25,!0);Sc.min_filter=J.TF_LINEAR;Sc.mag_filter=J.TF_LINEAR;M.append_edge_attr(e,
jb,Wc,Sc);M.append_edge_attr(e,Pa,Wc,D("COLOR","u_main",1,1,!0));m.push(Wc)}k=m;m=[]}if(Fc&&!Va){for(W=0;W<k.length;W++){var lc=k[W],Xc=aa(Hc.mb_decay_threshold,Hc.mb_factor);m.push(Xc);M.append_node_attr(e,Xc);var pd=D("COLOR","u_mb_tex_curr",1,1,!0);M.append_edge_attr(e,lc,Xc,pd);var jd=D("COLOR","u_mb_tex_accum",1,1,!0);Xc.slinks_internal.push(jd)}k=m;m=[]}if(Mc&&pc&&!Va){for(W=0;W<k.length;W++){var Pa=k[W],Ob=u(Ca[W]);b.cameras.push(Ob);yc=D("COLOR","u_color",1,1,!0);yc.min_filter=J.TF_LINEAR;
yc.mag_filter=J.TF_LINEAR;var Zb=y("X_BLUR");M.append_node_attr(e,Zb);M.append_edge_attr(e,Pa,Zb,yc);var gc=y("Y_BLUR");M.append_node_attr(e,gc);M.append_edge_attr(e,Zb,gc,yc);var Qa=ub[W],Ic=Y(Ob);Ob.dof_distance=b.dof_distance;Ob.dof_object=b.dof_object;Ob.dof_front=b.dof_front;Ob.dof_rear=b.dof_rear;Ob.dof_power=b.dof_power;Ob.dof_on=1;m.push(Ic);M.append_node_attr(e,Ic);M.append_edge_attr(e,Pa,Ic,D("COLOR","u_sharp",1,1,!0));M.append_edge_attr(e,gc,Ic,D("COLOR","u_blurred",1,1,!0));M.append_edge_attr(e,
Qa,Ic,D("DEPTH","u_depth",1,1,!0))}k=m;m=[]}if(!Va&&a.outline){for(W=0;W<Ca.length;W++){var Pa=k[W],$b=u(Ca[W]);b.cameras.push($b);var Yc=Q($b,ga);M.append_node_attr(e,Yc);var Pc=y("X_EXTEND"),Zc=D("COLOR","u_color",1,1,!0),kd=D("COLOR","u_outline_mask",1,1,!0);Pc.is_for_outline=!0;M.append_node_attr(e,Pc);M.append_edge_attr(e,Yc,Pc,Zc);var Qc=D("COLOR","u_color",1,.5,!0);Qc.min_filter=J.TF_LINEAR;Qc.mag_filter=J.TF_LINEAR;var Dc=y("Y_EXTEND");Dc.is_for_outline=!0;M.append_node_attr(e,Dc);M.append_edge_attr(e,
Pc,Dc,Qc);Zb=y("X_BLUR");Zb.is_for_outline=!0;M.append_node_attr(e,Zb);M.append_edge_attr(e,Dc,Zb,Qc);var Jc=D("COLOR","u_color",1,.25,!0);Jc.min_filter=J.TF_LINEAR;Jc.mag_filter=J.TF_LINEAR;var $c=D("COLOR","u_outline_mask_blurred",1,.25,!0);$c.min_filter=J.TF_LINEAR;$c.mag_filter=J.TF_LINEAR;gc=y("Y_BLUR");gc.is_for_outline=!0;M.append_node_attr(e,gc);M.append_edge_attr(e,Zb,gc,Jc);var Kc=X(gd);M.append_node_attr(e,Kc);M.append_edge_attr(e,Pa,Kc,D("COLOR","u_outline_src",1,1,!0));M.append_edge_attr(e,
Yc,Kc,kd);M.append_edge_attr(e,gc,Kc,$c);m.push(Kc)}k=m;m=[]}if(bd&&!Va){for(W=0;W<k.length;W++){var Pa=k[W],ad=ea(ic.brightness,ic.contrast,ic.exposure,ic.saturation);M.append_node_attr(e,ad);M.append_edge_attr(e,Pa,ad,D("COLOR","u_color",1,1,!0));m.push(ad)}k=m;m=[]}if(Gc){for(W=0;W<k.length;W++)if(Pa=k[W],va.smaa){var Lc=D("COLOR","u_color",1,1,!0);Lc.min_filter=J.TF_LINEAR;Lc.mag_filter=J.TF_LINEAR;var qd=S("SMAA_EDGE_DETECTION");M.append_node_attr(e,qd);M.append_edge_attr(e,Pa,qd,Lc);var cd=
S("SMAA_BLENDING_WEIGHT_CALCULATION");M.append_node_attr(e,cd);M.append_edge_attr(e,qd,cd,Lc);var rd=D("COLOR","u_search_tex",1,1,!1),sd=D("COLOR","u_area_tex",1,1,!1);rd.min_filter=J.TF_LINEAR;rd.mag_filter=J.TF_LINEAR;sd.min_filter=J.TF_LINEAR;sd.mag_filter=J.TF_LINEAR;cd.slinks_internal.push(rd);cd.slinks_internal.push(sd);var ld=S("SMAA_NEIGHBORHOOD_BLENDING");M.append_node_attr(e,ld);M.append_edge_attr(e,Pa,ld,Lc);var td=D("COLOR","u_blend",1,1,!0);td.min_filter=J.TF_LINEAR;td.mag_filter=J.TF_LINEAR;
M.append_edge_attr(e,cd,ld,td);m.push(ld)}else{var md=P();M.append_node_attr(e,md);var nd=D("COLOR","u_color",1,1,!0);nd.min_filter=J.TF_LINEAR;nd.mag_filter=J.TF_LINEAR;M.append_edge_attr(e,Pa,md,nd);if(1<va.render_resolution_factor){var ud=y("NONE");M.append_node_attr(e,ud);M.append_edge_attr(e,md,ud,nd);m.push(ud)}else m.push(md)}k=m;m=[]}if(a.anaglyph_use&&!Va){var od=pa();M.append_node_attr(e,od);M.append_edge_attr(e,k[0],od,D("COLOR","u_sampler_left",1,1,!0));M.append_edge_attr(e,k[1],od,D("COLOR",
"u_sampler_right",1,1,!0));m.push(od)}else m.push(k[0]);var Ad=M.node_by_attr(e,k[0]);if("MOTION_BLUR"==k[0].type)var vd=!0;else vd=!1,M.traverse_inputs(e,Ad,function(a,b,c){if(c.from==c.to)return vd=!0});if(vd){var Tc=ja();M.append_node_attr(e,Tc);M.append_edge_attr(e,k[0],Tc,D("COLOR","u_color",1,1,!0));k=m;m=[];m.push(Tc)}Da&&(sb?m.push(sb):m.push(Da));mb&&m.push(mb);if(!Va&&a.sky_params.procedural_skydome){var wd=fa(ga,a.sky_params);M.append_node_attr(e,wd);m.push(wd)}var Rc=da();M.append_node_attr(e,
Rc);for(W=0;W<m.length;W++){var dd=m[W];switch(dd.type){case "COLOR_PICKING":case "COLOR_PICKING_XRAY":M.append_edge_attr(e,dd,Rc,D("COLOR","NONE",1,1,!0));M.append_edge_attr(e,dd,Rc,D("DEPTH","NONE",1,1,!0));break;case "SKY":var Bd=D("CUBEMAP","u_sky",Fa.cubemap_tex_size,1,!1);M.append_edge_attr(e,dd,Rc,Bd);break;case "ANCHOR_VISIBILITY":var Cd=D("COLOR","NONE",1,1,!0);M.append_edge_attr(e,dd,Rc,Cd);break;default:if(Va){var xd=d[0]._render,ed=D("COLOR","OFFSCREEN",1,1,!0);ed.texture=xd;M.append_edge_attr(e,
m[W],Rc,ed);for(Aa=1;Aa<d.length;Aa++){var yd=d[Aa]._render,Tc=ja();M.append_node_attr(e,Tc);var Dd=D("COLOR","u_color",1,1,!0);M.append_edge_attr(e,m[W],Tc,Dd);ed=D("COLOR","OFFSCREEN",1,yd.source_size/xd.source_size,!0);ed.texture=yd;M.append_edge_attr(e,Tc,Rc,ed)}}else M.append_edge_attr(e,m[W],Rc,D("SCREEN","NONE",1,1,!0))}}if(Ea.enabled){var zd=N(e);zd&&G(e,zd)}h(e,pc);1<va.render_resolution_factor&&f(e);c(e);B(e);if(pb){for(W=0;W<sc.length;W++)p(e,sc[W]);for(W=0;W<ub.length;W++)p(e,ub[W]);for(W=
0;W<cc.length;W++)p(e,cc[W])}return e};a.init_subs=C;a.set_texel_size=function(a,b,c){var d=a.texel_size_multiplier;a.texel_size[0]=b*a.texel_mask[0]*d;a.texel_size[1]=c*a.texel_mask[1]*d};a.set_texel_size_mult=function(a,b){a.texel_size_multiplier=b};a.find_on_screen=function(a){var b=null;M.traverse(a,function(a,c){return c.camera&&null===c.camera.framebuffer?(b=c,!0):!1});return b};a.find_input=function(a,b,c){a=ga(a,b);for(b=0;b<a.length;b++)if(a[b].type===c)return a[b];return null};a.has_lower_subs=
qa;a.has_upper_subs=O;a.get_inputs=ga;a.get_outputs=ha;a.find_subs=function(a,b){var c=null;M.traverse(a,function(a,d){return d.type==b?(c=d,!0):!1});return c};a.debug_convert_to_dot=function(a){var b="digraph scenegraph {\n",b=b+"    ",b=b+'size="11.7,16.5";\n',b=b+"    ",b=b+'ratio="fill";\n',b=b+"    ",b=b+'node [shape=box margin="0.25,0.055"];\n',c=ia(a);M.traverse(a,function(a,d){var e=b+="    ",g="",g=d.type.replace(/_/g," ");"POSTPROCESSING"==d.type&&(g+=" ("+d.pp_effect.replace(/_/g," ")+
")");if(d.camera){for(var g=g+"\\n",f=0;f<c.length;f+=2)c[f]==d.camera.color_attachment&&(g+="C"+c[f+1]+" ");for(f=0;f<c.length;f+=2)c[f]==d.camera.depth_attachment&&(g+="D"+c[f+1])}d.slinks_internal.length&&(g+="\\n-----\\n");for(f=0;f<d.slinks_internal.length;f++)g+=ma(d.slinks_internal[f],a,null,c);f="SINK"==d.type?"dotted":d.enqueue?"solid":"dashed";b=e+(String(a)+' [label="'+g+'" color="black" style="'+(f+",bold")+'"];\n')});M.traverse_edges(a,function(a,d,e){var g=b+="    ",f=ma(e,a,d,c);b=
g+(String(a)+" -> "+String(d)+' [label="'+f+'" style="'+(e.active?"solid":"dotted")+'"];\n')});return b+="}"};a.create_rendering_queue=function(a){a=M.topsort_attr(a);for(var b=[],c=0;c<a.length;c++){var d=a[c];d.enqueue&&b.push(d)}return b}};b4w.module.__textures=function(a,r){function u(){return{name:"",type:0,source:"",source_id:"",width:0,height:0,compress_ratio:1,allow_node_dds:!0,source_size:1024,enable_canvas_mipmapping:!1,canvas_context:null,w_target:0,w_texture:null,w_renderbuffer:null,_nla_tex_event:null,is_movie:!1,vtex_data_id:-1,video_file:null,movie_length:0,fps:0,frame_start:0,frame_offset:0,frame_duration:0,seq_video:null,seq_movie_length:0,seq_fps:0,seq_cur_frame:-1,seq_video_played:!1,seq_last_discrete_mark:-1,video_was_stopped:!1,
use_auto_refresh:!1,use_cyclic:!1,use_nla:!1}}function h(c,d,e,f){var k=c.type,h=new Uint8Array([204,204,204,255]),m=u();switch(k){case "DATA_TEX2D":case "IMAGE":var l=v.createTexture(),p=v.TEXTURE_2D;v.bindTexture(p,l);v.texImage2D(p,0,v.RGBA,1,1,0,v.RGBA,v.UNSIGNED_BYTE,h);c.image&&"MOVIE"==c.image.source&&(m.is_movie=!0,m.frame_start=c.frame_start,m.frame_offset=c.frame_offset,m.frame_duration=c.frame_duration,m.use_auto_refresh=c.use_auto_refresh,m.use_cyclic=c.use_cyclic,m.movie_length=c.movie_length,
m.use_nla=c.b4w_nla_video,0!=m.frame_offset&&w.warn('Frame offset for texture "'+c.name+'" has a nonzero value. Can lead to undefined behaviour for mobile devices.'));break;case "NONE":l=v.createTexture();p=v.TEXTURE_2D;v.bindTexture(p,l);if("NONE"==c.b4w_source_type)return null;if("SCENE"==c.b4w_source_type)if(c.b4w_source_id&&(e=C.keysearch("name",c.b4w_source_id,e)))m.source_size=c.b4w_source_size,e._render_to_textures=e._render_to_textures||[],e._render_to_textures.push(c),v.texImage2D(p,0,v.RGBA,
1,1,0,v.RGBA,v.UNSIGNED_BYTE,h);else return null;break;case "ENVIRONMENT_MAP":l=v.createTexture();p=v.TEXTURE_CUBE_MAP;v.bindTexture(p,l);e="POSITIVE_X NEGATIVE_X POSITIVE_Y NEGATIVE_Y POSITIVE_Z NEGATIVE_Z".split(" ");for(var n=0;6>n;n++)v.texImage2D(v["TEXTURE_CUBE_MAP_"+e[n]],0,v.RGBA,1,1,0,v.RGBA,v.UNSIGNED_BYTE,h);break;case "BLEND":return null;default:return w.error('texture "'+c.name+'" has unsupported type "'+k+'"'),null}"NONE"==k&&(!c.b4w_enable_canvas_mipmapping||"CANVAS"!=c.b4w_source_type)||
"DATA_TEX2D"==k||"IMAGE"==k&&"MOVIE"==c.image.source?v.texParameteri(p,v.TEXTURE_MIN_FILTER,v.LINEAR):v.texParameteri(p,v.TEXTURE_MIN_FILTER,I[D.texture_min_filter]);v.texParameteri(p,v.TEXTURE_MAG_FILTER,v.LINEAR);h=p;e=c.b4w_anisotropic_filtering;"DEFAULT"===e&&(e=d);"OFF"!==e&&D.anisotropic_filtering&&(d=G.get_aniso())&&(e=parseFloat(e.split("x")[0]),v.texParameterf(h,d.TEXTURE_MAX_ANISOTROPY_EXT,e));"REPEAT"!=c.extension||c.b4w_shore_dist_map?(v.texParameteri(p,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),
v.texParameteri(p,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE)):(v.texParameteri(p,v.TEXTURE_WRAP_S,v.REPEAT),v.texParameteri(p,v.TEXTURE_WRAP_T,v.REPEAT));m.type=a.TT_RGBA_INT;m.width=1;m.height=1;m.w_texture=l;m.w_target=p;"CANVAS"==c.b4w_source_type&&"NONE"==k?(k=c.b4w_source_id,l=c.b4w_source_size,m.enable_canvas_mipmapping=c.b4w_enable_canvas_mipmapping,m.source_id=k,m.source="CANVAS",p=document.createElement("canvas"),p.width=l,p.height=l,m.canvas_context=p.getContext("2d"),f in g||(g[f]={}),g[f][k]=m,
b(m)):"SCENE"==c.b4w_source_type&&"NONE"==k?(m.source_id=c.b4w_source_id,m.source="SCENE"):(m.source=k,v.generateMipmap(p),v.bindTexture(p,null));m.name=c.name;return c._render=m}function b(a){if("CANVAS"!=a.source)throw"Wrong texture";var b=a.w_target;v.bindTexture(b,a.w_texture);var c=f(a),d=n(a),e=a.canvas_context.canvas;v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,!0);v.texImage2D(b,0,c,c,d,e);v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,!1);a.enable_canvas_mipmapping&&v.generateMipmap(b);v.bindTexture(b,null);
a.width=e.width;a.height=e.height}function l(a){v.texParameteri(a,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE);v.texParameteri(a,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE);v.texParameteri(a,v.TEXTURE_MAG_FILTER,v.LINEAR);v.texParameteri(a,v.TEXTURE_MIN_FILTER,v.LINEAR)}function c(a,b){var c=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384];return-1==c.indexOf(a)||-1==c.indexOf(b)}function f(b){switch(b.type){case a.TT_RGBA_INT:b=v.RGBA;break;case a.TT_RGB_INT:b=v.RGB;break;case a.TT_RGBA_FLOAT:b=v.RGBA;break;
case a.TT_RGB_FLOAT:b=v.RGB;break;case a.TT_DEPTH:b=v.DEPTH_COMPONENT;break;default:throw"Wrong texture type";}return b}function n(b){switch(b.type){case a.TT_RGBA_INT:b=v.UNSIGNED_BYTE;break;case a.TT_RGB_INT:b=v.UNSIGNED_BYTE;break;case a.TT_RGBA_FLOAT:b=v.FLOAT;break;case a.TT_RGB_FLOAT:b=v.FLOAT;break;case a.TT_DEPTH:b=v.UNSIGNED_INT;break;default:throw"Wrong texture type";}return b}function q(a,b){if(b in y&&a in y[b]){var c=y[b][a];c.video_file?c.video_file.play():c.seq_video&&(c.seq_video_played=
!0);return!0}return!1}function d(a,b){if(b in y&&a in y[b]){var c=y[b][a];c.video_file?c.video_file.pause():c.seq_video&&(c.seq_video_played=!1);return!0}return!1}function k(a,b){if(b in y&&a in y[b]){var c=y[b][a];c.video_file?c.video_file.currentTime=c.frame_offset/c.fps:c.seq_video&&(c.seq_cur_frame=m(c,c.frame_offset));return!0}return!1}function e(a){return a.video_file?!a.video_file.paused:a.seq_video?a.seq_video_played:!1}function m(a,b){return Math.round(b*a.seq_movie_length/a.movie_length)}
var B=r("__config"),N=r("__dds"),G=r("__extensions"),w=r("__print"),t=r("__time"),C=r("__util"),D=B.defaults,p=B.sfx;a.TF_NEAREST=0;a.TF_LINEAR=0;a.TF_NEAREST_MIPMAP_NEAREST=0;a.TF_LINEAR_MIPMAP_NEAREST=0;a.TF_NEAREST_MIPMAP_LINEAR=0;a.TF_LINEAR_MIPMAP_LINEAR=0;a.TT_RGBA_INT=10;a.TT_RGB_INT=20;a.TT_RGBA_FLOAT=30;a.TT_RGB_FLOAT=40;a.TT_DEPTH=50;a.TT_RENDERBUFFER=60;var g={},y={},v=null,I;a.setup_context=function(b){I=[b.NEAREST_MIPMAP_NEAREST,b.NEAREST_MIPMAP_LINEAR,b.LINEAR_MIPMAP_NEAREST,b.LINEAR_MIPMAP_LINEAR];
a.TF_NEAREST=b.NEAREST;a.TF_LINEAR=b.LINEAR;a.TF_NEAREST_MIPMAP_NEAREST=b.NEAREST_MIPMAP_NEAREST;a.TF_LINEAR_MIPMAP_NEAREST=b.LINEAR_MIPMAP_NEAREST;a.TF_NEAREST_MIPMAP_LINEAR=b.NEAREST_MIPMAP_LINEAR;a.TF_LINEAR_MIPMAP_LINEAR=b.LINEAR_MIPMAP_LINEAR;v=b};a.get_canvas_context=function(a,b){return b in g&&a in g[b]?g[b][a].canvas_context:null};a.update_canvas_context=function(a,c){return c in g&&a in g[c]?(b(g[c][a]),!0):!1};a.create_texture=function(b,c){var d=u();d.name=b;d.type=c;d.source="NONE";if(c==
a.TT_RENDERBUFFER)d.w_renderbuffer=v.createRenderbuffer();else{var e=v.TEXTURE_2D,g=v.createTexture();v.bindTexture(e,g);v.texParameteri(e,v.TEXTURE_MAG_FILTER,v.LINEAR);v.texParameteri(e,v.TEXTURE_MIN_FILTER,v.LINEAR);v.texParameteri(e,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE);v.texParameteri(e,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE);v.bindTexture(e,null);d.w_target=e;d.w_texture=g}return d};a.create_cubemap_texture=function(b,c){var d=v.createTexture(),e=v.TEXTURE_CUBE_MAP;v.bindTexture(e,d);v.texParameteri(e,
v.TEXTURE_MAG_FILTER,v.LINEAR);v.texParameteri(e,v.TEXTURE_MIN_FILTER,v.LINEAR);v.texParameteri(e,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE);v.texParameteri(e,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE);for(var g="TEXTURE_CUBE_MAP_POSITIVE_X TEXTURE_CUBE_MAP_NEGATIVE_X TEXTURE_CUBE_MAP_POSITIVE_Y TEXTURE_CUBE_MAP_NEGATIVE_Y TEXTURE_CUBE_MAP_POSITIVE_Z TEXTURE_CUBE_MAP_NEGATIVE_Z".split(" "),f=0;6>f;f++)v.texImage2D(v[g[f]],0,v.RGBA,c,c,0,v.RGBA,v.UNSIGNED_BYTE,null);v.bindTexture(e,null);e=u();e.name=b;e.type=a.TT_RGBA_INT;
e.source="NONE";e.width=3*c;e.height=2*c;e.compress_ratio=1;e.w_texture=d;e.w_target=v.TEXTURE_CUBE_MAP;return e};a.set_filters=function(b,c,d){if(b.type!=a.TT_RENDERBUFFER){var e=b.w_target;v.bindTexture(e,b.w_texture);c&&v.texParameteri(e,v.TEXTURE_MIN_FILTER,c);d&&v.texParameteri(e,v.TEXTURE_MAG_FILTER,d);v.bindTexture(e,null)}};a.get_filters=function(b){if(b.type==a.TT_RENDERBUFFER)return{min:a.TF_NEAREST,mag:a.TF_NEAREST};var c=b.w_target;v.bindTexture(c,b.w_texture);b=v.getTexParameter(c,v.TEXTURE_MIN_FILTER);
var d=v.getTexParameter(c,v.TEXTURE_MAG_FILTER);v.bindTexture(c,null);return{min:b,mag:d}};a.resize=function(b,c,d){c=Math.max(c,D.edge_min_tex_size_hack?2:1);d=Math.max(d,D.edge_min_tex_size_hack?2:1);if(b.width!=c||b.height!=d){if(b.type==a.TT_RENDERBUFFER)v.bindRenderbuffer(v.RENDERBUFFER,b.w_renderbuffer),v.renderbufferStorage(v.RENDERBUFFER,v.DEPTH_COMPONENT16,c,d),v.bindRenderbuffer(v.RENDERBUFFER,null);else{var e=b.w_target;v.bindTexture(e,b.w_texture);var g=f(b),k=n(b);v.texImage2D(e,0,g,
c,d,0,g,k,null);v.bindTexture(e,null)}c>D.max_texture_size||d>D.max_texture_size?w.error('Slink texture "'+b.name+'" has unsupported size: '+c+"x"+d+". Max available: "+D.max_texture_size+"x"+D.max_texture_size+"."):(b.width=c,b.height=d)}};a.create_texture_bpy=h;a.update_video_texture=function(a){var b=a.w_target;v.bindTexture(b,a.w_texture);v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,!0);4!=a.video_file.length?v.texImage2D(b,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,a.video_file):v.texImage2D(b,0,v.RGBA,1,1,0,v.RGBA,
v.UNSIGNED_BYTE,a.video_file);v.bindTexture(b,null)};a.update_seq_video_texture=function(a){var b=a.w_target;v.bindTexture(b,a.w_texture);v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,!0);v.texImage2D(b,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,a.seq_video[a.seq_cur_frame]);v.bindTexture(b,null)};a.update_texture=function(a,b,d,e,g){var f=a.source,k=a.w_target;v.bindTexture(k,a.w_texture);if(4==b.length){var h=!0;b=new Uint8Array([255*b[0],255*b[1],255*b[2],255*b[3]])}if("IMAGE"==f)if(h)v.texImage2D(k,0,v.RGBA,1,1,0,
v.RGBA,v.UNSIGNED_BYTE,b),a.width=1,a.height=1;else if(d){d=N.get_width_height(b);if(d.width>D.max_texture_size||d.height>D.max_texture_size){w.error('Texture "'+e+'" has unsupported size: '+d.width+"x"+d.height+". Max available: "+D.max_texture_size+"x"+D.max_texture_size+".");return}N.upload_dds_levels(v,G.get_s3tc(),b,!0);c(d.width,d.height)&&(a.auxilary_texture||w.warn("using NPOT texture",e),l(k));a.width=d.width;a.height=d.height;a.compress_ratio=N.get_compress_ratio(b)}else{v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,
!0);if(b.width>D.max_texture_size||b.height>D.max_texture_size){w.error('Texture "'+e+'" has unsupported size: '+b.width+"x"+b.height+". Max available: "+D.max_texture_size+"x"+D.max_texture_size+".");return}a.is_movie?D.seq_video_fallback?b&&(g in y||(y[g]={}),y[g][a.name]=a,a.seq_video=b,a.seq_movie_length=b.length,a.fps=a.seq_fps*a.movie_length/b.length,v.texImage2D(k,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,a.seq_video[0])):(b&&(g in y||(y[g]={}),y[g][a.name]=a),a.video_file=b,a.video_file.loop=a.use_cyclic,
a.fps=b.duration?a.movie_length/b.duration:t.get_framerate(),p.disable_playback_rate_hack||(b.playbackRate=t.get_framerate()/a.fps,p.clamp_playback_rate_hack&&2<b.playbackRate&&(b.playbackRate=2)),v.texImage2D(k,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,a.video_file)):v.texImage2D(k,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,b);a.is_movie?D.seq_video_fallback?(a.width=b[0].width,a.height=b[0].height):(a.width=b.videoWidth,a.height=b.videoHeight):(a.width=b.width,a.height=b.height);c(a.width,a.height)?(a.auxilary_texture||
(a.is_movie?w.warn("using NPOT video texture",e):w.warn("using NPOT texture",e)),l(k)):a.is_movie||v.generateMipmap(k)}else if("ENVIRONMENT_MAP"==f)if(d=[["POSITIVE_X",2,0],["NEGATIVE_X",0,0],["POSITIVE_Y",1,1],["NEGATIVE_Y",0,1],["POSITIVE_Z",1,0],["NEGATIVE_Z",2,1]],h){for(h=0;6>h;h++)g=d[h],v.texImage2D(v["TEXTURE_CUBE_MAP_"+g[0]],0,v.RGBA,1,1,0,v.RGBA,v.UNSIGNED_BYTE,b);a.width=3;a.height=2}else{v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,!1);f=b.width/3;if(f>D.max_cube_map_size){w.warn('Cubemap texture "'+
e+'" has unsupported size: '+b.width+"x"+b.height+". Max available: "+3*D.max_cube_map_size+"x"+2*D.max_cube_map_size+". Reduced image size will be used.");var m=D.max_cube_map_size/f*f}else m=f;for(h=0;6>h;h++){g=d[h];var n=document.createElement("canvas");n.width=m;n.height=m;var q=n.getContext("2d");"POSITIVE_Y"==g[0]||"NEGATIVE_Y"==g[0]?(q.translate(0,m),q.scale(1,-1)):(q.translate(m,0),q.scale(-1,1));q.drawImage(b,g[1]*f,g[2]*f,f,f,0,0,m,m);v.texImage2D(v["TEXTURE_CUBE_MAP_"+g[0]],0,v.RGBA,v.RGBA,
v.UNSIGNED_BYTE,n)}a.width=3*m;a.height=2*m;c(b.width/3,b.height/2)?(w.warn("using NPOT cube map texture",e),l(k)):v.generateMipmap(k)}else"DATA_TEX2D"==f&&(v.texImage2D(k,0,v.RGBA,b.width,b.height,0,v.RGBA,v.UNSIGNED_BYTE,b.data),a.width=b.width,a.height=b.height);v.bindTexture(k,null)};a.delete_texture=function(a){v.deleteTexture(a)};a.is_texture=function(a){return a&&a.name&&(a.w_texture||a.w_renderbuffer)?!0:!1};a.is_renderbuffer=function(a){return a&&a.name&&a.w_renderbuffer?!0:!1};a.is_float=
function(b){return b.type==a.TT_RGBA_FLOAT||b.type==a.TT_RGB_FLOAT?!0:!1};a.get_texture_channel_size=function(b){var c=0;switch(b.type){case a.TT_RGBA_INT:case a.TT_RGB_INT:c=4;break;case a.TT_RGBA_FLOAT:case a.TT_RGB_FLOAT:c=16;break;case a.TT_DEPTH:c=3;break;case a.TT_RENDERBUFFER:c=2}return c};a.generate_texture=function(a,b){var c=null;switch(a){case "SSAO_TEXTURE":c={name:"special_ssao_texture",type:"DATA_TEX2D",extension:"REPEAT",b4w_anisotropic_filtering:"OFF"},h(c,null,b,0),c.image={filepath:null}}return c};
a.cleanup=function(){if(!D.seq_video_fallback)for(var a in y)for(var b in y[a])y[a][b].video_file.pause(),y[a][b].video_file.src="",y[a][b].video_file.load();g={};y={}};a.pause=function(){for(var a in y)for(var b in y[a]){var c=y[a][b];e(c)&&(d(b,a),c.video_was_stopped=!0)}};a.reset=function(){for(var a in y)for(var b in y[a])k(b,a),y[a][b].video_was_stopped=!1};a.play=function(a){for(var b in y)for(var c in y[b]){var d=y[b][c];if(!a||d.video_was_stopped)q(c,b),d.video_was_stopped=!1}};a.play_video=
q;a.pause_video=d;a.reset_video=k;a.set_frame_video=function(a,b,c){return c in y&&a in y[c]?(a=y[c][a],a.video_file?a.video_file.currentTime=b/a.fps:a.seq_video&&(a.seq_cur_frame=b),!0):!1};a.video_is_played=e;a.video_update_is_available=function(a){return a.video_file||a.seq_video?a.video_file?2<=a.video_file.readyState:!0:0};a.video_get_current_frame=function(a){return a.video_file||a.seq_video?a.video_file?Math.round(a.video_file.currentTime*a.fps):a.seq_cur_frame:0};a.video_get_start_frame=function(a){return a.video_file||
a.seq_video?a.video_file?a.frame_offset:m(a,a.frame_offset):0};a.video_get_end_frame=function(a){if(!a.video_file&&!a.seq_video)return 0;var b=Math.min(a.frame_duration,a.movie_length-a.frame_offset);return a.video_file?a.frame_offset+b:m(a,a.frame_offset+b)};a.seq_video_get_discrete_timemark=function(a,b){return Math.round(b*a.seq_fps*(t.get_framerate()/a.fps))};a.video_get_duration=function(a){return Math.min(a.frame_duration,a.movie_length-a.frame_offset)};a.video_frame_to_seq_frame=m};b4w.module.__assets=function(a,r){function u(){return N.is_built_in_data()?r(N.paths.built_in_data_module).data:null}function h(){var a={_source_url:null,_parse_response:function(b){switch(a.responseType){case "json":case "text":return b;case "arraybuffer":b=atob(b);for(var c=b.length,d=new Int8Array(c),e=0;e<c;e++)d[e]=b.charCodeAt(e);return d.buffer;default:return b}},status:0,readyState:0,response:"",responseType:"",onreadystatechange:null,overrideMimeType:function(){},addEventListener:function(){},
open:function(b,c,d){a._source_url=c;a.readyState=1},send:function(){a.status=404;a.readyState=4;var b=u();b&&a._source_url in b&&(a.status=200,b[a._source_url]&&(a.response=a._parse_response(b[a._source_url])));if("[object Function]"==={}.toString.call(a.onreadystatechange))a.onreadystatechange()}};return a}function b(b){for(var e=0,k=0;k<b.length;k++){var h=b[k];20===h.state&&e++;if(e>=g.max_requests)break;if(10===h.state)switch(h.state=20,e++,h.type){case a.AT_ARRAYBUFFER:l(h,"arraybuffer");break;
case a.AT_JSON:l(h,"json");break;case a.AT_TEXT:l(h,"text");break;case a.AT_AUDIOBUFFER:c(h);break;case a.AT_IMAGE_ELEMENT:f(h);break;case a.AT_AUDIO_ELEMENT:n(h);break;case a.AT_VIDEO_ELEMENT:q(h);break;case a.AT_SEQ_VIDEO_ELEMENT:d(h);break;default:C.panic("Wrong asset type: "+h.type)}}}function l(a,b){var c=u(),d=c&&a.filepath in c?new h:new XMLHttpRequest;d.open("GET",a.filepath,!0);"text"==b?(d.overrideMimeType("text/plain"),d.responseType="text"):"json"==b?(d.overrideMimeType("application/json"),
d.responseType="text"):d.responseType=b;d.onreadystatechange=function(){if(40!=a.state&&4==d.readyState){if(200==d.status||0==d.status){var c=d.response;if(c){if("json"==b&&"string"==typeof c)try{c=JSON.parse(c)}catch(e){w.error(e+" (parsing JSON "+a.filepath+")");a.asset_cb(null,a.uri,a.type,a.filepath,a.opt_param);return}a.asset_cb(c,a.uri,a.type,a.filepath,a.opt_param)}else w.error("empty responce when trying to get "+a.filepath),a.asset_cb(null,a.uri,a.type,a.filepath,a.opt_param)}else w.error(d.status+
" when trying to get "+a.filepath),a.asset_cb(null,a.uri,a.type,a.filepath,a.opt_param);a.state=30}};d.addEventListener("progress",function(b){b.lengthComputable&&a.progress_cb(b.loaded/b.total)},!1);d.send(null)}function c(a){var b=u(),c=b&&a.filepath in b?new h:new XMLHttpRequest;c.open("GET",a.filepath,!0);c.responseType="arraybuffer";c.onreadystatechange=function(){if(40!=a.state&&4==c.readyState)if(200==c.status||0==c.status){var b=c.response;b?t.decode_audio_data(b,function(b){a.asset_cb(b,
a.uri,a.type,a.filepath,a.opt_param);a.state=30},function(){a.asset_cb(null,a.uri,a.type,a.filepath,a.opt_param);w.error("failed to decode "+a.filepath);a.state=30}):(a.asset_cb(null,a.uri,a.type,a.filepath,a.opt_param),w.error("empty responce when trying to get "+a.filepath),a.state=30)}else a.asset_cb(null,a.uri,a.type,a.filepath,a.opt_param),w.error(c.status+" when trying to get "+a.filepath),a.state=30};c.send(null)}function f(a){var b=document.createElement("img");p.allow_cors&&(b.crossOrigin=
"Anonymous");b.onload=function(){40!=a.state&&(a.asset_cb(b,a.uri,a.type,a.filepath,a.opt_param),a.state=30)};b.addEventListener("error",function(){40!=a.state&&(a.asset_cb(null,a.uri,a.type,a.filepath,a.opt_param),w.error("could not load image: "+a.filepath),a.state=30)},!1);var c=u();if(c&&a.filepath in c)if(c[a.filepath]){var d=e(a.filepath);b.src="data:"+d+";base64,"+c[a.filepath]}else G.is_ie11()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",!1,!1,null)):c=new CustomEvent("error"),
b.dispatchEvent(c);else b.src=a.filepath}function n(a){var b=document.createElement("audio");if(p.allow_cors||p.cors_chrome_hack)b.crossOrigin="Anonymous";b.addEventListener("loadeddata",function(){40!=a.state&&(a.asset_cb(b,a.uri,a.type,a.filepath,a.opt_param),a.state=30)},!1);b.addEventListener("error",function(){40!=a.state&&(a.asset_cb(null,a.uri,a.type,a.filepath,a.opt_param),w.error("could not load sound: "+a.filepath),a.state=30)},!1);var c=u();if(c&&a.filepath in c)if(c[a.filepath]){var d=
m(a.filepath);b.src="data:"+d+";base64,"+c[a.filepath];40!=a.state&&(a.asset_cb(b,a.uri,a.type,a.filepath,a.opt_param),a.state=30)}else G.is_ie11()?(c=document.createEvent("CustomEvent"),c.initCustomEvent("error",!1,!1,null)):c=new CustomEvent("error"),b.dispatchEvent(c);else b.src=a.filepath,p.is_mobile_device&&b.load();p.mobile_firefox_media_hack&&(b.autoplay=!0,b.pause());setTimeout(function(){b.some_prop_to_prevent_gc=1},5E3)}function q(a){function b(c){40!=a.state&&(a.asset_cb(null,a.uri,a.type,
a.filepath),w.error("could not load video: "+a.filepath,a.opt_param),a.state=30)}var c=document.createElement("video");c.muted=!0;if(p.allow_cors||p.is_mobile_device)c.crossOrigin="Anonymous";c.addEventListener("loadeddata",function(){c.removeEventListener("error",b,!1);40!=a.state&&(a.asset_cb(c,a.uri,a.type,a.filepath,a.opt_param),a.state=30)},!1);c.addEventListener("error",b,!1);var d=u();if(d&&a.filepath in d)if(d[a.filepath]){var e=B(a.filepath);c.src="data:"+e+";base64,"+d[a.filepath];40!=a.state&&
c.addEventListener("loadeddata",function(){a.asset_cb(c,a.uri,a.type,a.filepath,a.opt_param);a.state=30},!1)}else G.is_ie11()?(d=document.createEvent("CustomEvent"),d.initCustomEvent("error",!1,!1,null)):d=new CustomEvent("error"),c.dispatchEvent(d);else c.src=a.filepath,p.is_mobile_device&&c.load();p.mobile_firefox_media_hack&&(c.autoplay=!0,c.pause());setTimeout(function(){c.some_prop_to_prevent_gc=1},1E4)}function d(a){function b(c){a.asset_cb(c,a.uri,a.type,a.filepath,a.opt_param)}var c=u(),d=
c&&a.filepath in c?new h:new XMLHttpRequest;d.open("GET",a.filepath,!0);d.responseType="arraybuffer";d.onreadystatechange=function(){if(40!=a.state&&4==d.readyState){if(200==d.status||0==d.status){var c=d.response;c?k(c,b):(a.asset_cb(null,a.uri,a.type,a.filepath,a.opt_param),w.error("empty responce when trying to get "+a.filepath))}else a.asset_cb(null,a.uri,a.type,a.filepath,a.opt_param),w.error(d.status+" when trying to get "+a.filepath);a.state=30}};d.addEventListener("progress",function(b){b.lengthComputable&&
a.progress_cb(b.loaded/b.total)},!1);d.send(null)}function k(a,b){for(var c=new Int32Array(a),d=new Int8Array(a),e=c[3],g={images:[],blobs:[],fps:c[4]},f=20,k=0;k<e;k++){var h=c[f/4],m=d.subarray(f+4,f+4+h),m=new Blob([m],{type:"image/jpg"}),l=document.createElement("img");l.src=window.URL.createObjectURL(m);g.images.push(l);g.blobs.push(m);f+=h+8-h%4}l.onload=function(){for(var a=0;a<g.images.length;a++)window.URL.revokeObjectURL(g.images[a].src);delete g.blobs;b(g)}}function e(a){var b="image";
switch(C.get_file_extension(a).toLowerCase()){case "jpeg":case "jpg":b+="/jpeg";break;case "png":b+="/png"}return b}function m(a){var b="audio";switch(C.get_file_extension(a).toLowerCase()){case "ogv":case "ogg":b+="/ogg";break;case "mp3":b+="/mpeg";break;case "m4v":case "mp4":b+="/mp4";break;case "webm":b+="/webm"}return b}function B(a){var b="video";switch(C.get_file_extension(a).toLowerCase()){case "ogv":b+="/ogg";break;case "webm":b+="/webm";break;case "m4v":b+="/mp4"}return b}var N=r("__config"),
G=r("__compat"),w=r("__print"),t=r("__sfx"),C=r("__util"),D=r("__version"),p=N.defaults,g=N.assets;a.AT_ARRAYBUFFER=10;a.AT_JSON=20;a.AT_TEXT=30;a.AT_AUDIOBUFFER=40;a.AT_IMAGE_ELEMENT=50;a.AT_AUDIO_ELEMENT=60;a.AT_VIDEO_ELEMENT=70;a.AT_SEQ_VIDEO_ELEMENT=80;var y=[],v=0,I={};a.split_extension=function(a){a=a.split(".");var b=Array(2);b[0]=a.slice(0,-1).join(".");b[1]=String(a.slice(-1));return b};a.get_text_sync=function(a){if(I[a])return I[a];var b=g.prevent_caching?a+D.timestamp():a,c=new XMLHttpRequest;
c.overrideMimeType("text/plain");c.open("GET",b,!1);c.send(null);if(200==c.status||0==c.status){b=c.responseText;if(b.length)return I[a]=b;C.panic("Error XHR: responce is empty, GET "+a)}else C.panic("Error XHR: "+c.status+", GET "+a)};a.cleanup=function(){for(var a=0;a<y.length;a++)y[a].state=40;y=[];v=0;I={}};a.enqueue=function(a,c,d,e){for(var f=0;f<a.length;f++){var k=a[f],k={uri:k[0],type:k[1],filepath:k[2],opt_param:k[3],state:10,asset_cb:c||function(){},pack_cb:d||function(){},progress_cb:e||
function(){},pack_index:v};if(g.prevent_caching){var h=u();h&&k.filepath in h||(k.filepath+=D.timestamp())}y.push(k)}b(y);v++};a.update=function(){b(y);for(var a=y,c=0,d=!0,e=0;e<a.length;e++){var g=a[e];g.pack_index===a[c].pack_index?30!==g.state&&(d=!1):(d&&(a[e-1].pack_cb(),d=e-c,a.splice(c,d),e-=d),c=e,d=30===a[e].state?!0:!1);e===a.length-1&&d&&(a[e].pack_cb(),a.splice(c))}}};b4w.module.__loader=function(a,r){function u(b,c,d,e){var f=t,k=N.create(),l;for(l in c){var n=h(c[l]);(e&&n.is_resource||!b&&n.primary_only)&&m(n);N.append_node_attr(k,n)}for(l in c)for(n=c[l],n.name=l,b=0;b<n.inputs.length;b++)N.append_edge_attr(k,c[n.inputs[b]],n,null);c=h({name:"out",priority:a.FINISH_PRIORITY,cb_before:function(a,b,c,d,e,g){0===b.id&&(f.start_secondary_threads=!0);B(b)||(b.status=2);b.loaded_cb(b.id,!0);e(b,c);G.log("%cTHREAD "+b.id+": LOADED CALLBACK","color: #f0f;")},relative_size:5});
var q=[];if(d)for(d=N.get_sink_nodes(k),b=0;b<d.length;b++)q.push(N.get_node_attr(k,d[b]));else N.traverse(k,function(a,b){b.background_loading||q.push(b)});N.append_node_attr(k,c);for(b=0;b<q.length;b++)c.inputs.push(q[b].name),N.append_edge_attr(k,q[b],c,null);return k}function h(a){a.background_loading=a.background_loading||!1;a.priority||0===a.priority||(a.priority=a.SYNC_PRIORITY);a.inputs=a.inputs||[];a.is_finished=a.is_finished||!1;a.skip=a.skip||!1;a.relative_size=a.relative_size||0;a.is_resource=
a.is_resource||!1;a.primary_only=a.primary_only||!1;a.status=0;a.loop_index=0;a.load_rate=0;a.cb_param=a.cb_param||null;return a}function b(a,b,c){b.complete_load_cb(c,b);b.status=3;a.active_threads--;b.stageload_cb=null;b.complete_load_cb=null;b.stage_graph=null;b.stages_queue=null}function l(a,b){for(var c=[],d=[],e=0;e<b.length;e++){var f=b[e];N.get_node_attr(a.stage_graph,f).is_finished&&(N.traverse_outputs(a.stage_graph,f,function(d,e,g){var f=!0;N.traverse_inputs(a.stage_graph,d,function(a,
b,c){if(!b.is_finished)return f=!1,1});f&&-1==c.indexOf(d)&&-1==b.indexOf(d)&&c.push(d)}),d.push(e))}for(e=d.length-1;0<=e;e--)b.splice(d[e],1);return c}function c(a){var b=[],c=a.stages_queue,d=!1;do{var e=l(a,c);b.push.apply(b,c);0<e.length&&(d=!0);c=e}while(0<e.length);c=function(b,c){var d=N.get_node_attr(a.stage_graph,b),e=N.get_node_attr(a.stage_graph,c),g=e.priority-d.priority;0==g&&(g=d.background_loading-e.background_loading);return g};d&&b.sort(c);a.stages_queue=b;return a.stages_queue.length}
function f(a,b,c){if(b.skip)return b.is_finished=!0,q(a,b),!1;if(!b.cb_before&&!b.cb_loop&&!b.cb_after)return q(a,b),!1;if(0==b.status&&(b.status++,b.cb_before))return b.cb_before(c,a,b,b.cb_param,q,d),!0;if(1==b.status){if(b.cb_loop)return b.cb_loop(c,a,b,b.cb_param,q,d),!0;b.status++}return 2==b.status&&(b.status++,b.cb_after)?(b.cb_after(c,a,b,b.cb_param,q,d),!0):!1}function n(a){if(0==a.stages_size_total)return 100;var b=0;N.traverse(a.stage_graph,function(c,d){a.do_not_load_resources&&d.is_resource||
(b+=d.load_rate*d.relative_size)});return w.trunc(100*b/a.stages_size_total)}function q(a,b){b.is_finished=!0;b.status=3;k(a,b,1)}function d(a,b,c){1>c?k(a,b,c):b.status++}function k(a,b,c){var d=t;if(b.cb_before||b.cb_loop||b.cb_after)if(b.load_rate=c,b=n(a),a.curr_percents!=b||1==c)a.stageload_cb(b,performance.now()-a.time_load_start),a.curr_percents=b,d.make_idle_iteration=!0}function e(a,b){var c=null;N.traverse(a.stage_graph,function(a,d){if(d.name==b)return c=d,1});return c}function m(a){a.skip=
!0;a.load_rate=1}function B(a){return a&&(3==a.status||4==a.status)}var N=r("__graph"),G=r("__print"),w=r("__util");a.SYNC_PRIORITY=0;a.ASYNC_PRIORITY=1;a.FINISH_PRIORITY=2;var t=null;a.get_scheduler=function(){return t};a.create_scheduler=function(){var a={threads:[],current_thread_index:0,active_threads:0,start_secondary_threads:!1,make_idle_iteration:!1};return t=a};a.create_thread=function(a,b,c,d,e,f,k,h){var m=t,l={id:m.threads.length,status:0,filepath:b,binary_name:"",loaded_cb:c||function(){},
load_hidden:h||!1,wait_complete_loading:f,time_load_start:0,curr_percents:0,stages_size_total:0,reset_time_cycle:!1,stageload_cb:d||function(){},complete_load_cb:e||function(){},stage_graph:null,stages_queue:null,has_video_textures:!1,has_background_music:!1,init_wa_context:!1};a=u(0===l.id,a,f,k);l.stage_graph=a;b=[];c=N.get_source_nodes(a);for(d=0;d<c.length;d++)b.push(c[d]);l.stages_queue=b;N.traverse(a,function(a,b){if(b.cb_before||b.cb_loop||b.cb_after)l.do_not_load_resources&&b.is_resource||
(l.stages_size_total+=b.relative_size)});m.threads.push(l);m.active_threads++;return l.id};a.update_scheduler=function(d){var e=t,k;(k=!e)||(k=0==t.active_threads);if(!k)if(e.make_idle_iteration)e.make_idle_iteration=!1;else{k=performance.now();do{var g=e.threads[e.current_thread_index],h=d[g.id];if(!B(g))if(0==g.status&&(g.status=1,g.time_load_start=performance.now(),g.stageload_cb(0,0)),c(g)){var m=g,l=m.stages_queue.length;do{var n=N.get_node_attr(m.stage_graph,m.stages_queue[0]),q=f(m,n,h);n.priority==
a.ASYNC_PRIORITY&&(m.reset_time_cycle=!0);n=m.stages_queue.shift();m.stages_queue.push(n);l--}while(!q&&0!=l)}else b(e,g,h);e.start_secondary_threads&&(e.current_thread_index=(e.current_thread_index+1)%e.threads.length);if(g.reset_time_cycle){g.reset_time_cycle=!1;break}}while(16>performance.now()-k)}};a.abort_thread=function(a){var c=t;b(c,a,null);a.status=4;0===a.id&&(c.start_secondary_threads=!0);a.loaded_cb(a.id,!1)};a.stage_part_finish_cb=d;a.skip_stage_by_name=function(a,b){var c=e(a,b);null!==
c&&m(c)};a.thread_is_finished=B;a.is_primary_loaded=function(a){var b=t;if(!b)return!1;a|=0;return b.threads[a]&&(3==b.threads[a].status||2==b.threads[a].status)};a.cleanup=function(){t=null}};b4w.module.__logic_nodes=function(a,r){function u(a,b,d,e,g,f){switch(b.state){case 1:c.error("Unknown node type: "+a.type);break;case 2:d.curr_node=a.slot_idx_order}}function h(a){return b.get_object(b.GET_OBJECT_BY_DUPLI_NAME_LIST,a.dupli_name_list,0)}var b=r("__objects"),l=r("__scenes"),c=r("__print"),f=r("__nla");r("__config");var n=r("__controls"),q=r("__util"),d=r("__animation"),k=r("__assets"),e=r("__batch"),m=r("__geometry"),B=r("__time"),N=[],G={ENTRYPOINT:function(a,b,c,d,e,f){switch(b.state){case 2:c.curr_node=
a.slot_idx_order}},HIDE:function(a,b,c,d,e,f){switch(b.state){case 1:a.obj=h(a);break;case 2:l.hide_object(a.obj),c.curr_node=a.slot_idx_order}},SHOW:function(a,b,c,d,e,f){switch(b.state){case 1:a.obj=h(a);break;case 2:l.show_object(a.obj),c.curr_node=a.slot_idx_order}},PAGEPARAM:function(a,b,c,d,e,f){switch(b.state){case 2:b=c.variables;d=a.vard;a:{e=a.param_name;f=location.href.toString();if(-1!=f.indexOf("?")){f=f.split("?")[1].split("&");for(var k=0;k<f.length;k++){var h=f[k].split("=");if(1<
h.length&&h[0]==e){e=Number(h[1]);break a}}}e=0}b[d]=e;c.curr_node=a.slot_idx_order}},SELECT:function(a,d,e,f,g,k){switch(d.state){case 1:e=d.logic_threads[e.thread_index];f=h(a);g=b.get_selectable_objects(d.scene);k=g.indexOf(f);if(-1==k)c.error("logic script error: non-selectable object:",a.dupli_name_list[a.dupli_name_list.length-1]);else{a.state=-1;a.sel_objs_len=g.length;a.sel_obj_idx=k;k=[];for(var m=0;m<g.length;m++)k.push(n.create_selection_sensor(g[m],!0));g=w();n.create_sensor_manifold(f,
"LOGIC_NODES_SELECT_"+a.label,n.CT_SHOT,k,n.default_OR_logic_fun,g,[a,d,e])}break;case 2:if(-1<a.state){e.curr_node=a.state?a.slot_idx_jump:a.slot_idx_order;a.state=-1;break}a.bools.not_wait&&(e.curr_node=a.slot_idx_order)}},PLAY:function(a,b,c,d,e,k){switch(b.state){case 1:b.no_nla_control=!1;break;case 2:if(b.nla_in_play&&!a.in_play){if(b.curr_thread==b.nla_thread)break;b.nla_in_play=!1;for(e=0;e<b.logic_threads.length;e++){var h=b.logic_threads[e];h==b.nla_thread&&(h.thread_state.curr_node=h.nodes[h.thread_state.curr_node].slot_idx_order)}e=
b.nla_thread.nodes;for(h=0;h<e.length;h++)e[h].in_play=!1}d=f.calc_curr_frame_scene(b.scene._nla,d,!1,k);a.in_play?d>=a.frame_end&&(a.in_play=!1,b.nla_in_play=!1,b.nla_thread=null,c.curr_node=a.slot_idx_order):(c=f.get_frame_offset(b.scene)+(a.frame_start-d),f.set_frame_offset(b.scene,c),a.in_play=!0,b.nla_thread=b.curr_thread,b.nla_in_play=!0)}},REDIRECT:function(a,b,c,d,e,f){switch(b.state){case 2:window.location.href=a.url,b.state=3}},MATH:function(a,b,c,d,e,f){switch(b.state){case 2:b=-1==a.var1?
a.num1:c.variables[a.var1];d=-1==a.var2?a.num2:c.variables[a.var2];switch(a.op){case "ADD":c.variables[a.vard]=b+d;break;case "MUL":c.variables[a.vard]=b*d;break;case "SUB":c.variables[a.vard]=b-d;break;case "DIV":0==d&&q.panic("Division by zero in Logic script"),c.variables[a.vard]=b/d}c.curr_node=a.slot_idx_order}},CONDJUMP:function(a,b,c,d,e,f){switch(b.state){case 2:b=-1==a.var1?a.num1:c.variables[a.var1];d=-1==a.var2?a.num2:c.variables[a.var2];e=!1;switch(a.cond){case "EQUAL":b==d&&(e=!0);break;
case "NOTEQUAL":b!=d&&(e=!0);break;case "LESS":b<d&&(e=!0);break;case "GREATER":b>d&&(e=!0);break;case "LEQUAL":b<=d&&(e=!0);break;case "GEQUAL":b>=d&&(e=!0)}c.curr_node=e?a.slot_idx_jump:a.slot_idx_order}},REGSTORE:function(a,b,c,d,e,f){switch(b.state){case 2:c.variables[a.vard]=a.num1,c.curr_node=a.slot_idx_order}},PLAY_ANIM:function(a,b,c,e,g,f){e=d.SLOT_ALL;""==!a.anim_name&&(e=d.SLOT_0);switch(b.state){case 1:a.obj=h(a);break;case 2:switch(d.is_play(a.obj,e)||0!=a.state||(a.state=1),a.state){case -1:""==
a.anim_name?d.apply_def(a.obj):d.apply(a.obj,a.anim_name,e);a.bools.not_wait||(c.block_sel=!0);d.set_behavior(a.obj,d.AB_FINISH_STOP,e);d.set_first_frame(a.obj,e);d.play(a.obj,null,e);a.state=0;break;case 0:a.bools.not_wait&&(c.curr_node=a.slot_idx_order,a.state=-1);break;case 1:a.bools.not_wait||(c.block_sel=!1);c.curr_node=a.slot_idx_order;a.state=-1;break;default:a.state=-1}}},SELECT_PLAY:function(a,b,c,d,e,f){switch(b.state){case 2:c.curr_node=a.slot_idx_order}},SEND_REQ:function(a,b,c,d,e,f){function h(a,
b,c,d,e){for(var g in a)for(var f in e[0].parse_resp_list)g==e[0].parse_resp_list[f]&&(e[1][g]=a[g]);e[0].state=1}switch(b.state){case 2:switch(a.state){case -1:a.state=0;k.enqueue([[a.url,k.AT_JSON,a.url,[a,c.variables]]],h,null,null);break;case 1:a.state=-1,c.curr_node=a.slot_idx_order}}},INHERIT_MAT:function(a,c,d,f,g,k){switch(c.state){case 1:for(c=0;2>c;c++)a.objects["id"+c]=b.get_object(b.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths["id"+c],0);break;case 2:e.inherit_material(a.objects.id0,
a.materials_names.id0,a.objects.id1,a.materials_names.id1),d.curr_node=a.slot_idx_order}},SET_SHADER_NODE_PARAM:function(a,c,d,e,g,f){switch(c.state){case 1:a.objects_paths.id0&&(a.objects.id0=b.get_object(b.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0),a.nodes_paths.id0.unshift(a.materials_names.id0));break;case 2:"ShaderNodeRGB"==a.shader_nd_type&&b.set_nodemat_rgb(a.objects.id0,a.nodes_paths.id0,a.bools.id0?d.variables[a.vars.id0]:a.floats.id0,a.bools.id1?d.variables[a.vars.id1]:a.floats.id1,
a.bools.id2?d.variables[a.vars.id2]:a.floats.id2),"ShaderNodeValue"==a.shader_nd_type&&b.set_nodemat_value(a.objects.id0,a.nodes_paths.id0,a.bools.id0?d.variables[a.vars.id0]:a.floats.id0),d.curr_node=a.slot_idx_order}},DELAY:function(a,b,c,d,e,f){switch(b.state){case 2:-1==a.state?(a.state=0,a.timer=0):0==a.state&&(a.timer+=e,a.floats.dl<a.timer&&(a.state=-1,c.curr_node=a.slot_idx_order))}},APPLY_SHAPE_KEY:function(a,d,e,f,g,k){switch(d.state){case 1:d=a.objects.id0=b.get_object(b.GET_OBJECT_BY_DUPLI_NAME_LIST,
a.objects_paths.id0,0);e=a.common_usage_names.sk;m.check_shape_keys(d)?m.has_shape_key(d,e)||(c.error("Wrong key name:",e),a.mute=!0):(c.error("No shape keys in object:",d.name),a.mute=!0);break;case 2:m.apply_shape_key(a.objects.id0,a.common_usage_names.sk,a.bools.skv?e.variables[a.vars.skv]:a.floats.skv),e.curr_node=a.slot_idx_order}},OUTLINE:function(a,d,e,f,g,k){switch(d.state){case 1:d=a.objects.id0=b.get_object(b.GET_OBJECT_BY_DUPLI_NAME_LIST,a.objects_paths.id0,0);d&&d.render&&d.render.outlining||
(c.error("Can't evaluate 'Outline' logic node: wrong object"),a.mute=!0);break;case 2:d=a.objects.id0;switch(a.common_usage_names.outline_operation){case "PLAY":f=d.render.outline_anim_settings_default;b.apply_outline_anim(d,f.outline_duration,f.outline_period,f.outline_relapses);break;case "STOP":b.clear_outline_anim(d);break;case "INTENSITY":d.render.outline_intensity=a.bools["in"]?e.variables[a.vars["in"]]:a.floats["in"]}e.curr_node=a.slot_idx_order}}};a.init_logic=function(a,b){var c={data_id:b,
scene_name:a.name,state:0,nla_in_play:!1,no_nla_control:!0,nla_thread:null,scene:a,curr_thread:null,logic_threads:[]};a._logic=c;var d=a.b4w_logic_nodes,e=c.logic_threads;c.state=1;for(var f=0;f<d.length;f++){var k={nodes:[],thread_state:{scene:a,curr_node:0,block_sel:!1,thread_index:f,variables:{R1:0,R2:0,R3:0,R4:0,R5:0,R6:0,R7:0,R8:0}}};e.push(k);for(var h=e[e.length-1],m=d[f],l=0;l<m.length;l++){var n=m[l],n={type:n.type,label:n.label,slot_idx_order:n.slot_idx_order,slot_idx_jump:n.slot_idx_jump,
frame_start:n.frame_range[0],frame_end:n.frame_range[1],in_play:!1,state:-1,sel_objs_len:-1,sel_obj_idx:-1,cond:n.condition,var1:n.variable1,var2:n.variable2,num1:n.number1,num2:n.number2,vard:n.variabled,url:n.url,param_name:n.param_name,op:n.operation,mute:n.mute,dupli_name_list:n.object,obj:null,objects:{},anim_name:n.anim_name,parse_resp_list:n.parse_resp_list,objects_paths:n.objects_paths,nodes_paths:n.nodes_paths,floats:n.floats,bools:n.bools,vars:n.variables,materials_names:n.materials_names,
shader_nd_type:n.shader_nd_type,common_usage_names:n.common_usage_names,thread:h,process_node:G[n.type]?G[n.type]:u,processed:!1,timer:0};h.nodes.push(n)}for(m=0;m<h.nodes.length;m++)n=h.nodes[m],n.process_node(n,c,k.thread_state,0,0)}c.state=2;N.push(c)};a.update=function(a,b){var c=f.get_start_time();if(!(0>=c))for(var d=0;d<N.length;d++){for(var e=d,k=a,h=b,m=c,l=N[e],n=0;n<N[e].logic_threads.length;n++){l.curr_thread=N[e].logic_threads[n];var q=N[e].logic_threads[n],r=l,x=k,u=h,A=m,w=q.nodes;
if(w.length){for(var S=0;S<w.length;S++)w[S].processed=!1;for(S=0;S<w.length;S++){if(0<=q.thread_state.curr_node)var G=w[q.thread_state.curr_node];else break;if(G.processed)break;if(G.mute)if("ENTRYPOINT"==G.type)break;else q.thread_state.curr_node=G.slot_idx_order,G.processed=!0;else G.process_node(G,r,q.thread_state,x,u,A),G.processed=!0}}}l.nla_in_play||l.no_nla_control||(e=f.get_frame_offset(l.scene)-B.get_framerate()*h,f.set_frame_offset(l.scene,e))}};var w=function(){return function(a,b,c,d){c=
d[0];var e=d[1];d=d[2];for(var f=0;f<c.sel_objs_len;f++)if(n.get_sensor_value(a,b,f)&&f==c.sel_obj_idx){if(e.nla_in_play&&e.nla_thread==c.thread)c.state=-1;else if(!d.thread_state.block_sel||c.bools.no_wait)c.state=1;return}c.state=0}};a.cleanup=function(){N=[]}};b4w.module.__nla=function(a,r){function u(a,b,c){for(var d=0;d<a.length;d++){var e=a[d],g=c+" ["+e.frame_start+":"+e.frame_end+"]",f=Math.max(b.frame_start,e.frame_start);e.action_frame_start+=f-e.frame_start;e.frame_start=f;e.frame_end=Math.min(b.frame_end+1,e.frame_end);e.frame_start>e.frame_end?(t.warn("NLA: out of scene range: "+g),a.splice(d,1),d--):e.anim_name||"CLIP"!=e.type||(t.warn('NLA: no action in strip for object "'+c+'".'),a.splice(d,1),d--)}}function h(a,b){for(var c=0;c<a.length;c++){for(var d=
a[c],e=b.frame_start,g=b.frame_end+1,f=0;f<a.length;f++){var k=a[f];d.anim_slot==k.anim_slot&&(k.frame_end<=d.frame_start&&(e=d.frame_start),k.frame_start>=d.frame_end&&(g=Math.min(g,k.frame_start)))}d.ext_frame_start=e;d.ext_frame_end=g}}function b(){return{type:"CLIP",frame_start:0,frame_end:0,scheduled:!1,paused:!1,anim_name:"",anim_uuid:"",anim_slot:0,action_frame_start:0,action_frame_end:0,ext_frame_start:0,ext_frame_end:0,use_reverse:!1,scale:1,repeat:1}}function l(a,b){if(a.animation_data){var c=
a.animation_data.nla_tracks;if(c)for(var d=0;d<c.length;d++)b.push(c[d])}c=a.nodes;for(d=0;d<c.length;d++){var e=c[d];e.node_group&&(e=e.node_group.node_tree)&&l(e,b)}}function c(a,b){var c=Math.round(a)-b.frame_start;b.use_cyclic&&(c%=b.frame_duration,0>c&&(c+=b.frame_duration));return b.frame_offset+c}function f(a,b,c,d){b=(b-d)*g.get_framerate()+a.frame_offset;b>a.frame_start&&(b-=a.frame_start,a.cyclic&&c&&(b%=a.frame_end-a.frame_start+1),b+=a.frame_start);return b}function n(a,b){a=y.clamp(a,
b.frame_start,b.frame_end);var c=a-b.frame_start,d=(b.frame_end-b.frame_start)/b.repeat,c=c/d&&0==c%d?b.action_frame_end:b.action_frame_start+c%d/b.scale;b.use_reverse&&(c=b.action_frame_end-c+b.action_frame_start);return c}function q(a,c){for(var d=[],e=0;e<a.length;e++){var g=a[e].strips;if(g)for(var f=0;f<g.length;f++){var k=g[f],h=b();h.type=k.type;h.frame_start=k.frame_start;h.frame_end=k.frame_end;h.anim_slot=c;h.action_frame_start=k.action_frame_start;h.action_frame_end=k.action_frame_end;
h.use_reverse=k.use_reverse;h.scale=k.scale;h.repeat=k.repeat;k.action&&(h.anim_name=k.action.name,h.anim_uuid=k.action.uuid);d.push(h)}}return d}function d(a){return"SPEAKER"==a.type&&a.data.animation_data&&a.data.animation_data.nla_tracks.length?!0:!1}function k(a){if("MESH"!=a.type||!a.data)return!1;a=a.data.materials;if(!a)return!1;for(var b=0;b<a.length;b++){var c=a[b],d=c.node_tree;if(c.use_nodes&&d&&e(d))return!0}return!1}function e(a,b){if(a.animation_data){var c=a.animation_data.nla_tracks;
if(c&&c.length)return!0}for(var c=a.nodes,d=0;d<c.length;d++){var g=c[d];g.node_group&&(g=g.node_group.node_tree)&&e(g,b)}return!1}function m(a){return a.b4w_use_nla||a.b4w_use_logic_editor}function B(a,b){var c=C.get_active();if(c._nla){var d=f(c._nla,b,!0,I);c._nla.frame_offset-=d-a;c._nla.force_update=!0}}var N=r("__animation");r("__camera");r("__controls");r("__config");r("__lights");r("__loader");var G=r("__objects"),w=r("__obj_util"),t=r("__print"),C=r("__scenes"),D=r("__sfx"),p=r("__textures"),
g=r("__time"),y=r("__util"),v=[],I=-1;a.update_object=function(a,c){var e;e=null;for(var g=c.scenes_data.length-1;0<=g;g--){var f=c.scenes_data[g];if(m(f.scene)&&(e=f,f.scene._is_main))break}if(e){e.obj_has_nla_on_scene=!0;var k=0;if((g=a.animation_data)&&g.nla_tracks.length){var h=g.nla_tracks;if(w.is_armature(c)||w.is_camera(c)||w.is_mesh(c)||w.is_empty(c)||w.is_lamp(c)||w.is_speaker(c))h=q(h,k),h.length&&(c.nla_events=c.nla_events.concat(h),k++)}d(a)&&(h=a.data.animation_data.nla_tracks,h=q(h,
k),h.length&&(c.nla_events=c.nla_events.concat(h),k++));if(w.is_mesh(c))for(f=a.data.materials,g=0;g<f.length;g++){var p=f[g];if(p.use_nodes&&p.node_tree&&(h=[],l(p.node_tree,h),h=q(h,k),h.length)){for(var p=k,n=h,v=N.get_all_actions(),t=[],B=0,r=0;r<n.length;r++){var u=n[r];""!=u.anim_uuid?u=y.keysearch("uuid",u.anim_uuid,v):(u=u.anim_name,u=y.keysearch("name",u,v)||y.keysearch("name",u+"_B4W_BAKED",v));if(u){var u=u.fcurves,D=[],C;for(C in u)D.push(C);t.push(D)}}for(r=0;r<t.length;r++){v=!1;for(u=
0;u<r;u++)if(y.arrays_have_common(t[r],t[u])){n[r].anim_slot=n[u].anim_slot;v=!0;break}v||(n[r].anim_slot=k+B++)}k=p+B;c.nla_events=c.nla_events.concat(h)}}for(g=0;g<a.particle_systems.length;g++)f=a.particle_systems[g],C=f.settings,"EMITTER"==C.type&&C.b4w_allow_nla&&(C=b(),C.type="CLIP",C.frame_start=e.scene.frame_start,C.frame_end=e.scene.frame_end+1,C.anim_name=f.name,C.anim_slot=k,C.action_frame_start=C.frame_start,C.action_frame_end=C.frame_end,c.nla_events.push(C),k++);f=k+1;for(g=0;g<c.vertex_anim.length;g++)h=
c.vertex_anim[g],h.allow_nla&&(k=f,C=b(),C.type="CLIP",C.frame_start=e.scene.frame_start,C.frame_end=e.scene.frame_end+1,C.anim_name=h.name,C.anim_slot=k,C.action_frame_start=C.frame_start,C.action_frame_end=C.frame_end,c.nla_events.push(C))}};a.update_scene=function(a,c,d){a._nla||(a._nla={frame_start:a.frame_start,frame_end:a.frame_end,frame_offset:0,last_frame:-1,range_end:a.frame_end,range_start:a.frame_start,user_callback:null,cyclic:c,objects:[],textures:[],scene_name:a.name,is_stopped:!1,force_update:!1,
rewinded_to_start:!0});c=a._nla;for(var e=G.get_scene_objs_derived(a,"ALL",d),g=0;g<e.length;g++){var f=e[g];if(f.nla_events.length){for(var k=0;k<f.scenes_data.length;k++){var m=f.scenes_data[k];m.scene==a&&m.obj_has_nla_on_scene&&c.objects.push(f)}u(f.nla_events,c,f.name);h(f.nla_events,c)}}a=a._render.video_textures;for(g=0;g<a.length;g++){var l=a[g]._render;l.use_nla&&(l.video_file||l.seq_video)&&l.vtex_data_id==d&&(e=b(),e.type="VIDEO",l.use_cyclic?(e.frame_start=0,e.frame_end=c.frame_end):(e.frame_start=
y.clamp(l.frame_start,0,c.frame_end),e.frame_end=y.clamp(l.frame_start+l.frame_duration,0,c.frame_end)),e.anim_name=a[g].name,l._nla_tex_event=e,c.textures.push(l),l.video_file&&(l.video_file.oncanplay=function(){p.update_video_texture(l)}))}v.push(c)};a.start=function(){I=0};a.get_start_time=function(){return I};a.get_frame_offset=function(a){return a._nla?a._nla.frame_offset:null};a.set_frame_offset=function(a,b){return a._nla?(a._nla.frame_offset=b,!0):!1};a.update=function(a,b){if(!(0>I)){0==
I&&(I=a);for(var d=0;d<v.length;d++){var e=v[d];e.is_stopped&&(e.frame_offset-=g.get_framerate()*b);var k=f(e,a,!0,I);if((!e.is_stopped||e.force_update)&&k>=e.range_end)if(e.cyclic){var k=e,h=a;k.user_callback&&k.user_callback();B(k.range_start,h);k.rewinded_to_start=!0;k=f(k,h,!0,I)}else{var h=e,m=k;h.is_stopped=!0;h.frame_offset-=m-h.range_end;h.user_callback&&h.user_callback()}if(!e.is_stopped||e.force_update){for(var h=e,m=k,l=0;l<h.objects.length;l++){for(var q=h.objects[l],t=q.nla_events,u=
0;u<t.length;u++){var r=t[u];"SOUND"==r.type&&m<h.last_frame-1E-6&&(r.scheduled=!1)}for(u=0;u<t.length;u++)switch(r=t[u],r.type){case "CLIP":if(r.ext_frame_start<=m&&m<r.ext_frame_end&&!r.scheduled){var w=q,C=r;""!=C.anim_uuid?N.apply_by_uuid(w,C.anim_uuid,C.anim_slot):N.apply(w,C.anim_name,C.anim_slot);N.set_behavior(w,N.AB_FINISH_STOP,C.anim_slot);var G=n(C.frame_start,C);N.set_frame(w,G,C.anim_slot);for(w=0;w<t.length;w++)t[w]!=r&&t[w].anim_slot==r.anim_slot&&(t[w].scheduled=!1);r.scheduled=!0}r.scheduled&&
(w=q,C=n(m,r),G=N.get_current_frame_float(w,r.anim_slot),1E-6<Math.abs(C-G)&&N.set_frame(w,C,r.anim_slot));break;case "SOUND":(m<h.last_frame-1E-6||h.last_frame<r.frame_start)&&r.frame_start<=m&&m<r.frame_end&&!r.scheduled&&(w=q,G=r,C=(G.frame_start-m)/g.get_framerate(),G=(G.frame_end-G.frame_start)/g.get_framerate(),D.play(w,C,G),r.scheduled=!0),h.last_frame<r.frame_end&&r.frame_end<=m&&r.scheduled&&(r.scheduled=!1)}}h=a;m=e;l=k;for(q=0;q<m.textures.length;q++)if(t=m.textures[q],t.video_file||t.seq_video){u=
!1;r=t;w=c(l,r);w=y.clamp(w,r.frame_offset,r.frame_offset+p.video_get_duration(r)-1);r=p.video_frame_to_seq_frame(t,w);r==t.seq_movie_length&&r--;if(m.force_update||m.rewinded_to_start)t.video_file?p.set_frame_video(t.name,w,t.vtex_data_id):p.set_frame_video(t.name,r,t.vtex_data_id),u=!0;m.is_stopped||(t.use_cyclic&&(t.video_file?w==t.frame_offset&&(p.set_frame_video(t.name,t.frame_offset,t.vtex_data_id),u=!0):(C=p.video_frame_to_seq_frame(t,t.frame_offset),r==C&&(p.set_frame_video(t.name,r,t.vtex_data_id),
u=!0))),C=t,G=c(l,C),C=C.frame_offset<=G&&G<=C.frame_offset+p.video_get_duration(C),G=p.video_is_played(t),C&&!G?(p.play_video(t.name,t.vtex_data_id),t.seq_video&&(u=!0)):G&&!C?t.video_file?Math.round(t.video_file.currentTime*t.fps)<w?u=!0:p.pause_video(t.name,t.vtex_data_id):p.pause_video(t.name,t.vtex_data_id):G&&C&&(u=!0));p.video_update_is_available(t)&&u&&(t.video_file?p.update_video_texture(t):(u=p.seq_video_get_discrete_timemark(t,h),u!=t.seq_last_discrete_mark&&(t.seq_cur_frame=r,p.update_seq_video_texture(t)),
t.seq_last_discrete_mark=u))}e.last_frame=k}e.force_update=!1;e.rewinded_to_start=!1}}};a.calc_curr_frame_scene=f;a.cleanup=function(){v.length=0;I=-1};a.bpy_obj_has_nla=function(a){var b=a.animation_data;return b&&b.nla_tracks.length||d(a)||k(a)?!0:!1};a.scene_use_nla=m;a.set_frame=B;a.get_frame=function(a){var b=C.get_active();return b._nla?f(b._nla,a,!0,I):-1};a.stop_nla=function(){var a=C.get_active();a._nla&&(a._nla.is_stopped=!0);for(var a=a._nla.textures,b=0;b<a.length;b++){var c=a[b];p.pause_video(c.name,
c.vtex_data_id)}};a.play_nla=function(a){var b=C.get_active();b._nla&&(b._nla.is_stopped=!1,b._nla.user_callback=a?a:null)};a.get_frame_start=function(){var a=C.get_active();return a._nla?a._nla.frame_start:-1};a.get_frame_end=function(){var a=C.get_active();return a._nla?a._nla.frame_end:-1};a.is_play=function(){var a=C.get_active();return a._nla?!a._nla.is_stopped:!1};a.check_nla=function(){var a=C.get_active();return a._nla?a.b4w_use_nla:!1};a.check_logic_nodes=function(){var a=C.get_active();
return a._nla?0<a.b4w_logic_nodes.length:!1};a.set_range=function(a,b){var c=C.get_active();if(c._nla)c._nla.range_start=a,c._nla.range_end=b;else return!1};a.reset_range=function(){var a=C.get_active();if(a._nla)a=a._nla,a.range_start=a.frame_start,a.range_end=a.frame_end;else return!1};a.set_cyclic=function(a){var b=C.get_active();if(b._nla)b._nla.cyclic=a;else return!1};a.clear_callback=function(){var a=C.get_active();a._nla&&(a._nla.user_callback=null)}};b4w.module.__camera=function(a,r){function u(b){b=b.render;switch(b.move_style){case a.MS_TARGET_CONTROLS:b.init_dist=U.dist(b.trans,b.pivot);b.init_top=b.cameras[0].top;break;case a.MS_HOVER_CONTROLS:b.use_distance_limits&&(b.init_dist=U.dist(b.trans,b.hover_pivot),b.init_top=b.cameras[0].top)}}function h(){return{left:new Float32Array([0,0,0,0]),right:new Float32Array([0,0,0,0]),top:new Float32Array([0,0,0,0]),bottom:new Float32Array([0,0,0,0]),near:new Float32Array([0,0,0,0]),far:new Float32Array([0,
0,0,0])}}function b(b){switch(b){case "STATIC":return a.MS_STATIC;case "TARGET":return a.MS_TARGET_CONTROLS;case "EYE":return a.MS_EYE_CONTROLS;case "HOVER":return a.MS_HOVER_CONTROLS;default:throw"Unknown move style";}}function l(b){var c;c={type:b,name:"",size_mult:1,width:0,height:0,framebuffer:null,color_attachment:null,depth_attachment:null,aspect:0,fov:0,near:0,far:0,left:0,right:0,top:0,bottom:0,eye:new Float32Array(3),eye_last:new Float32Array(3),quat:new Float32Array(4),view_matrix:new Float32Array(16),
billboard_view_matrix:new Float32Array(16),proj_matrix:new Float32Array(16),view_proj_inv_matrix:new Float32Array(16),prev_view_proj_matrix:new Float32Array(16),sky_vp_inv_matrix:new Float32Array(16),shadow_cast_billboard_view_matrix:new Float32Array(16),view_proj_matrix:new Float32Array(16),dof_distance:0,dof_front:0,dof_rear:0,dof_power:0,dof_object:null,dof_on:0,frustum_planes:h(),stereo_conv_dist:0,stereo_eye_dist:0,reflection_plane:null,csm_centers:null,csm_radii:null,csm_center_dists:new Float32Array(4),
pcf_blur_radii:new Float32Array(4)};if(b==a.TYPE_NONE)return c;switch(b){case a.TYPE_PERSP:q(c,40,.1,1E3);break;case a.TYPE_ORTHO:q(c,2.5,.1,1E3);break;case a.TYPE_PERSP_ASPECT:break;case a.TYPE_ORTHO_ASPECT:break;case a.TYPE_ORTHO_ASYMMETRIC:break;case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:throw"Stereo camera may only be created from perspective one";default:throw"Unknown camera type";}return c}function c(b,c,d){if(b.type!=a.TYPE_STEREO_LEFT&&b.type!=a.TYPE_STEREO_RIGHT)throw"set_stereo_params(): wrong camera type";
b.stereo_conv_dist=c;b.stereo_eye_dist=d;g(b,b.aspect);if(Q.check_active()&&(c=Q.get_active(),b=c._render.shadow_params))for(c=Q.get_camera(c).render.cameras,d=0;d<c.length;d++)H(c[d],b)}function f(a,b){return n(a.render.quat,b)}function n(a,b){var c=R.quat_to_dir(a,R.AXIS_Y,na),d=R.quat_to_dir(a,R.AXIS_Z,V),e=-Math.asin(c[1]/U.length(c)),c=Math.abs(e)>Math.PI/4?U.scale(d,-R.sign(e),E):U.scale(c,-R.sign(d[1]),E),g=Math.atan(Math.abs(c[0]/c[2]));0<d[1]&&(e=R.sign(e)*Math.PI-e);d=g;0>c[2]&&(d=Math.PI-
d);0>c[0]&&(d=2*Math.PI-d);b[0]=d;b[1]=e;return b}function q(b,c,d,e,g){switch(b.type){case a.TYPE_PERSP:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:b.fov=c;b.aspect=1;break;case a.TYPE_ORTHO:b.top=c;b.aspect=1;break;case a.TYPE_PERSP_ASPECT:delete b.fov;b.fov=c;b.aspect=g/c;break;case a.TYPE_ORTHO_ASPECT:b.top=c;b.aspect=g/c;break;default:aa.error("set_frustum(): Unsupported camera type: "+b.type)}b.near=d;b.far=e}function d(b,c){var d=c.render.trans,e=c.render.quat,f=ha;S.rotateX(c.render.world_matrix,
-Math.PI/2,f);S.invert(f,b.view_matrix);if(b.reflection_plane){var f=b.reflection_plane[0],k=b.reflection_plane[1],h=b.reflection_plane[2],m=b.reflection_plane[3],l=ha;l[0]=1-2*f*f;l[1]=-2*f*k;l[2]=-2*f*h;l[3]=0;l[4]=-2*f*k;l[5]=1-2*k*k;l[6]=-2*k*h;l[7]=0;l[8]=-2*f*h;l[9]=-2*k*h;l[10]=1-2*h*h;l[11]=0;l[12]=-2*f*m;l[13]=-2*k*m;l[14]=-2*h*m;l[15]=1;S.multiply(b.view_matrix,l,b.view_matrix);g(b,b.aspect,!0);f=qa;k=ha;S.invert(b.view_matrix,k);S.transpose(k,k);ba.transformMat4(b.reflection_plane,k,f);
k=O;k[0]=(R.sign(f[0])+b.proj_matrix[8])/b.proj_matrix[0];k[1]=(R.sign(f[1])+b.proj_matrix[9])/b.proj_matrix[5];k[2]=-1;k[3]=(1+b.proj_matrix[10])/b.proj_matrix[14];ba.scale(f,2/(f[0]*k[0]+f[1]*k[1]+f[2]*k[2]+f[3]*k[3]),f);b.proj_matrix[2]=f[0];b.proj_matrix[6]=f[1];b.proj_matrix[10]=f[2]+1;b.proj_matrix[14]=f[3]}b.type==a.TYPE_STEREO_LEFT?b.view_matrix[12]+=b.stereo_eye_dist/2:b.type==a.TYPE_STEREO_RIGHT&&(b.view_matrix[12]-=b.stereo_eye_dist/2);S.multiply(b.proj_matrix,b.view_matrix,b.view_proj_matrix);
v(b);y(b);U.copy(b.eye,b.eye_last);U.copy(d,b.eye);Y.copy(e,b.quat)}function k(b,c,d,e){S.lookAt(c,d,e,b.view_matrix);b.type==a.TYPE_STEREO_LEFT?b.view_matrix[12]+=b.stereo_eye_dist/2:b.type==a.TYPE_STEREO_RIGHT&&(b.view_matrix[12]-=b.stereo_eye_dist/2);S.multiply(b.proj_matrix,b.view_matrix,b.view_proj_matrix);v(b);y(b);U.copy(c,b.eye)}function e(a){var b=a.render.cameras;if(!b)throw"Wrong object";for(var c=a.render,e=0;e<b.length;e++){var g=b[e];d(g,a);R.extract_frustum_planes(g.view_proj_matrix,
g.frustum_planes);if(g.dof_object)if(g.dof_on){var f=c.trans,k=X.get_translation(g.dof_object,na),f=U.dist(f,k);g.dof_distance=f}else g.dof_distance=0}}function m(b){b=b.render;if(b.move_style==a.MS_TARGET_CONTROLS){var c=R.quat_to_dir(b.quat,R.AXIS_Z,na);b.target_cam_upside_down=0<c[1]}}function B(b,c){var d=b.render,e=d.horizontal_limits;!e||d.move_style!=a.MS_EYE_CONTROLS&&d.move_style!=a.MS_TARGET_CONTROLS||(c&&(d=f(b,ja),e.left+=d[0],e.right+=d[0]),e.left=R.angle_wrap_0_2pi(e.left),e.right=R.angle_wrap_0_2pi(e.right))}
function N(b,c){var d=b.render,e=d.vertical_limits;!e||d.move_style!=a.MS_EYE_CONTROLS&&d.move_style!=a.MS_TARGET_CONTROLS||(c&&(d=f(b,ja),e.up+=d[1],e.down+=d[1]),e.up=R.angle_wrap_periodic(e.up,-Math.PI,Math.PI),e.down=R.angle_wrap_periodic(e.down,-Math.PI,Math.PI))}function G(b){var c=b.render;if(ea.is_camera(b)){var d=c.cameras;if(d[0].type===a.TYPE_ORTHO){if(c.move_style===a.MS_TARGET_CONTROLS)var f=U.dist(c.trans,c.pivot),c=f/c.init_dist*c.init_top;else c.use_distance_limits&&c.move_style===
a.MS_HOVER_CONTROLS?(f=U.distance(c.trans,c.hover_pivot),c=f/c.init_dist*c.init_top):c=d[0].top;for(f=0;f<d.length;f++){var k=d[f];k.top=c;g(k,k.aspect)}e(b)}}}function w(a,b,c,d,e){var g=a.render,k=b,h=c;if(d||e)a=f(a,pa),d&&(k=b-a[0]),e&&(h=c-a[1]);if(k||h)b=Y.identity(T),k&&(k=Y.setAxisAngle(R.AXIS_Y,k,da),Y.multiply(b,k,b)),h&&(k=R.quat_to_dir(g.quat,R.AXIS_X,na),h=Y.setAxisAngle(k,h,da),Y.normalize(h,h),Y.multiply(b,h,b)),Y.multiply(b,g.quat,g.quat)}function t(a,b,c,d,e){var g=a.render,k=b,h=
c;if(d||e){var m=f(a,pa);d&&(k=b-m[0]);e&&(h=c-m[1])}D(a,a.render.pivot,k,h);a=f(a,pa);a=R.angle_wrap_periodic(a[1],-Math.PI,Math.PI);g.target_cam_upside_down=Math.abs(a)>Math.PI/2}function C(a,b,c,d,e){var g=a.render,k=b,h=c;if(d||e){var m=f(a,pa);d&&(k=b-m[0]);e&&(h=c-m[1])}g.enable_hover_hor_rotation||(k=0);D(a,g.hover_pivot,k,h);h&&p(a)}function D(a,b,c,d){var e=a.render;if(c||d){var g=Y.identity(T);c&&(c=Y.setAxisAngle(R.AXIS_Y,c,da),Y.multiply(g,c,g));a=z(a);d&&(!a||a&&e.use_distance_limits)&&
(a=R.quat_to_dir(e.quat,R.AXIS_X,na),d=Y.setAxisAngle(a,d,da),Y.normalize(d,d),Y.multiply(g,d,g));R.rotate_point_pivot(e.trans,b,g,e.trans);Y.multiply(g,e.quat,e.quat)}}function p(a){var b=a.render;if(b.use_distance_limits){var c=f(a,ja)[1];a=a.render;a.hover_angle_limits.down-a.hover_angle_limits.up?(c=(a.hover_angle_limits.down-c)/(a.hover_angle_limits.down-a.hover_angle_limits.up),c=Math.max(c,0)):c=0;c=c*(a.distance_max-a.distance_min)+a.distance_min;a=R.quat_to_dir(b.quat,R.AXIS_MY,na);U.normalize(a,
a);U.scale(a,c,a);U.subtract(b.hover_pivot,a,b.trans)}}function g(b,c,d){switch(b.type){case a.TYPE_PERSP:if(!c)throw"No aspect ratio";b.aspect=c;case a.TYPE_PERSP_ASPECT:S.perspective(R.rad(b.fov),b.aspect,b.near,b.far,b.proj_matrix);break;case a.TYPE_ORTHO:if(!c)throw"No aspect ratio";b.aspect=c;case a.TYPE_ORTHO_ASPECT:c=b.top*b.aspect;S.ortho(-c,c,-b.top,b.top,b.near,b.far,b.proj_matrix);break;case a.TYPE_ORTHO_ASYMMETRIC:S.ortho(b.left,b.right,b.bottom,b.top,b.near,b.far,b.proj_matrix);break;
case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:if(!c)throw"No aspect ratio";b.aspect=c;var e=Math.tan(b.fov*Math.PI/360);c=b.near*e;var g=b.aspect*b.stereo_conv_dist*e;b.type==a.TYPE_STEREO_LEFT?(e=g-b.stereo_eye_dist/2,g+=b.stereo_eye_dist/2):(e=g+b.stereo_eye_dist/2,g-=b.stereo_eye_dist/2);e=-(b.near/b.stereo_conv_dist*e);g*=b.near/b.stereo_conv_dist;S.frustum(e,g,-c,c,b.near,b.far,b.proj_matrix);b.left=e;b.right=g;break;case a.TYPE_NONE:return;default:throw"Wrong camera type: "+b.type;}d||(S.multiply(b.proj_matrix,
b.view_matrix,b.view_proj_matrix),v(b),y(b))}function y(a){S.copy(a.view_matrix,a.sky_vp_inv_matrix);a.sky_vp_inv_matrix[12]=0;a.sky_vp_inv_matrix[13]=0;a.sky_vp_inv_matrix[14]=0;a.sky_vp_inv_matrix[15]=1;S.multiply(a.proj_matrix,a.sky_vp_inv_matrix,a.sky_vp_inv_matrix);S.invert(a.sky_vp_inv_matrix,a.sky_vp_inv_matrix)}function v(a){S.copy(a.view_matrix,a.view_proj_inv_matrix);S.multiply(a.proj_matrix,a.view_proj_inv_matrix,a.view_proj_inv_matrix);S.invert(a.view_proj_inv_matrix,a.view_proj_inv_matrix)}
function I(b,c,d,e,g){e||(e=new Float32Array(24));c||(c=b.near);d||(d=b.far);var f,k,h,m,l,p,n,q;switch(b.type){case a.TYPE_NONE:throw"Extraction from NONE camera is not possible";case a.TYPE_PERSP:case a.TYPE_PERSP_ASPECT:f=c*Math.tan(b.fov*Math.PI/360);m=-f;k=f*b.aspect;h=-k;l=d/c*f;q=-l;p=l*b.aspect;n=-p;break;case a.TYPE_ORTHO:case a.TYPE_ORTHO_ASPECT:h=b.top*b.aspect;f=l=b.top;k=p=h;m=q=-b.top;h=n=-h;break;case a.TYPE_ORTHO_ASYMMETRIC:f=l=b.top;k=p=b.right;m=q=b.bottom;h=n=b.left;break;case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:l=
c/b.near;f=c*Math.tan(b.fov*Math.PI/360);m=-f;k=b.right*l;h=b.left*l;n=d/c;l=f*n;q=-l;p=k*n;n*=h;break;default:throw"Wrong camera type: "+b.type;}e[0]=h;e[1]=m;e[2]=-c;e[3]=k;e[4]=m;e[5]=-c;e[6]=k;e[7]=f;e[8]=-c;e[9]=h;e[10]=f;e[11]=-c;e[12]=n;e[13]=q;e[14]=-d;e[15]=n;e[16]=l;e[17]=-d;e[18]=p;e[19]=l;e[20]=-d;e[21]=p;e[22]=q;e[23]=-d;g&&(c=ha,S.invert(b.view_matrix,c),R.positions_multiply_matrix(e,c,e,0));return e}function z(b){return ea.is_camera(b)&&b.render&&b.render.move_style==a.MS_HOVER_CONTROLS?
!0:!1}function H(a,b){if(b.enable_csm){var c=b.csm_num;if(!a.csm_centers){var d=b.csm_num;a.csm_centers=Array(d);for(var e=0;e<d;e++)a.csm_centers[e]=new Float32Array(3);a.csm_radii=new Float32Array(d)}for(d=0;d<c;d++){var e=0==d?a.near:F(b,a,d-1),g=F(b,a,d),e=I(a,e,g,ia),e=x.get_frustum_mec(e);a.csm_centers[d].set(e.center);a.csm_radii[d]=e.radius;a.csm_center_dists[d]=U.length(e.center);a.pcf_blur_radii[d]=L(b.first_cascade_blur_radius,b.last_cascade_blur_radius,c,d)}}else a.pcf_blur_radii[0]=b.first_cascade_blur_radius}
function F(a,b,c){var d=a.csm_num,e=R.clamp(a.csm_first_cascade_border,b.near,b.far);a=R.clamp(a.csm_last_cascade_border,b.near,b.far);c=L(e,a,d,c);return R.clamp(c,b.near,b.far)}function L(a,b,c,d){switch(d){case 0:break;case c-1:a=b;break;default:a=0==a?0:a*Math.pow(b/a,d/(c-1))}return a}var x=r("__boundings");r("__config");var K=r("__constraints"),A=r("__container"),P=r("__mat3"),S=r("__mat4"),ea=r("__obj_util"),aa=r("__print"),Y=r("__quat"),Q=r("__scenes"),X=r("__transform"),R=r("__util"),U=r("__vec3"),
ba=r("__vec4");a.TYPE_NONE=10;a.TYPE_PERSP=20;a.TYPE_ORTHO=30;a.TYPE_PERSP_ASPECT=40;a.TYPE_ORTHO_ASPECT=50;a.TYPE_ORTHO_ASYMMETRIC=60;a.TYPE_STEREO_LEFT=70;a.TYPE_STEREO_RIGHT=80;a.MS_STATIC=0;a.MS_TARGET_CONTROLS=2;a.MS_EYE_CONTROLS=3;a.MS_HOVER_CONTROLS=4;var fa=Math.PI/180/2,ja=new Float32Array(2),pa=new Float32Array(2),na=new Float32Array(3),V=new Float32Array(3),E=new Float32Array(3),T=new Float32Array(4),da=new Float32Array(4),qa=new Float32Array(4),O=new Float32Array(4),ga=new Float32Array(16),
ha=new Float32Array(16),ia=new Float32Array(24);a.camera_object_to_camera=function(c,d){var e=d.render,g=c.data;switch(g.type){case "PERSP":var k=l(a.TYPE_PERSP);if(g.angle_y)var h=g.angle_y/Math.PI*180;q(k,h,g.clip_start,g.clip_end);break;case "ORTHO":k=l(a.TYPE_ORTHO),q(k,g.ortho_scale/2,g.clip_start,g.clip_end)}k.name=d.name;e.underwater=!1;e.move_style=b(g.b4w_move_style);e.dof_distance=g.dof_distance;h=g.dof_object;e.dof_object=h?h._object:null;e.dof_front=g.b4w_dof_front;e.dof_rear=g.b4w_dof_rear;
e.dof_power=g.b4w_dof_power;e.enable_hover_hor_rotation=g.b4w_enable_hover_hor_rotation;e.cameras=[k];e.velocity_trans=g.b4w_trans_velocity;e.velocity_rot=g.b4w_rot_velocity;e.velocity_zoom=g.b4w_zoom_velocity;e.move_style==a.MS_TARGET_CONTROLS&&(e.pivot.set(g.b4w_target),m(d));var n=d.temp_bpy_obj,g=d.render,h=g.move_style;if(h===a.MS_TARGET_CONTROLS||h===a.MS_EYE_CONTROLS||h===a.MS_HOVER_CONTROLS){var n=n.data,J=null,t=null,v=null;h===a.MS_TARGET_CONTROLS||h===a.MS_EYE_CONTROLS?(n.b4w_use_panning&&
(g.use_panning=n.b4w_use_panning),n.b4w_use_horizontal_clamping&&(J={left:n.b4w_rotation_left_limit,right:n.b4w_rotation_right_limit}),n.b4w_use_vertical_clamping&&(t={down:n.b4w_rotation_down_limit,up:n.b4w_rotation_up_limit}),h===a.MS_TARGET_CONTROLS&&(g.use_distance_limits=n.b4w_use_distance_limits&&n.b4w_distance_min<=n.b4w_distance_max,g.use_distance_limits&&(g.distance_min=n.b4w_distance_min,g.distance_max=n.b4w_distance_max))):h===a.MS_HOVER_CONTROLS&&(n.b4w_use_horizontal_clamping&&n.b4w_horizontal_translation_min<=
n.b4w_horizontal_translation_max&&(J={left:n.b4w_horizontal_translation_min,right:n.b4w_horizontal_translation_max}),n.b4w_use_vertical_clamping&&n.b4w_vertical_translation_min<=n.b4w_vertical_translation_max&&(t={down:n.b4w_vertical_translation_min,up:n.b4w_vertical_translation_max}),g.use_distance_limits=n.b4w_use_distance_limits&&n.b4w_hover_angle_min<=n.b4w_hover_angle_max&&n.b4w_distance_min<=n.b4w_distance_max,g.use_distance_limits&&(v={down:n.b4w_hover_angle_min,up:n.b4w_hover_angle_max},g.distance_min=
n.b4w_distance_min,g.distance_max=n.b4w_distance_max));var E=J;E&&h==a.MS_EYE_CONTROLS&&(E.left*=-1,E.right*=-1);if(E=t)switch(h){case a.MS_TARGET_CONTROLS:E.down*=-1;E.up*=-1;break;case a.MS_HOVER_CONTROLS:var A=-E.down;E.down=-E.up;E.up=A}(E=v)&&h==a.MS_HOVER_CONTROLS&&(E.down*=-1,E.up*=-1);g.horizontal_limits=J;g.vertical_limits=t;g.hover_angle_limits=v;B(d,"LOCAL"==n.b4w_horizontal_clamping_type);N(d,"LOCAL"==n.b4w_vertical_clamping_type)}if(e.move_style===a.MS_HOVER_CONTROLS)if(e=d.render,e.use_distance_limits){h=
d.temp_bpy_obj;g=d.render;n=R.quat_to_dir(g.quat,R.AXIS_MY,na);J=qa;J.set(R.AXIS_Y);J[3]=0;h=R.line_plane_intersect(J,-h.data.b4w_hover_zero_level,g.trans,n,g.hover_pivot);n=f(d,ja)[1];if(!h||Math.abs(n)<fa)aa.warn("Active hover camera view vector and the supporting plane are parallel to each other. Set hover pivot based on the camera position."),g.hover_pivot[0]=g.trans[0],g.hover_pivot[1]=0,g.hover_pivot[2]=g.trans[2];g=f(d,ja);e=R.calc_returning_angle(g[1],e.hover_angle_limits.up,e.hover_angle_limits.down);
0<g[1]&&aa.warn("Active hover camera has wrong orientation");e?C(d,0,e):p(d)}else e.enable_hover_hor_rotation=!1;k.type==a.TYPE_ORTHO&&u(d)};a.init_ortho_props=u;a.create_frustum_planes=h;a.create_camera=l;a.check_attachment=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return Boolean(a.color_attachment);case "DEPTH":return Boolean(a.depth_attachment);case "SCREEN":return!Boolean(a.color_attachment)&&!Boolean(a.depth_attachment);default:throw"Wrong attachment type: "+b;}};a.set_attachment=function(a,
b,c){switch(b){case "COLOR":case "CUBEMAP":a.color_attachment=c;break;case "DEPTH":a.depth_attachment=c;break;case "SCREEN":a.color_attachment=null;a.depth_attachment=null;break;default:throw"Wrong attachment type: "+b;}};a.get_attachment=function(a,b){switch(b){case "COLOR":case "CUBEMAP":return a.color_attachment;case "DEPTH":return a.depth_attachment;case "SCREEN":return null;default:throw"Wrong attachment type: "+b;}};a.make_stereo=function(b,d){if(b.type!=a.TYPE_PERSP||d!=a.TYPE_STEREO_LEFT&&
d!=a.TYPE_STEREO_RIGHT)throw"make_stereo(): wrong camera type";b.type=d;c(b,6,.065)};a.set_stereo_params=c;a.get_camera_angles=f;a.get_camera_angles_from_quat=n;a.get_camera_angles_char=function(a,b){f(a,b);b[0]=R.angle_wrap_0_2pi(b[0]+Math.PI);b[1]*=-1;return b};a.get_angles=function(a,b){var c=a.render,d=R.quat_to_dir(c.quat,R.AXIS_MY,na),e=Math.asin(d[1]/U.length(d));0==d[0]&&0==d[2]?c=0:(Math.abs(e)>Math.PI/4&&(d=0>=e?R.quat_to_dir(c.quat,R.AXIS_MZ,V):R.quat_to_dir(c.quat,R.AXIS_Z,V)),c=Math.atan(Math.abs(d[0]/
d[2])),0<d[2]&&(c=Math.PI-c),0<d[0]&&(c=2*Math.PI-c));b[0]=c;b[1]=e;return b};a.set_frustum=q;a.set_frustum_asymmetric=function(b,c,d,e,g,f,k){switch(b.type){case a.TYPE_ORTHO_ASYMMETRIC:b.left=c;b.right=d;b.bottom=e;b.top=g;b.near=f;b.far=k;break;default:aa.error("set_frustum_asymmetric(): Unsupported camera type: "+b.type)}};a.get_move_style=function(a){return a.render.move_style};a.set_view=d;a.set_view_eye_target_up=k;a.set_view_trans_quat=function(a,b,c){var d=na;d[0]=0;d[1]=-1;d[2]=0;U.transformQuat(d,
c,d);d[0]+=b[0];d[1]+=b[1];d[2]+=b[2];var e=V;e[0]=0;e[1]=0;e[2]=-1;U.transformQuat(e,c,e);k(a,b,d,e)};a.eye_target_up_to_trans_quat=function(a,b,c,d,e){d[0]=a[0];d[1]=a[1];d[2]=a[2];S.lookAt(a,b,c,ha);S.invert(ha,ha);S.rotateX(ha,Math.PI/2,ha);P.fromMat4(ha,ga);Y.fromMat3(ga,e)};a.update_camera_transform=e;a.update_camera=function(b){var c=b.render,d=b.render;if(d.move_style===a.MS_TARGET_CONTROLS||d.move_style===a.MS_EYE_CONTROLS){if(d.horizontal_limits){var e=d.horizontal_limits.left,g=d.horizontal_limits.right,
k=f(b,ja);(k=d.move_style==a.MS_TARGET_CONTROLS?R.calc_returning_angle(k[0],e,g):R.calc_returning_angle(k[0],g,e))&&(d.move_style==a.MS_TARGET_CONTROLS?t(b,k,0):w(b,k,0))}d.vertical_limits&&(e=d.vertical_limits.down,g=d.vertical_limits.up,k=f(b,ja),(k=d.move_style==a.MS_TARGET_CONTROLS?R.calc_returning_angle(k[1],g,e):R.calc_returning_angle(k[1],e,g))&&(d.move_style==a.MS_TARGET_CONTROLS?t(b,0,k):w(b,0,k)));d.move_style===a.MS_TARGET_CONTROLS&&d.use_distance_limits&&(k=b.render,e=U.subtract(k.trans,
k.pivot,na),g=U.length(e),g>k.distance_max?(U.scale(e,k.distance_max/g,e),U.add(k.pivot,e,k.trans)):g<k.distance_min&&(g=R.quat_to_dir(k.quat,R.AXIS_MY,V),U.scale(g,100*k.distance_min,g),U.add(e,g,e),U.scale(e,-k.distance_min/U.length(e),e),U.add(k.pivot,e,k.trans)))}d.move_style===a.MS_HOVER_CONTROLS&&(d=b.render,k=d.use_distance_limits?d.hover_pivot:d.trans,d.horizontal_limits&&(e=R.clamp(k[0],d.horizontal_limits.left,d.horizontal_limits.right)-k[0],k[0]+=e,d.use_distance_limits&&(d.trans[0]+=e)),
d.vertical_limits&&(e=R.clamp(k[2],d.vertical_limits.down,d.vertical_limits.up)-k[2],k[2]+=e,d.use_distance_limits&&(d.trans[2]+=e)),d=b.render,d.use_distance_limits&&d.hover_angle_limits&&(k=f(b,ja)[1],k=R.calc_returning_angle(k,d.hover_angle_limits.up,d.hover_angle_limits.down),R.quat_to_dir(d.quat,R.AXIS_MY,na),k&&C(b,0,k)));G(b);switch(c.move_style){case a.MS_TARGET_CONTROLS:K.rotate_to(c.trans,c.quat,c.pivot);K.correct_up(b,R.AXIS_Y);break;case a.MS_EYE_CONTROLS:b.constraint||K.correct_up(b,
R.AXIS_Y)}m(b)};a.update_camera_upside_down=m;a.prepare_horizontal_limits=B;a.prepare_vertical_limits=N;a.update_ortho_scale=G;a.rotate_eye_camera=w;a.rotate_target_camera=t;a.rotate_hover_camera=C;a.hover_camera_update_distance=p;a.is_float_aspect=function(b){switch(b.type){case a.TYPE_PERSP:case a.TYPE_ORTHO:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:return!0;default:return!1}};a.get_angular_diameter=function(b){b=b.render.cameras[0];switch(b.type){case a.TYPE_PERSP:case a.TYPE_PERSP_ASPECT:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:return Math.PI*
b.fov/180;default:return aa.error("get_min_fov(): Unsupported camera type: "+b.type),0}};a.set_projection=g;a.calc_sky_vp_inverse=y;a.calc_view_proj_inverse=v;a.extract_frustum_corners=I;a.assign_boundings=function(a){a=a.render;var b=x.zero_bounding_box();b.min_x=-1;b.max_x=1;b.min_y=-1;b.max_y=1;b.min_z=-1;b.max_z=1;a.bb_local=b;var c=x.create_bounding_sphere(1,[0,0,0]);a.bs_local=c;a.bcap_local=x.create_bounding_capsule(1,b);a.bcyl_local=x.create_bounding_cylinder(1,b);a.bcon_local=x.create_bounding_cone(1,
b)};a.is_target_camera=function(b){return ea.is_camera(b)&&b.render&&b.render.move_style==a.MS_TARGET_CONTROLS?!0:!1};a.is_eye_camera=function(b){return ea.is_camera(b)&&b.render&&b.render.move_style==a.MS_EYE_CONTROLS?!0:!1};a.is_hover_camera=z;a.update_camera_shadows=H;a.csm_far_plane=F;a.project_point=function(b,c,d){b=b.render.cameras[0];switch(b.type){case a.TYPE_PERSP:case a.TYPE_PERSP_ASPECT:case a.TYPE_ORTHO:case a.TYPE_ORTHO_ASPECT:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:var e=qa;
e.set(c);e[3]=1;ba.transformMat4(e,b.view_proj_matrix,e);c=-e[1]/e[3];d[0]=(e[0]/e[3]+1)/2*b.width;d[1]=(c+1)/2*b.height;A.viewport_to_canvas_coords(d[0],d[1],d,b);2<d.length&&(d[2]=(e[2]/Math.abs(e[3])+1)/2);return d;default:return aa.error("Non-compatible camera"),d}};a.get_first_cam=function(a){return a.render.cameras[0]};a.get_edge=function(b,c){switch(b.type){case a.TYPE_PERSP:case a.TYPE_PERSP_ASPECT:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:var d=Math.tan(R.rad(b.fov)/2);switch(c){case "LEFT":return-d*
b.aspect;case "RIGHT":return d*b.aspect;case "TOP":return d;case "BOTTOM":return-d}break;case a.TYPE_ORTHO:case a.TYPE_ORTHO_ASPECT:switch(c){case "LEFT":return-b.top*b.aspect;case "RIGHT":return b.top*b.aspect;case "TOP":return b.top;case "BOTTOM":return-b.top}break;case a.TYPE_ORTHO_ASYMMETRIC:switch(c){case "LEFT":return b.left;case "RIGHT":return b.right;case "TOP":return b.top;case "BOTTOM":return b.bottom}break;default:R.panic("Unknown camera type")}};a.is_ortho=function(b){switch(b.type){case a.TYPE_ORTHO:case a.TYPE_ORTHO_ASPECT:case a.TYPE_ORTHO_ASYMMETRIC:return!0;
default:return!1}};a.get_fov=function(b,c){switch(b.type){case a.TYPE_PERSP:case a.TYPE_PERSP_ASPECT:case a.TYPE_STEREO_LEFT:case a.TYPE_STEREO_RIGHT:var d=R.rad(b.fov);return c?d*b.aspect:d;default:return 0}}};b4w.module.__lights=function(a,r){function u(a){b.scale(a.color,a.energy,a.color_intensity)}r("__print");var h=r("__util"),b=r("__vec3"),l=new Float32Array(3);a.lamp_to_light=function(a,f){var n=a.data,q={name:"",type:n.type,prev_direction:new Float32Array(3),direction:new Float32Array(3),color:new Float32Array(3),color_intensity:new Float32Array(3),default_energy:0,spot_size:0,spot_blend:0,generate_shadows:!1,need_sun_fog_update:!1,dynamic_intensity:!1,use_diffuse:!0,use_specular:!0,energy:1,distance:25,
falloff_type:"INVERSE_SQUARE"},q=f.light=q;q.name=f.name;q.use_diffuse=n.use_diffuse;q.use_specular=n.use_specular;var d=h.quat_to_dir(f.render.quat,h.AXIS_Y,l);b.normalize(d,d);q.direction.set(d);q.color[0]=n.color[0];q.color[1]=n.color[1];q.color[2]=n.color[2];q.energy=q.default_energy=n.energy;u(q);q.distance=n.distance;if("POINT"===q.type||"SPOT"===q.type)q.distance=n.distance;"SPOT"===q.type?(q.spot_blend=n.spot_blend,q.spot_size=n.spot_size):"POINT"===q.type&&(q.spot_size=Math.PI/2);q.generate_shadows=
n.b4w_generate_shadows;q.dynamic_intensity=n.b4w_dynamic_intensity};a.set_light_color=function(a,b){a.color[0]=b[0];a.color[1]=b[1];a.color[2]=b[2];u(a)};a.set_light_spot_blend=function(a,b){a.spot_blend=b};a.set_light_distance=function(a,b){a.distance=b};a.set_light_spot_size=function(a,b){a.spot_size=b};a.set_light_energy=function(a,b){a.energy=b;u(a)};a.update_light_transform=function(a){if("LAMP"!=a.type)throw"Wrong light object";var f=a.light;if(f){h.quat_to_dir(a.render.quat,h.AXIS_Y,f.direction);
b.normalize(f.direction,f.direction);if("SUN"==f.type){a=Math.acos(b.dot(f.prev_direction,h.VEC3_UNIT));var l=Math.acos(b.dot(f.direction,h.VEC3_UNIT));f.need_sun_fog_update=Math.floor(a/.025)!=Math.floor(l/.025)?!0:!1}b.copy(f.direction,f.prev_direction)}}};b4w.module.__scenes=function(a,r){function u(a){for(var b=0;b<a.length;b++){var c=a[b];if(!c._render_to_textures||!c._render_to_textures.length)return c}return null}function h(){if(!Bb)throw"No active scene available";return Bb}function b(a,c,d){for(var e=0;e<a.length;e++){var g=a[e];"ALL"!=c&&c!=g.type||d.push(g);(g=g.dupli_group)&&b(g.objects,c,d)}}function l(a,b,d){if(!Ia.depth_tex_available||!c(a,b,d))return null;a=a.b4w_shadow_settings;d={};a.csm_resolution>Ia.max_texture_size?(d.csm_resolution=
Ia.max_texture_size,Ba.error("Shadow map texture has unsupported size. Changed to "+Ia.max_texture_size+".")):d.csm_resolution=a.csm_resolution;d.self_shadow_polygon_offset=a.self_shadow_polygon_offset;d.self_shadow_normal_offset=a.self_shadow_normal_offset;d.enable_csm=a.b4w_enable_csm;if(b=ya.get_first_lamp_with_shadows(b)||b[0])d.lamp_type=b.light.type,d.spot_size=b.light.spot_size,d.distance=b.light.distance,"SPOT"!=d.lamp_type&&"POINT"!=d.lamp_type||!d.enable_csm||(Ba.warn("Generating shadows for SPOT or POINT light. Disabling Cascaded Shadow Maps"),
d.enable_csm=!1);d.enable_csm?(d.csm_num=a.csm_num,d.csm_first_cascade_border=a.csm_first_cascade_border,d.first_cascade_blur_radius=a.first_cascade_blur_radius,d.csm_last_cascade_border=a.csm_last_cascade_border,d.last_cascade_blur_radius=a.last_cascade_blur_radius,d.fade_last_cascade=a.fade_last_cascade,d.blend_between_cascades=a.blend_between_cascades):(d.csm_num=1,d.csm_first_cascade_border=a.csm_first_cascade_border,d.first_cascade_blur_radius=a.first_cascade_blur_radius,d.csm_last_cascade_border=
a.csm_last_cascade_border,d.last_cascade_blur_radius=a.last_cascade_blur_radius,d.fade_last_cascade=!1,d.blend_between_cascades=!1);return d}function c(a,b,c){if(Ia.shadows)switch(a.b4w_render_shadows){case "OFF":return!1;case "ON":return!0}else return!1;var d=!1,e=!1;a=Ia.ssao&&a.b4w_enable_ssao;if(0==b.length&&!a)return!1;for(b=0;b<c.length;b++){var g=c[b].temp_bpy_obj;g.b4w_shadow_cast&&(d=!0);g.b4w_shadow_receive&&(e=!0);if((a||d)&&e)return!0}return!1}function f(a){for(var b=0;b<a.length;b++)if("SUN"==
a[b].light.type)return!0;return!1}function n(a){if(!Ia.shore_smoothing)return!1;a=ja(a);for(var b=0;b<a.length;b++){var c=a[b];if(c.b4w_water&&c.b4w_water_shore_smoothing)return!0}return!1}function q(a){for(var b=0;b<a.length;b++)for(var c=a[b].temp_bpy_obj.particle_systems,d=0;d<c.length;d++){var e=c[d].settings;if(e.b4w_enable_soft_particles&&0<e.b4w_particles_softness)return!0}return!1}function d(a){for(var b=ja(a),c=[],d=0;d<b.length;d++){var e=b[d];if(e.b4w_water){for(var g={},f=0;f<a.length;f++)for(var k=
a[f].temp_bpy_obj,h=k.data.materials,m=0;m<h.length;m++)h[m]==e&&(g.water_level=k.location[1]);g.fog_color_density=e.b4w_water_fog_color.slice(0);g.fog_color_density.push(e.b4w_water_fog_density);e.b4w_water_dynamic?(g.dynamic=!0,g.waves_height=e.b4w_waves_height,g.waves_length=e.b4w_waves_length,g.dst_noise_scale0=e.b4w_water_dst_noise_scale0,g.dst_noise_scale1=e.b4w_water_dst_noise_scale1,g.dst_noise_freq0=e.b4w_water_dst_noise_freq0,g.dst_noise_freq1=e.b4w_water_dst_noise_freq1,g.dir_min_shore_fac=
e.b4w_water_dir_min_shore_fac,g.dir_freq=e.b4w_water_dir_freq,g.dir_noise_scale=e.b4w_water_dir_noise_scale,g.dir_noise_freq=e.b4w_water_dir_noise_freq,g.dir_min_noise_fac=e.b4w_water_dir_min_noise_fac,g.dst_min_fac=e.b4w_water_dst_min_fac,g.waves_hor_fac=e.b4w_water_waves_hor_fac):(g.dynamic=!1,g.waves_height=0,g.waves_length=0);g.caustics=e.b4w_water_enable_caust;g.caustic_scale=e.b4w_water_caust_scale;g.caustic_brightness=e.b4w_water_caust_brightness;g.caustic_speed=new Float32Array([.3,.7]);g.shoremap_image=
null;e=e.texture_slots;for(f=0;f<e.length;f++)k=e[f].texture,!0===k.b4w_shore_dist_map&&(g.shoremap_image=k.image,g.shoremap_tex_size=k.image.size[0],g.shore_boundings=k.b4w_shore_boundings,g.max_shore_dist=k.b4w_max_shore_dist);c.push(g)}}if(0<c.length){g=c[0];if(!g.dynamic)for(d=0;d<c.length;d++)c[d].dynamic&&(g=c[d]);return g}return null}function k(a){var b={refractions:!1};a=ja(a);for(var c=function(a){if(a){a=a.nodes;for(var d=0;d<a.length;d++){var e=a[d];"GROUP"==e.type&&e.node_group&&c(e.node_group.node_tree);
"GROUP"==e.type&&"B4W_REFRACTION"==e.node_tree_name&&(b.refractions=!0)}}},d=0;d<a.length;d++){var e=a[d];e.b4w_refractive&&(b.refractions=!0);e.node_tree&&c(e.node_tree)}return b}function e(a,b){if(Ia.reflections)switch(a.b4w_render_reflections){case "OFF":return!1}else return!1;for(var c=[],d=0,e=0;e<b.length;e++){var g=b[e];g.render.reflective&&"CUBE"==g.render.reflection_type&&d++;if(g.reflective_objs.length){for(var f=null,k=0;k<c.length;k++)if(c[k]==g){f=k;break}null==f&&c.push(g)}}return{refl_plane_objs:c,
num_cube_refl:d,cube_refl_subs:[],plane_refl_subs:[]}}function m(a,b){var c=a.b4w_sky_settings,d={};d.render_sky=c.render_sky;d.procedural_skydome=c.procedural_skydome&&b;d.use_as_environment_lighting=c.use_as_environment_lighting;d.sky_color=c.color;d.rayleigh_brightness=c.rayleigh_brightness;d.mie_brightness=c.mie_brightness;d.spot_brightness=c.spot_brightness;d.scatter_strength=c.scatter_strength;d.rayleigh_strength=c.rayleigh_strength;d.mie_strength=c.mie_strength;d.rayleigh_collection_power=
c.rayleigh_collection_power;d.mie_collection_power=c.mie_collection_power;d.mie_distribution=c.mie_distribution;d.reflexible=c.reflexible;d.reflexible_only=c.reflexible_only;!b&&c.procedural_skydome&&Ba.warn("There is no sun on the scene. Procedural sky won't be rendered");return d}function B(a){var b={};a=a.b4w_ssao_settings;b.radius_increase=a.radius_increase;b.hemisphere=a.hemisphere;b.blur_depth=a.blur_depth;b.blur_discard_value=a.blur_discard_value;b.influence=a.influence;b.dist_factor=a.dist_factor;
b.samples=a.samples;return b}function N(a){if(!(Ia.bloom&&a.b4w_enable_bloom&&a._render.sun_exist))return null;var b={};a=a.b4w_bloom_settings;b.blur=a.blur;b.edge_lum=a.edge_lum;b.key=a.key;return b}function G(a){var b={};a=a.b4w_motion_blur_settings;b.mb_decay_threshold=a.motion_blur_decay_threshold;b.mb_factor=a.motion_blur_factor;return b}function w(a){var b={};a=a.b4w_color_correction_settings;b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b}
function t(a){var b={};a=a.b4w_god_rays_settings;b.intensity=a.intensity;b.max_ray_length=a.max_ray_length;b.steps_per_pass=a.steps_per_pass;return b}function C(a){var b={};b.outline_color=a.b4w_outline_color;b.outline_factor=a.b4w_outline_factor;return b}function D(a){var b={};a=a.b4w_glow_settings;b.small_glow_mask_coeff=a.small_glow_mask_coeff;b.large_glow_mask_coeff=a.large_glow_mask_coeff;b.small_glow_mask_width=a.small_glow_mask_width;b.large_glow_mask_width=a.large_glow_mask_width;return b}
function p(a,b){var c=a.light_settings,d={};d.environment_energy=c.environment_energy;d.use_environment_light=c.use_environment_light;d.environment_color=c.environment_color;d.horizon_color=a.horizon_color.slice(0);d.zenith_color=a.zenith_color.slice(0);d.use_sky_paper=a.use_sky_paper;d.use_sky_blend=a.use_sky_blend;d.use_sky_real=a.use_sky_real;d.sky_texture_slot=null;d.sky_texture_param=null;d.environment_texture_slot=null;if(d.use_environment_light&&"SKY_TEXTURE"==d.environment_color&&(!b.procedural_skydome||
!b.use_as_environment_lighting)){for(var c=null,e=0;e<a.texture_slots.length;e++)if(a.texture_slots[e].texture.b4w_use_as_environment_lighting){c=a.texture_slots[e];break}c?d.environment_texture_slot=c:(Ba.warn("environment lighting is set to 'Sky Texture', but there is no world texture with 'Sky Texture Usage' property set to 'ENVIRONMENT_LIGHTING'"),d.use_environment_light=!1)}for(e=0;e<a.texture_slots.length;e++)if(a.texture_slots[e].texture.b4w_use_as_skydome){c=a.texture_slots[e];d.sky_texture_slot=
c;d.sky_texture_param={blend_factor:c.blend_factor,horizon_factor:c.horizon_factor,zenith_up_factor:c.zenith_up_factor,zenith_down_factor:c.zenith_down_factor,color:c.color,default_value:c.default_value,invert:c.invert,use_rgb_to_intensity:c.use_rgb_to_intensity,blend_type:c.blend_type,use_map_blend:c.use_map_blend,use_map_horizon:c.use_map_horizon,use_map_zenith_up:c.use_map_zenith_up,use_map_zenith_down:c.use_map_zenith_down};break}return d}function g(a){var b=a.fog_settings,c={};c.use_fog=b.use_fog;
c.intensity=b.intensity;c.depth=b.depth;c.start=b.start;c.height=b.height;c.falloff=b.falloff;c.color=b.use_custom_color?b.color.slice(0):a.horizon_color.slice(0);a=c.color;c.fog_color_density=new Float32Array([a[0],a[1],a[2],1/c.depth]);c.fog_params=new Float32Array([c.intensity,c.depth,c.start,c.height]);return c}function y(a){if(!Ia.dynamic_grass)return!1;for(var b=!1,c=!1,d=0;d<a.length;d++){for(var e=a[d].temp_bpy_obj,g=e.data.materials,f=0;f<g.length;f++)g[f].b4w_terrain&&(b=!0);e=e.particle_systems;
for(f=0;f<e.length;f++)g=e[f].settings,"HAIR"==g.type&&g.b4w_dynamic_grass&&(c=!0);if(b&&c)return!0}return!1}function v(a,b){if(fb.outlining_overview_mode)return!0;if(Ia.enable_selectable)switch(a.b4w_enable_object_selection){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)if(b[c].render.selectable)return!0;return!1}else return!1}function I(a,b){if(fb.outlining_overview_mode)return!0;if(Ia.enable_outlining)switch(a.b4w_enable_outlining){case "OFF":return!1;case "ON":return!0;
case "AUTO":for(var c=0;c<b.length;c++)if(b[c].render.outlining)return!0;return!1}else return!1}function z(a,b){if(Ia.glow_materials)switch(a.b4w_enable_glow_materials){case "OFF":return!1;case "ON":return!0;case "AUTO":for(var c=0;c<b.length;c++)for(var d=b[c].temp_bpy_obj.data.materials,e=0;e<d.length;e++)if(Fa.check_material_glow_output(d[e]))return!0;return!1}else return!1}function H(a,b){if(Ia.refractions)switch(a.b4w_render_refractions){case "OFF":return!1;case "ON":return!0;case "AUTO":return b.refractions}else return!1}
function F(a){for(var b=0;b<a.length;b++)for(var c=a[b].temp_bpy_obj.data.materials,d=0;d<c.length;d++){var e=c[d],g=e.game_settings.alpha_blend;if(e.b4w_render_above_all&&"OPAQUE"!=g&&"CLIP"!=g)return!0}return!1}function L(a,b){switch(a.b4w_enable_anchors_visibility){case "OFF":return!1;case "ON":return!0}for(var c=0;c<b.length;c++){var d=b[c];if(d.anchor&&d.anchor.detect_visibility)return!0}return!1}function x(a,b,c){var d=Ea.node_by_attr(a,b);Ea.traverse_inputs(a,d,function(a,b,d){if(d.active){switch(d.from){case "COLOR":case "CUBEMAP":a=
b.camera.color_attachment;break;case "DEPTH":a=b.camera.depth_attachment;break;case "SCREEN":a=null;break;case "MAIN_CUBE_REFLECT":return;default:throw"Wrong slink";}switch(d.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":case "u_cube_reflection":case "u_plane_reflection":break;default:if(!a)throw"Connection of SCREEN is forbidden";if(a.w_renderbuffer)throw"Batch texture can't use renderbuffer";ra.check_uniform(c.shader,d.to)&&Z.append_texture(c,a,d.to)}}});
for(a=0;a<b.slinks_internal.length;a++){var d=b.slinks_internal[a],e=b.textures_internal[a];switch(d.to){case "COLOR":case "CUBEMAP":case "DEPTH":case "NONE":case "SCREEN":case "OFFSCREEN":break;default:if(e.w_renderbuffer)throw"Batch texture can't use renderbuffer";ra.check_uniform(c.shader,d.to)&&Z.append_texture(c,e,d.to)}}}function K(a,b){return{do_render:!0,do_render_cube:[!0,!0,!0,!0,!0,!0],obj_render:a,batch:b}}function A(a,b,c,d,e,g){for(var f=b.render,k=ya.get_scene_data(b,e).batches,h=0;h<
k.length;h++){var m=k[h];if(!(m.shadow_cast_only||m.reflexible_only||"MAIN"!=m.type&&"NODES_GLOW"!=m.type&&"PARTICLES"!=m.type)&&("OPAQUE"==m.subtype&&"OPAQUE"==d||"BLEND"==m.subtype&&"BLEND"==d||"XRAY"==m.subtype&&"XRAY"==d||"NODES_GLOW"==m.type&&"GLOW"==d)){g||(P(m,a,b,c,d,e),Z.update_shader(m),S(m));var l=K(f,m);a.bundles.push(l);x(c,a,m);ea(m)}}var J=function(a,b){return a==b?0:a>b?1:-1};a.bundles.sort(function(a,b){return a.batch&&b.batch?-J(a.batch.blend,b.batch.blend)||-J(a.batch.alpha_clip,
b.batch.alpha_clip)||J(a.batch.offset_z,b.batch.offset_z):0})}function P(a,b,c,d,e,g){var f=c.render,k=ya.get_scene_data(c,g),h="NO_SHADOWS";if((c=ka.find_subs(d,"SHADOW_CAST"))&&a.shadow_receive){switch(e){case "OPAQUE":h="SHADOW_MAPPING_OPAQUE";break;case "BLEND":case "XRAY":h="SHADOW_MAPPING_BLEND";break;case "COLOR_ID":case "REFLECT":case "GLOW":h="NO_SHADOWS";break;case "DEPTH":h="SHADOW_MASK_GENERATION";break;default:throw"Wrong subscene type";}Z.assign_shadow_receive_dirs(a,g._render.shadow_params,
c)}c=a.shaders_info;ra.set_directive(c,"SHADOW_USAGE",h);a.dynamic_grass&&(h=ka.find_subs(d,"GRASS_MAP"))&&aa(a,h,f);if("DEPTH"!=a.type&&"COLOR_ID"!=e||a.has_nodes)if(e=b.num_lights,ra.set_directive(c,"NUM_LIGHTS",e),ra.set_directive(c,"NUM_LFACTORS",0==e%2?e/2:Math.floor(e/2)+1),"special_skydome.glslf"==ra.get_fname(c)&&ra.set_directive(c,"REFLECTION_PASS",0),ra.set_directive(c,"SSAO_ONLY",0),b.water_params&&b.water_fog_color_density?ra.set_directive(c,"WATER_EFFECTS",1):ra.set_directive(c,"WATER_EFFECTS",
0),b.water_params&&b.caustics&&f.caustics?(ra.set_directive(c,"CAUSTICS",1),ra.set_directive(c,"CAUST_SCALE",ra.glsl_value(b.caust_scale)),ra.set_directive(c,"CAUST_SPEED",ra.glsl_value(b.caust_speed,2)),ra.set_directive(c,"CAUST_BRIGHT",ra.glsl_value(b.caust_brightness))):ra.set_directive(c,"CAUSTICS",0),b.water_params&&(ra.set_directive(c,"WAVES_HEIGHT",ra.glsl_value(b.water_waves_height)),ra.set_directive(c,"WAVES_LENGTH",ra.glsl_value(b.water_waves_length)),ra.set_directive(c,"WATER_LEVEL",ra.glsl_value(b.water_level))),
f=k.cube_refl_subs,k=k.plane_refl_subs,-1!==a.texture_names.indexOf("u_mirrormap")?ra.set_directive(c,"REFLECTION_TYPE","REFL_MIRRORMAP"):a.reflective&&f?(f=f.camera.color_attachment,Z.append_texture(a,f,"u_cube_reflection"),ra.set_directive(c,"REFLECTION_TYPE","REFL_CUBE")):a.reflective&&k?(f=k.camera.color_attachment,Z.append_texture(a,f,"u_plane_reflection"),ra.set_directive(c,"REFLECTION_TYPE","REFL_PLANE")):ra.set_directive(c,"REFLECTION_TYPE","REFL_NONE"),(k=ka.find_subs(d,"SKY"))?a.procedural_sky?
(f=k.camera.color_attachment,Z.append_texture(a,f,"u_sky")):Ia.procedural_fog?(a.cube_fog=k.cube_fog,ra.set_directive(c,"PROCEDURAL_FOG",1)):ra.set_directive(c,"PROCEDURAL_FOG",0):ra.set_directive(c,"PROCEDURAL_FOG",0),f=g._render.world_light_set,f.use_environment_light&&(ra.set_directive(c,"USE_ENVIRONMENT_LIGHT",1),"SKY_TEXTURE"==f.environment_color?(f=f.environment_texture_slot?Z.get_batch_texture(f.environment_texture_slot,!1):k.camera.color_attachment,ra.set_directive(c,"SKY_TEXTURE",1),Z.append_texture(a,
f,"u_sky_texture")):"SKY_COLOR"==f.environment_color&&ra.set_directive(c,"SKY_COLOR",1)),f=g._render.world_fog_set,f.use_fog&&(ra.set_directive(c,"USE_FOG",1),ra.set_directive(c,"FOG_TYPE",f.falloff)),a.refractive?(Ia.depth_tex_available&&ra.set_directive(c,"USE_REFRACTION_CORRECTION",1),"MAIN"==a.type&&a.has_nodes||"NODES_GLOW"==a.type?(ra.set_directive(c,"REFRACTIVE",1),g._render.refractions?ra.set_directive(c,"USE_REFRACTION",1):ra.set_directive(c,"USE_REFRACTION",0)):g._render.refractions?ra.set_directive(c,
"REFRACTIVE",1):ra.set_directive(c,"REFRACTIVE",0)):(ra.set_directive(c,"REFRACTIVE",0),ra.set_directive(c,"USE_REFRACTION",0),ra.set_directive(c,"USE_REFRACTION_CORRECTION",0)),a.water&&(Ia.shore_smoothing&&a.water_shore_smoothing&&ka.find_subs(d,"DEPTH")?ra.set_directive(c,"SHORE_SMOOTHING",1):ra.set_directive(c,"SHORE_SMOOTHING",0),a.water_dynamic&&b.water_params&&b.water_waves_height?ra.set_directive(c,"DYNAMIC",1):ra.set_directive(c,"DYNAMIC",0)),"PARTICLES"==a.type&&(ra.set_directive(c,"SIZE_RAMP_LENGTH",
a.particles_data.size_ramp_length),ra.set_directive(c,"COLOR_RAMP_LENGTH",a.particles_data.color_ramp_length)),!a.forked_batch)for(a=a.textures,b=0;b<a.length;b++)if(f=a[b],"SCENE"==f.source)for(d=0;d<Za.length;d++)for(c=Za[d],k=Za[d]._render_to_textures,e=0;e<k.length;e++)k[e]._render==f&&Ea.append_edge_attr(Tb,c,g,null)}function S(a){var b=a.shader.attributes,c=a.bufs_data.pointers,d;for(d in b)c[d]||Ja.panic('missing data for "'+d+'" attribute');if("MAIN"==a.type||"NODES_GLOW"==a.type)if(b=ra.get_varyings_count(a.shader.vshader),
10<b&&("MAIN"==a.type&&Ba.warn("Varying limit exceeded for main shader - "+b+', materials: "'+a.material_names.join(", ")+'"'),"MAIN"==a.type&&a.has_nodes||"NODES_GLOW"==a.type))d=c=0,a.uv_maps_usage&&(c=Ja.get_dict_length(a.uv_maps_usage)),a.vertex_colors_usage&&(d=Ja.get_dict_length(a.vertex_colors_usage)),Ba.warn("Varying limit exceeded for node shader - "+b+", uv: "+c+", vc: "+d+', materials: "'+a.material_names.join(", ")+'"')}function ea(a){8<a.textures.length&&Ba.warn(a.type,"too many textures used - "+
a.textures.length+' (max 8), materials "'+a.material_names.join(", ")+'"')}function aa(a,b,c){a.grass_map_dim=b.grass_map_dim;var d=b.grass_map_dim[0],e=b.grass_map_dim[1],g=b.grass_map_dim[2];c=c.bb_local;c=Math.max(c.max_x-c.min_x,c.max_z-c.min_z);g=0==g?c:Math.max(g,c);b.grass_map_dim[2]=g;b=b.camera;M.set_frustum(b,g/2,-e,-d,g/2);M.set_projection(b);d=a.grass_size||0;d=0==d?c:Math.max(d,c);a.grass_size=d}function Y(a){var b=V(a,"MAIN_OPAQUE"),c=!0,d=a._render.shadow_params;Ea.traverse(a._render.graph,
function(a,e){"SHADOW_CAST"===e.type&&(X(e,b.camera,e.bundles,d,c),c=!1)})}function Q(a){Ea.traverse(a._render.graph,function(a,b){"OUTLINE"===b.type&&(b.draw_outline_flag=1)})}function X(a,b,c,d,e){if(0!=c.length){var g=a.camera;ab.copy(b.eye,g.eye);ua.copy(b.view_matrix,g.shadow_cast_billboard_view_matrix);if("SUN"===d.lamp_type||"HEMI"===d.lamp_type){var f=pb;ta.zero_bounding_box(f);for(var k=0;k<c.length;k++){var h=c[k].obj_render;0==k?ta.copy_bb(h.bb_world,f):ta.expand_bounding_box(f,h.bb_world)}c=
ta.extract_bb_corners(f,bc);Ja.positions_multiply_matrix(c,g.view_matrix,c);if(d.enable_csm){d=ab.copy(b.csm_centers[a.csm_index],Fc);f=ua.invert(b.view_matrix,Gc);Ja.positions_multiply_matrix(d,f,d);Ja.positions_multiply_matrix(d,g.view_matrix,d);a=b.csm_radii[a.csm_index];if(e)for(ic=0,oc=-Infinity,e=2;e<c.length;e+=3)ic=Math.min(ic,c[e]),oc=Math.max(oc,c[e]);e=pb;e.max_x=d[0]+a;e.max_y=d[1]+a;e.max_z=oc;e.min_x=d[0]-a;e.min_y=d[1]-a;e.min_z=ic}else{a=e=pb;b=hc;b.set(c);c=ac/9;d=ua.identity(Gc);
ua.rotate(d,c,Ja.AXIS_MZ,d);k=f=-1;for(h=0;10>h;h++){var m=ta.bb_from_coords(b,Hc),l=(m.max_x-m.min_x)*(m.max_y-m.min_y);if(-1==f||l<f)f=l,k=h,ta.copy_bb(m,a);Ja.positions_multiply_matrix(b,d,b)}c*=k;0<c&&(a=ua.identity(Gc),ua.rotate(a,c,Ja.AXIS_MZ,a),ua.multiply(a,g.view_matrix,g.view_matrix));c=e.max_x-e.min_x;a=e.max_y-e.min_y;c&&a&&(b=Math.abs(c-a)/2,2<c/a?(e.max_y+=b,e.min_y-=b):2<a/c&&(e.max_x+=b,e.min_x-=b));e.max_x+=.005;e.max_y+=.005;e.max_z+=.005;e.min_x-=.005;e.min_y-=.005;e.min_z-=.005}M.set_frustum_asymmetric(g,
e.min_x,e.max_x,e.min_y,e.max_y,-e.max_z,-e.min_z);M.set_projection(g);Ja.extract_frustum_planes(g.view_proj_matrix,g.frustum_planes)}else"SPOT"!==d.lamp_type&&"POINT"!==d.lamp_type||M.set_projection(g,g.aspect)}}function R(a,b,c,d,e){for(var g=b.render,f=ya.get_scene_data(b,d).batches,k=0;k<f.length;k++){var h=f[k];"COLOR_ID"==h.type&&(e||(P(h,a,b,c,"COLOR_ID",d),Z.update_shader(h),S(h)),"COLOR_PICKING"==a.type&&"COLOR_ID"==h.subtype||"COLOR_PICKING_XRAY"==a.type&&"COLOR_ID_XRAY"==h.subtype)&&(e||
(Z.set_batch_directive(h,"USE_OUTLINE",0),Z.update_shader(h),S(h)),h=K(g,h),a.bundles.push(h))}}function U(a,b,c,d,e){d||(e.dynamic_grass&&(d=ka.find_subs(c,"GRASS_MAP"))&&aa(e,d,b),Z.update_shader(e),S(e));b=K(b,e);a.bundles.push(b);x(c,a,e);ea(e)}function ba(a,b){for(var c=na(b,kb),d=a.light,e=a.render,g=ya.get_scene_data(a,b),f=g.light_index,k=0;k<c.length;k++){var h=c[k];h.light_positions.set(e.trans,3*f);h.light_directions.set(d.direction,3*f);h.light_color_intensities.set(d.color_intensity,
3*f);switch(d.type){case "SUN":h.sun_quaternion.set(e.quat);h.sun_intensity=d.color_intensity;"SKY"===h.type?(h.need_fog_update=d.need_sun_fog_update,ab.copy(d.direction,h.sun_direction),fa(b,h)):ab.copy(d.direction,h.sun_direction);break;case "HEMI":case "POINT":case "SPOT":break;default:Ba.error("Unknown light type: "+d.type+'".')}var m=nc;m[0]=d.use_diffuse?1:0;m[1]=d.use_specular?1:0;h.light_factors.set(m,2*f);h.need_perm_uniforms_update=!0;for(m=0;m<h.bundles.length;m++){var l=h.bundles[m].batch;
l.lamp_uuid_indexes&&Z.set_lamp_data(l,a)}}c=V(b,"MAIN_OPAQUE").camera;g=g.shadow_subscenes;d=b._render.shadow_params;for(k=0;k<g.length;k++)h=g[k],M.set_view_trans_quat(h.camera,e.trans,e.quat),X(h,c,h.bundles,d,!0)}function fa(a,b){Ga.draw(b);if(b.need_fog_update)for(var c=na(a,["MAIN_OPAQUE","MAIN_BLEND","MAIN_XRAY","MAIN_GLOW"]),d=0;d<c.length;d++)for(var e=c[d].bundles,g=0;g<e.length;g++){var f=e[g];f.do_render&&(f=f.batch,Z.check_batch_perm_uniform(f,"u_cube_fog")&&Ga.update_batch_permanent_uniform(f,
"u_cube_fog"))}}function ja(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c].temp_bpy_obj.data,e=0;e<d.materials.length;e++){var g=d.materials[e];-1==b.indexOf(g)&&b.push(g)}return b}function pa(a,b,c){for(var d=a._render,e=a._camera.render.cameras,g=0;g<e.length;g++){var f=e[g];M.set_projection(f,b/c);d.shadow_params&&M.update_camera_shadows(f,d.shadow_params)}d.shadow_params&&(d.need_shadow_update=!0,V(a,"DEPTH").need_perm_uniforms_update=!0,V(a,"MAIN_BLEND").need_perm_uniforms_update=!0);var k=
d.graph;ka.traverse_slinks(k,function(d,e,g,f){if(d.update_dim){f=d.size_mult*b;var h=d.size_mult*c;if(e)for(e=0;e<g.slinks_internal.length;e++)g.slinks_internal[e]==d&&xb.resize(d.texture,f,h);else switch(xb.is_texture(d.texture)&&xb.resize(d.texture,f,h),d=g.camera,d.width=f,d.height=h,g.type){case "DOF":E(a,{dof_power:g.camera.dof_power,dof_on:g.camera.dof_on});break;case "GLOW_COMBINE":da(a,{small_glow_mask_width:g.small_glow_mask_width,large_glow_mask_width:g.large_glow_mask_width});break;case "BLOOM":T(a,
{bloom_blur:g.bloom_blur});break;case "OUTLINE":g=ka.find_input(k,g,"POSTPROCESSING");d=ka.find_input(k,g,"POSTPROCESSING");f=ka.find_input(k,d,"POSTPROCESSING");h=ka.find_input(k,f,"POSTPROCESSING");ka.set_texel_size(g,1/b,1/c);ka.set_texel_size(d,1/b,1/c);ka.set_texel_size(f,1/b,1/c);ka.set_texel_size(h,1/b,1/c);break;default:ka.set_texel_size(g,1/b,1/c)}}})}function na(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];Ea.traverse(a._render.graph,function(a,b){b.type==e&&c.push(b)})}return c}function V(a,
b){return ka.find_subs(a._render.graph,b)}function E(a,b){var c=V(a,"DOF");if(!c)return Ba.error("DOF is not enabled on the scene. Check camera settings"),0;var d=a._render.graph;"boolean"==typeof b.dof_on&&(c.camera.dof_on=parseFloat(b.dof_on));"number"==typeof b.dof_distance&&(c.camera.dof_distance=b.dof_distance);"number"==typeof b.dof_front&&(c.camera.dof_front=b.dof_front);"number"==typeof b.dof_rear&&(c.camera.dof_rear=b.dof_rear);if("number"==typeof b.dof_power){c.camera.dof_power=b.dof_power;
var e=ka.find_input(d,c,"POSTPROCESSING"),d=ka.find_input(d,e,"POSTPROCESSING");ka.set_texel_size_mult(e,c.camera.dof_power);ka.set_texel_size(e,1/c.camera.width,1/c.camera.height);ka.set_texel_size_mult(d,c.camera.dof_power);ka.set_texel_size(d,1/c.camera.width,1/c.camera.height)}c.need_perm_uniforms_update=!0}function T(a,b){var c=V(a,"LUMINANCE_TRUNCED"),d=V(a,"BLOOM");if(!c||!d)return Ba.error("Bloom is not enabled on the scene"),0;"number"==typeof b.bloom_key&&(c.bloom_key=b.bloom_key,c.need_perm_uniforms_update=
!0);"number"==typeof b.bloom_edge_lum&&(c.bloom_edge_lum=b.bloom_edge_lum,c.need_perm_uniforms_update=!0);if("number"==typeof b.bloom_blur){var e=a._render.graph,c=ka.find_input(e,d,"BLOOM_BLUR"),e=ka.find_input(e,c,"BLOOM_BLUR");d.bloom_blur=b.bloom_blur;ka.set_texel_size_mult(c,b.bloom_blur);ka.set_texel_size(c,1/d.camera.width,1/d.camera.height);ka.set_texel_size_mult(e,b.bloom_blur);ka.set_texel_size(e,1/d.camera.width,1/d.camera.height)}}function da(a,b){var c=V(a,"GLOW_COMBINE");if(!c)return Ba.error("Glow is not enabled on the scene"),
null;for(var d=a._render.graph,e=ka.get_inputs(d,c),g=0;g<e.length;++g){var f=e[g];if("POSTPROCESSING"===f.type&&"GLOW_MASK_LARGE"===f.subtype)var k=f;if("POSTPROCESSING"===f.type&&"GLOW_MASK_SMALL"===f.subtype)var h=f}e=ka.find_input(d,k,"POSTPROCESSING");d=ka.find_input(d,h,"POSTPROCESSING");"number"==typeof b.small_glow_mask_coeff&&(c.small_glow_mask_coeff=b.small_glow_mask_coeff,c.need_perm_uniforms_update=!0);"number"==typeof b.large_glow_mask_coeff&&(c.large_glow_mask_coeff=b.large_glow_mask_coeff,
c.need_perm_uniforms_update=!0);"number"==typeof b.small_glow_mask_width&&(c.small_glow_mask_width=b.small_glow_mask_width,ka.set_texel_size_mult(h,b.small_glow_mask_width),ka.set_texel_size(h,1/c.camera.width,1/c.camera.height),h.need_perm_uniforms_update=!0,ka.set_texel_size_mult(d,b.small_glow_mask_width),ka.set_texel_size(d,1/c.camera.width,1/c.camera.height),d.need_perm_uniforms_update=!0);"number"==typeof b.large_glow_mask_width&&(c.large_glow_mask_width=b.large_glow_mask_width,ka.set_texel_size_mult(k,
b.large_glow_mask_width),ka.set_texel_size(k,1/c.camera.width,1/c.camera.height),k.need_perm_uniforms_update=!0,ka.set_texel_size_mult(e,b.large_glow_mask_width),ka.set_texel_size(e,1/c.camera.width,1/c.camera.height),e.need_perm_uniforms_update=!0)}function qa(a,b){var c=V(Bb,"MAIN_OPAQUE");if(!c||!c.water_params)return Ba.error("get_water_surface_level() - no water parameters on the scene"),0;var d=c.water_waves_height,e=c.water_waves_length,g=c.water_level,f=c.water_params;if(!d||!f.dynamic)return f.water_level;
var k=ab.length(c.wind),h=c.time;k&&(h*=k);var m=nc;m[0]=20/e*(a-.25*h);m[1]=20/e*(b-.25*h);k=Ja.cellular2x2(m);m[0]=17/e*(b+.1*h);m[1]=17/e*(a+.1*h);var m=Ja.cellular2x2(m),k=k+m-1,l=f.dst_noise_scale0,m=f.dst_noise_scale1,J=f.dst_noise_freq0,p=f.dst_noise_freq1,n=nc;n[0]=l*(a+J*h);n[1]=l*(b+J*h);l=Ja.snoise(n);n[0]=m*(b-p*h);n[1]=m*(a-p*h);m=Ja.snoise(n);m*=d*l;if(c.use_shoremap)if(p=(a-c.shoremap_center[0])/c.shoremap_size[0],n=(c.shoremap_center[1]+b)/c.shoremap_size[1],p+=.5,n+=.5,1<p||0>p||
1<n||0>n)d=m;else var p=Ja.get_array_smooth_value(Bb._render.shore_distances,c.shoremap_tex_size,p,n),n=f.dir_min_shore_fac,l=f.dir_freq,q=f.dir_noise_scale,t=f.dir_noise_freq,J=f.dir_min_noise_fac,f=f.dst_min_fac,c=e/c.max_shore_dist/Math.PI,q=[q/e*(a+t*h),q/e*(b+t*h)],e=Math.sqrt(p),d=d*Math.max(p,n)*Math.sin(e/c+l*h)*Math.max(Ja.snoise(q),J),h=Math.max(e,f),d=d*(1-h)+m*h,k=k*p;else d=m;return g+(d+.05*k)}function O(a,b,c){b.is_for_outline&&"POSTPROCESSING"==b.type&&c.do_render!=b.do_render&&(b.do_render=
c.do_render);c.do_render||"OUTLINE"!=b.type||(b.draw_outline_flag=0)}function ga(a,b,c,d){var e=Ea.get_node_attr(a,b);M.set_attachment(e.camera,c,d);e.assign_texture=!0;Ea.traverse_outputs(a,b,function(b,e,g){g.active&&g.from==c&&ka.check_slink_tex_conn(g)&&ha(a,b,g.to,d)});Ea.traverse_inputs(a,b,function(b,e,g){g.active&&g.from==c&&g.from==g.to&&ga(a,b,c,d)})}function ha(a,b,c,d){a=Ea.get_node_attr(a,b).bundles;for(b=0;b<a.length;b++)Z.replace_texture(a[b].batch,d,c)}function ia(a){var b=V(a,"GRASS_MAP");
if(b){var c=b.camera,d=a._camera.render,e=d.trans;a=Fc;a[0]=0;a[1]=-b.grass_map_dim[2]/2;a[2]=0;ab.transformQuat(a,d.quat,a);a[0]+=e[0];a[1]=0;a[2]+=e[2];b=bd;b[0]=0;b[1]=0;b[2]=0;b[3]=1;M.set_view_trans_quat(c,a,b)}}function ma(a,b){Ea.traverse(a,function(c,d){if("MOTION_BLUR"==d.type){if(!d.slinks_internal[0]||!d.textures_internal[0])throw"Wrong MOTION_BLUR subscene";var e=d.slinks_internal[0],g=d.textures_internal[0];d.textures_internal[0]=d.camera.color_attachment;Ea.traverse_outputs(a,c,function(b,
c,d){d.active&&ha(a,b,d.to,g)});ga(a,c,e.from,g);ha(a,c,e.to,d.textures_internal[0]);d.motion_blur_exp=Math.exp(-b/d.mb_factor)}})}function ca(a){return a._render.wind}var Z=r("__batch"),ta=r("__boundings"),M=r("__camera"),la=r("__config"),oa=r("__container");r("__constraints");var J=r("__debug"),Ua=r("__geometry"),Ea=r("__graph"),va=r("__hud"),ua=r("__mat4"),Fa=r("__nodemat"),ya=r("__obj_util"),mc=r("__physics"),Oa=r("__prerender"),xa=r("__primitives"),Ba=r("__print"),Ga=r("__renderer"),ka=r("__scenegraph"),
fd=r("__sfx"),ra=r("__shaders"),xb=r("__textures"),Ja=r("__util"),ab=r("__vec3"),Ia=la.defaults,fb=la.outlining,ob=la.scenes,Wa="GRASS_MAP SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH OUTLINE_MASK WIREFRAME".split(" ");a.OBJECT_SUBSCENE_TYPES=Wa;var kb="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT GOD_RAYS GOD_RAYS_COMBINE SKY LUMINANCE_TRUNCED DEPTH SHADOW_CAST COLOR_PICKING COLOR_PICKING_XRAY OUTLINE_MASK".split(" "),
Ec="MAIN_OPAQUE SSAO MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT".split(" "),Uc="SHADOW_CAST MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT COLOR_PICKING COLOR_PICKING_XRAY DEPTH GOD_RAYS OUTLINE_MASK WIREFRAME".split(" "),Vc="MAIN_OPAQUE MAIN_BLEND MAIN_XRAY MAIN_GLOW MAIN_PLANE_REFLECT MAIN_CUBE_REFLECT".split(" "),Sb=null,Bb=null,Za=[],Tb=null,ac=Math.PI/2,nc=new Float32Array(2),Fc=new Float32Array(3),bd=new Float32Array(4),Gc=new Float32Array(16),
bc=new Float32Array(24),hc=new Float32Array(24),pb=ta.zero_bounding_box(),Hc=ta.zero_bounding_box(),ic=0,oc=-Infinity;a.create_scene_render=function(){return{}};a.set_active=function(a){Bb=a;fd.set_active_scene(a)};a.prepare_rendering=function(a,b){var c=a._render,d=ka.create_rendering_queue(c.graph);if(a==b){pa(a,oa.get_viewport_width(),oa.get_viewport_height());for(var e=0;e<d.length;e++)a._render.queue.push(d[e])}else for(e=a._render_to_textures[0],pa(a,e._render.source_size,e._render.source_size),
e=0;e<d.length;e++)b._render.queue.push(d[e]);d=na(a,Uc);for(e=0;e<d.length;e++)d[e].wind.set(c.wind);for(e=0;e<c.queue.length;e++)"SHADOW_CAST"==c.queue[e].type&&Ga.draw(c.queue[e])};a.get_main=function(){Sb||(Sb=u(Za));return Sb};a.find_main_scene=u;a.get_active=h;a.check_active=function(){return Bb?!0:!1};a.get_camera=function(a){return a._camera};a.get_all_scenes=function(){return Za};a.get_rendered_scenes=function(){if(1==Za.length)return Za;for(var a=0;a<Za.length;a++){var b=Za[a]._render.graph;
Ea.traverse(b,function(b,c){for(var d=0;d<c.bundles.length;d++){for(var e=c.bundles[d].batch.textures,g=null,f=0;f<e.length;f++)if("SCENE"==e[f].source&&e[f].source_id==Za[a].name&&"COPY"!=c.type){Ba.error('Texture-scene loop detected. A scene is rendered to texture "'+e[f].name+'" yet this texture belongs to the same scene.');Ea.node_by_attr(Tb,Za[a]);g=c.bundles[d].batch;break}g&&(g.textures=[],g.texture_names=[],Z.update_batch_material_debug(g,null),Z.update_shader(g))}})}for(var c=[],a=0;a<Za.length;a++)if(b=
Za[a],!b._render_to_textures.length){b=Ea.node_by_attr(Tb,b);Ea.enforce_acyclic(Tb,b);b=Ea.subgraph_node_conn(Tb,b,Ea.BACKWARD_DIR);b=Ea.topsort(b);Ea.traverse(b,function(a,b){c.push(b)});break}return c};a.append_scene=function(a,b,c,h,J){a._render_to_textures=a._render_to_textures||[];a._nla=null;var E=a._render,Ua=a._camera.render;E.video_textures=[];var A=a.world;E.lamps_number=c.length;E.sun_exist=f(c);E.sky_params=m(A,E.sun_exist);E.world_light_set=p(A,E.sky_params);E.world_fog_set=g(A);E.anchor_visibility=
L(a,J);Ua.cameras[0].type!=M.TYPE_PERSP&&Ia.anaglyph_use?(Ba.warn("Anaglyph stereo is disabled for the non-perspective camera"),J=!1):J=Ia.anaglyph_use;E.anaglyph_use=J;E.reflection_params=e(a,b);E.bloom_params=N(a);E.mb_params=G(a);E.cc_params=w(a);E.god_rays_params=t(a);E.outline_params=C(a);E.glow_params=D(a);E.dof=Ia.dof&&(0<Ua.dof_distance||Ua.dof_object);E.motion_blur=Ia.motion_blur&&a.b4w_enable_motion_blur;E.compositing=Ia.compositing&&a.b4w_enable_color_correction;E.antialiasing=Ia.antialiasing&&
a.b4w_enable_antialiasing;E.ssao=Ia.ssao&&a.b4w_enable_ssao;E.god_rays=Ia.god_rays&&a.b4w_enable_god_rays&&E.sun_exist;E.depth_tex=Ia.depth_tex_available;E.glow_over_blend=a.world.b4w_render_glow_over_blend;E.ssao_params=B(a);J=k(h);E.materials_params=J;E.refractions=H(a,J);E.shadow_params=l(a,c,h);E.water_params=d(h);E.xray=F(h);E.soft_particles=q(h);E.shore_smoothing=n(h);E.dynamic_grass=y(h);E.color_picking=v(a,h);E.outline=I(a,h);E.glow_materials=z(a,h);switch(a.b4w_reflection_quality){case "LOW":E.cubemap_refl_size=
ob.cube_reflect_low;E.plane_refl_size=ob.plane_reflect_low;break;case "MEDIUM":E.cubemap_refl_size=ob.cube_reflect_medium;E.plane_refl_size=ob.plane_reflect_medium;break;case "HIGH":E.cubemap_refl_size=ob.cube_reflect_high;E.plane_refl_size=ob.plane_reflect_high;break;default:E.cubemap_refl_size=ob.cube_reflect_low,E.plane_refl_size=ob.plane_reflect_low}c=a._render_to_textures.sort(function(a,b){return b._render.source_size-a._render.source_size});E.graph=ka.create_rendering_graph(E,Ua,c);E.queue=
[];E.need_shadow_update=!1;E.need_grass_map_update=!1;E.need_outline=!1;E.wind=new Float32Array(3);Za.push(a);Tb||(Tb=Ea.create());Ea.append_node_attr(Tb,a);for(E=0;E<b.length;E++)ya.scene_data_set_active(b[E],!0,a)};a.append_scene_vtex=function(a,b,c){for(var d=0;d<b.length;d++)b[d]._render&&b[d]._render.is_movie&&(b[d]._render.vtex_data_id=c,a._render.video_textures.push(b[d]))};a.combine_scene_bpy_objects=function(a,c){c||(c="ALL");var d=[];b(a.objects,c,d);return d};a.get_graph=function(a){return a._render.graph};
a.generate_auxiliary_batches=function(a){Ea.traverse(a,function(b,c){var d=null;switch(c.type){case "POSTPROCESSING":d=Z.create_postprocessing_batch(c.pp_effect);break;case "SSAO":d=Z.create_ssao_batch(c);break;case "SSAO_BLUR":d=Z.create_ssao_blur_batch(c);break;case "DEPTH_PACK":d=Z.create_depth_pack_batch();break;case "REFRACT":case "COPY":d=Z.create_postprocessing_batch("NONE");break;case "GOD_RAYS":d=ka.find_input(a,c,"WIREFRAME")||ka.find_input(a,c,"MAIN_BLEND")||ka.find_input(a,c,"GOD_RAYS");
d=Z.create_god_rays_batch(d.camera.color_attachment,c.pack,c.water,c.steps_per_pass);break;case "GOD_RAYS_COMBINE":var d=ka.find_input(a,c,"WIREFRAME")||ka.find_input(a,c,"MAIN_BLEND"),e=ka.find_input(a,c,"GOD_RAYS"),d=Z.create_god_rays_combine_batch(d.camera.color_attachment,e.camera.color_attachment);break;case "MOTION_BLUR":d=Z.create_motion_blur_batch(c.mb_decay_threshold);break;case "DOF":var d=Z.create_dof_batch(),e=ka.find_input(a,c,"POSTPROCESSING"),g=ka.find_input(a,e,"POSTPROCESSING");ka.set_texel_size_mult(e,
c.camera.dof_power);ka.set_texel_size_mult(g,c.camera.dof_power);break;case "OUTLINE":var d=Z.create_outline_batch(),e=ka.find_input(a,c,"POSTPROCESSING"),g=ka.find_input(a,e,"POSTPROCESSING"),f=ka.find_input(a,g,"POSTPROCESSING"),k=ka.find_input(a,f,"POSTPROCESSING");ka.set_texel_size_mult(g,c.blur_texel_size_mult);ka.set_texel_size_mult(e,c.blur_texel_size_mult);ka.set_texel_size_mult(k,c.ext_texel_size_mult*c.outline_factor);ka.set_texel_size_mult(f,c.ext_texel_size_mult*c.outline_factor);break;
case "GLOW_COMBINE":d=Z.create_glow_combine_batch();break;case "COMPOSITING":d=Z.create_compositing_batch();break;case "ANTIALIASING":d=Z.create_antialiasing_batch();break;case "SMAA_RESOLVE":case "SMAA_EDGE_DETECTION":case "SMAA_BLENDING_WEIGHT_CALCULATION":case "SMAA_NEIGHBORHOOD_BLENDING":d=Z.create_smaa_batch(c.type);break;case "ANAGLYPH":d=Z.create_anaglyph_batch();break;case "SKY":d=Z.create_procedural_sky_batch();break;case "LUMINANCE":d=Z.create_luminance_batch();break;case "AVERAGE_LUMINANCE":d=
Z.create_average_luminance_batch();break;case "LUMINANCE_TRUNCED":d=Z.create_luminance_trunced_batch();break;case "BLOOM_BLUR":d=Z.create_bloom_blur_batch();break;case "BLOOM":d=ka.find_input(a,c,"BLOOM_BLUR");e=ka.find_input(a,d,"BLOOM_BLUR");ka.set_texel_size_mult(d,c.bloom_blur);ka.set_texel_size_mult(e,c.bloom_blur);d=Z.create_bloom_combine_batch();break;case "VELOCITY":d=Z.create_velocity_batch();break;case "ANCHOR_VISIBILITY":d=Z.create_anchor_visibility_batch()}d&&(e=K(ya.create_render("NONE"),
d),S(d),c.bundles.push(e),x(a,c,d),ea(d))})};a.append_object=function(a,b,c){switch(b.type){case "MESH":var d=a._render.graph,e=b.render;!ka.find_subs(d,"SHADOW_CAST")&&e.shadow_receive&&(e.shadow_receive=!1);e=na(a,Wa);c&&mc.obj_has_physics(b)&&mc.append_object(b,a);for(var g=0;g<e.length;g++){var f=e[g],k=b,h=d,m=a,l=c;switch(f.type){case "MAIN_OPAQUE":A(f,k,h,"OPAQUE",m,l);break;case "MAIN_BLEND":A(f,k,h,"BLEND",m,l);break;case "MAIN_XRAY":A(f,k,h,"XRAY",m,l);break;case "MAIN_GLOW":A(f,k,h,"GLOW",
m,l);break;case "MAIN_PLANE_REFLECT":case "MAIN_CUBE_REFLECT":for(var J=k.render,p=ya.get_scene_data(k,m).batches,n=0;n<p.length;n++){var q=p[n];if(("MAIN"==q.type||"PARTICLES"==q.type)&&"REFLECT"==q.subtype){if("MAIN_PLANE_REFLECT"==f.type){var t;a:{t=m._render.reflection_params.plane_refl_subs;for(var v=0;v<t.length;v++)if(t[v]==f){t=v;break a}t=null}if(t==J.plane_reflection_id)continue}else{a:{if(m._render.reflection_params)for(t=m._render.reflection_params.cube_refl_subs,v=0;v<t.length;v++)if(t[v]==
f){t=v;break a}t=null}if(t==J.cube_reflection_id)continue}l||(P(q,f,k,h,"REFLECT",m),t=q.shaders_info,ra.set_directive(t,"DISABLE_FOG",0),ra.set_directive(t,"WATER_EFFECTS",0),"special_skydome.glslf"==ra.get_fname(t)&&ra.set_directive(t,"REFLECTION_PASS",1),ra.set_directive(t,"TEXTURE_NORM",0),Z.update_shader(q),S(q));q=K(J,q);f.bundles.push(q)}}break;case "DEPTH":J=ya.get_scene_data(k,m).batches;for(p=0;p<J.length;p++)n=J[p],"DEPTH"!=n.type||n.shadow_cast_only||"DEPTH"!=n.subtype&&"NODES"!=n.subtype||
(l||(P(n,f,k,h,"DEPTH",m),Z.update_shader(n),S(n)),q=K(k.render,n),f.bundles.push(q),x(h,f,n),ea(n));break;case "SHADOW_CAST":J=!1;p=k.render;k=ya.get_scene_data(k,m).batches;n=ka.find_subs(h,"GRASS_MAP");for(q=0;q<k.length;q++)t=k[q],"DEPTH"==t.type&&"SHADOW_CAST"==t.subtype&&(J=!0,l||(v=f.num_lights,Z.set_batch_directive(t,"NUM_LIGHTS",v),Z.set_batch_directive(t,"NUM_LFACTORS",0==v%2?v/2:Math.floor(v/2)+1),ra.set_directive(t.shaders_info,"SHADOW_USAGE","SHADOW_CASTING"),t.dynamic_grass&&n&&aa(t,
n,p),Z.set_batch_directive(t,"SHADOW_TEX_RES",ra.glsl_value(m._render.shadow_params.csm_resolution)),Z.update_shader(t),S(t)),t=K(p,t),f.bundles.push(t));J&&(k=m._render.shadow_params,m=ka.find_subs(h,"MAIN_OPAQUE"),X(f,m.camera,f.bundles,k,!0));break;case "COLOR_PICKING":R(f,k,h,m,l);break;case "COLOR_PICKING_XRAY":R(f,k,h,m,l);break;case "OUTLINE_MASK":h=k.render;k=ya.get_scene_data(k,m).batches;for(m=0;m<k.length;m++)J=k[m],"COLOR_ID"==J.type&&"OUTLINE"==J.subtype&&(l||(Z.set_batch_directive(J,
"USE_OUTLINE",1),Z.update_shader(J),S(J)),J=K(h,J),f.bundles.push(J));break;case "GRASS_MAP":h=k.render;k=ya.get_scene_data(k,m).batches;for(m=0;m<k.length;m++)J=k[m],"GRASS_MAP"==J.type&&(l||(Z.update_shader(J),S(J)),J=K(h,J),f.bundles.push(J),J=f.camera,t=h.bb_world,p=f.grass_map_dim[0],n=f.grass_map_dim[1],q=f.grass_map_dim[2],0==p&&0==n?(p=t.min_y,n=t.max_y):(p=Math.min(p,t.min_y),n=Math.max(n,t.max_y)),t=1E-4*(n-p),f.grass_map_dim[0]=p-t,f.grass_map_dim[1]=n+t,M.set_frustum(J,q/2,-n,-p,q/2),
M.set_projection(J));break;case "WIREFRAME":for(J=k.render,k=ya.get_scene_data(k,m).batches,m=0;m<k.length;m++)p=k[m],"WIREFRAME"==p.type&&U(f,J,h,l,p)}}break;case "LAMP":ba(b,a)}ya.scene_data_set_active(b,!0,a)};a.schedule_shadow_update=function(a){a._render.need_shadow_update=!0};a.get_csm_borders=function(a,b){for(var c=a._render.shadow_params,d=new Float32Array(c.csm_num),e=0;e<c.csm_num;e++)d[e]=M.csm_far_plane(c,b,e);return d};a.append_wireframe_batch=U;a.hide_object=function(a){a.render.hide=
!0};a.show_object=function(a){a.render.hide=!1};a.is_hidden=function(a){return a.render.hide};a.remove_object_bundles=function(a,b,c){b=b.render;a=na(a,Wa);for(var d=0;d<a.length;d++)for(var e=a[d].bundles,g=e.length-1;0<=g;g--){var f=e[g];f.obj_render==b&&(f.batch&&c&&Ua.cleanup_bufs_data(f.batch.bufs_data),e.splice(g,1))}};a.update_lamp_scene=ba;a.cleanup=function(){for(var a=0;a<Za.length;a++){var b=Za[a];Ea.traverse(b._render.graph,function(a,b){if("SINK"!=b.type){var c=b.camera;Ga.render_target_cleanup(c.framebuffer,
c.color_attachment,c.depth_attachment,c.width,c.height);for(var c=b.bundles,d=0;d<c.length;d++){var e=c[d].batch;e&&Z.clear_batch(e)}}});b._render.graph=[];b._render.queue=[]}Bb=Sb=null;Za.length=0;Tb=null};a.make_frustum_shot=function(a,b,c){a=M.extract_frustum_corners(a,a.near,a.far,null,!0);var d=xa.generate_frustum(a);a=ya.create_render("DYNAMIC");a.bb_world=a.bb_local=ta.big_bounding_box();a.bs_world=a.bs_local=ta.big_bounding_sphere();var e=a.bs_world.radius;a.be_world=a.be_local=ta.create_bounding_ellipsoid([e,
0,0],[0,e,0],[0,0,e],a.bs_world.center);c=Z.create_shadeless_batch(d,c,.5);c=K(a,c);b.bundles.push(c)};a.get_scene_timeline=function(a){return[a.frame_start,a.frame_end]};a.setup_dim=function(a,b,c){oa.setup_viewport_dim(a,b,c);Bb&&pa(Bb,a,b)};a.subs_array=na;a.get_subs=V;a.get_environment_colors=function(a){a=na(a,kb)[0];var b=a.horizon_color,c=a.zenith_color,d=[],e=[];d[0]=b[0];d[1]=b[1];d[2]=b[2];e[0]=c[0];e[1]=c[1];e[2]=c[2];return[a.environment_energy,d,e]};a.set_environment_colors=function(a,
b,c,d){a=na(a,kb);for(var e=0;e<a.length;e++){var g=a[e];isNaN(b)||(g.environment_energy=b);c&&g.horizon_color.set(c);d&&g.zenith_color.set(d);g.need_perm_uniforms_update=!0}};a.get_sky_params=function(a){if(a=V(a,"SKY")){var b={};b.color=Array(3);ab.copy(a.sky_color,b.color);b.procedural_skydome=a.procedural_skydome;b.use_as_environment_lighting=a.use_as_environment_lighting;b.rayleigh_brightness=a.rayleigh_brightness;b.mie_brightness=a.mie_brightness;b.spot_brightness=a.spot_brightness;b.scatter_strength=
a.scatter_strength;b.rayleigh_strength=a.rayleigh_strength;b.mie_strength=a.mie_strength;b.rayleigh_collection_power=a.rayleigh_collection_power;b.mie_collection_power=a.mie_collection_power;b.mie_distribution=a.mie_distribution;return b}return null};a.set_sky_params=function(a,b){var c=V(a,"SKY");c&&("number"==typeof b.procedural_skydome&&(c.procedural_skydome=b.procedural_skydome),"number"==typeof b.use_as_environment_lighting&&(c.use_as_environment_lighting=b.use_as_environment_lighting),"object"==
typeof b.color&&c.sky_color.set(b.color),"number"==typeof b.rayleigh_brightness&&(c.rayleigh_brightness=b.rayleigh_brightness),"number"==typeof b.mie_brightness&&(c.mie_brightness=b.mie_brightness),"number"==typeof b.spot_brightness&&(c.spot_brightness=b.spot_brightness),"number"==typeof b.scatter_strength&&(c.scatter_strength=b.scatter_strength),"number"==typeof b.rayleigh_strength&&(c.rayleigh_strength=b.rayleigh_strength),"number"==typeof b.mie_strength&&(c.mie_strength=b.mie_strength),"number"==
typeof b.rayleigh_collection_power&&(c.rayleigh_collection_power=b.rayleigh_collection_power),"number"==typeof b.mie_collection_power&&(c.mie_collection_power=b.mie_collection_power),"number"==typeof b.mie_distribution&&(c.mie_distribution=b.mie_distribution),c.need_perm_uniforms_update=!0,c.need_fog_update=!0,fa(a,c))};a.get_fog_color_density=function(a,b){var c=b||[],d=na(a,Ec)[0].fog_color_density;c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];return c};a.set_fog_color_density=function(a,b){for(var c=
na(a,Ec),d=0;d<c.length;d++){var e=c[d];e.fog_color_density.set(b);e.need_perm_uniforms_update=!0}};a.get_ssao_params=function(a){var b=V(a,"SSAO");a=V(a,"SSAO_BLUR");if(!b)return null;var c=b.bundles[0].batch,d={};d.ssao_quality=Z.get_batch_directive(c,"SSAO_QUALITY")[1];d.ssao_hemisphere=b.ssao_hemisphere;d.ssao_blur_depth=a.ssao_blur_depth;d.blur_discard_value=a.ssao_blur_discard_value;d.radius_increase=b.ssao_radius_increase;d.influence=b.ssao_influence;d.dist_factor=b.ssao_dist_factor;d.ssao_only=
b.ssao_only;d.ssao_white=Z.get_batch_directive(c,"SSAO_WHITE")[1];return d};a.set_ssao_params=function(a,b){var c=V(a,"SSAO"),d=V(a,"SSAO_BLUR");if(!c)return Ba.error("SSAO is not enabled on the scene"),0;if("string"==typeof b.ssao_quality){var e=c.bundles[0].batch;Z.set_batch_directive(e,"SSAO_QUALITY",b.ssao_quality);Z.update_shader(e,!0)}"number"==typeof b.ssao_hemisphere&&(e=c.bundles[0].batch,Z.set_batch_directive(e,"SSAO_HEMISPHERE",b.ssao_hemisphere),Z.update_shader(e,!0));"number"==typeof b.ssao_blur_depth&&
(e=d.bundles[0].batch,Z.set_batch_directive(e,"SSAO_BLUR_DEPTH",b.ssao_blur_depth),Z.update_shader(e,!0));"number"==typeof b.ssao_blur_discard_value&&(d.ssao_blur_discard_value=b.ssao_blur_discard_value);"number"==typeof b.ssao_radius_increase&&(c.ssao_radius_increase=b.ssao_radius_increase);"number"==typeof b.ssao_influence&&(c.ssao_influence=b.ssao_influence);"number"==typeof b.ssao_dist_factor&&(c.ssao_dist_factor=b.ssao_dist_factor);if("number"==typeof b.ssao_only){c=V(a,"MAIN_OPAQUE");c.ssao_only=
b.ssao_only;for(var g=0;g<c.bundles.length;g++)e=c.bundles[g].batch,Z.set_batch_directive(e,"SSAO_ONLY",b.ssao_only),Z.update_shader(e,!0)}"number"==typeof b.ssao_white&&(e=c.bundles[0].batch,Z.set_batch_directive(e,"SSAO_WHITE",b.ssao_white),Z.update_shader(e,!0));c.need_perm_uniforms_update=!0;d.need_perm_uniforms_update=!0};a.get_dof_params=function(a){a=V(a,"DOF");if(!a)return null;var b={};b.dof_distance=a.camera.dof_distance;b.dof_front=a.camera.dof_front;b.dof_rear=a.camera.dof_rear;b.dof_power=
a.camera.dof_power;b.dof_object=a.camera.dof_object;return b};a.set_dof_params=E;a.get_god_rays_params=function(a){var b=na(a,["GOD_RAYS"]);a=V(a,"GOD_RAYS_COMBINE");if(!b||!a)return null;var c={};c.god_rays_max_ray_length=b[0].max_ray_length;c.god_rays_intensity=a.god_rays_intensity;c.god_rays_steps=Z.get_batch_directive(b[0].bundles[0].batch,"STEPS_PER_PASS")[1];return c};a.set_god_rays_params=function(a,b){var c=na(a,["GOD_RAYS"]),d=V(a,"GOD_RAYS_COMBINE");if(!c||!d)return Ba.error("God Rays are not enabled on the scene"),
0;"number"==typeof b.god_rays_intensity&&(d.god_rays_intensity=b.god_rays_intensity);if("number"==typeof b.god_rays_max_ray_length)for(var e=b.god_rays_max_ray_length,g=0;g<c.length;g++)c[g].max_ray_length=e,c[g].radial_blur_step=e/c[g].steps_per_pass/(g+1),c[g].need_perm_uniforms_update=!0;if("number"==typeof b.god_rays_steps)for(var f=ra.glsl_value(b.god_rays_steps,1),e=c[0].max_ray_length,g=0;g<c.length;g++){c[g].steps_per_pass=f;c[g].radial_blur_step=e/f/(g+1);c[g].need_perm_uniforms_update=!0;
var k=c[g].bundles[0].batch;Z.set_batch_directive(k,"STEPS_PER_PASS",f);Z.update_shader(k,!0)}d.need_perm_uniforms_update=!0};a.get_bloom_params=function(a){var b=V(a,"LUMINANCE_TRUNCED");a=V(a,"BLOOM");if(!b||!a)return null;var c={};c.bloom_key=b.bloom_key;c.bloom_edge_lum=b.bloom_edge_lum;c.bloom_blur=a.bloom_blur;return c};a.set_bloom_params=T;a.get_glow_material_params=function(a){a=V(a,"GLOW_COMBINE");if(!a)return null;var b={};b.small_glow_mask_coeff=a.small_glow_mask_coeff;b.large_glow_mask_coeff=
a.large_glow_mask_coeff;b.small_glow_mask_width=a.small_glow_mask_width;b.large_glow_mask_width=a.large_glow_mask_width;return b};a.set_glow_material_params=da;a.get_wind_params=function(a){var b=ca(a);a=ab.length(b);if(0==a)return null;var b=180*Math.atan(b[0]/b[2])/Math.PI,c={};c.wind_dir=b;c.wind_strength=a;return c};a.schedule_grass_map_update=function(a){a._render.need_grass_map_update=!0};a.get_water_surface_level=qa;a.get_water_mat_params=function(a,b){var c=V(a,"MAIN_OPAQUE");if(c&&(b.waves_height=
c.water_waves_height,b.waves_length=c.water_waves_length,c.water_fog_color_density)){b.water_fog_density=c.water_fog_color_density[3];var d=b.water_fog_color=[];d[0]=c.water_fog_color_density[0];d[1]=c.water_fog_color_density[1];d[2]=c.water_fog_color_density[2]}};a.set_water_params=function(a,b){var c=V(a,"MAIN_OPAQUE");if(!c||!c.water_params)return Ba.error("set_water_params() - no water parameters on the scene"),null;c=c.water_params;"number"==typeof b.dst_noise_scale0&&(c.dst_noise_scale0=b.dst_noise_scale0);
"number"==typeof b.dst_noise_scale1&&(c.dst_noise_scale1=b.dst_noise_scale1);"number"==typeof b.dst_noise_freq0&&(c.dst_noise_freq0=b.dst_noise_freq0);"number"==typeof b.dst_noise_freq1&&(c.dst_noise_freq1=b.dst_noise_freq1);"number"==typeof b.dir_min_shore_fac&&(c.dir_min_shore_fac=b.dir_min_shore_fac);"number"==typeof b.dir_freq&&(c.dir_freq=b.dir_freq);"number"==typeof b.dir_noise_scale&&(c.dir_noise_scale=b.dir_noise_scale);"number"==typeof b.dir_noise_freq&&(c.dir_noise_freq=b.dir_noise_freq);
"number"==typeof b.dir_min_noise_fac&&(c.dir_min_noise_fac=b.dir_min_noise_fac);"number"==typeof b.dst_min_fac&&(c.dst_min_fac=b.dst_min_fac);"number"==typeof b.waves_hor_fac&&(c.waves_hor_fac=b.waves_hor_fac);"number"==typeof b.water_dynamic&&(c.dynamic=b.water_dynamic);for(var d=na(a,Vc),e=0;e<d.length;e++){var g=d[e];"number"==typeof b.water_fog_density&&c.fog_color_density&&(g.water_fog_color_density[3]=b.water_fog_density);"object"==typeof b.water_fog_color&&c.fog_color_density&&g.water_fog_color_density.set(b.water_fog_color);
"number"==typeof b.waves_height&&(g.water_waves_height=b.waves_height);"number"==typeof b.waves_length&&(g.water_waves_length=b.waves_length);g.need_perm_uniforms_update=!0}};a.get_shore_dist=function(a,b){var c=V(Bb,"MAIN_OPAQUE");if(!c.use_shoremap)return 100;var d=c.max_shore_dist,e=c.water_level,g=(a[0]-c.shoremap_center[0])/c.shoremap_size[0],f=(c.shoremap_center[1]+a[2])/c.shoremap_size[1],g=g+.5,f=f+.5;if(1<g||0>g||1<f||0>f)e=1;else return c=d*Ja.get_array_smooth_value(Bb._render.shore_distances,
c.shoremap_tex_size,g,f),e=(e-a[1])*b,e=Math.sqrt(c*c+e*e)};a.update=function(a,b){for(var c=h()._camera.render,d=0;d<Za.length;d++){var e=Za[d],g=e._render.graph,f=e._render;if(f.water_params)var k=c.trans[1]-qa(c.trans[0],c.trans[2]);for(var m=0;m<f.video_textures.length;m++){var l=f.video_textures[m]._render,J=l.video_file,p=l.seq_video;if(!(e.b4w_use_nla&&l.use_nla||!J&&!p)&&xb.video_is_played(l)){var n=xb.video_get_current_frame(l),q=xb.video_get_start_frame(l);J&&Ia.is_mobile_device&&(q-=5);
var t=xb.video_get_end_frame(l);!l.use_cyclic&&n>=t?xb.pause_video(l.name,l.vtex_data_id):(p&&n>=t&&(n=l.seq_cur_frame=0),n<q&&xb.reset_video(l.name,l.vtex_data_id),xb.video_update_is_available(l)&&(J?xb.update_video_texture(l):(J=xb.seq_video_get_discrete_timemark(l,a),J!=l.seq_last_discrete_mark&&(xb.update_seq_video_texture(l),l.seq_cur_frame++),l.seq_last_discrete_mark=J)))}}Ea.traverse(g,function(b,c){-1<Uc.indexOf(c.type)&&(c.time=a);f.water_params&&(c.cam_water_depth=k)})}for(d=0;d<Za.length;d++)if(e=
Za[d],f=e._render,g=f.graph,c=f.queue,c.length)for(f.need_shadow_update&&(Y(e),f.need_shadow_update=!1),f.need_grass_map_update&&(ia(e),f.need_grass_map_update=!1),f.need_outline&&(Q(e),f.need_outline=!1),f.motion_blur&&ma(g,b),e=ka.find_subs(g,"OUTLINE_MASK"),m=0;m<c.length;m++)l=c[m],Oa.prerender_subs(l),e&&O(g,l,e),Ga.draw(l);Ia.show_hud_debug_info&&va.show_debug_info(Za,b)};a.request_outline=function(a){a._render.need_outline=!0};a.get_all_subscenes=function(a){var b=[];Ea.traverse(a._render.graph,
function(a,c){b.push(c)});return b};a.get_cam_water_depth=function(){var a=V(Bb,"MAIN_BLEND"),b=Bb;return a||b._render.water_params?a.cam_water_depth:null};a.get_object_data_id=function(a){return a.render.data_id};a.update_scene_permanent_uniforms=function(a){Ea.traverse(a._render.graph,function(a,b){b.need_perm_uniforms_update=!0})};a.set_wireframe_mode=function(a,b){a.do_render=b!=J.WM_NONE;for(var c=0;c<a.bundles.length;c++)a.bundles[c].batch.wireframe_mode=b;a.blend=b==J.WM_TRANSPARENT_WIREFRAME;
a.need_perm_uniforms_update=!0};a.set_wireframe_edge_color=function(a,b){for(var c=0;c<a.bundles.length;c++)a.bundles[c].batch.wireframe_edge_color=b,a.need_perm_uniforms_update=!0};a.update_force_scene=function(a,b){var c=b.field,d=a._render.wind;if(c&&"WIND"==c.type&&d){Ja.quat_to_dir(b.render.quat,Ja.AXIS_Y,d);ab.normalize(d,d);ab.scale(d,c.strength,d);for(var c=na(a,Uc),e=0;e<c.length;e++)c[e].wind.set(d)}};a.pick_color=function(a,b,c){var d=V(a,"COLOR_PICKING");if(d)return b=oa.canvas_to_viewport_coords(b,
c,nc,d.camera),Oa.prerender_subs(d),Ga.draw(d,d.bundles),(a=V(a,"COLOR_PICKING_XRAY"))?(Oa.prerender_subs(a),Ga.draw(a,a.bundles),d=a.camera):d=d.camera,b[1]=d.height-b[1],Ga.read_pixels(d.framebuffer,b[0],b[1]);Ba.error("Object Selection is not available on the scene");return null};a.set_outline_color=function(a){var b=h();if(b=V(b,"OUTLINE"))b.outline_color.set(a),b.need_perm_uniforms_update=!0};a.get_wind=ca;a.get_meta_tags=function(a){var b={title:"",description:""};a.b4w_tags&&(b.title=a.b4w_tags.title,
b.description=a.b4w_tags.description);return b};a.update_cube_reflect_subs=function(a,b){var c=Fc;ab.negate(b,c);for(var d=0;6>d;d++){var e=a.cube_view_matrices[d],g=a.cube_cam_frustums[d],f=a.camera;ua.translate(Ja.INV_CUBE_VIEW_MATRS[d],c,e);ua.multiply(f.proj_matrix,e,f.view_proj_matrix);Ja.extract_frustum_planes(f.view_proj_matrix,g)}};a.update_plane_reflect_subs=function(a,b,c){Ja.trans_quat_to_plane(b,c,Ja.AXIS_Y,a.camera.reflection_plane)};a.assign_scene_data_subs=function(a,b,c){var d=a._render.shadow_params,
e=a._render.reflection_params;c=ya.get_first_lamp_with_shadows(c)||c[0];for(var g=0;g<b.length;g++){var f=b[g],k=ya.get_scene_data(f,a);if(e)if(null!=f.render.plane_reflection_id){var h=e.plane_refl_subs;if(h.length){var m=f.render.plane_reflection_id;k.plane_refl_subs=h[m]}}else null!=f.render.cube_reflection_id&&(h=e.cube_refl_subs,h.length&&(m=f.render.cube_reflection_id,k.cube_refl_subs=h[m]));d&&f==c&&(k.shadow_subscenes=na(a,["SHADOW_CAST"]))}};a.marker_frame=function(a,b){return a.timeline_markers[b]}};b4w.module.__physics=function(a,r){function u(a,b){for(var c=a.cons_descends,d=0;d<c.length;d++)c[d].physics_settings.use_collision_compound&&b.push(c[d]),u(c[d],b);return null}function h(a,b,c){for(var d=a._physics.bundles,e=0;e<d.length;e++)for(var g=d[e].physics,f=0;f<g.collision_tests.length;f++){var k=g.collision_tests[f];"ANY"!=k.collision_id&&c!=k.collision_id||D(k,a,b)}}function b(a,b,d){if(A.is_active(a))switch(b){case A.IN_LOADED:var e=l(a);e._physics.worker_loaded=!0;d=Date.now()-performance.now();
A.post_msg(a,A.OUT_INIT,d,fa.max_fps,fa.calc_fps?ja.fps_measurement_interval:0);break;case A.IN_LOG:ea.log_raw("URANIUM:",d.slice(1));break;case A.IN_ERROR:ea.error(d);break;case A.IN_FBMSG:K.fbmsg.apply(this,d.slice(1));break;case A.IN_TRANSFORM:var g=c(d.body_id);if(g){a=d.trans;e=d.quat;b=d.linvel;var k=d.angvel,g=g.physics;g.curr_time=d.time;X.set_sep(a,1,e,g.curr_tsr);U.copy(b,g.linvel);U.copy(k,g.angvel)}break;case A.IN_PROP_OFFSET:(a=c(d.chassis_hull_body_id))&&X.set_sep(d.trans,1,d.quat,a.vehicle.prop_offsets[d.prop_ind]);
break;case A.IN_FLOATER_BOB_TRANSFORM:if(e=c(d[1]))a=d[4],e=e.floater.bobs[d[2]],Q.set_translation(e,d[3]),Q.set_rotation(e,a),Q.update_transform(e);break;case A.IN_VEHICLE_SPEED:if(g=c(d[1]))g.vehicle.speed=d[2];break;case A.IN_COLLISION:e=l(a);f(e,d.body_id_a,d.body_id_b,d.result,null,null,0);break;case A.IN_COLLISION_POS_NORM:e=l(a);f(e,d.body_id_a,d.body_id_b,d.result,d.coll_point,d.coll_norm,d.coll_dist);break;case A.IN_COLLISION_IMPULSE:if(g=c(d[1]))a=g.physics,a.col_imp_test_cb&&a.col_imp_test_cb(d[2]);
break;case A.IN_RAY_HIT:case A.IN_RAY_HIT_POS_NORM:e=l(a);if(a=e._physics.ray_tests[d.id])if(e=c(d.body_id_hit),b==A.IN_RAY_HIT)b=a.callback,b(a.id,d.hit_fract,e,d.hit_time);else{b=d.hit_fract;var k=d.hit_time,g=d.hit_pos,h=a.callback;g?h(a.id,b,e,k,g,d.hit_norm):h(a.id,b,e,k)}break;case A.IN_REMOVE_RAY_TEST:y(id);break;case A.IN_PING:a=V.indexOf(a);e=(d[2]-d[1]).toFixed(3);b=(performance.now()-d[2]).toFixed(3);d=(performance.now()-d[1]).toFixed(3);console.log("Physics #"+a+" Ping: OUT "+e+" ms, IN "+
b+" ms, ALL "+d+" ms");break;case A.IN_FPS:na=d[1];break;case A.IN_DEBUG_STATS:a=V.indexOf(a);console.log("Worker: #"+String(a));console.log(d[1]);break;default:ea.error("Wrong message: "+b)}}function l(a){for(var b=0;b<V.length;b++)if(V[b]==a)return E[b]}function c(a){return T[a]||null}function f(a,b,d,e,g,f,k){a=a._physics.bundles;for(var h=0;h<a.length;h++)for(var m=a[h].physics,l=0;l<m.collision_tests.length;l++){for(var p=m.collision_tests[l],q=p.pairs,t=!1,v=0;v<q.length;v++){var E=q[v];if(E[0]===
b&&E[1]===d){p.pair_results[v]=e;t=!0;break}}t&&(q=n(p),g&&p.body_id_src!=b&&(t=g,v=f,E=k,t[0]+=v[0]*E,t[1]+=v[1]*E,t[2]+=v[2]*E,v[0]*=-1,v[1]*=-1,v[2]*=-1),t=q?p.body_id_src==b?c(d):c(b):null,p.callback(q,t,g,f,k))}}function n(a){a=a.pair_results;for(var b=!1,c=0;c<a.length;c++)b=b||a[c];return b}function q(){O.body++;return O.body}function d(a){if("ANY"==a)return 0;var b=qa.indexOf(a);return-1==b?(qa.push(a),qa.length-1):b}function k(a){return{body_id:a,mass:0,is_ghost:!1,simulated:!0,is_vehicle:!1,
is_character:!1,is_floater:!1,cons_id:null,collision_id:"",collision_id_num:0,collision_callbacks:{},collision_tests:[],col_imp_test_cb:null,curr_time:0,curr_tsr:new Float32Array([0,0,0,1,0,0,0,1]),linvel:new Float32Array(3),angvel:new Float32Array(3),cached_trans:new Float32Array(3),cached_quat:new Float32Array(4)}}function e(a,b){switch(a){case "BOX":var c=b.bb_local;break;case "CYLINDER":c=b.bcyl_local;break;case "CONE":c=b.bcon_local;break;case "SPHERE":c=b.bs_local;break;case "CAPSULE":c=b.bcap_local}return c}
function m(a){if(!a)return null;var b={};"number"===typeof a.min_x&&(b.min_x=a.min_x);"number"===typeof a.min_y&&(b.min_y=a.min_y);"number"===typeof a.min_z&&(b.min_z=a.min_z);"number"===typeof a.max_x&&(b.max_x=a.max_x);"number"===typeof a.max_y&&(b.max_y=a.max_y);"number"===typeof a.max_z&&(b.max_z=a.max_z);"object"===typeof a.center&&(b.center=a.center);"number"===typeof a.radius&&(b.radius=a.radius);"number"===typeof a.height&&(b.height=a.height);return b}function B(a,b,c,d,e){var g=a.render.trans,
f=b.render.world_matrix,k=new Float32Array(16);P.invert(f,k);f=new Float32Array(3);U.transformMat4(g,k,f);switch(b.vehicle.type){case 10:b=b.vehicle_settings;a=a.render.bb_local;A.post_msg(e,A.OUT_ADD_CAR_WHEEL,c,f,b.suspension_rest_length,b.roll_influence,(a.max_y-a.min_y)/2,d);break;case 20:A.post_msg(e,A.OUT_ADD_BOAT_BOB,c,f,a.synchronize_pos)}}function N(a){return a.physics&&a.physics.cons_id}function G(a,b,c,d,e,g,f,k,h,m){var l;O.constraint++;l=O.constraint.toString(16);var p=b.physics.body_id;
e=e.physics.body_id;var n=w(p);A.post_msg(n,A.OUT_APPEND_CONSTRAINT,l,a,k,p,c,d,e,g,f,h,m);b.physics.cons_id=l}function w(a){for(var b=0;b<E.length;b++)for(var c=E[b]._physics.bundles,d=0;d<c.length;d++)if(c[d].physics.body_id==a)return V[b];return null}function t(a){var b=a.physics;if(b&&(0===b.mass||!0===b.is_ghost||!1===b.simulated||"RIGID_BODY"!==b.type&&"DYNAMIC"!==b.type)&&(a.render.trans[0]!=a.physics.cached_trans[0]||a.render.trans[1]!=a.physics.cached_trans[1]||a.render.trans[2]!=a.physics.cached_trans[2]||
a.render.quat[0]!=a.physics.cached_quat[0]||a.render.quat[1]!=a.physics.cached_quat[1]||a.render.quat[2]!=a.physics.cached_quat[2])){var b=a.physics,c=a.render;U.copy(c.trans,b.cached_trans);aa.copy(c.quat,b.cached_quat);var d=A.get_msg_cache(A.OUT_SET_TRANSFORM);d.body_id=b.body_id;d.trans=c.trans;"DYNAMIC"==b.type?aa.identity(d.quat):d.quat=c.quat;b=w(b.body_id);A.post_msg(b,A.OUT_SET_TRANSFORM)}a=a.cons_descends;for(b=0;b<a.length;b++)t(a[b])}function C(a,b,c,d,e){e=e||new Float32Array(3);a=a.render.quat;
e[0]=b;e[1]=c;e[2]=d;return U.transformQuat(e,a,e)}function D(a,b,c){var d=a.pairs,e=a.pair_results,g=a.body_id_src,f=[],k=a.collision_id;if(!f)throw"At least one destination required";for(var h=0;h<b._physics.bundles.length;h++){var m=b._physics.bundles[h];if("ANY"==k||m.physics.collision_id==k)m=m.physics.body_id,f&&-1==f.indexOf(m)&&f.push(m)}for(b=0;b<f.length;b++)k=f[b],g<k&&!p(d,g,k)?(d.push([g,k]),e.push(!1)):g>k&&!p(d,k,g)&&(d.push([k,g]),e.push(!1));A.post_msg(c,A.OUT_ACTIVATE,g);A.post_msg(c,
A.OUT_APPEND_COLLISION_TEST,d,a.calc_pos_norm)}function p(a,b,c){for(var d=0;d<a.length;d++)if(a[d][0]==b&&a[d][1]==c)return!0;return!1}function g(a){if(a.physics&&a.physics.col_imp_test_cb){a=a.physics;var b=w(a.body_id);A.post_msg(b,A.OUT_CLEAR_COLLISION_IMPULSE_TEST,a.body_id);a.col_imp_test_cb=null}}function y(a){var b=v(a),c=I(a),b=b._physics;b.ray_tests[a]&&(delete b.ray_tests[a],b.ray_tests_arr.splice(b.ray_tests_arr.indexOf,1),A.post_msg(c,A.OUT_REMOVE_RAY_TEST,a))}function v(a){for(var b=
0;b<E.length;b++){var c=E[b];if(c._physics.ray_tests[a])return c}return null}function I(a){for(var b=0;b<E.length;b++)if(E[b]._physics.ray_tests[a])return V[b];return null}function z(a,b,c){if(b.steering_wheel){a=a.physics.body_id;var d=b.engine_force*b.force_max,e=b.brake_force*b.brake_max,g=-b.steering*b.steering_max*2*Math.PI/b.steering_ratio;b.inverse_control&&(g*=-1);switch(b.type){case 10:A.post_msg(c,A.OUT_UPDATE_CAR_CONTROLS,a,d,e,g);break;case 20:A.post_msg(c,A.OUT_UPDATE_BOAT_CONTROLS,a,
d,e,g)}}}function H(a){return a.is_vehicle&&"CHASSIS"==a.vehicle_settings.part}function F(a){return a.is_vehicle&&"HULL"==a.vehicle_settings.part}function L(a){return a.is_floating&&"MAIN_BODY"==a.floating_settings.part}var x=r("__config");r("__constraints");var K=r("__debug"),A=r("__ipc"),P=r("__mat4"),S=r("__obj_util"),ea=r("__print"),aa=r("__quat");r("__renderer");var Y=r("__scenes"),Q=r("__transform"),X=r("__tsr"),R=r("__util"),U=r("__vec3"),ba=r("__version"),fa=x.physics,ja=x.defaults,pa=x.assets,
na=0,V=[],E=[],T={},da=[],qa=[],O={body:0,constraint:0,ray_test:0},ga=new Float32Array(3),ha=new Float32Array(4),ia=new Float32Array(4),ma=new Float32Array(16),ca=new Float32Array(8),Z=new Float32Array(8);a.init_scene_physics=function(a){a._physics={worker_loaded:!1,bundles:[],ray_tests:{},ray_tests_arr:[]};var c=fa.uranium_path;pa.prevent_caching&&(c+=ba.timestamp());ea.log("%cLOAD PHYSICS","color: #0a0",fa.use_workers?"Using Separate Worker Thread,":"Using Same Thread,","Max FPS: "+fa.max_fps);
ea.log("%cPHYSICS PATH","color: #0a0",c);var d=A.create_worker(c,!fa.use_workers);A.attach_handler(d,b);V.push(d);E.push(a);fa.ping&&setInterval(function(){A.post_msg(d,A.OUT_PING,performance.now())},1E3)};a.check_worker_loaded=function(a){return a._physics?a._physics.worker_loaded:!0};a.cleanup=function(){for(var a=0;a<V.length;a++)A.terminate(V[a]);V.length=0;E.length=0;T={};da.length=0;qa.length=0;for(var b in O)O[b]=0};a.append_object=function(a,b){if(!a.render)throw"No object render: "+a.name;
var c=a.physics_settings,g;a:{for(var f=0;f<E.length;f++)if(E[f]==b){g=V[f];break a}g=void 0}var l=[];c.use_collision_compound&&u(a,l);var p=b._physics.bundles;if(H(a)||F(a)||a.is_character||L(a)||a.use_obj_physics){var n,t=a,v=g,r=t.temp_bpy_obj,x=t.render,w=t.physics_settings,y=w.physics_type,D=q();if("CAMERA"==t.type)var C=w.use_collision_bounds?w.collision_bounds_type:"BOX",O=e(C,x),K=x.friction,qa=x.elasticity,K=.5,qa=0;else"EMPTY"==t.type?(C="EMPTY",O=null,qa=K=0):(C=w.use_collision_bounds?
w.collision_bounds_type:"BOX",O=e(C,x),K=x.friction,qa=x.elasticity);var I=x.trans,ga=x.quat,ha=w.use_ghost,pa=w.use_sleep,Q=w.mass,na=w.velocity_min,Z=w.velocity_max,ca=w.damping,ba=w.rotation_damping,X=r.b4w_collision_id,ja=d(X),fa=w.collision_margin,Bb=w.collision_group,Za=w.collision_mask,Tb=x.bs_local.radius,ac=m(O),nc=r.b4w_correct_bounding_offset,Fc;var bd=C;if(l.length){var Gc=[],bc={};bc.quat=new Float32Array([0,0,0,1]);bc.trans=new Float32Array(3);bc.worker_bounding=ac;bc.bounding_type=
bd;Gc.push(bc);P.invert(x.world_matrix,ma);aa.invert(x.quat,ia);for(var hc=0;hc<l.length;hc++){var pb={},Hc=l[hc],ic=Hc.physics_settings.collision_bounds_type,oc=new Float32Array(4),gd=new Float32Array(3);U.transformMat4(Hc.render.trans,ma,gd);aa.multiply(ia,Hc.render.quat,oc);pb.trans=gd;pb.quat=oc;pb.bounding_type=ic;pb.worker_bounding=m(e(ic,Hc.render));Gc.push(pb)}Fc=Gc}else Fc=[];A.post_msg(v,A.OUT_APPEND_BOUNDING_BODY,D,I,ga,y,ha,pa,Q,na,Z,ca,ba,ja,fa,Bb,Za,C,ac,Tb,K,qa,Fc,nc);T[D]=t;da.push(t);
var Mc=k(D);Mc.type=y;Mc.mass=Q;Mc.is_ghost=ha;Mc.collision_id=X;Mc.collision_id_num=ja;n=Mc;a.physics=n;var pc={batch:null,physics:n};p.push(pc);h(b,g,n.collision_id)}else for(var hd=S.get_scene_data(a,b).batches,Va=0;Va<hd.length;Va++){var Ca=hd[Va],jc;if(!(jc="PHYSICS"!=Ca.type))a:{for(var yb=b._physics.bundles,za=0;za<yb.length;za++){var qc=yb[za].batch;if(qc&&qc.id==Ca.id){jc=!0;break a}}jc=!1}if(!jc)if(Ca.submesh.base_length)if(Ca.water&&b._render.water_params){var W=Ca,qb=b,Ka=g,sa=Y.get_subs(qb,
"MAIN_OPAQUE");A.post_msg(Ka,A.OUT_APPEND_WATER,sa.water_level);if(sa.water_params&&W.water_dynamics){var Aa={};Aa.dst_noise_scale0=W.dst_noise_scale0;Aa.dst_noise_scale1=W.dst_noise_scale1;Aa.dst_noise_freq0=W.dst_noise_freq0;Aa.dst_noise_freq1=W.dst_noise_freq1;Aa.dir_min_shore_fac=W.dir_min_shore_fac;Aa.dir_freq=W.dir_freq;Aa.dir_noise_scale=W.dir_noise_scale;Aa.dir_noise_freq=W.dir_noise_freq;Aa.dir_min_noise_fac=W.dir_min_noise_fac;Aa.dst_min_fac=W.dst_min_fac;Aa.waves_hor_fac=W.waves_hor_fac;
var Ha=sa.water_waves_height,Ub=sa.water_waves_length;sa.use_shoremap?A.post_msg(Ka,A.OUT_ADD_WATER_WRAPPER,Aa,sa.shoremap_size[0],sa.shoremap_size[1],sa.shoremap_center[0],sa.shoremap_center[1],sa.max_shore_dist,Ha,Ub,sa.shoremap_tex_size,qb._render.shore_distances):A.post_msg(Ka,A.OUT_ADD_WATER_WRAPPER,Aa,0,0,0,0,0,Ha,Ub,0,null)}}else{if(Ca.use_ghost){var bb=a,gb=Ca,Ib=g,ub=q(),rc=gb.submesh,sc=rc.va_frames[0].a_position,cc=rc.indices||null,Qa=gb.collision_id,Cb=d(Qa);A.post_msg(Ib,A.OUT_APPEND_GHOST_MESH_BODY,
ub,sc,cc,bb.render.trans,Cb,gb.collision_margin,gb.collision_group,gb.collision_mask);var Vb=k(ub);Vb.is_ghost=!0;Vb.collision_id=Qa;Vb.collision_id_num=Cb;n=Vb}else{var Nc=a,Jb=Ca,rb=g,Db=q(),Ma=Jb.submesh,hb=Ma.va_frames[0].a_position,Kb=Ma.indices||null,vb=Nc.render.trans,tc=Jb.friction,Eb=Jb.elasticity,Lb=Jb.collision_id,kc=d(Lb);A.post_msg(rb,A.OUT_APPEND_STATIC_MESH_BODY,Db,hb,Kb,vb,tc,Eb,kc,Jb.collision_margin,Jb.collision_group,Jb.collision_mask);var uc=k(Db);uc.collision_id=Lb;uc.collision_id_num=
kc;n=uc}pc={batch:Ca,physics:n};p.push(pc);h(b,g,n.collision_id)}else ea.error("Object "+a.name+" has collision material with no assigned vertices")}if(H(a)||F(a)){var Da=a,sb=g,cb=Da.physics.body_id;H(Da)?(Da.vehicle.type=10,A.post_msg(sb,A.OUT_APPEND_CAR,cb,Da.vehicle.suspension_compression,Da.vehicle.suspension_stiffness,Da.vehicle.suspension_damping,Da.vehicle.wheel_friction,Da.vehicle.max_suspension_travel_cm)):F(Da)&&(Da.vehicle.type=20,A.post_msg(sb,A.OUT_APPEND_BOAT,cb,Da.vehicle.floating_factor,
Da.vehicle.water_lin_damp,Da.vehicle.water_rot_damp));if(Da.vehicle.props){var Pb=Da.vehicle.props;switch(Da.vehicle.type){case 10:B(Pb[1],Da,cb,!0,sb);B(Pb[0],Da,cb,!0,sb);B(Pb[3],Da,cb,!1,sb);B(Pb[2],Da,cb,!1,sb);break;case 20:for(var La=0;La<Pb.length;La++)B(Pb[La],Da,cb,!1,sb)}}z(a,a.vehicle,g)}else if(a.is_character){var ib=g,dc=a.render,wa=a.physics,db=dc.bb_local.max_y-dc.bb_local.min_y,Xa=wa.body_id,jb=a.character_settings,Na=jb.walk_speed,lb=jb.run_speed,zc=jb.step_height,Wb=jb.jump_strength,
wb=jb.waterline,Ac=R.dir_ground_proj_angle(a);A.post_msg(ib,A.OUT_APPEND_CHARACTER,Xa,Ac,db,Na,lb,zc,Wb,wb);wa.is_character=!0}else if(L(a)){var Ya=a,Qb=g,Fb=Ya.physics.body_id;A.post_msg(Qb,A.OUT_APPEND_FLOATER,Fb,Ya.floater.floating_factor,Ya.floater.water_lin_damp,Ya.floater.water_rot_damp);if(Ya.floater.bobs)for(var tb=Ya.floater.bobs,Ra=0;Ra<tb.length;Ra++){var mb=tb[Ra],Mb=mb.render.trans,Oc=Ya.render.world_matrix,eb=new Float32Array(16);P.invert(Oc,eb);var Pa=new Float32Array(3);U.transformMat4(Mb,
eb,Pa);A.post_msg(Qb,A.OUT_ADD_FLOATER_BOB,Fb,Pa,mb.bob_synchronize_pos)}Ya.physics.is_floater=!0}for(Va=0;Va<da.length;Va++)if(a=da[Va],a.physics){var Gb=a;if(!N(Gb))for(var Nb=0;Nb<Gb.physics_constraints.length;Nb++){var Sa=Gb.physics_constraints[Nb],zb=Sa.target,nb=Sa.pivot_type;if(zb.physics){var Hb=new Float32Array([Sa.pivot_x,Sa.pivot_y,Sa.pivot_z]),Ab,vc=new Float32Array([Sa.axis_x,Sa.axis_y,Sa.axis_z]);Ab=R.euler_to_quat(vc,new Float32Array(4));var Bc=P.fromRotationTranslation(Ab,Hb,new Float32Array(16)),
wc=P.multiply(Gb.render.world_matrix,Bc,new Float32Array(16)),ec=P.invert(zb.render.world_matrix,new Float32Array(16)),Rb=P.multiply(ec,wc,ec),Xb=R.matrix_to_trans(Rb),xc=R.matrix_to_quat(Rb),Ta=Sa,$a={};$a.use_limit_x=Ta.use_limit_x;$a.use_limit_y=Ta.use_limit_y;$a.use_limit_z=Ta.use_limit_z;$a.use_angular_limit_x=Ta.use_angular_limit_x;$a.use_angular_limit_y=Ta.use_angular_limit_y;$a.use_angular_limit_z=Ta.use_angular_limit_z;$a.limit_max_x=Ta.limit_max_x;$a.limit_min_x=Ta.limit_min_x;$a.limit_max_y=
Ta.limit_max_y;$a.limit_min_y=Ta.limit_min_y;$a.limit_max_z=Ta.limit_max_z;$a.limit_min_z=Ta.limit_min_z;$a.limit_angle_max_x=Ta.limit_angle_max_x;$a.limit_angle_min_x=Ta.limit_angle_min_x;$a.limit_angle_max_y=Ta.limit_angle_max_y;$a.limit_angle_min_y=Ta.limit_angle_min_y;$a.limit_angle_max_z=Ta.limit_angle_max_z;$a.limit_angle_min_z=Ta.limit_angle_min_z;G(nb,Gb,Hb,Ab,zb,Xb,xc,$a,null,null)}}}};a.find_obj_by_body_id=c;a.update=function(a,b){for(var c=0;c<V.length;c++){var d=V[c],e=a,g=b;d&&A.is_fallback(d)&&
A.post_msg(d,A.OUT_UPDATE_WORLD,e,g);for(g=0;g<da.length;g++){var f=da[g],k=f.physics;if(k.simulated&&k.curr_time){var h=A.is_fallback(d)?e-k.curr_time:performance.now()/1E3-k.curr_time,h=Math.min(h,10/fa.max_fps),h=h-1/fa.max_fps;ja.no_phy_interp_hack&&(h=0);var m=ca;X.integrate(k.curr_tsr,h,k.linvel,k.angvel,ca);Q.set_tsr(f,m);Q.update_transform(f);t(f);if(f.vehicle)for(var k=f,h=k.vehicle.props,m=k.render.tsr,l=ca,p=0;p<h.length;p++){var n=h[p];X.multiply(m,k.vehicle.prop_offsets[p],l);Q.set_tsr(n,
l);Q.update_transform(n)}f.vehicle&&f.vehicle.steering_wheel&&(k=f.vehicle,h=k.steering_wheel)&&(m=f.vehicle.steering_wheel_axis,n=ma,l=f.render.trans,p=f.render.quat,R.transform_mat4(f.vehicle.steering_wheel_matrix,1,p,l,n),R.matrix_to_trans(n,h.render.trans),R.matrix_to_quat(n,h.render.quat),n=ha,R.transform_vec4(m,1,p,l,n),m=ia,aa.setAxisAngle(n,-k.steering*k.steering_max*2*Math.PI,m),aa.multiply(m,h.render.quat,h.render.quat),Q.update_transform(h));f.vehicle&&f.vehicle.speedometer&&(k=f.vehicle,
h=k.speedometer)&&(l=f.vehicle.speedometer_axis,m=ma,p=f.render.trans,n=f.render.quat,R.transform_mat4(f.vehicle.speedometer_matrix,1,n,p,m),R.matrix_to_trans(m,h.render.trans),R.matrix_to_quat(m,h.render.quat),m=ha,R.transform_vec4(l,1,n,p,m),l=ia,p=Math.abs(k.speed)*k.speed_ratio,p>k.max_speed_angle&&(p=k.max_speed_angle),aa.setAxisAngle(m,-p,l),aa.multiply(l,h.render.quat,h.render.quat),Q.update_transform(h));f.vehicle&&f.vehicle.tachometer&&(k=f.vehicle,h=k.tachometer)&&(m=f.vehicle.tachometer_axis,
n=ma,l=f.render.trans,p=f.render.quat,R.transform_mat4(f.vehicle.tachometer_matrix,1,p,l,n),R.matrix_to_trans(n,h.render.trans),R.matrix_to_quat(n,h.render.quat),f=ha,R.transform_vec4(m,1,p,l,f),m=ia,aa.setAxisAngle(f,-Math.abs(k.engine_force)*k.delta_tach_angle,m),aa.multiply(m,h.render.quat,h.render.quat),Q.update_transform(h))}}A.post_msg_arr(d);d=Y.get_subs(E[c],"MAIN_OPAQUE");d.water_params&&0<d.water_params.waves_height&&(e=U.length(d.wind),A.post_msg(V[c],A.OUT_SET_WATER_TIME,d.time*e))}};
a.get_active_scene=function(){return E[0]};a.pause=function(){for(var a=0;a<V.length;a++)A.post_msg(V[a],A.OUT_PAUSE)};a.resume=function(){for(var a=0;a<V.length;a++)A.post_msg(V[a],A.OUT_RESUME)};a.enable_simulation=function(a){a=a.physics;if(!a)throw"No object physics";if(!a.simulated){var b=a.body_id,c=w(b);a.simulated=!0;A.post_msg(c,A.OUT_ENABLE_SIMULATION,b)}};a.disable_simulation=function(a){a=a.physics;if(!a)throw"No object physics";if(a.simulated){var b=a.body_id,c=w(b);a.simulated=!1;A.post_msg(c,
A.OUT_DISABLE_SIMULATION,b)}};a.scene_has_physics=function(a){return Boolean(a._physics)};a.obj_has_physics=function(a){return Boolean(a.physics)};a.has_dynamic_physics=function(a){return(a=a.physics)&&a.simulated&&("RIGID_BODY"==a.type||"DYNAMIC"==a.type)&&0<a.mass&&0==a.is_ghost?!0:!1};a.has_simulated_physics=function(a){return(a=a.physics)&&a.simulated?!0:!1};a.set_gravity=function(a,b){var c=a.physics.body_id,d=w(c);A.post_msg(d,A.OUT_SET_GRAVITY,c,b)};a.has_constraint=N;a.apply_constraint=G;
a.clear_constraint=function(a){a=a.physics;var b=a.cons_id,c=w(body_a);A.post_msg(c,A.OUT_REMOVE_CONSTRAINT,b);a.cons_id=null};a.pull_to_constraint_pivot=function(b,c,d,e,g,f){c=X.create_sep(c,1,d,ca);g=X.create_sep(g,1,f,Z);X.invert(c,c);X.multiply(g,c,c);Q.get_tsr(e,g);X.multiply(g,c,c);Q.set_tsr(b,c);Q.update_transform(b);a.set_transform(b,b.render.trans,b.render.quat)};a.set_transform=function(a,b,c){var d=a.physics;X.set_sep(a.render.trans,1,a.render.quat,d.curr_tsr);a=A.get_msg_cache(A.OUT_SET_TRANSFORM);
a.body_id=d.body_id;a.trans=b;a.quat=c;b=w(d.body_id);A.post_msg(b,A.OUT_SET_TRANSFORM)};a.sync_transform=t;a.apply_velocity=function(a,b,c,d){C(a,b,c,d,ga);a=a.physics.body_id;b=Math.abs(0);c=Math.abs(0);d=Math.abs(0);var e=Math.abs(ga[0]),g=Math.abs(ga[1]),f=Math.abs(ga[2]);ga[0]=e?ga[0]/e*Math.max(e,b):0;ga[1]=g?ga[1]/g*Math.max(g,c):0;ga[2]=f?ga[2]/f*Math.max(f,d):0;b=w(a);A.post_msg(b,A.OUT_SET_LINEAR_VELOCITY,a,ga[0],ga[1],ga[2])};a.apply_velocity_world=function(a,b,c,d){a=a.physics.body_id;
var e=w(a);A.post_msg(e,A.OUT_SET_LINEAR_VELOCITY,a,b,c,d)};a.apply_force=function(a,b,c,d){C(a,b,c,d,ga);a=a.physics.body_id;b=w(a);A.post_msg(b,A.OUT_APPLY_CENTRAL_FORCE,a,ga[0],ga[1],ga[2])};a.apply_torque=function(a,b,c,d){C(a,b,c,d,ga);a=a.physics.body_id;b=w(a);A.post_msg(b,A.OUT_APPLY_TORQUE,a,ga[0],ga[1],ga[2])};a.set_character_move_dir=function(a,b,c){a=a.physics.body_id;var d=w(a);A.post_msg(d,A.OUT_SET_CHARACTER_MOVE_DIR,a,b,c)};a.set_character_move_type=function(a,b){var c=a.physics.body_id,
d=w(c);A.post_msg(d,A.OUT_SET_CHARACTER_MOVE_TYPE,c,b)};a.set_character_walk_velocity=function(a,b){var c=a.physics.body_id,d=w(c);A.post_msg(d,A.OUT_SET_CHARACTER_WALK_VELOCITY,c,b)};a.set_character_run_velocity=function(a,b){var c=a.physics.body_id,d=w(c);A.post_msg(d,A.OUT_SET_CHARACTER_RUN_VELOCITY,c,b)};a.set_character_fly_velocity=function(a,b){var c=a.physics.body_id,d=w(c);A.post_msg(d,A.OUT_SET_CHARACTER_FLY_VELOCITY,c,b)};a.character_jump=function(a){a=a.physics.body_id;var b=w(a);A.post_msg(b,
A.OUT_CHARACTER_JUMP,a)};a.character_rotation_inc=function(a,b,c){a=a.physics.body_id;var d=w(a);A.post_msg(d,A.OUT_CHARACTER_ROTATION_INCREMENT,a,b,c)};a.set_character_rotation=function(a,b,c){a=a.physics.body_id;var d=w(a);A.post_msg(d,A.OUT_SET_CHARACTER_ROTATION,a,b,c)};a.set_character_rotation_h=function(a,b){var c=a.physics.body_id,d=w(c);A.post_msg(d,A.OUT_SET_CHARACTER_HOR_ROTATION,c,b)};a.set_character_rotation_v=function(a,b){var c=a.physics.body_id,d=w(c);A.post_msg(d,A.OUT_SET_CHARACTER_VERT_ROTATION,
c,b)};a.append_collision_test=function(a,b,c,d){var e=a.physics,g=e.body_id;b=b||"ANY";for(var f=0;f<e.collision_tests.length;f++)if(a=e.collision_tests[f],a.collision_id==b&&a.callback==c)return;a={body_id_src:g,calc_pos_norm:d||!1,collision_id:b,callback:c,pairs:[],pair_results:[]};e.collision_tests.push(a);b=w(g);c=l(b);D(a,c,b)};a.remove_collision_test=function(a,b,c){a=a.physics;for(var d=w(a.body_id),e=l(d),g=0;g<a.collision_tests.length;g++){var f=a.collision_tests[g];if(f.collision_id==b&&
f.callback==c){if(n(f)){var k=U.set(0,0,0,ga);f.callback(!1,null,k,k,0)}a.collision_tests.splice(g,1);g--;for(var k=d,h=e._physics.bundles,f=f.pairs,m=0;m<h.length;m++)for(var p=h[m].physics,q=0;q<p.collision_tests.length;q++)for(var t=p.collision_tests[q],v=0;v<t.pairs.length;v++)for(var E=t.pairs[v],r=0;r<f.length;r++){var B=f[r];E[0]==B[0]&&E[1]==B[1]&&(f.splice(r,1),r--)}f.length&&A.post_msg(k,A.OUT_REMOVE_COLLISION_TEST,f)}}};a.apply_collision_impulse_test=function(a,b){a.physics&&a.physics.col_imp_test_cb&&
g(a);var c=a.physics,d=w(c.body_id);A.post_msg(d,A.OUT_APPLY_COLLISION_IMPULSE_TEST,c.body_id);c.col_imp_test_cb=b};a.clear_collision_impulse_test=g;a.append_ray_test=function(a,b,c,e,g,f,k,h,m){var p;O.ray_test++;p=O.ray_test;e=e||"ANY";a={id:p,body_id:a?a.physics.body_id:0,from:new Float32Array(b),to:new Float32Array(c),collision_id:e,collision_id_num:d(e),autoremove:f,calc_all_hits:k,calc_pos_norm:h,ign_src_rot:m,callback:g};b=w(a.body_id)||V[0];c=l(b)._physics;p=a.id;c.ray_tests[p]=a;c.ray_tests_arr.push(a);
A.post_msg(b,A.OUT_APPEND_RAY_TEST,a.id,a.body_id,a.from,a.to,a.collision_id_num,a.autoremove,a.calc_all_hits,a.calc_pos_norm,a.ign_src_rot);return p};a.remove_ray_test=y;a.change_ray_test_from_to=function(a,b,c){var d=v(a),e=I(a);(d=d._physics.ray_tests[a])&&!d.autoremove&&(d.from.set(b),d.to.set(c),A.post_msg(e,A.OUT_CHANGE_RAY_TEST_FROM_TO,a,b,c))};a.is_ray_test=function(a){return v(a)._physics.ray_tests[a]?!0:!1};a.vehicle_throttle=function(a,b){var c=a.vehicle;c.engine_force=b;var d=w(a.physics.body_id);
z(a,c,d)};a.vehicle_steer=function(a,b){var c=a.vehicle;c.steering=b;var d=w(a.physics.body_id);z(a,c,d)};a.vehicle_brake=function(a,b){var c=a.vehicle;c.brake_force=b;var d=w(a.physics.body_id);z(a,c,d)};a.is_vehicle_chassis=H;a.is_vehicle_hull=F;a.is_car_wheel=function(a){if(!a.is_vehicle)return!1;a=a.vehicle_settings.part;return"WHEEL_FRONT_LEFT"==a||"WHEEL_FRONT_RIGHT"==a||"WHEEL_BACK_LEFT"==a||"WHEEL_BACK_RIGHT"==a?!0:!1};a.is_boat_bob=function(a){return a.is_vehicle?"BOB"==a.vehicle_settings.part?
!0:!1:!1};a.is_floater_bob=function(a){return a.is_floating?"BOB"==a.floating_settings.part?!0:!1:!1};a.is_vehicle_steering_wheel=function(a){return a.is_vehicle&&"STEERING_WHEEL"==a.vehicle_settings.part?!0:!1};a.is_vehicle_speedometer=function(a){return a.is_vehicle&&"SPEEDOMETER"==a.vehicle_settings.part?!0:!1};a.is_vehicle_tachometer=function(a){return a.is_vehicle&&"TACHOMETER"==a.vehicle_settings.part?!0:!1};a.get_vehicle_speed=function(a){return a.vehicle.speed};a.wheel_index=function(a){switch(a){case "WHEEL_FRONT_LEFT":return 0;
case "WHEEL_FRONT_RIGHT":return 1;case "WHEEL_BACK_LEFT":return 2;case "WHEEL_BACK_RIGHT":return 3}};a.is_character=function(a){return a.is_character};a.is_floater_main=L;a.get_fps=function(){return na};a.debug_workers=function(){for(var a=0;a<V.length;a++)A.post_msg(V[a],A.OUT_DEBUG)};a.remove_bounding_object=function(a){var b=da.indexOf(a);-1==b&&ea.error("Object "+a.name+" doesn't have bounding physics");for(var c=a.physics.body_id,d=w(c),e=l(d),f=e._physics.bundles,k=[],h=0;h<f.length;h++)for(var m=
f[h].physics,p=0;p<m.collision_tests.length;p++)for(var q=m.collision_tests[p],t=0;t<q.pairs.length;t++){var v=q.pairs[t],E=q.pair_results[t];if(v[0]==c||v[1]==c)q.pairs.splice(t,1),q.pair_results.splice(t,1),t--,E&&!n(q)&&(E=U.set(0,0,0,ga),q.callback(!1,null,E,E,0)),k.push(v)}k.length&&A.post_msg(d,A.OUT_REMOVE_COLLISION_TEST,k);a.physics&&a.physics.col_imp_test_cb&&g(a);delete T[c];da.splice(b,1);a=e._physics.bundles;for(b=0;b<a.length;b++)a[b].physics.body_id==c&&(a.splice(b,1),b--);A.post_msg(d,
A.OUT_REMOVE_BODY,c)}};b4w.module.__data=function(a,r){function u(a,b){Ja[b.id]=null;ab[b.id]=null}function h(a,b,c){var d;a instanceof ArrayBuffer&&(a=O.get_width_height(a));d=a.width;a=a.height;J.log("%cLOAD IMAGE "+d+"x"+a,"color: #"+(2048<d||2048<a?"a00":1024<d||1024<a?"aa0":"0a0"),b);-1==b.indexOf(Ia)&&c&&J.warn("image",b,"is not from app root.")}function b(a,b,c,d,e,g){d=b.filepath;if(!d)throw"Nothing requested";E.enqueue([[d,E.AT_JSON,d]],function(d,g,f,k){if(d){J.log("%cLOAD METADATA","color: #616",k);g=xa.str_to_version(d.b4w_format_version);
switch(xa.version_cmp(g,Ga.min_format_version)){case -1:g[0]<Ga.min_format_version[0]?xa.panic("JSON version is too old relative to B4W engine: "+xa.version_to_str(g)+", required: "+xa.version_to_str(Ga.min_format_version)+". Reexport scene with the latest B4W addon to fix it."):J.warn("JSON version is a bit old relative to B4W engine: "+ +xa.version_to_str(g)+", required: "+xa.version_to_str(Ga.min_format_version)+". Some compatibility issues can occur. Reexport scene with the latest B4W addon to fix it.");
break;case 1:g[0]>Ga.min_format_version[0]?xa.panic("B4W engine version is too old relative to JSON. Can't load the scene. Update your engine version to fix it."):J.warn("B4W engine version is a bit old relative to JSON. Some compatibility issues can occur. Update your engine version to fix it.")}Ga.loaded_data_version=g;for(var h in d)a[h]=d[h];0===b.id&&(fb=a);(d=a.binaries[0].binfile)?b.binary_name=d:(ha.skip_stage_by_name(b,"load_binaries"),ha.skip_stage_by_name(b,"prepare_bindata"));a==fb||ha.skip_stage_by_name(b,
"start_nla");d=a==fb;if(a.b4w_export_errors)for(h=0;h<a.b4w_export_errors.length;h++)g=a.b4w_export_errors[h],(d&&"PRIMARY"==g.type||"ALL"==g.type)&&J.export_error(g.text);d=a==fb;if(a.b4w_export_warnings)for(h=0;h<a.b4w_export_warnings.length;h++)g=a.b4w_export_warnings[h],(d&&"PRIMARY"==g.type||"ALL"==g.type)&&J.export_warn(g.text);e(b,c)}else ha.abort_thread(b)},null,function(a){g(b,c,a)})}function l(a,b,c,d,e,g){d=U(b.filepath)+b.binary_name;if(!d)throw"Binary data is missing";E.enqueue([[d,E.AT_ARRAYBUFFER,
d]],function(d,g,f,k){d?(J.log("%cLOAD BINARY","color: #616",k),a.bin_data=d,d=n(d),g=xa.str_to_version(a.b4w_format_version),d[0]!=g[0]&&xa.panic("BIN version does not match to JSON version: "+xa.version_to_str(d)+", required: "+xa.version_to_str(Ga.min_format_version)+". Couldn't load the scene. Reexport scene to fix it."),d[1]!=g[1]&&J.warn("BIN version does not match to JSON version: "+ +xa.version_to_str(d)+", required: "+xa.version_to_str(Ga.min_format_version)+". Some compatibility issues can occur. Reexport scene to fix it."),
e(b,c)):ha.abort_thread(b)},null,function(a){g(b,c,a)})}function c(a,b,c,d,e,g){Fa.check_shaders_loaded()&&e(b,c)}function f(a,b,c,d,e,g){d=a.bin_data;g=a.binaries[0];var f=a.objects,k=a.meshes;a=a.actions;for(var h=xa.check_endians(),m=n(d),m=5<=m[0]&&4<m[1]?12:0,l=["indices"],p=["normal","tangent"],J=["color","group"],t=["position","texcoord","texcoord2"],v=0;v<k.length;v++)for(var E=k[v].submeshes,A=0;A<E.length;A++)for(var r in E[A]){var B=E[A][r][1];if(-1!=l.indexOf(r)){var u=4*E[A][r][0]+g["int"]+
m,Ua=E[A],x=r,va=d;if(h)var T=new Uint32Array(va,u,B);else for(var T=new Uint32Array(B),va=new DataView(va),w=0;w<B;w++)T[w]=va.getUint32(u+4*w,!0);Ua[x]=T}else if(-1!=t.indexOf(r))u=4*E[A][r][0]+g["float"]+m,E[A][r]=q(d,u,B,h);else if(-1!=p.indexOf(r)){u=2*E[A][r][0]+g["short"]+m;Ua=E[A];x=r;va=d;T=new Float32Array(B);va=new DataView(va);for(w=0;w<B;w++)T[w]=va.getInt16(u+2*w,!0)/32767;Ua[x]=T}else if(-1!=J.indexOf(r)){u=2*E[A][r][0]+g.ushort+m;Ua=E[A];x=r;va=d;T=new Float32Array(B);va=new DataView(va);
for(w=0;w<B;w++)T[w]=va.getUint16(u+2*w,!0)/65535;Ua[x]=T}}for(r=0;r<f.length;r++)for(k=f[r].particle_systems,l=0;l<k.length;l++)p=k[l],p.transforms=q(d,4*p.transforms[0]+g["float"]+m,p.transforms[1],h);for(f=0;f<a.length;f++){r=a[f];k=r.fcurves;l=r.frame_range;J=l[0];t=l[1];v=V.get_approx_curve_length(J,t);l=null;0>v&&(v=0);var A=E=!1,ua;for(ua in k)E|=-1<ua.indexOf("rotation_euler"),A|=-1<ua.indexOf("rotation_quaternion");p=[];for(ua in k)if(E&&A&&-1<ua.indexOf("rotation_euler"))delete k[ua];else{var B=
k[ua],y;for(y in B)u=B[y],Ua=q(d,g["float"]+4*u.bin_data_pos[0]+m,u.bin_data_pos[1],h),x=new Float32Array(v),null===l&&(l=new Int8Array(v)),V.approximate_curve(u,Ua,x,l,J,t),u._pierced_points=x;-1<ua.indexOf("rotation_euler")&&(V.fcurve_replace_euler_by_quat(k[ua]),p.push(ua))}for(J=0;J<p.length;J++)t=p[J],v=t.replace("euler","quaternion"),k[v]=k[t],delete k[t];r._bflags=l}e(b,c)}function n(a){var b=new Uint8Array(a,0,4),c=(new Uint32Array(a,4,1))[0];a=(new Uint32Array(a,8,1))[0];for(var d=0;d<b.length;d++)if("B4WB"[d]!=
String.fromCharCode(b[d])){c=5;a=4;break}return[c,a]}function q(a,b,c,d){if(d)d=new Float32Array(a,b,c);else{d=new Float32Array(c);a=new DataView(a);for(var e=0;e<c;e++)d[e]=a.getFloat32(b+4*e,!0)}return d}function d(a,b,c,d,e,g){var f=a.cameras,k=a.groups,h=a.materials,l=a.meshes,p=a.node_groups,n=a.objects,q=a.particles,v=a.scenes,E=a.speakers,A=a.textures,r=a.worlds;p||(J.warn('"node_groups" datablock undefined. reexport main scene.'),p=a.node_groups=[]);for(var B="actions armatures cameras curves groups images lamps materials meshes node_groups objects particles scenes sounds speakers textures worlds".split(" "),
u={},x=0;x<B.length;x++)for(var T=a[B[x]],y=0;y<T.length;y++){var Ea=T[y];u[Ea.uuid]=Ea}for(var F=0;F<v.length;F++){for(var da=v[F],D=da.objects,z=0;z<D.length;z++)t(D,z,u);da.camera&&t(da,"camera",u);da.world&&t(da,"world",u)}for(F=0;F<k.length;F++)for(var C=k[F].objects,z=0;z<C.length;z++)t(C,z,u);for(F=0;F<n.length;F++){var Fa=n[F];Fa.dupli_group&&t(Fa,"dupli_group",u);Fa.parent&&t(Fa,"parent",u);Fa.dg_parent&&t(Fa,"dg_parent",u);if(Fa.animation_data){var Ba=Fa.animation_data;Ba.action&&t(Ba,"action",
u);if(Ba.nla_tracks)for(z=0;z<Ba.nla_tracks.length;z++)for(var O=Ba.nla_tracks[z],Oa=0;Oa<O.strips.length;Oa++)O.strips[Oa].action&&t(O.strips[Oa],"action",u)}switch(Fa.type){case "MESH":if(!Fa.data)throw"mesh not found for object "+Fa.name;t(Fa,"data",u);for(var P=!1,H=Fa.modifiers,z=0;z<H.length;z++){var K=H[z];"ARMATURE"==K.type?(P&&J.warn('Object "'+Fa.name+'" has more than one armature modifiers. Only the first one will be used.'),P=!0,t(K,"object",u)):"CURVE"==K.type&&t(K,"object",u)}var qa=
Fa.particle_systems;if(qa)for(z=0;z<qa.length;z++)t(qa[z],"settings",u);break;case "ARMATURE":t(Fa,"data",u);for(var G=Fa.pose.bones,S=Fa.data.bones,z=0;z<G.length;z++){var N=G[z];N.bone=S[N.bone];var I=N.constraints;if(I)for(Oa=0;Oa<I.length;Oa++){var ga=I[Oa];ga.target&&t(ga,"target",u)}for(var ka=N.parent_recursive,Oa=0;Oa<ka.length;Oa++)ka[Oa]=G[ka[Oa]]}break;case "LAMP":case "CAMERA":case "SPEAKER":case "CURVE":t(Fa,"data",u)}if(I=Fa.constraints)for(z=0;z<I.length;z++)ga=I[z],ga.target&&t(ga,
"target",u);var ra=Fa.lod_levels;if(ra)for(z=0;z<ra.length;z++){var ea=ra[z];ea.object&&t(ea,"object",u)}}for(F=0;F<l.length;F++)for(var xb=l[F].materials,z=0;z<xb.length;z++)t(xb,z,u);for(F=0;F<h.length;F++){for(var Ga=h[F],aa=Ga.texture_slots,z=0;z<aa.length;z++)t(aa[z],"texture",u);var ha=Ga.node_tree;ha&&w(ha,u)}for(F=0;F<p.length;F++)(ha=p[F].node_tree)&&w(ha,u);for(F=0;F<A.length;F++){var pa=A[F],Q=pa.type;"IMAGE"!=Q&&"ENVIRONMENT_MAP"!=Q||t(pa,"image",u)}for(F=0;F<f.length;F++){var ia=f[F];
ia.dof_object&&t(ia,"dof_object",u)}for(F=0;F<E.length;F++){var Ja=E[F];Ja.sound&&t(Ja,"sound",u);if(Ja.animation_data&&(Ba=Ja.animation_data,Ba.action&&t(Ba,"action",u),Ba.nla_tracks))for(z=0;z<Ba.nla_tracks.length;z++)for(O=Ba.nla_tracks[z],Oa=0;Oa<O.strips.length;Oa++)O.strips[Oa].action&&t(O.strips[Oa],"action",u)}for(F=0;F<q.length;F++){for(var na=q[F],aa=na.texture_slots,z=0;z<aa.length;z++)t(aa[z],"texture",u);na.dupli_group&&t(na,"dupli_group",u);na.dupli_object&&t(na,"dupli_object",u)}for(F=
0;F<r.length;F++)if(aa=r[F].texture_slots)for(z=0;z<aa.length;z++)t(aa[z],"texture",u);Ua.check_bpy_data(a);for(var R=b.id,Y=a.textures,Z=a==fb?a.scenes[0].b4w_anisotropic_filtering:m().b4w_anisotropic_filtering,Wa=0;Wa<Y.length;Wa++)a==fb||"SCENE"!=Y[Wa].b4w_source_type||(Y[Wa].b4w_source_id=""),ya.create_texture_bpy(Y[Wa],Z,a.scenes,R);for(var Ia={},U=a.objects,ma=0;ma<U.length;ma++){var ba=U[ma];if("MESH"===ba.type&&!ba.particle_systems.length)for(var ab=ba.data,X=ab.name,Ec=ab.submeshes,ja=ab.materials,
ob=0;ob<Ec.length;ob++)0!==Ec[ob].base_length||Ia[X]||(ja[ob]&&J.warn('material "'+ja[ob].name+'" is not assigned to any face (object "'+ba.name+'").'),Ia[X]=!0)}for(var la=a.meshes,ta=0;ta<la.length;ta++){var kb=la[ta];kb.materials.length||kb.uv_textures.length&&J.warn('mesh "'+kb.name+'" has a UV map but has no exported material.')}var Sb=a.materials,Vc=Ua.create_material("DEFAULT");Sb.push(Vc);for(var Ya=a.meshes,Qb=xa.keysearch("name","DEFAULT",a.materials),Fb=0;Fb<Ya.length;Fb++){var tb=Ya[Fb];
0==tb.materials.length&&tb.materials.push(Qb)}for(var Ra=a.actions,mb=b.id,Mb=0;Mb<Ra.length;Mb++){var Oc=Ra[Mb];Oc._data_id=mb;V.append_action(Oc)}for(var eb=a.scenes,Pa=0;Pa<eb.length;Pa++){for(var Gb=eb[Pa],Nb=[],Sa=[],zb=eb[Pa].objects,nb=0;nb<zb.length;nb++){var Hb=zb[nb];L(zb,Hb,Nb,Sa);var Ab=Hb.dupli_group;if(Ab)for(var vc=Ab.objects,Bc=0;Bc<vc.length;Bc++)L(vc,vc[Bc],Nb,Sa)}for(nb=0;nb<Sa.length;nb++)for(var wc=Sa[nb],ec=[Gb],Rb=0;Rb<ec.length;Rb++){for(var Xb=ec[Rb].objects,xc=0;xc<Xb.length;xc++){var Ta=
Xb[xc].dupli_group;if(Ta){var $a=Ta.objects,fc=$a.indexOf(wc);-1<fc&&$a.splice(fc,1)}}var fc=Xb.indexOf(wc);-1<fc&&Xb.splice(fc,1)}for(nb=0;nb<Nb.length;nb++)xa.append_unique(Nb[nb][0],Nb[nb][1])}var Cc=a==fb;!Cc&&1<a.scenes.length&&(a.scenes=[va.find_main_scene(a.scenes)],J.warn("loading data contains multiple scenes.","Only the first one will be loaded."));var Yb=m(),yc=Cc?Yb:va.find_main_scene(a.scenes);mc.set_framerate(Yb.fps);if(1<a.scenes.length){var Wc=a.scenes.indexOf(Yb);a.scenes.splice(Wc,
1);a.scenes.unshift(Yb)}for(var Sc=0;Sc<a.scenes.length;Sc++){var lc=a.scenes[Sc];lc._render=va.create_scene_render();lc._is_main=lc==yc;lc._is_primary_thread=Cc;fd.enabled&&lc.b4w_enable_physics&&(Cc||!oa.scene_has_physics(m())&&lc==va.find_main_scene(a))&&oa.init_scene_physics(lc);Cc?lc.b4w_enable_audio&&ua.attach_scene_sfx(lc):lc.b4w_enable_audio&&!Yb._sfx&&ua.attach_scene_sfx(Yb)}for(var Xc=b.id,pd=m(),jd=a==fb,Ob=0;Ob<a.scenes.length;Ob++){var Zb=a.scenes[Ob],gc=va.combine_scene_bpy_objects(Zb,
"ALL");ca.scene_use_nla(Zb)&&Ua.assign_logic_nodes_object_params(gc,Zb);for(var Ic=0;Ic<gc.length;Ic++){var $b=gc[Ic];M.check_bpy_obj_scene_compatibility($b,Zb,a)&&($b._scenes||($b._scenes=[]),$b._scenes.push(jd?Zb:pd))}for(var Yc=gc,Pc=0;Pc<Yc.length;Pc++){var Zc=Yc[Pc];if(Zc._scenes)for(var kd=Zc.particle_systems,Qc=0;Qc<kd.length;Qc++){var Dc=kd[Qc].settings;if("HAIR"==Dc.type)if("OBJECT"==Dc.render_type){var Jc=Dc.dupli_object;Jc._scenes||(Jc._scenes=Zc._scenes.slice())}else if("GROUP"==Dc.render_type)for(var $c=
Dc.dupli_group,Kc=0;Kc<$c.objects.length;Kc++)Jc=$c.objects[Kc],Jc._scenes||(Jc._scenes=Zc._scenes.slice())}}}for(var ad=fa(a,Xc),Ob=0;Ob<ad.length;Ob++)if($b=ad[Ob],!jd&&$b.parent&&-1<Uc.indexOf($b.parent.type)&&($b.parent=""),"MESH"==$b.type){var Lc=Ua.apply_mesh_modifiers($b);Lc&&(a.meshes.push(Lc),$b.data=Lc)}e(b,c)}function k(a,b,c,d,e,g){d=fa(a,b.id);g=b.id;for(var f=0;f<d.length;f++){var k=d[f];if(k._scenes){for(var h=la.create_object(k.name,k.type,k.origin_name),m=0;m<k._scenes.length;m++)la.append_scene_data(h,
k._scenes[m]);h.temp_bpy_obj=k;k._object=h;M.update_object(k,h);h.render.data_id=g;h.is_hair_dupli=k._is_hair_dupli||!1}}d=M.get_all_objects(b.id);for(g=0;g<d.length;g++)f=d[g],ca.update_object(f.temp_bpy_obj,f);if(a==fb)for(g=b.id,f=0;f<a.scenes.length;f++)for(var k=a.scenes[f],h=0,m=M.get_scene_objs(k,"LAMP",g),l=0;l<m.length;l++)la.get_scene_data(m[l],k).light_index=h++;for(g=0;g<d.length;g++)f=d[g],f.is_hair_dupli||(M.update_object_relations(f),Oa.update_transform(f));for(a=0;a<d.length;a++)if(g=
d[a],"MESH"==g.type&&(f=g.armobj)){var f=f.render,k=g.render.bone_skinning_info,h=[],p;for(p in k)m=k[p],h.push(4*m.deform_bone_index,4*m.bone_index);f.mesh_to_arm_bone_maps.push(h);f.skinned_renders.push(g.render)}a=p=-1;g=V.get_max_bones();for(f=0;f<d.length;f++)k=d[f],h=k.render,la.is_mesh(k)&&h.is_skinning&&(k=h.max_bones,k>p&&(p=k),g>=k&&k>a&&(a=k));for(f=0;f<d.length;f++)k=d[f],h=k.render,la.is_mesh(k)&&h.is_skinning&&(h.frames_blending=!0,p<g?h.max_bones=p:h.max_bones<=g?h.max_bones=a:(J.warn('too many bones for "'+
k.name+'" / '+h.max_bones+" bones (max "+g+" with blending, "+2*g+" without blending). Blending between frames will be disabled."),h.max_bones=p,h.frames_blending=!1),h.frames_blending=h.frames_blending&&!ra.frames_blending_hack);for(p=0;p<d.length;p++)if(a=d[p],g=a.temp_bpy_obj,la.is_mesh(a)&&(f=g.lod_levels.length))for(k=a,h=0;h<f;h++)if(m=g.lod_levels[h].object){m=m._object;m.render.lod_transition_ratio=a.render.lod_transition_ratio;k.render.lod_dist_max=g.lod_levels[h].distance;m.render.lod_dist_min=
g.lod_levels[h].distance;if(g.lod_levels[h+1])m.render.lod_dist_max=g.lod_levels[h+1].distance;else{m.render.last_lod=!0;m.render.lod_dist_max=1E4;break}k.render.last_lod=!1;k=m}else{k.render.last_lod=!0;k.render.lod_dist_max=g.lod_levels[h].distance;break}for(p=0;p<d.length;p++)if(a=d[p],a.is_vehicle)if(g=a.vehicle_settings,"CHASSIS"==g.part){a.vehicle={};a.vehicle.force_max=g.force_max;a.vehicle.brake_max=g.brake_max;a.vehicle.suspension_compression=g.suspension_compression;a.vehicle.suspension_stiffness=
g.suspension_stiffness;a.vehicle.suspension_damping=g.suspension_damping;a.vehicle.wheel_friction=g.wheel_friction;a.vehicle.roll_influence=g.roll_influence;a.vehicle.max_suspension_travel_cm=g.max_suspension_travel_cm;a.vehicle.engine_force=0;a.vehicle.brake_force=1;a.vehicle.steering=0;a.vehicle.speed=0;a.vehicle.props=[];a.vehicle.prop_offsets=[];a.vehicle.steering_wheel=null;k=(f=la.get_dg_parent(a))?la.get_dg_objects(f,d):d;for(f=0;f<k.length;f++)h=k[f],h.is_vehicle&&(m=h.vehicle_settings,oa.is_car_wheel(h)&&
g.name==m.name?(m=oa.wheel_index(h.vehicle_settings.part),a.vehicle.props[m]=h,a.vehicle.prop_offsets[m]=new Float32Array(8)):oa.is_vehicle_steering_wheel(h)&&g.name==m.name?(a.vehicle.steering_wheel=h,a.vehicle.steering_max=m.steering_max,a.vehicle.steering_ratio=m.steering_ratio,a.vehicle.inverse_control=m.inverse_control,m=ia.invert(a.render.world_matrix,new Float32Array(16)),h=ia.multiply(m,h.render.world_matrix,m),a.vehicle.steering_wheel_matrix=h,m=new Float32Array([1,0,0,0]),Ba.transformMat4(m,
h,m),a.vehicle.steering_wheel_axis=m):oa.is_vehicle_speedometer(h)&&g.name==m.name?(a.vehicle.speedometer=h,a.vehicle.speed_ratio=m.speed_ratio,a.vehicle.max_speed_angle=m.max_speed_angle,m=ia.invert(a.render.world_matrix,new Float32Array(16)),h=ia.multiply(m,h.render.world_matrix,m),a.vehicle.speedometer_matrix=h,m=new Float32Array([1,0,0,0]),Ba.transformMat4(m,h,m),a.vehicle.speedometer_axis=m):oa.is_vehicle_tachometer(h)&&g.name==m.name&&(a.vehicle.tachometer=h,a.vehicle.delta_tach_angle=m.delta_tach_angle,
m=ia.invert(a.render.world_matrix,new Float32Array(16)),h=ia.multiply(m,h.render.world_matrix,m),a.vehicle.tachometer_matrix=h,m=new Float32Array([1,0,0,0]),Ba.transformMat4(m,h,m),a.vehicle.tachometer_axis=m));if(4!=a.vehicle.props.length)throw"Not enough wheels for chassis "+a.name;}else if("HULL"==g.part)for(a.vehicle={},a.vehicle.props=[],a.vehicle.prop_offsets=[],a.vehicle.force_max=g.force_max,a.vehicle.brake_max=g.brake_max,a.vehicle.floating_factor=g.floating_factor,a.vehicle.water_lin_damp=
g.water_lin_damp,a.vehicle.water_rot_damp=g.water_rot_damp,a.vehicle.engine_force=0,a.vehicle.brake_force=1,a.vehicle.steering=0,a.vehicle.speed=0,a.vehicle.steering_wheel=null,k=(f=la.get_dg_parent(a))?la.get_dg_objects(f,d):d,f=0;f<k.length;f++)h=k[f],h.is_vehicle&&(m=h.vehicle_settings,oa.is_boat_bob(h)&&g.name==m.name?(a.vehicle.props.push(h),a.vehicle.prop_offsets.push(new Float32Array(8))):oa.is_vehicle_steering_wheel(h)&&g.name==m.name?(a.vehicle.steering_wheel=h,a.vehicle.steering_max=m.steering_max,
a.vehicle.steering_ratio=m.steering_ratio,a.vehicle.inverse_control=m.inverse_control,m=ia.invert(a.render.world_matrix,new Float32Array(16)),h=ia.multiply(m,h.render.world_matrix,m),a.vehicle.steering_wheel_matrix=h,m=new Float32Array([1,0,0,0]),Ba.transformMat4(m,h,m),a.vehicle.steering_wheel_axis=m):oa.is_vehicle_speedometer(h)&&g.name==m.name?(a.vehicle.speedometer=h,a.vehicle.speed_ratio=m.speed_ratio,a.vehicle.max_speed_angle=m.max_speed_angle,m=ia.invert(a.render.world_matrix,new Float32Array(16)),
h=ia.multiply(m,h.render.world_matrix,m),a.vehicle.speedometer_matrix=h,m=new Float32Array([1,0,0,0]),Ba.transformMat4(m,h,m),a.vehicle.speedometer_axis=m):oa.is_vehicle_tachometer(h)&&g.name==m.name&&(a.vehicle.tachometer=h,a.vehicle.delta_tach_angle=m.delta_tach_angle,m=ia.invert(a.render.world_matrix,new Float32Array(16)),h=ia.multiply(m,h.render.world_matrix,m),a.vehicle.tachometer_matrix=h,m=new Float32Array([1,0,0,0]),Ba.transformMat4(m,h,m),a.vehicle.tachometer_axis=m));for(p=0;p<d.length;p++)if(a=
d[p],a.is_floating&&(g=a.floating_settings,"MAIN_BODY"==g.part))for(a.floater={},a.floater.floating_factor=g.floating_factor,a.floater.water_lin_damp=g.water_lin_damp,a.floater.water_rot_damp=g.water_rot_damp,a.floater.bobs=[],f=(f=la.get_dg_parent(a))?la.get_dg_objects(f,d):d,k=0;k<f.length;k++)h=f[k],h.is_floating&&(m=h.floating_settings,oa.is_floater_bob(h)&&g.name==m.name&&(a.floater.bobs.push(h),h.bob_synchronize_pos=h.floating_settings.synchronize_position));e(b,c)}function e(a,b,c,d,e,g){for(d=
0;d<a.scenes.length;d++)g=a.scenes[d],g._camera=g.camera._object;d=m();g=a==fb;for(var f=0;f<a.scenes.length;f++){var k=g?a.scenes[f]:d,h=M.get_scene_objs(k,"ALL",b.id),l=g?M.get_scene_objs(k,"LAMP",b.id):M.get_scene_objs(k,"LAMP",0),p=M.get_scene_objs(k,"MESH",b.id),J=M.get_scene_objs(k,"EMPTY",b.id);g&&(va.append_scene(k,h,l,p,J),k._render.video_textures.length&&(b.has_video_textures=!0));va.append_scene_vtex(k,a.textures,b.id);for(var n=0;n<J.length;n++)M.update_force(J[n]);J=[];va.set_active(k);
T.generate_main_batches(k,p,l,J);h=va.get_graph(k);if(g){n=k._render.sky_params;if(n.render_sky||n.procedural_skydome)n=T.generate_sky_meta_obj(k,n),J.push(n);va.generate_auxiliary_batches(h)}for(n=0;n<p.length;n++)T.create_forked_batches(p[n],h,k);for(n=0;n<J.length;n++)T.create_forked_batches(J[n],h,k),M.objects_storage_add(J[n]);h=M.get_scene_objs(k,"ALL",b.id);va.assign_scene_data_subs(k,h,l)}for(d=0;d<a.scenes.length;d++)delete a.scenes[d].camera;d=a.materials;if(ka.dds_available&&Ga.use_dds)for(a=
0;a<d.length;a++){k=d[a];l=k.texture_slots;for(g=0;g<l.length;g++)if(p=l[g],J=p.texture,"IMAGE"==J.type||"ENVIRONMENT_MAP"==J.type)f=J.image,f._is_dds||(-1<f.filepath.indexOf(".dds")?f._is_dds=!0:(f._is_dds=!J.b4w_disable_compression&&!p.use_map_normal&&"ENVIRONMENT_MAP"!=J.type&&!J.b4w_shore_dist_map&&"MOVIE"!=f.source,f._is_dds&&(f.filepath+=".dds")));if(g=k.node_tree)for(k=g.nodes,g=0;g<k.length;g++)f=k[g],"TEXTURE"==f.type&&(l=f.texture)&&(f=l.image)&&!f._is_dds&&(f._is_dds=l._render.allow_node_dds&&
!l.b4w_disable_compression&&"MOVIE"!=f.source,f._is_dds&&(f.filepath+=".dds"))}else for(a=a.images,d=0;d<a.length;d++)g=a[d],f=Boolean("FILE"==g.source&&-1<g.filepath.indexOf(".dds")),g._is_dds=f;e(b,c)}function m(){return va.find_main_scene(fb.scenes)}function B(a,b,c,d,e,g){d=a.groups;g=a.objects;for(var f={},k={},h={},m={},l=0;l<d.length;l++){var p=d[l];f[p.uuid]=p;h[p.uuid]=p}for(l=0;l<g.length;l++)p=g[l],k[p.uuid]=p,m[p.uuid]=p;a=a.scenes;for(l=0;l<a.length;l++)N(a[l].objects,null,m,h);for(var J in h)J in
f||d.push(h[J]);for(J in m)J in k||g.push(m[J]);e(b,c)}function N(a,b,c,d){for(var e=[],g=0;g<a.length;g++){var f=a[g],k=c[f.uuid];if(f=k.proxy){b&&-1==e.indexOf(f.uuid)&&e.push(f.uuid);for(var h=c[f.uuid],m=h.constraints,f=0;f<m.length;f++){var l=xa.clone_object_json(m[f]);l.name+="_CLONE";k.constraints.push(l)}"b4w_proxy_inherit_anim"in k&&!k.b4w_proxy_inherit_anim||(k.animation_data&&(h.animation_data=xa.clone_object_json(k.animation_data)),h.b4w_use_default_animation=k.b4w_use_default_animation,
h.b4w_auto_skel_anim=k.b4w_auto_skel_anim,h.b4w_anim_behavior=k.b4w_anim_behavior,h.b4w_cyclic_animation=k.b4w_cyclic_animation)}}for(g=0;g<e.length;g++)k=xa.get_index_for_key_value(a,"uuid",e[g]),-1<k&&a.splice(k,1);e={};if(b)for(g=0;g<a.length;g++)f=a[g],k=c[f.uuid],m=xa.clone_object_json(k),k="origin_name"in k?k.origin_name:k.name,m.name=la.gen_dupli_name(b.name,k),m.origin_name=k,m.dg_parent={uuid:b.uuid},G(m),c[m.uuid]=m,e[f.uuid]=m.uuid,f.uuid=m.uuid;for(g=0;g<a.length;g++)f=a[g],k=c[f.uuid],
k.dupli_group&&(f=k.dupli_group,m=d[f.uuid],h=xa.clone_object_json(m),h.name=xa.unique_name(m.name+"_CLONE"),h.uuid=ma.hexdigest("Group"+h.name),d[h.uuid]=h,f.uuid=h.uuid,N(h.objects,k,c,d));if(b)for(g=0;g<a.length;g++){f=a[g];k=c[f.uuid];k.parent&&k.parent.uuid in e?k.parent.uuid=e[k.parent.uuid]:k.parent&&(J.warn("Object's \""+k.name+'" parent is not in dupli group. Disabling parenting.'),k.parent=null);m=k.constraints;for(f=0;f<m.length;f++)b=m[f],b.target&&b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);
if(b=k.pose)for(d=b.bones,f=0;f<d.length;f++)if(m=d[f].constraints)for(h=0;h<m.length;h++)b=m[h],b.target&&b.target.uuid in e&&(b.target.uuid=e[b.target.uuid]);b=k.modifiers;for(f=0;f<b.length;f++)d=b[f],d.object&&d.object.uuid in e&&(d.object.uuid=e[d.object.uuid]);if((k=k.lod_levels)&&k.length)for(f=0;f<k.length;f++)b=k[f],b.object&&b.object.uuid in e&&(b.object.uuid=e[b.object.uuid])}for(var p in e)ob[p]=e[p]}function G(a){a.uuid=ma.hexdigest("Object"+a.name)}function w(a,b){for(var c=a.nodes,
d=0;d<c.length;d++){var e=c[d];"TEXTURE"==e.type&&e.texture&&t(e,"texture",b);"LAMP"==e.type&&e.lamp&&(e.lamp.uuid in ob&&(e.lamp.uuid=ob[e.lamp.uuid]),b[e.lamp.uuid]||(e.lamp=null));"GROUP"==e.type&&e.node_group&&t(e,"node_group",b)}e=a.links;for(d=0;d<e.length;d++){var g=e[d];C(g,"from_node",c);C(g,"to_node",c);D(g,"from_socket",g.from_node.outputs);D(g,"to_socket",g.to_node.inputs)}if(c=a.animation_data)if(c.action&&t(c,"action",b),c.nla_tracks)for(d=0;d<c.nla_tracks.length;d++)for(e=c.nla_tracks[d],
g=0;g<e.strips.length;g++)e.strips[g].action&&t(e.strips[g],"action",b)}function t(a,b,c){(c=c[a[b].uuid])||J.error("Dangling link found:",b,a);a[b]=c}function C(a,b,c){c=xa.keysearch("name",a[b].name,c);a[b]=c}function D(a,b,c){c=xa.keysearch("identifier",a[b].identifier,c);a[b]=c}function p(a,b,c,d,e,g){if(!Ga.do_not_load_resources){for(var f=U(b.filepath),k=a.images,m={},l=[],p=0;p<k.length;p++){var n=k[p],q=n.uuid;if("FILE"===n.source||"MOVIE"===n.source){var t=y(n,a.textures);if(!t.length)J.warn("image ",
n.name," has no users.");else if(!t[0].b4w_shore_dist_map){t=xa.normpath_preserve_protocol(f+n.filepath);if("FILE"===n.source){var v=n._is_dds?E.AT_ARRAYBUFFER:E.AT_IMAGE_ELEMENT;ka.min50_available&&Ga.use_min50&&(t=E.split_extension(t),"dds"==t[1]?(t=E.split_extension(t[0]),t=t[0]+".min50."+t[1]+".dds"):t=t[0]+".min50."+t[1])}else"MOVIE"===n.source&&(Ga.seq_video_fallback?(t=E.split_extension(t),t=t[0]+".altconv.seq",v=E.AT_SEQ_VIDEO_ELEMENT):(t=E.split_extension(t),v=ua.detect_video_container(t[1]),
t=v!=t[1]?t[0]+".altconv."+v:t[0]+"."+v,v=E.AT_VIDEO_ELEMENT));l.push([q,v,t]);m[q]=n}}}l.length?(d.image_counter=0,E.enqueue(l,function(e,f,k,p){if(e){if(k==E.AT_VIDEO_ELEMENT||k==E.AT_SEQ_VIDEO_ELEMENT){if(k==E.AT_VIDEO_ELEMENT)var n=e.videoWidth,q=e.videoHeight;else n=e.images[0].width,q=e.images[0].height;J.log("%cLOAD VIDEO "+n+"x"+q,"color: #"+(2048<n||2048<q?"a00":1024<n||1024<q?"aa0":"0a0"),p);-1==p.indexOf(Ia)&&J.warn("video",p,"is not from app root.")}else h(e,p,!0);f=m[f];p=y(f,a.textures);
for(n=0;n<p.length;n++){var q=p[n],t=q.image.filepath;k==E.AT_SEQ_VIDEO_ELEMENT?(q._render.seq_fps=e.fps,ya.update_texture(q._render,e.images,f._is_dds,t,b.id)):ya.update_texture(q._render,e,f._is_dds,t,b.id)}}e=++d.image_counter/l.length;g(b,c,e)},function(){J.log("%cLOADED ALL IMAGES","color: #0a0");e(b,c)})):e(b,c)}}function g(a,b,c,d,e,g){a=va.get_rendered_scenes();for(d=0;d<a.length;d++)g=a[d],ca.scene_use_nla(g)&&ca.update_scene(g,g.b4w_nla_cyclic,b.id);e(b,c)}function y(a,b){for(var c=[],d=
0;d<b.length;d++){var e=b[d];e.image===a&&c.push(e)}return c}function v(a,b,c,d,e,g){if(!Ga.do_not_load_resources){a=U(b.filepath);for(var f=[],k={},h=M.get_all_objects(b.id),m=0;m<h.length;m++){var l=h[m],p=l.temp_bpy_obj;if(I(l)){var n=p.data.sound,p=n.uuid;"BACKGROUND_MUSIC"==ua.get_spk_behavior(l)?(p=xa.gen_uuid(),b.has_background_music=!0):"NONE"!=ua.get_spk_behavior(l)&&Ga.init_wa_context_hack&&(b.init_wa_context=!0);if(!(p in k)){k[p]=[];n=xa.normpath_preserve_protocol(a+n.filepath);switch(ua.source_type(l)){case ua.AST_ARRAY_BUFFER:var q=
E.AT_AUDIOBUFFER;break;case ua.AST_HTML_ELEMENT:q=E.AT_AUDIO_ELEMENT}var n=E.split_extension(n),t=ua.detect_audio_container(n[1]),n=t!=n[1]?n[0]+".altconv."+t:n[0]+"."+t;f.push([p,q,n])}k[p].push(l)}}f.length?E.enqueue(f,function(a,e,h,m){if(a)for(J.log("%cLOAD SOUND","color: #0aa",m),-1==m.indexOf(Ia)&&J.warn("sound",m,"is not from app root."),e=k[e],h=0;h<e.length;h++)ua.update_spkobj(e[h],a);a=++d.sound_counter/f.length;g(b,c,a)},function(){J.log("%cLOADED ALL SOUNDS","color: #0aa");e(b,c)}):e(b,
c)}}function I(a){return la.is_speaker(a)&&ua.source_type(a)!=ua.AST_NONE}function z(a,b,c){a=M.get_scene_objs(a,"SPEAKER",b);for(b=0;b<a.length;b++){var d=a[b];la.is_speaker(d)&&(ua.is_cyclic(d)||c)&&ua.play_def(d)}}function H(a){for(var b=a._render.video_textures,c=0;c<b.length;c++){var d=b[c]._render;a.b4w_use_nla&&b[c].b4w_nla_video||!b[c].use_auto_refresh||(ya.reset_video(d.name,d.vtex_data_id),ya.play_video(d.name,d.vtex_data_id))}}function F(a,b,c,d,e,g){ca.start();J.log("%cSTART NLA","color: #0a0");
e(b,c)}function L(a,b,c,d){if(b.lod_levels&&b.lod_levels.length)for(var e=b.lod_levels.length,g=0;g<e;g++){var f=b.lod_levels[g],k=f.object;if(k){var h=xa.clone_object_nr(k);h.name=b.name+"_LOD_"+String(g+1);G(h);h.lod_levels=[];c.push([a,h]);d.push(k);f.object=h}}}function x(a,b,c,d,e,g){d=!0;for(g=0;g<a.scenes.length;g++)if(!oa.check_worker_loaded(a.scenes[g])){d=!1;break}d&&(e(b,c),J.log("%cPHYSICS READY","color: #0a0"))}function K(a,b,c,d,e,g){d=m();for(g=0;g<a.scenes.length;g++){var f=a.scenes[g],
k=a==fb?oa.scene_has_physics(f):oa.scene_has_physics(d)||oa.scene_has_physics(f);a!=fb&&(f=d);if(fd.enabled&&k)for(k=0;k<Vc.length;k++)for(var h=M.get_scene_objs(f,Vc[k],b.id),l=0;l<h.length;l++){var p=h[l];p.render.data_id==b.id&&(oa.append_object(p,f),b.load_hidden&&oa.obj_has_physics(p)&&oa.disable_simulation(p))}}e(b,c)}function A(a,b,c,d,e,g){var f={};d=[];var k=a.scenes;for(g=0;g<a.scenes.length;g++){var m=k[g];if(m._render.water_params&&(m=m._render.water_params.shoremap_image)&&"FILE"===m.source){var l=
m.uuid,p=U(b.filepath),p=xa.normpath_preserve_protocol(p+m.filepath);d.push([l,m._is_dds?E.AT_ARRAYBUFFER:E.AT_IMAGE_ELEMENT,p]);f[l]=m}}d.length?E.enqueue(d,function(c,d,e,g){if(c){h(c,g,!0);d=f[d];g=y(d,a.textures);for(e=0;e<g.length;e++){var m=g[e];ya.update_texture(m._render,c,d._is_dds,m.image.filepath,b.id)}for(e=0;e<k.length;e++)if(g=k[e],g._render.water_params.shoremap_image===d){var l=c,p=d,n=document.createElement("canvas"),m=p.size[0],p=p.size[1];n.width=m;n.height=p;n=n.getContext("2d");
n.drawImage(l,0,0);l=n.getImageData(0,0,m,p).data;n=new Float32Array(4);n[0]=1/16581375;n[1]=1/65025;n[2]=1/255;n[3]=1;for(var m=m*p,p=new Float32Array(m),J=0;J<m;J++)p[J]=n[1]*l[4*J+2]+n[2]*l[4*J+3];g._render.shore_distances=p}}},function(){e(b,c)}):e(b,c)}function P(a,b,c,d,e,g){if(Ga.antialiasing&&Ga.smaa){d=a.scenes[0];a=[];var f=["SMAA_EDGE_DETECTION","SMAA_BLENDING_WEIGHT_CALCULATION","SMAA_NEIGHBORHOOD_BLENDING","SMAA_RESOLVE"];for(g=0;g<f.length;g++){var k=va.get_subs(d,f[g]);k&&a.push(k)}if(a.length){d=
[];U(b.filepath);g=E.AT_IMAGE_ELEMENT;d.push(["SEARCH_TEXTURE",g,da.paths.smaa_search_texture_path]);d.push(["AREA_TEXTURE",g,da.paths.smaa_area_texture_path]);for(g=0;g<a.length;g++)if(f=a[g],"SMAA_BLENDING_WEIGHT_CALCULATION"==f.type){a=f.slinks_internal;for(g=0;g<a.length;g++)if(f=a[g],"u_search_tex"==f.to)var m=f.texture;else if("u_area_tex"==f.to)var l=f.texture;break}d.length?E.enqueue(d,function(a,c,d,e){a&&(h(a,e,!1),c="SEARCH_TEXTURE"==c?m:l,c.source="IMAGE",c.auxilary_texture=!0,d=-1!=e.indexOf(".dds")?
1:0,ya.update_texture(c,a,d,e,b.id),ya.set_filters(c,ya.TF_LINEAR,ya.TF_LINEAR))},function(){e(b,c)}):e(b,c)}else e(b,c)}else e(b,c)}function S(a,b,c,d,e,g){for(c=0;c<a.scenes.length;c++){e=a.scenes[c];a!=fb&&(e=m());var f=M.get_scene_objs(e,"LAMP",b.id);for(g=0;g<f.length;g++){var k=f[g];k.render.data_id==b.id&&d.added_objects.push({scene:e,obj:k})}f=M.get_scene_objs(e,"ALL",b.id);for(g=0;g<f.length;g++)k=f[g],"LAMP"!=k.type&&k.render.data_id==b.id&&(b.load_hidden&&la.is_mesh(k)&&va.hide_object(k),
d.added_objects.push({scene:e,obj:k}))}}function ea(a,b,c,d,e,g){var f=d.added_objects;e=d.obj_counter;if(f.length){a=f[e].obj;e=f[e].scene;var k=la.get_scene_data(a,e);va.append_object(e,a,!1);a.anchor&&na.append(a);d=++d.obj_counter/f.length;"LAMP"==a.type&&M.sort_lamps(e);f=k.cube_refl_subs;null!=a.render.cube_reflection_id&&f&&va.update_cube_reflect_subs(f,a.render.trans);f=a.reflective_objs;f.length&&e._render.reflection_params&&(e=k.plane_refl_subs,va.update_plane_reflect_subs(e,a.render.trans,
a.render.quat),la.update_refl_objects(f,e.camera.reflection_plane))}else d=1;g(b,c,d)}function aa(a,b,c,d,e,g){if(a==fb){a=va.get_main();d=va.get_rendered_scenes();for(g=0;g<d.length;g++){var f=d[g];va.prepare_rendering(f,a);f.b4w_use_logic_editor&&Z.init_logic(f,b.id)}va.set_active(a)}else va.update_scene_permanent_uniforms(m());a=M.get_all_objects(b.id);M.update_objects_dynamics(a);e(b,c)}function Y(a,b,c,d,e,g){if(a==fb)for(d=0;d<a.scenes.length;d++)H(a.scenes[d]),z(a.scenes[d],b.id);else H(m()),
z(m(),b.id);e(b,c)}function Q(a,b,c,d,e,g){Ga.is_mobile_device&&(b.has_video_textures||b.has_background_music||b.init_wa_context)?Wa||X(a,e,b,c):e(b,c)}function X(a,b,c,d){var e=Sb.parentElement;Ec=e.style.zIndex;e.style.zIndex="999";Wa=document.createElement("div");Wa.style.position="relative";Wa.style.height="88px";Wa.style.width="88px";var g=Math.round(Sb.offsetHeight/2-44),f=Math.round(Sb.offsetWidth/2-44);Wa.style.top=g.toString()+"px";Wa.style.left=f.toString()+"px";Wa.style.backgroundImage=
"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALAAAACwCAYAAACvt+ReAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAbrwAAG68BXhqRHAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAABVDSURBVHic7Z15kF1Vncc/v05Ys7JIQJZ0GLaAgCzCQARGFMIwZKTiqCPBAbTEEodBhYKALJKSVWYsCpTBcgCLAdQBHWZACCCyhCElIRiWEMOSBZAkCglJOoTQyW/++J3Xfe95971+273v3fvOp6qr+5573+vT3d8+93vP+Z3fTwjUhKoKsC0wLvKxDTA68rEVMNK9ZDiwpft6PdDvvl4LvA+sBt5zn1cCy4EVwDJgpYhouj9RMZB2d6ATUdWtgD2BXvcxARgPbJ5RFzYAS4BFwGL38YqIvJ/R988NQcCAqm4LHADsA+yLibannX1KYBMm6JeBBcA8EVnZ3i61n64UsKoOAyYCh7iPCeTvd6HA68BcYA6wQEQ2trdL2ZO3P1rDqGoPsD9wNHAkMKqBt1nNoFctfV7j2ldj/rbPXdsvIuvd994S88QAIzCfHPXOHyHurRvt21PALOAFEdnUwHvkjsILWFV7gcnAUcDYWl8GvAEsZNCDLhKR91rfw4RvrjoWuyv0us97ALtS+99rFfAEMFNElqTRx06hkAJ2I94ngRMwXzsUmzCxzsP85csisja9HtaPqo7CbM9EzK/vRW1/vwXATODJ0h2hSBRKwO5hbAom3KFuw2uAZzD/+JyIrEm5ey1FVUcDB2Ee/hPU9vM+ANwnIu+m3L3MKISAVXU3YCrwNwx6zSTWArOBJ7Gn+P4q1+YGVR0OfByzSX+N+exKfAg8DtwtIm9m0L1UybWAVfWjwJcw4Vb6WRT4A3YbnV0U0VZCVTfDRDwZOJDKv5dNwGPAXSLydja9az25FLCqbg9MA44FhlW4bDXwIPYgszyrvnUSqrojJuRqlqof+C1wp4i8k1XfWkWuBKyqmwN/D3wRW7ZN4m3gfzHhfpBV3zoZNyofBXwem81I4gPgHsxabMiqb82SGwGr6lHAV7A50yQWA3cCT4c4gmRcPMeRwCnY0ngSK4BbRGRWZh1rgo4XsJtZOAvzdUm8CfwSeKxbJu+bxQl5EnAqsEuFy+YAPxKRP2fWsQboWAG7X/JJwGkMRnVFWQXcDjwchNsYbnVyMibkMQmXvA/8DLi/U+9qHSlg95B2HvCxhNP9wG+AO0SkL+F8oE7cws9UzCNvlnDJAuA6EVmWacdqoOMErKpHA98keS7zReAGEXkr2151B6q6C3A2sF/C6bWYpXgy215Vp2MErKpbYMI9NuF0H3ArNrPQkbeyouCs2wnA6SQPIo8AN3XKDE9HCFhVdwK+iwWv+DwLXF+k5c88oKrbAecAByecfh24shMsRdsFrKqHYn53pHdqAzYtdk8YdduDG40nA18DtvBOrwP+TURmZ96xCG0VsKp+DrtV+f1YDFwrIkuz7lOgHBeSej6wm38KmzP+deadcrRFwG765kxsmszncexBrXChf3nGzVScg63o+cwEftyOHSGZC9htmLwAONQ71Y/9N/9P1n0K1I6qngycQXkMyjPANVkPPJkKWFVHApcDe3un1mIPBc9n2Z9AY6jqgcBFlM9SLAAuy3J+PjMBu20yM4DdvVPLge+JyBtZ9SXQPC4G+zJsD1+U14BLs9p+lYmAXTzDFZRHQi0EZojIqiz6EWgtqroNcCmWQyPKUuDiLKY+Uxewqo4BrqL8CfZF4PKQrCPfuIe7S7Dg+ShvARekPTilKmBVHYGNvHt4p54FrshT3GmgMm4V9SJsf16URcBFae43TE3Abrbh+5Q/sM0Gri761p5uwwXNTwcO904twOxEKrMTqaRPcvO851Eu3uewqZYg3oIhIh9iVnGOd2ofYLrLhtRy0sr/dSbl/4nzMdvwYUrfM9Bm3MB0JfCCd+pQbFNCy2m5gN3ysL/CthCbWgmrawXHPdfMAF7xTk12iyAtpaUCVtXDsNiGKMuxqbIg3i7BzSzNwPbXRfmqC95qGS0TsKqOA75N/MGwjzDP25W41K+XYausA83AeS58tiW0RMCRucBo7oF+zPMWOrlcoDJudfUqIBrkMxK40KVIaJpWjcBnUR6MfkuIbQiIyDzgNq95d+AbrXj/pgWsqpMo3wb0eIgqC5Rw8cL+Xrrj3P7HpmhKwKr6EeBfvOYlwA3NvG+gkFyPxUhEOcvtQG+YhgXstpucSzykbgO2kyLMOARiOE1ci2XHLDES+I7TUkM0MwJPoTxvw63hoS1QCRFZjCVKiXIAcGKj79mQgJ11+LLX/BxwX6MdCXQN92K7N6Kc1qiVaHQE/ibx7JB9wA/D7uHAUDiN3MhgMRyArWlwqbluAbsskf5qyq0hb0OgVlwe4tu85sPcjFZd1CVgN/l8htf8IrYrNRCohwexAK8oX3OxxTVT7wg8FdghctyPbYEP1iFQF04zNzBYQxpge+Cz9bxPzQJ2qYb+wWu+NyTaCzSKW2q+32v+gttDWRP1jMDTiOfpXYUllg4EmuFOrJ5JiS2xDPI1UZOAXTWgT3vNt4f8vIFmcRq63Wv+jCtQMyS1jsCnEM/E8haWZjO3qOrDqrp/u/sRAGwSIFqzbjjwj7W8cEgBuwQWftDFfxagMvpngLmqerNbmAm0CVci4ude87GquvNQr61lBP6cd90SrCJ6ERiO7d/7o6pe0KoY1UBDPI5lJS3Rg2mvKlUF7J4Gj/Ga7yjgtNk2wNXAC6r6+XZ3phtxmvqF1/wpl/2nIkONwFOI1x7+E/B0/d3LDXsBvwz+uG08hRWqLLEZySl4B6goYLdN6ASv+b8LOPomEfxxG3Be+F6v+cRqq3PVRuCjie9xWwM82nj3ckfwx+3hYeLzwqNITqoNVBfw8d7xg10aqB78cYa46kd+bM3kStcnCtjVRNgn2gQ81Gznck7wx9kxE9NciYluOreMSiOwr/g/iMjbiVd2H8Efp4wr3+XvaPcdAZAgYJeYz/ccIVwyTvDH6ePf8Y9x2oyRNALvD4yNHPdhKVED5QR/nB5PY7XoSmwD7OtflCRgf9n4/0I61CEJ/rjFuCSB/sBZNhsRE7DL4XqEd01Rlo2zIPjj1uJrb5JvI/wReCIwOnK8GpiXQseKTPDHrWMutv5QYix2txvAF7Bf42BOsA8NE/xxkzjtzfWaYxr1BezvNvbTxQfqJ/jj5njWO45pdEDALuqnN3JuE5asJNAagj9ujGeJL2rs4YpmAvER+EDiyakXplkeqUsJ/rhOXMXP16JNRFKaRQU80XtteHhLj+CP68PX4sB8cE9So+Pl1LoTKBH8cW34WowL2BUlHB+5QIE/pt+vgCP44+rMJ+6DJ7h49YEReE/io/Ebwf9mTvDHFRCR1dhO+BLDcOWLS6Lt9V7j1/gKZEfwx8ks9I4nwKCAd/dOLkq9O4GhCP44jp84vRcqj8BBwJ1D8MeGr8legB5Xn8CPdg9lAjqL4I/jOSMAxquq9ADbAtFfyJpQWbNj6Vp/7BKoR3PxbQmM7QHGedcuy6xXgUbpVn+83DselyRg/6JA59Jt/tjX5g5BwPmnm/xx4gjs5576S0adCbSWbvDHK7zj7XqI78AAy7weyC9F9serveNRSQIOS8jFoIj+2Bfw6CDgYlM0f+xrc3QPVnC52kWB/FMUf+yPwCN7sBysUT7IqDOB7Mm7P97gHW+eJOCwC7n45NUff+gdb5YkYP+iQDHJoz9OFPBwrzGMwN1FnvxxooADgRLvt7sD9dJD+Yjrj8iBYrMSmA7sLyL3tbszQ1Bmd4djw/Lm3kX+016gePQDtwAXi8if292ZGqko4ChhBC4+jwDfFpEX292ROqlJwBVLGgVyz0Lg3BxYhUr4MyUbeihfeRtFoGjkyedWoyzsYTgJ68sZdSaQPnn0udVIFHBZhE9GnQmkS159bjV8bb4XBFw88u5zq+Hb27XDMX8UZfuMOhNoLSuBa4AfugIpRWQH7/id4ZTvM9oxo84EWkPRfG41fG0uTxKwr/JA51JEn1sNX5uJAg4jcOdTZJ9bjbId9D3Au8SD2EdFaxAEOoqizOfWjapuC4yINL0PvNcjIgos9a7vzapjgZroB34C7C0i1xT4Ia0aE7zjJSIyUPUwMfNfoCN4BDhIRL7eBQ9p1ej1jhfBYODOYu+kr/ZA9nSrz63EeO94CQwK2B+B90y9O4FKdMN8biPs5R0vhkEBvwJsxGoPAOyqqqNCnYxM6ab53LpQ1dHAzpGmjcCr4DK0i8h64jZCgH0y6l8g+Nyh2Jd4Ec7XnWZjlYkq1uIKpMZCYIqIHNdFixGN4GvxpdIX1QScx8QXeaFr53Mb5EDveECr0e1Dz2PF5EpD9d6qOsbVqg20huBz60RVxxCvoqUkjcAishJ4PXKhAB9Pu4NdRPC5jXEIcf/7SrSGi58XYm7CiwPNEXxuc/ganBM98AU8xzs+TFXDLuXGCD63SZz2fAHHBllfwAuI79AYSbAR9RLiFlrHwcTT/67CKzkbE7CIbASe8t7kk6l0rZgEn9tajvaOZ4nIpmhDUm60Wd7xEarqJ5QIxAk+t8W4bJmHec2+NhMF/DwWI1xiBHB467pWKILPTY8jga0jx+8SmT4rUSZgFx/sK/2ElnYt/wSfmz7HecdPOG3GqJRedaZ3fKCq7tSSbuWf4HNTRlV3BA7wmh9KujZRwCKyBJuRGGgCjm9J7/JL8LnZMZn44sV8EfF3DQGVR2AoH4VPUNUtm+1ZDgk+N0NUdQvKLauvxQGqCfgJ4nnTRgHHNt613BF8bns4jngGnjUkzD6UqChgEfkA+I3XPFVVu6EsQfC5bcBp67Ne831Oi4kMJcb7iecP3hE4orHu5YLgc9vLJCA6WbAB02BFqgpYRN4FHveap6mqJF2fY4LPbTNu9D3Fa340GnmWRC124G4guny3G+VLfHkl+NzO4Rhg18jxRuBXQ71oSAGLyJvAY17zNFUdlnB5nngAOCD43PbjRt8ves2/E5E/DfXaWh/I7iJejuuj5HxeWEROFBF/G1WgPZwI7BI57gd+XssLaxKwiLwN/NZrPlVVRyRdHwjUiqqOBKZ5zQ+LyLJaXl/PlNidwPrI8RjgS3W8PhBIYhrxed/12B2/JmoWsIi8gz3QRTlJVXdJuj4QGApV3Q34W6/5F272qybqXZT4FfF8wsOBbxVwWi2QMk4z/0x8Z/wy4N563qcuAbtpplu95n0I4ZaB+jmR8oQlP613KrPuZWERmQX83ms+XVW3q/e9At2Jqm4PnOY1zxaR2fW+V6NxDTcCfZHjEQQrEaiBiHWI7rZYB/x7I+/XkICdyb7daz4ImNLI+wW6ipOBQ72220TkL428WTORZfcDL3htp6tqbxPvGSgwqro78E9e8zxsVbQhGhaw25/0r8DaSPPmwPldGvgeqIKqbgWcD0R3uK/BEnmX7XWrlaZie92wf4PXvBtwbvDDgRJOC+cQXy4G+HGj1qFE08HpIvIUFgAe5QjKA5MD3ctUyhPkzBSRJ5t941btrriJeGZLgDNU1c/rGugyVPUgyn3vq8DNrXj/lgjYbfn4PvG8asOA74aHuu7FLRVPZ7D2CpjvvapVsdct298mIiuAHxAPft8auERVt2nV9wnkA1dZ83vEq2sqcJ2I+OWNG6alGzRF5DnKl5rHAZe6p9BAF6CqWwOXUV6c+6ci8mwrv1fLdxiLyK8Bf1/ZnsCMML1WfFxeh0uBv/JOPSgidQXq1EJaW+R/Avjr2hOBi13WwUABcQmpLwQ+5p2agz3ot5xUBOxyuF5HPD0VWLLsC0K61uLh/qYXUb5MPB+42uWebjmpLja4LUdXAHt4p54HZpSK1QXyjbMNF2PxMFEWAReKyNryV7WG1FfLXJnQq7EVuigvAZeLyLq0+xBID/dccwnltdzeBKYPldehWVJPEyUiq7H/Tj+74H7AFWGKLb+4qbJrKBfvUuCitMULGYzAJdzu0xmUVx1/BxuJ/ZW8QAfjFim+R/lU2WvApVkVyMw04MZ54sspLyTeB1wpIvOy7E+gMdzy8HTiixRgD2yXi0hf+avSIfOIMeeZLgA+4Z3aiC2C3NtMeF0gPVxU2VQstsHPzPR74NqsH8zbEvLoUgmdCZyUcHo2FiOa2X9xYGjcwPMtksuuPQjclNZUWTXaGrOrqicDX03ox1Lsv3lx5p0KlOF2UpxPeTzvJuA/0lhhq5W2B52r6gHYL2esd+pD4A7gnmAp2oOzDFOAM4jvpACLKvuBiPj1tTOl7QIGUNVx2CqOv34OVhv3epcZKJARbuv7OZQvToDNNFzZyqiyRukIAcNAZcZvUF4fDGyW4mfAA2E0Thc36v4d9qC2dcIlM4GbOyWXcscIuISqTgLOJl7kucR84AYReSPbXnUHbm73bCzwymcNcKPbQtYxdJyAYeD29R3Ki92B5Y69D7grzFS0BrfIdAqW7ml4wiXzsJmhpjZgpkFHChhqupWtxpKrPNSO6Zsi4LLsnwCcSjzFaYl1wG10sHXrWAGXcOvtX8cq2CSxHPgvTMibKlwTiOAGh0nAl4GdK1z2DPCjThx1o3S8gEs4b/wVbItSEkuxxMizOnW0aDduAWkSZhd2rXDZMmxu9+nMOtYEuREwDET8n4jd8pJsBdiIfC82Iod4YwaCzY8CvkD5YkSJ9Vj+57s7ZYahFnIl4BLOVkwDPk3yQwfYU/ODmJDfzqpvnYSq7oQVzp5MsscFeyh+GHsorjkzeqeQSwGXUNUdsTodn6JybLNiO0BmYjloczO6NIKbTz8SqyK1P5X/xhuB32HCbfuCRKPkWsAlXJ2OqZiQq+23W4cFC80C5opIf5Vrc4OzCAdhNuFwKtsrsCX6R7El+iHrsHU6hRBwCbe74yTMJ1e6ZZbow56052JiTn33QCtR1bHAwcAh2EbKoUqercFS4t6Xt5+1GoUScAm3yfAo7Dbq12FIfAmWr+t5bLXvZbcVqmNQ1THYCtm+2Bae3ant7zcfeAh4slrV97xSSAFHccujx2P1nbet9WXAW1j1+iVY4sIlWT3kuHoj44EJQC+WGKaecmbvAk9gGSALvexeeAGXcJP3+2Ej8yTKwzdroQ+bJ12BTdetwFYE10Q+r8PiZPtL03guGHw49qC5NWZvRkc+74DNb5c+GqmAugrz9rOAl7plLrxrBBzFTejvhXnHQ7C8FXn7XSjwCvCs+1jYjSuRefujpYLzl/tj/nIi5i/9PV/tZiNmZV7Gcmq8mNXO304mCDgBd8vfA/OfvZgXHQ9klZxwPbAY89+L3NevhpXFcoKA68BN05V86g7Adgz62NGYd90KG72Hua8B3sdG0H5MnH2YZy755ncY9NTLijTNlTb/Dz+sKh/f1rAbAAAAAElFTkSuQmCC')";
Wa.style.backgroundSize="88px";kb=document.createElement("div");kb.style.position="relative";kb.style.height=Sb.offsetHeight.toString()+"px";kb.style.width=Sb.offsetWidth.toString()+"px";kb.style.background="rgba(0, 0, 0, 0.5)";kb.style.zIndex="999";e.appendChild(kb);kb.appendChild(Wa);Wa.addEventListener("click",function(){c.has_video_textures&&(ya.play(),ya.pause(),ya.reset());if(c.has_background_music){if(a==fb)for(var e=0;e<a.scenes.length;e++)z(a.scenes[e],c.id,!0);else z(m(),c.id,!0);ua.pause()}c.init_wa_context&&
ua.play_empty_sound();R();b(c,d)},!1)}function R(){if(Wa){var a=Sb.parentElement;a.style.zIndex=Ec;kb.removeChild(Wa);a.removeChild(kb);Wa=kb=null;Ec=0}}function U(a){(a=a.split("/").slice(0,-1).join("/"))&&(a+="/");return a}function ba(a,b,c){V.is_animated(b)&&V.remove(b);M.clear_outline_anim(b);qa.check_sensor_manifold(b)&&qa.remove_sensor_manifold(b);oa.obj_has_physics(b)&&oa.remove_bounding_object(b);va.remove_object_bundles(a,b,c);la.is_speaker(b)&&ua.speaker_remove(b);na.is_anchor(b)&&na.remove(b)}
function fa(a,b){if(!ab[b]){for(var c=a.scenes,d=[],e=0;e<c.length;e++)ja(c[e].objects,0,a==fb,d);ab[b]=[];for(e=0;e<d.length;e++)for(var g=d[e],c=0;c<g.length;c++)for(var f=g[c],k=0;k<f.length;k++)ab[b].push(f[k]);d=a.particles;for(e=0;e<d.length;e++){if(g=d[e].dupli_object)g._is_hair_dupli=!0,ab[b].push(g);if(c=d[e].dupli_group)for(f=c.objects,c=0;c<f.length;c++)g=f[c],g._is_hair_dupli=!0,ab[b].push(g)}}return ab[b]}function ja(a,b,c,d){d[b]=d[b]||[];for(var e=d[b],g=0;g<a.length;g++){var f=a[g],
k=pa(f);e[k]=e[k]||[];(c||-1==Uc.indexOf(f.type))&&-1==e[k].indexOf(f)&&e[k].push(f);(f=f.dupli_group)&&ja(f.objects,b+1,c,d)}}function pa(a){return(a=a.parent||V.get_bpy_armobj(a))?1+pa(a):0}var na=r("__anchors"),V=r("__animation"),E=r("__assets"),T=r("__batch");r("__camera");var da=r("__config"),qa=r("__controls"),O=r("__dds"),ga=r("__extensions");r("__lights");var ha=r("__loader"),ia=r("__mat4"),ma=r("__md5"),ca=r("__nla"),Z=r("__logic_nodes"),ta=r("__nodemat"),M=r("__objects"),la=r("__obj_util"),
oa=r("__physics"),J=r("__print"),Ua=r("__reformer"),Ea=r("__renderer"),va=r("__scenes"),ua=r("__sfx"),Fa=r("__shaders"),ya=r("__textures"),mc=r("__time"),Oa=r("__transform"),xa=r("__util"),Ba=r("__vec4"),Ga=da.defaults,ka=da.assets,fd=da.physics,ra=da.animation,xb=da.sfx,Ja=null,ab=null,Ia="",fb=null,ob={},Wa=null,kb=null,Ec=0,Uc=["LAMP","CAMERA"],Vc=["MESH","CAMERA","EMPTY"],Sb=null;a.is_primary_loaded=function(a){return ha.is_primary_loaded(a)};a.update=function(){ha.update_scheduler(Ja)};a.setup_canvas=
function(a){Sb=a};a.update_media_controls=function(a,b){if(Wa){kb.style.height=b.toString()+"px";kb.style.width=a.toString()+"px";var c=Math.round(b/2-44),d=Math.round(a/2-44);Wa.style.top=c.toString()+"px";Wa.style.left=d.toString()+"px"}};a.load=function(a,h,m,n,J){var q={load_main:{priority:ha.ASYNC_PRIORITY,background_loading:!1,inputs:[],is_resource:!1,relative_size:500,primary_only:!1,cb_before:b},duplicate_objects:{priority:ha.SYNC_PRIORITY,background_loading:!1,inputs:["load_main"],is_resource:!1,
relative_size:50,primary_only:!1,cb_before:B},load_binaries:{priority:ha.ASYNC_PRIORITY,background_loading:!1,inputs:["load_main"],is_resource:!1,relative_size:500,primary_only:!1,cb_before:l},wait_for_shaders:{priority:ha.ASYNC_PRIORITY,background_loading:!0,inputs:[],is_resource:!1,relative_size:50,primary_only:!0,cb_loop:c},prepare_bindata:{priority:ha.SYNC_PRIORITY,background_loading:!1,inputs:["duplicate_objects","load_binaries"],is_resource:!1,relative_size:0,primary_only:!1,cb_before:f},prepare_bpy_data:{priority:ha.SYNC_PRIORITY,
background_loading:!1,inputs:["duplicate_objects","prepare_bindata"],is_resource:!1,relative_size:100,primary_only:!1,cb_before:d},process_objects:{priority:ha.SYNC_PRIORITY,background_loading:!1,inputs:["prepare_bpy_data"],is_resource:!1,relative_size:100,primary_only:!1,cb_before:k},process_scenes:{priority:ha.SYNC_PRIORITY,background_loading:!1,inputs:["process_objects","wait_for_shaders"],is_resource:!1,relative_size:300,primary_only:!1,cb_before:e},load_smaa_textures:{priority:ha.ASYNC_PRIORITY,
background_loading:!0,inputs:["process_scenes"],is_resource:!1,relative_size:10,primary_only:!0,cb_before:P},load_shoremap:{priority:ha.ASYNC_PRIORITY,background_loading:!0,inputs:["process_scenes"],is_resource:!1,relative_size:10,primary_only:!0,cb_before:A},load_textures:{priority:ha.ASYNC_PRIORITY,background_loading:!0,inputs:["process_scenes"],is_resource:!0,relative_size:500,primary_only:!1,cb_before:p,cb_param:{image_counter:0}},update_scenes_nla:{priority:ha.SYNC_PRIORITY,background_loading:!1,
inputs:["process_scenes","load_textures"],is_resource:!1,relative_size:20,primary_only:!1,cb_before:g},wait_physics_workers:{priority:ha.ASYNC_PRIORITY,background_loading:!0,inputs:["load_shoremap"],is_resource:!1,relative_size:20,primary_only:!1,cb_loop:x},add_physics_objects:{priority:ha.SYNC_PRIORITY,background_loading:!1,inputs:["wait_physics_workers"],is_resource:!1,relative_size:20,primary_only:!1,cb_before:K},add_objects:{priority:ha.SYNC_PRIORITY,background_loading:!1,inputs:["add_physics_objects"],
is_resource:!1,relative_size:800,primary_only:!1,cb_before:S,cb_loop:ea,cb_after:aa,cb_param:{added_objects:[],obj_counter:0}},load_speakers:{priority:ha.ASYNC_PRIORITY,background_loading:!0,inputs:["add_objects"],is_resource:!0,relative_size:30,primary_only:!1,cb_before:v,cb_param:{sound_counter:0}},mobile_media_start:{priority:ha.SYNC_PRIORITY,background_loading:!Ga.is_mobile_device,inputs:["load_textures","update_scenes_nla","load_speakers"],is_resource:!0,relative_size:5,primary_only:!1,cb_before:Q,
cb_loop:Q},synchronize_media:{priority:ha.SYNC_PRIORITY,background_loading:!0,inputs:["mobile_media_start"],is_resource:!0,relative_size:70,primary_only:!1,cb_before:Y},start_nla:{priority:ha.SYNC_PRIORITY,background_loading:!0,inputs:["mobile_media_start"],is_resource:!1,relative_size:5,primary_only:!1,cb_before:F}},t=ha.get_scheduler();t||(t=ha.create_scheduler(),Ja={},ab={},ob={});Ja[t.threads.length]={};return ha.create_thread(q,a,h,m,u,n||xb.audio_loading_hack,Ga.do_not_load_resources,J)};a.unload=
function(a){var b=ha.get_scheduler();if(!b||!b.threads.length||a&&!ha.thread_is_finished(b.threads[a]))J.error("Unable to unload data!");else{if(0==a)J.log("%cUNLOAD ALL","color: #00a"),na.cleanup(),V.cleanup(),ua.cleanup(),ca.cleanup(),va.cleanup(),ha.cleanup(),oa.cleanup(),M.cleanup(),xa.cleanup(),Ea.cleanup(),ta.cleanup(),Fa.cleanup(),qa.cleanup(),ga.cleanup(),E.cleanup(),ya.cleanup(),Z.cleanup(),ab=null,ob={},Ja=fb=null;else{J.log("%cUNLOAD DATA "+a,"color: #00a");V.remove_actions(a);for(var b=
va.get_all_scenes(),c=0;c<b.length;c++)for(var d=b[c],e=M.get_scene_objs(d,"ALL",a),g=e.length-1;0<=g;g--){var f=e[g];ba(d,f,!0);e.splice(g,1);var k=M.get_scene_objs(d,f.type,a),f=k.indexOf(f);-1!=f&&k.splice(f,1)}}R()}};a.prepare_object_unloading=ba;a.set_debug_resources_root=function(a){Ia=a}};b4w.module.__batch=function(a,r){function u(a){a={type:a,subtype:"",id:0,render_id:0,odd_id_prop:"",textures:[],texture_names:[],material_names:[],common_attributes:[],uv_maps_usage:null,vertex_colors_usage:{},shader:null,shaders_info:{vert:null,frag:null,directives:[],node_elements:[]},attribute_setters:[],particle_system:null,bufs_data:null,use_shape_keys:!1,debug_sphere:!1,debug_sphere_dynamic:!1,wireframe_mode:0,num_vertices:0,num_triangles:0,jitter_amp:0,jitter_freq:0,grass_scale_threshold:0,
grass_size:0,grass_map_dim:new Float32Array(3),cube_fog:new Float32Array(16),alpha_clip:!1,blend:!1,color_mask:!1,depth_mask:!1,xray:!1,use_backface_culling:!1,use_shadeless:!1,dynamic_geometry:!1,shadow_cast:!1,shadow_cast_only:!1,shadow_receive:!1,reflexible:!1,reflexible_only:!1,reflective:!1,dynamic_grass:!1,procedural_sky:!1,draw_mode:ba.DM_DEFAULT,zsort_type:ba.ZSORT_DISABLED,can_fork_outline:!1,forked_batch:!1,psys_name:"",shadow_source:"",halo:!1,halo_size:0,halo_hardness:0,halo_stars_blend:0,
halo_stars_height:0,halo_rings_color:new Float32Array(3),halo_lines_color:new Float32Array(3),halo_particles:!1,ambient:0,emit:0,diffuse_intensity:1,reflect_factor:0,specular_color_factor:0,specular_alpha:1,parallax_scale:0,diffuse_color_factor:0,alpha_factor:1,normal_factor:0,mirror_factor:0,offset_z:0,refr_bump:0,diffuse_params:Array(2),specular_params:new Float32Array(3),texture_scale:new Float32Array(3),specular_color:new Float32Array(3),diffuse_color:new Float32Array(4),fresnel_params:new Float32Array(4),
lamp_uuid_indexes:null,lamp_light_positions:null,lamp_light_directions:null,lamp_light_color_intensities:null,lamp_light_factors:null,has_nodes:!1,water:!1,water_dynamic:!1,water_shore_smoothing:!1,water_generated_mesh:!1,water_num_cascads:0,water_subdivs:0,water_detailed_dist:0,water_norm_uv_velocity:.1,shallow_water_col_fac:0,shore_water_col_fac:0,foam_factor:0,foam_uv_freq:new Float32Array(2),foam_mag:new Float32Array(2),foam_scale:new Float32Array(2),shallow_water_col:new Float32Array(3),shore_water_col:new Float32Array(3),
normalmap_scales:null,refractive:!1,particles_data:null};a.diffuse_color[3]=1;a.color_mask=!0;a.depth_mask=!0;return a}function h(a){switch(a.type){case "MAIN":case "PARTICLES":a.subtype=a.blend?a.xray?"XRAY":"BLEND":"OPAQUE";break;case "DEPTH":a.subtype=a.has_nodes?"NODES":"DEPTH";break;case "COLOR_ID":a.subtype=a.xray?"COLOR_ID_XRAY":"COLOR_ID"}}function b(a){var b=a.bufs_data;a.bufs_data=null;var c=pa.copy_object_props_by_value(a);a.bufs_data=b;c.bufs_data=b;return c}function l(a,b){for(var c=
[],d=0;d<a.length;d++){var e=a[d],g=e.temp_bpy_obj,k=e.render,h=Y.zero_bounding_box();Y.copy_bb(k.bb_original,h);var m=g.data.b4w_bounding_cylinder_radius,l=g.data.b4w_bounding_sphere_radius,p=g.data.b4w_bounding_sphere_center,q=g.data.b4w_bounding_ellipsoid_axes,g=g.data.b4w_bounding_ellipsoid_center;if(k.billboard){var m=Math.max(Math.abs(h.max_x),Math.abs(h.min_x)),l=Math.max(Math.abs(h.max_y),Math.abs(h.min_y)),t=Math.max(Math.abs(h.max_z),Math.abs(h.min_z)),t=Math.sqrt(m*m+l*l+t*t),m=Math.sqrt(m*
m+l*l);h.max_x=h.max_y=h.max_z=t;h.min_x=h.min_y=h.min_z=-t;l=t;p[0]=p[1]=p[2]=0;q[0]=q[1]=q[2]=t;g[0]=g[1]=g[2]=0}k.bb_local=h;t=Y.bounding_box_transform(h,k.world_matrix);k.bb_world=t;n(k,m,m,h);h=Y.create_bounding_sphere(l,p);k.bs_local=h;h=Y.bounding_sphere_transform(h,k.world_matrix);k.bs_world=h;q=Y.create_bounding_ellipsoid([q[0],0,0],[0,q[1],0],[0,0,q[2]],g);k.be_local=q;q=Y.bounding_ellipsoid_transform(q,k.tsr);k.be_world=q;c=c.concat(f(e,k,b))}return c}function c(a,b,c){for(var d=[],e=[],
g={},k=0;k<a.length;k++){var h=a[k],m=h.temp_bpy_obj,l=h.render,p=Y.zero_bounding_box();Y.copy_bb(l.bb_original,p);var n=Y.bounding_box_transform(p,l.world_matrix),q=Y.create_bounding_sphere(m.data.b4w_bounding_sphere_radius,m.data.b4w_bounding_sphere_center),t=Y.bounding_sphere_transform(q,l.world_matrix),v=m.data.b4w_bounding_ellipsoid_axes,m=Y.create_bounding_ellipsoid([v[0],0,0],[0,v[1],0],[0,0,v[2]],m.data.b4w_bounding_ellipsoid_center),v=Y.bounding_ellipsoid_transform(m,l.tsr);l.bb_local=p;
l.bb_world=n;l.bs_local=q;l.bs_world=t;l.be_local=m;l.be_world=v;p={};p.shadow_cast=l.shadow_cast;p.shadow_cast_only=l.shadow_cast_only;p.shadow_receive=l.shadow_receive;p.selectable=l.selectable;p.origin_selectable=l.origin_selectable;p.outlining=l.outlining;p.origin_outlining=l.origin_outlining;p.outline_anim_settings_default=l.outline_anim_settings_default;p.reflexible=l.reflexible;p.reflexible_only=l.reflexible_only;p.reflective=l.reflective;p.cube_reflection_id=l.cube_reflection_id;p.plane_reflection_id=
l.plane_reflection_id;p.reflection_type=l.reflection_type;p.caustics=l.caustics;p.wind_bending=l.wind_bending;p.main_bend_col=l.main_bend_col;p.detail_bend_col=l.detail_bend_col;p.billboard=l.billboard;p.billboard_type=l.billboard_type;p.billboard_spherical=l.billboard_spherical;p.dynamic_grass=l.dynamic_grass;p.do_not_cull=l.do_not_cull;p.disable_fogging=l.disable_fogging;p.mats_values=l.mats_values;p.mats_value_inds=l.mats_value_inds;p.mats_anim_inds=l.mats_anim_inds;p.mats_rgbs=l.mats_rgbs;p.mats_rgb_inds=
l.mats_rgb_inds;p.mats_rgb_anim_inds=l.mats_rgb_anim_inds;p.dynamic_geometry=l.dynamic_geometry;n=l.bs_world.center;p.grid_id=0==c?[0,0]:[Math.floor(n[0]/c),Math.floor(n[2]/c)];p.lod_dist_max=l.lod_dist_max;p.lod_dist_min=l.lod_dist_min;p.lod_transition_ratio=l.lod_transition_ratio;p.do_not_render=l.do_not_render;l=JSON.stringify(p);g[l]=g[l]||[];g[l].push(h)}for(var E in g){p=JSON.parse(E);c=g[E];var h=pa.create_render("STATIC"),A;for(A in p)h[A]=p[A];h.data_id=a[0].render.data_id;h.wind_bending_amp=
0;h.wind_bending_freq=0;h.detail_bending_freq=0;h.detail_bending_amp=0;h.branch_bending_amp=0;h.hide=!1;for(k=0;k<c.length;k++)l=c[k],0==k?(h.bb_world=ia.clone_object_r(l.render.bb_world),h.bs_world=ia.clone_object_r(l.render.bs_world),h.be_local=ia.clone_object_r(l.render.be_local),h.be_world=ia.clone_object_r(l.render.be_world)):(Y.expand_bounding_box(h.bb_world,l.render.bb_world),Y.expand_bounding_sphere(h.bs_world,l.render.bs_world));h.bb_local=ia.clone_object_r(h.bb_world);h.bs_local=ia.clone_object_r(h.bs_world);
e.push({render:h,objects:c})}for(a=0;a<e.length;a++)for(g=e[a].render,k=e[a].objects,E=0;E<k.length;E++){A=k[E];c=A.temp_bpy_obj;h=f(A,g,b);A.render.billboard&&!A.render.billboard_pres_glob_orientation?(l=ha.create(),ha.set_trans(A.render.trans,l)):(l=A.render,l=ha.create_sep(l.trans,l.scale,l.quat));p={};if(g.wind_bending||g.billboard)p.au_center_pos=[l[0],l[1],l[2]];g.wind_bending&&(p.au_wind_bending_amp=[A.render.wind_bending_amp],p.au_wind_bending_freq=[c.b4w_wind_bending_freq],p.au_detail_bending_amp=
[c.b4w_detail_bending_amp],p.au_detail_bending_freq=[c.b4w_detail_bending_freq],p.au_branch_bending_amp=[c.b4w_branch_bending_amp]);for(n=0;n<h.length;n++)m=h[n].render,q=h[n].submesh,t=h[n].batch,m.is_hair_particles?m.billboard?ba.submesh_apply_particle_transform(q,l):ba.submesh_apply_transform(q,l):("COLOR_ID"==t.type&&(m=h[n].render=A.render,t.odd_id_prop=c.uuid,D(t,m),m=L(m),F(t,m,0)),q=ba.submesh_apply_transform(q,l),ba.submesh_apply_params(q,p));d=d.concat(h)}return d}function f(a,b,c){var e=
a.temp_bpy_obj,g=[],f=q(c,b),k=L(b),h=e.data,m=h.materials,l=Array(m.length),p=qa.find_subs(c,"MAIN_OPAQUE"),n=!1;p&&(n=p.light_positions.length?!0:!1);for(var t=0;t<f.length;t++)for(var E=f[t],A=0;A<m.length;A++){var r=m[A];if(("LENS_FLARES"!=r.name||n)&&!ba.has_empty_submesh(h,A)){var B=u(E);"COLOR_ID"==E&&(B.can_fork_outline=!(e.b4w_do_not_render||r.b4w_do_not_render));"MAIN"==E&&(l[A]=B);if(H(B,r)){"DEPTH"==E&&l[A]&&(B.use_shadeless=l[A].use_shadeless);B.draw_mode=b.use_shape_keys||b.dynamic_geometry?
ba.DM_DYNAMIC_TRIANGLES:ba.DM_DEFAULT;D(B,b);for(var x=B,w=e.particle_systems,y=0;y<w.length;y++){var da=w[y].settings.b4w_vcol_from_name,C=w[y].settings.b4w_vcol_to_name;""!==da&&""!==C&&(x.vertex_colors_usage[da]={generate_buffer:!1,src:[{name:da,mask:7}]})}"DYNAMIC"==b.type&&(B.odd_id_prop=e.uuid);F(B,k);var P=ba.extract_submesh(h,A,B.common_attributes,b.bone_skinning_info,B.vertex_colors_usage,B.uv_maps_usage);"LENS_FLARES"==r.name&&(P=na.prepare_lens_flares(P));g.push({batch:B,submesh:P,mat_names:[r.name],
render:b,rel_objects:[a]})}}}var K=e.particle_systems;if(0<K.length&&g.length){for(var G=!1,S=!1,t=0;t<K.length;t++){var N=K[t],I=N.settings;I.use_render_emitter&&(G=!0);"HAIR"!=I.type||"OBJECT"!=I.render_type&&"GROUP"!=I.render_type&&N.transforms.length||(S=!0);if(G&&S)break}var ga=g[0].batch.vertex_colors_usage;if(S)if(1<m.length){for(var ea,M={},aa=0;aa<K.length;aa++){var ha=K[aa].settings;if("HAIR"==ha.type&&("OBJECT"==ha.render_type||"GROUP"==ha.render_type)){var pa=ha.b4w_vcol_from_name,V=ha.b4w_vcol_to_name;
""!==pa&&""!==V&&(M[pa]=ia.clone_object_r(ga[pa]))}}"a_bending_col_main"in ga&&(M.a_bending_col_main=ia.clone_object_r(ga.a_bending_col_main));"a_bending_col_detail"in ga&&(M.a_bending_col_detail=ia.clone_object_r(ga.a_bending_col_detail));ea=ba.extract_submesh_all_mats(h,[],M)}else ea=g[0].submesh;else ea=null;for(var Q,Y=ea,ca=a.temp_bpy_obj,U=[],X=ca.particle_systems,ja=ca.data,oa=0;oa<X.length;oa++){var fa=X[oa],la=fa.settings;if(la.count)if("EMITTER"==la.type){if("DYNAMIC"==b.type){var ta=u("PARTICLES"),
Va,Ca=ja.materials,jc=fa.settings.material-1;jc>=Ca.length&&(R.warn('Wrong material used for rendering particle system "'+fa.name+'"'),jc=0);Va=Ca[jc];"HALO"===fa.settings.render_type&&(ta.halo_particles=!0);d(ta,Va);var yb=ta,za=fa.settings;switch(za.b4w_billboard_align){case "VIEW":v(yb,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW");break;case "XY":v(yb,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_XY");break;case "YZ":v(yb,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_YZ");break;case "ZX":v(yb,"BILLBOARD_ALIGN","BILLBOARD_ALIGN_ZX");
break;default:throw"Wrong billboard align value";}v(yb,"BILLBOARD",0);v(yb,"SOFT_PARTICLES",za.b4w_enable_soft_particles&&0<za.b4w_particles_softness&&Z.depth_tex_available?1:0);v(yb,"SOFT_STRENGTH",O.glsl_value(za.b4w_particles_softness));O.set_directive(yb.shaders_info,"WORLD_SPACE","WORLD"==za.b4w_coordinate_system?1:0);ta.dynamic_geometry=!0;ta.odd_id_prop=a.name+"_"+la.uuid;ta.psys_name=fa.name;F(ta,k);na.init_particles_data(ta,fa,Va);var qc=na.generate_emitter_particles_submesh(ta,ja,fa,a.render.tsr);
U.push({batch:ta,submesh:qc,mat_names:[Va.name],render:b,rel_objects:[a]})}}else if("HAIR"==la.type){var W=ia.init_rand_r_seed(fa.seed);la.b4w_dynamic_grass&&(b.do_not_cull=!0);var qb=T.check_particles_bin_format(Z.loaded_data_version)&&!la.b4w_initial_rand_rotation&&!la.b4w_hair_billboard,Ka=4;qb&&(Ka=8);if(fa.transforms.length)var sa=fa.transforms;else for(var Aa=ba.geometry_random_points(Y,la.count,!1,W),sa=new Float32Array(Aa.length*Ka),Ha=0;Ha<Aa.length;Ha++){var Ub=.75+.5*ia.rand_r(W);sa[Ha*
Ka]=Aa[Ha][0];sa[Ha*Ka+1]=Aa[Ha][1];sa[Ha*Ka+2]=Aa[Ha][2];sa[Ha*Ka+3]=Ub;qb&&(sa[Ha*Ka+4]=1,sa[Ha*Ka+5]=0,sa[Ha*Ka+6]=0,sa[Ha*Ka+7]=0)}var bb=qa.find_subs(c,"GRASS_MAP")?!0:!1;if("OBJECT"==la.render_type)var gb=[q(c,la.dupli_object._object.render,!0)],Ib=z(a,b,ga,Y,[la.dupli_object._object],gb,[sa],la,fa,bb,W,!1),U=U.concat(Ib);else if("GROUP"==la.render_type){for(var ub=[],rc=la.dupli_group.objects,Ha=0;Ha<rc.length;Ha++)ub.push(rc[Ha]._object);for(var sc=!1,gb=[],Ha=0;Ha<ub.length;Ha++){var cc=
q(c,la.dupli_group.objects[Ha]._object.render,!0);gb.push(cc)}if(la.use_whole_group){for(var Qa,Cb=sa,Vb=ub,Nc=qb,Jb=Ka,rb={},Db=new Float32Array([0,0,0,1]),Ma=0;Ma<Cb.length;Ma+=Jb)for(var hb=0;hb<Vb.length;hb++){var Kb=ma.create();ma.scale(Vb[hb].render.trans,Vb[hb].render.scale,Kb);var vb=ma.clone([Cb[Ma],Cb[Ma+1],Cb[Ma+2]]);rb[hb]||(rb[hb]=new Float32Array(Cb.length));Nc&&(rb[hb][Ma+4]=Db[0]=Cb[Ma+4],rb[hb][Ma+5]=Db[1]=Cb[Ma+5],rb[hb][Ma+6]=Db[2]=Cb[Ma+6],rb[hb][Ma+7]=Db[3]=Cb[Ma+7],ia.quat_bpy_b4w(Db,
Db),ia.transformQuatFast(Kb,Db,Kb));ma.add(vb,Kb,vb);rb[hb][Ma]=vb[0];rb[hb][Ma+1]=vb[1];rb[hb][Ma+2]=vb[2];rb[hb][Ma+3]=Cb[Ma+3]}Qa=rb;sc=!0}else{var tc;if(la.use_group_count){for(var Eb=sa,Lb=ub,kc=la.dupli_weights,uc=W,Da=qb,sb=Ka,cb={},Pb=[],La=0;La<Lb.length;La++)for(var ib=Lb[La],dc=ib.origin_name||ib.name,wa=0;wa<kc.length;wa++){var db=kc[wa];dc==db.name&&Pb.push(db)}kc.length!=Pb.length&&R.error("dupli weights match failed");for(La=0;La<Eb.length;La+=sb){for(var Xa,jb=Pb,Na=[0],lb=0;lb<jb.length;lb++)Na[lb+
1]=Na[lb]+jb[lb].count;for(var zc=Na[Na.length-1]*ia.rand_r(uc),Wb=0,lb=0;lb<Na.length;lb++)if(zc>=Na[lb]&&zc<Na[lb+1]){Wb=lb;break}Xa=Wb;cb[Xa]=cb[Xa]||[];cb[Xa].push(Eb[La],Eb[La+1],Eb[La+2],Eb[La+3]);Da&&cb[Xa].push(Eb[La+4],Eb[La+5],Eb[La+6],Eb[La+7])}for(Xa in cb)cb[Xa]=new Float32Array(cb[Xa]);tc=cb}else{for(var wb=sa,Ac=W,Ya=qb,Qb=Ka,Fb=ub.length,tb={},Ra=0;Ra<wb.length;Ra+=Qb){var mb=Math.floor(Fb*ia.rand_r(Ac));tb[mb]=tb[mb]||[];tb[mb].push(wb[Ra],wb[Ra+1],wb[Ra+2],wb[Ra+3]);Ya&&tb[mb].push(wb[Ra+
4],wb[Ra+5],wb[Ra+6],wb[Ra+7])}for(mb in tb)tb[mb]=new Float32Array(tb[mb]);tc=tb}Qa=tc}Ib=z(a,b,ga,Y,ub,gb,Qa,la,fa,bb,W,sc);U=U.concat(Ib)}"INSTANCE"==la.b4w_wind_bend_inheritance&&a.render.wind_bending&&R.warn('Emitter object "'+a.name+"\" has a particle system with wind bending inheritance from the particle instance. Wind bending on the emitter isn't disabled. Expect unforeseen behavior.")}else throw"Unknown particle settings type";}Q=U;g=G?g.concat(Q):Q}return g}function n(a,b,c,d){a.bcyl_local=
Y.create_bounding_cylinder(b,d);a.bcap_local=Y.create_bounding_capsule(c,d);a.bcon_local=Y.create_bounding_cone(b,d)}function q(a,b,c){var d;b.do_not_render&&!c?(d=[],b.selectable&&qa.find_subs(a,"COLOR_PICKING")&&d.push("COLOR_ID")):(d=["MAIN","NODES_GLOW"],(b.selectable&&qa.find_subs(a,"COLOR_PICKING")||b.outlining&&qa.find_subs(a,"OUTLINE_MASK"))&&!c&&d.push("COLOR_ID"),qa.find_subs(a,"WIREFRAME")&&d.push("WIREFRAME"),(qa.find_subs(a,"DEPTH")||qa.find_subs(a,"SHADOW_CAST"))&&d.push("DEPTH"),qa.find_subs(a,
"GRASS_MAP")&&d.push("GRASS_MAP"));d.push("PHYSICS");if(b.shadow_cast_only||b.reflexible_only)for(a=null,b.shadow_cast_only&&(a=["MAIN","NODES_GLOW","COLOR_ID","PHYSICS","WIREFRAME"]),b.reflexible_only&&(b=["COLOR_ID","PHYSICS","DEPTH","WIREFRAME"],a=null!==a?ia.array_intersect(a,b):b),b=a,a=0;a<b.length;a++)c=d.indexOf(b[a]),-1!==c&&d.splice(c,1);return d}function d(a,b,c){switch(a.type){case "MAIN":if(b.b4w_do_not_render)a=!1;else{if(b.use_nodes)t(a,b,"MAIN");else{e(a,b);var d=b.game_settings.alpha_blend;
a.xray=b.b4w_render_above_all&&"OPAQUE"!=d&&"CLIP"!=d;a.offset_z=b.offset_z;a.texture_scale.set([1,1,1]);var g=b.texture_slots;ca.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.diffuse_color);switch(b.name){case "LENS_FLARES":K(a,"special_lens_flares.glslv","special_lens_flares.glslf");y(a,"a_position");y(a,"a_texcoord");var f=c?[1,1,1,0]:null,f=m(g[0],f);A(a,f);break;default:K(a,"main_stack.glslv","main_stack.glslf");if(!b.use_shadeless){var h=ja.create_lighting_graph(b.uuid,
b.name,{use_shadeless:b.use_shadeless,diffuse_shader:b.diffuse_shader,specular_shader:b.specular_shader});a.shaders_info.node_elements=ja.compose_node_elements(h)}var l=B("use_map_color_diffuse",!0,g),p=B("use_map_color_spec",!0,g),n=B("use_map_normal",!0,g),q=B("use_map_mirror",!0,g),f=B("use_stencil",!0,g),h=l[0],p=p[0],n=n[0],q=q[0],l=l[1],g=f[0]&&B("use_rgb_to_intensity",!0,g)[0];if(h){switch(h.blend_type){case "MIX":v(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":v(a,
"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}f="IMAGE"==h.texture._render.source&&c?[a.diffuse_color[0],a.diffuse_color[1],a.diffuse_color[2],1]:"ENVIRONMENT_MAP"==h.texture._render.source&&c?[.8,.8,.8,1]:null;f=m(h,f);A(a,f,"u_colormap0");Z.alpha_clip_filtering_hack&&"CLIP"==d&&ga.set_filters(f,ga.TF_NEAREST,ga.TF_NEAREST);a.diffuse_color_factor=h.diffuse_color_factor;a.alpha_factor=h.use_map_alpha?h.alpha_factor:0;a.texture_scale.set(h.scale)}d=h&&h==p;p&&(d||(f=c?[.5,.5,.5,1]:null,f=m(p,
f),A(a,f,"u_specmap0")),a.specular_color_factor=p.specular_color_factor);if(n&&(y(a,"a_normal"),y(a,"a_tangent"),f=c?[.5,.5,1,1]:null,f=m(n,f),A(a,f,"u_normalmap0"),a.normal_factor=n.normal_factor,f=n.texture,f.b4w_use_map_parallax&&Z.parallax)){var E=O.glsl_value(f.b4w_parallax_steps),r=O.glsl_value(f.b4w_parallax_lod_dist);v(a,"PARALLAX",1);v(a,"PARALLAX_STEPS",E);v(a,"PARALLAX_LOD_DIST",r);a.parallax_scale=f.b4w_parallax_scale}q&&(f=c?[0,0,.5,1]:null,f=m(q,f),A(a,f,"u_mirrormap"),a.mirror_factor=
q.mirror_factor);if(q=h&&l&&g?1:0)f=c?[.8,.8,.8,1]:null,f=m(l,f),A(a,f,"u_colormap1"),f=c?[.5,.5,.5,1]:null,f=m(g,f),A(a,f,"u_stencil0");(c=h||p||n)&&a.texture_scale.set(c.scale);v(a,"TEXTURE_SPEC",void 0==p?0:1);v(a,"ALPHA_AS_SPEC",d?1:0);v(a,"TEXTURE_STENCIL_ALPHA_MASK",q);y(a,"a_position");y(a,"a_normal");(h||p||n)&&y(a,"a_texcoord");if(b.b4w_water){a.water=!0;a.water_dynamic=b.b4w_water_dynamic;b.b4w_water_shore_smoothing&&!a.blend?(R.warn('Material: "'+b.name+'" is opaque.',"Disabling shore smoothing."),
a.water_shore_smoothing=!1):a.water_shore_smoothing=b.b4w_water_shore_smoothing;K(a,"special_water.glslv","special_water.glslf");c=ja.create_lighting_graph(b.uuid,b.name,{use_shadeless:!1,diffuse_shader:b.diffuse_shader,specular_shader:b.specular_shader});a.shaders_info.node_elements=ja.compose_node_elements(c);y(a,"a_position");Z.water_wireframe_debug?(y(a,"a_polyindex"),a.depth_mask=!0,a.wireframe_edge_color=[0,0,0],v(a,"DEBUG_WIREFRAME",1)):v(a,"DEBUG_WIREFRAME",0);d=b.texture_slots;c=B("use_map_normal",
!0,d);q=B("use_map_mirror",!0,d)[0];c.length&&(f=m(c[0]),A(a,f,"u_normalmap0"),a.water_norm_uv_velocity=b.b4w_water_norm_uv_velocity);v(a,"NUM_NORMALMAPS",c.length);a.normalmap_scales=Array(c.length);for(f=0;f<c.length;f++)a.normalmap_scales[f]=new Float32Array(2),a.normalmap_scales[f].set([c[f].scale[0],c[f].scale[1]]);q&&(f=m(q),A(a,f,"u_mirrormap"),a.mirror_factor=q.mirror_factor);q=null;if(Z.foam)for(f=0;f<d.length;f++){var u=d[f];if(!0===u.texture.b4w_water_foam){q=u;break}}q?(v(a,"FOAM",1),
f=m(q),A(a,f,"u_foam"),a.foam_factor=b.b4w_foam_factor,a.foam_uv_freq.set(q.texture.b4w_foam_uv_freq),a.foam_mag.set(q.texture.b4w_foam_uv_magnitude),a.foam_scale[0]=q.scale[0],a.foam_scale[1]=q.scale[1]):v(a,"FOAM",0);for(f=0;f<d.length;f++)if(u=d[f],!0===u.texture.b4w_shore_dist_map){var x=u;break}x&&Z.allow_vertex_textures?(x=m(x),A(a,x,"u_shore_dist_map"),v(a,"SHORE_PARAMS",1),x=u.texture.b4w_shore_boundings,v(a,"MAX_SHORE_DIST",O.glsl_value(u.texture.b4w_max_shore_dist)),v(a,"SHORE_MAP_SIZE_X",
O.glsl_value(x[0]-x[1])),v(a,"SHORE_MAP_SIZE_Y",O.glsl_value(x[2]-x[3])),v(a,"SHORE_MAP_CENTER_X",O.glsl_value((x[0]+x[1])/2)),v(a,"SHORE_MAP_CENTER_Y",O.glsl_value((x[2]+x[3])/2))):v(a,"SHORE_PARAMS",0);if(b.b4w_generated_mesh&&Z.depth_tex_available)v(a,"GENERATED_MESH",1),a.water_generated_mesh=!0,a.water_num_cascads=b.b4w_water_num_cascads,a.water_subdivs=b.b4w_water_subdivs,a.water_detailed_dist=b.b4w_water_detailed_dist;else{y(a,"a_normal");if(q||c.length)y(a,"a_texcoord"),y(a,"a_tangent");v(a,
"GENERATED_MESH",0)}if(b.b4w_water_dynamic){u=O.glsl_value(b.b4w_water_dst_noise_scale0);x=O.glsl_value(b.b4w_water_dst_noise_scale1);c=O.glsl_value(b.b4w_water_dst_noise_freq0);var d=O.glsl_value(b.b4w_water_dst_noise_freq1),q=O.glsl_value(b.b4w_water_dir_min_shore_fac),f=O.glsl_value(b.b4w_water_dir_freq),E=O.glsl_value(b.b4w_water_dir_noise_scale),r=O.glsl_value(b.b4w_water_dir_noise_freq),T=O.glsl_value(b.b4w_water_dir_min_noise_fac),F=O.glsl_value(b.b4w_water_dst_min_fac),z=O.glsl_value(b.b4w_water_waves_hor_fac);
v(a,"DST_NOISE_SCALE_0",u);v(a,"DST_NOISE_SCALE_1",x);v(a,"DST_NOISE_FREQ_0",c);v(a,"DST_NOISE_FREQ_1",d);v(a,"DIR_MIN_SHR_FAC",q);v(a,"DIR_FREQ",f);v(a,"DIR_NOISE_SCALE",E);v(a,"DIR_NOISE_FREQ",r);v(a,"DIR_MIN_NOISE_FAC",T);v(a,"DST_MIN_FAC",F);v(a,"WAVES_HOR_FAC",z)}G(a,b);w(a,b);a.shallow_water_col.set(b.b4w_shallow_water_col);a.shore_water_col.set(b.b4w_shore_water_col);a.shallow_water_col_fac=b.b4w_shallow_water_col_fac;a.shore_water_col_fac=b.b4w_shore_water_col_fac;v(a,"ABSORB",O.glsl_value(b.b4w_water_absorb_factor));
v(a,"SSS_STRENGTH",O.glsl_value(b.b4w_water_sss_strength));v(a,"SSS_WIDTH",O.glsl_value(b.b4w_water_sss_width))}"HALO"===b.type&&(u=b.halo,K(a,"halo.glslv","halo.glslf"),v(a,"NUM_RINGS",u.ring_count),v(a,"NUM_LINES",u.line_count),v(a,"NUM_STARS",u.star_tip_count),v(a,"SKY_STARS",b.b4w_halo_sky_stars?1:0),a.common_attributes=["a_position"],a.halo_size=u.size,a.halo_hardness=u.hardness/20,a.halo_rings_color.set(u.b4w_halo_rings_color),a.halo_lines_color.set(u.b4w_halo_lines_color),a.halo_stars_blend=
1/b.b4w_halo_stars_blend_height,a.halo_stars_height=b.b4w_halo_stars_min_height,a.halo=!0);v(a,"TEXCOORD",0);v(a,"NORMAL_TEXCOORD",0);h&&k(a,h,"TEXTURE_COLOR0_CO");l&&k(a,l,"TEXTURE_COLOR1_CO");g&&k(a,g,"TEXTURE_STENCIL_ALPHA_MASK_CO");p&&k(a,p,"TEXTURE_SPEC_CO");n&&k(a,n,"TEXTURE_NORM_CO");v(a,"SHADELESS",b.use_shadeless?1:0);a.use_shadeless=b.use_shadeless}d=b.game_settings.alpha_blend;v(a,"ALPHA","OPAQUE"===d?0:1);v(a,"ALPHA_CLIP","CLIP"===d?1:0);v(a,"DOUBLE_SIDED_LIGHTING",b.b4w_double_sided_lighting?
1:0);b.use_vertex_color_paint?(v(a,"VERTEX_COLOR",1),y(a,"a_color")):v(a,"VERTEX_COLOR",0);a.ambient=b.ambient;a.diffuse_intensity=b.diffuse_intensity;a.emit=b.emit;a.specular_color.set(b.specular_color);a.specular_alpha=b.specular_alpha;G(a,b);w(a,b);b.b4w_wettable?v(a,"WETTABLE",1):v(a,"WETTABLE",0);N(a,b);a.refractive=b.b4w_refractive;a.refr_bump=b.b4w_refr_bump}a=!0}break;case "NODES_GLOW":a=t(a,b,"GLOW");break;case "DEPTH":if("LENS_FLARES"===b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===
b.type)a=!1;else if(e(a,b),a.blend)a=!1;else{h=b.game_settings.alpha_blend;b.use_nodes&&"CLIP"==h?t(a,b,"DEPTH"):(K(a,"depth.glslv","depth.glslf"),ca.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.diffuse_color));y(a,"a_position");y(a,"a_normal");v(a,"ALPHA","OPAQUE"===h?0:1);a.texture_scale.set([1,1,1]);if((b=B("use_map_color_diffuse",!0,b.texture_slots)[0])&&"CLIP"===h){a.texture_scale.set(b.scale);v(a,"TEXTURE_COLOR",1);y(a,"a_texcoord");if("IMAGE"==b.texture._render.source||
"ENVIRONMENT_MAP"==b.texture._render.source)h=m(b),A(a,h,"u_colormap0");"NONE"==b.texture._render.source&&(h=m(b),A(a,h,"u_colormap0"))}else v(a,"TEXTURE_COLOR",0);a=!0}break;case "PHYSICS":b.b4w_collision?(a.use_ghost=b.b4w_use_ghost,a.collision_id=b.b4w_collision_id,a.collision_margin=b.b4w_collision_margin,a.collision_group=b.b4w_collision_group,a.collision_mask=b.b4w_collision_mask,a.friction=b.physics.friction,a.elasticity=b.physics.elasticity,a=!0):b.b4w_water?(a.water=!0,a.water_dynamics=b.b4w_water_dynamic,
a.dst_noise_scale0=b.b4w_water_dst_noise_scale0,a.dst_noise_scale1=b.b4w_water_dst_noise_scale1,a.dst_noise_freq0=b.b4w_water_dst_noise_freq0,a.dst_noise_freq1=b.b4w_water_dst_noise_freq1,a.dir_min_shore_fac=b.b4w_water_dir_min_shore_fac,a.dir_freq=b.b4w_water_dir_freq,a.dir_noise_scale=b.b4w_water_dir_noise_scale,a.dir_noise_freq=b.b4w_water_dir_noise_freq,a.dir_min_noise_fac=b.b4w_water_dir_min_noise_fac,a.dst_min_fac=b.b4w_water_dst_min_fac,a.waves_hor_fac=b.b4w_water_waves_hor_fac,a=!0):a=!1;
break;case "COLOR_ID":if("LENS_FLARES"===b.name||"HALO"===b.type)a=!1;else{e(a,b);a.zsort_type=ba.ZSORT_DISABLED;a.depth_mask=!0;a.blend=!1;h=b.game_settings.alpha_blend;a.xray=b.b4w_render_above_all&&"OPAQUE"!=h&&"CLIP"!=h;b.use_nodes&&"CLIP"==h?t(a,b,"COLOR_ID"):(K(a,"color_id.glslv","color_id.glslf"),ca.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.diffuse_color));y(a,"a_position");v(a,"ALPHA","OPAQUE"===h?0:1);a.texture_scale.set([1,1,1]);if((b=B("use_map_color_diffuse",
!0,b.texture_slots)[0])&&"CLIP"===h){a.texture_scale.set(b.scale);v(a,"TEXTURE_COLOR",1);y(a,"a_texcoord");if("IMAGE"==b.texture._render.source||"ENVIRONMENT_MAP"==b.texture._render.source)h=m(b),A(a,h,"u_colormap0");"NONE"==b.texture._render.source&&(h=m(b),A(a,h,"u_colormap0"))}else v(a,"TEXTURE_COLOR",0);a=!0}break;case "GRASS_MAP":!b.b4w_terrain||b.b4w_do_not_render?a=!1:(e(a,b),a.blend=!1,a.zsort_type=ba.ZSORT_DISABLED,a.depth_mask=!0,K(a,"grass_map.glslv","grass_map.glslf"),y(a,"a_position"),
h=b.b4w_dynamic_grass_size?b.b4w_dynamic_grass_size:null,b=b.b4w_dynamic_grass_color?b.b4w_dynamic_grass_color:null,a.vertex_colors_usage.a_grass_size={generate_buffer:!0,src:[]},h?(a.vertex_colors_usage.a_grass_size.src.push({name:h,mask:4}),v(a,"DYNAMIC_GRASS_SIZE",1)):v(a,"DYNAMIC_GRASS_SIZE",0),a.vertex_colors_usage.a_grass_color={generate_buffer:!0,src:[]},b?(a.vertex_colors_usage.a_grass_color.src.push({name:b,mask:7}),v(a,"DYNAMIC_GRASS_COLOR",1)):v(a,"DYNAMIC_GRASS_COLOR",0),a=!0);break;case "WIREFRAME":"LENS_FLARES"===
b.name||b.b4w_water||b.b4w_do_not_render||"HALO"===b.type?a=!1:(K(a,"wireframe.glslv","wireframe.glslf"),y(a,"a_position"),y(a,"a_normal"),y(a,"a_polyindex"),a.depth_mask=!0,a.wireframe_mode=0,a.wireframe_edge_color=[0,0,0],a=!0);break;case "PARTICLES":if(b.b4w_do_not_render)a=!1;else{h=b.texture_slots;if(a.halo_particles)K(a,"particles_color.glslv","particles_color.glslf");else if(K(a,"particles_texture.glslv","particles_texture.glslf"),p=ja.create_lighting_graph(b.uuid,b.name,{use_shadeless:!1,
diffuse_shader:b.diffuse_shader,specular_shader:b.specular_shader}),a.shaders_info.node_elements=ja.compose_node_elements(p),h=B("use_map_color_diffuse",!0,h)[0]){v(a,"TEXTURE_COLOR",1);switch(h.blend_type){case "MIX":v(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX");break;case "MULTIPLY":v(a,"TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY")}a.diffuse_color_factor=h.diffuse_color_factor;a.alpha_factor=h.use_map_alpha?h.alpha_factor:0;h=m(h);A(a,h)}ca.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],
b.alpha,a.diffuse_color);a.ambient=b.ambient;a.diffuse_intensity=b.diffuse_intensity;a.emit=b.emit;a.specular_color.set(b.specular_color);a.specular_alpha=b.specular_alpha;y(a,"a_position");y(a,"a_normal");h=b.game_settings.alpha_blend;v(a,"ALPHA","OPAQUE"===h?0:1);v(a,"ALPHA_CLIP","CLIP"===h?1:0);v(a,"PARTICLES_SHADELESS",b.use_shadeless?1:0);G(a,b);w(a,b);e(a,b);h=b.game_settings.alpha_blend;a.xray=b.b4w_render_above_all&&"OPAQUE"!=h&&"CLIP"!=h;a.offset_z=b.offset_z;a=!0}break;default:throw"Wrong batch type: "+
a.type;}return a}function k(a,b,c){switch(b.texture_coords){case "UV":case "ORCO":v(a,c,"TEXTURE_COORDS_UV_ORCO");v(a,"TEXCOORD",1);break;case "NORMAL":v(a,c,"TEXTURE_COORDS_NORMAL");v(a,"NORMAL_TEXCOORD",1);break;default:v(a,c,0)}}function e(a,b){var c=b.game_settings,d=c.alpha_blend;switch(d){case "ALPHA_SORT":a.blend=!0;a.zsort_type=ba.ZSORT_BACK_TO_FRONT;a.depth_mask=!0;a.alpha_clip=!1;break;case "ALPHA":a.blend=!0;a.zsort_type=ba.ZSORT_DISABLED;a.depth_mask=!0;a.alpha_clip=!1;break;case "CLIP":a.blend=
!1;a.zsort_type=ba.ZSORT_DISABLED;a.depth_mask=!0;a.alpha_clip=!0;break;case "ADD":a.blend=!0;a.zsort_type=ba.ZSORT_DISABLED;a.depth_mask=!1;a.alpha_clip=!1;break;case "OPAQUE":a.blend=!1;a.zsort_type=ba.ZSORT_DISABLED;a.depth_mask=!0;a.alpha_clip=!1;break;default:throw Error("Unknown alpha blend mode: "+d);}a.use_backface_culling=c.use_backface_culling}function m(a,b){var c=a.texture,d=c._render,c=c.image;d&&b&&c&&ga.update_texture(d,b,c._is_dds,c.filepath);return d}function B(a,b,c){for(var d=[],
e=c.length,g=0;g<e;g++){var f=c[g];f[a]==b&&f.texture&&f.texture._render&&d.push(f)}return d}function N(a,b){var c=b.raytrace_transparency;a.fresnel_params[0]=c.fresnel;a.fresnel_params[1]=1-c.fresnel_factor/5;c=b.raytrace_mirror;a.reflect_factor=c.reflect_factor;a.fresnel_params[2]=c.fresnel;a.fresnel_params[3]=1-c.fresnel_factor/5}function G(a,b){var c,d=0;switch(b.specular_shader){case "PHONG":case "COOKTORR":c=b.specular_hardness;break;case "WARDISO":c=b.specular_slope;break;case "TOON":c=b.specular_toon_size;
d=b.specular_toon_smooth;break;case "BLINN":c=b.specular_ior;d=b.specular_hardness;break;default:R.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.name+'")'),c=b.specular_hardness}a.specular_params[0]=b.specular_intensity;a.specular_params[1]=c;a.specular_params[2]=d}function w(a,b){switch(b.diffuse_shader){case "LAMBERT":a.diffuse_params[0]=0;a.diffuse_params[1]=0;break;case "OREN_NAYAR":a.diffuse_params[0]=b.roughness;a.diffuse_params[1]=0;break;case "FRESNEL":a.diffuse_params[0]=
b.diffuse_fresnel;a.diffuse_params[1]=b.diffuse_fresnel_factor;break;case "MINNAERT":a.diffuse_params[0]=b.darkness;a.diffuse_params[1]=0;break;case "TOON":a.diffuse_params[0]=b.diffuse_toon_size;a.diffuse_params[1]=b.diffuse_toon_smooth;break;default:R.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.name+'")'),a.diffuse_params[0]=0,a.diffuse_params[1]=0}}function t(a,b,c){if(!b.use_nodes||b.b4w_do_not_render)return!1;var d;switch(c){case "MAIN":K(a,"main.glslv","main.glslf");
d=!1;break;case "GLOW":K(a,"main.glslv","main.glslf");d=!0;break;case "DEPTH":K(a,"depth.glslv","depth.glslf");d=!1;break;case "COLOR_ID":K(a,"color_id.glslv","color_id.glslf"),d=!1}c=ja.compose_nmat_graph(b.node_tree,b.uuid,!1,b.name,c);if(!c)return R.error('Failed to create node graph for material "'+b.name+'", disable nodes'),C(a,b),!0;a.has_nodes=!0;v(a,"NODES",1);v(a,"NODES_GLOW",d?1:0);var g=b.game_settings.alpha_blend;v(a,"ALPHA","OPAQUE"===g?0:1);v(a,"ALPHA_CLIP","CLIP"===g?1:0);v(a,"DOUBLE_SIDED_LIGHTING",
b.b4w_double_sided_lighting?1:0);y(a,"a_position");b.use_orco_tex_coord&&y(a,"a_orco_tex_coord");e(a,b);a.offset_z=b.offset_z;g=b.game_settings.alpha_blend;a.xray=b.b4w_render_above_all&&"OPAQUE"!=g&&"CLIP"!=g;ca.set(b.diffuse_color[0],b.diffuse_color[1],b.diffuse_color[2],b.alpha,a.diffuse_color);a.emit=b.emit;a.ambient=b.ambient;N(a,b);b.b4w_wettable?v(a,"WETTABLE",1):v(a,"WETTABLE",0);a.shaders_info.node_elements=ja.compose_node_elements(c);var f=!1;fa.traverse(c,function(b,c){switch(c.type){case "UVMAP":case "TEX_COORD_UV":case "GEOMETRY_UV":case "UV_MERGED":var d=
c.data.name,e=c.data.value;a.uv_maps_usage||(a.uv_maps_usage={});a.uv_maps_usage[e]=d;break;case "GEOMETRY_VC":case "GEOMETRY_VC1":case "GEOMETRY_VC2":case "GEOMETRY_VC3":d=c.data.name;a.vertex_colors_usage[d]={generate_buffer:!0,src:[{name:c.data.value}]};e=0;if("GEOMETRY_VC"==c.type)e=7;else for(var k=0;k<c.outputs.length;k++){var h="RGB".indexOf(c.outputs[k].identifier);-1<h&&(e|=1<<2-h)}a.vertex_colors_usage[d].src[0].mask=e;break;case "TEX_COORD_NO":case "GEOMETRY_NO":y(a,"a_normal");break;case "MATERIAL_BEGIN":y(a,
"a_normal");f=!0;break;case "TEXTURE_COLOR":case "TEXTURE_ENVIRONMENT":d=c.data.name;e=c.data.value;!1!==e._render.allow_node_dds&&(e._render.allow_node_dds="TEXTURE_ENVIRONMENT"!=c.type?!0:!1);A(a,e._render,d);Z.alpha_clip_filtering_hack&&"CLIP"==g&&ga.set_filters(c.data.value._render,ga.TF_NEAREST,ga.TF_NEAREST);break;case "TEXTURE_NORMAL":case "B4W_PARALLAX":v(a,"CALC_TBN_SPACE",1);y(a,"a_normal");y(a,"a_tangent");d=c.data.name;e=c.data.value;e._render.allow_node_dds=!1;A(a,e._render,d);break;
case "LAMP":c.data&&(a.lamp_uuid_indexes=c.data);break;case "B4W_REFRACTION":a.refractive=!0}});f||(a.use_shadeless=!0);return!0}function C(a,b){switch(a.type){case "DEPTH":K(a,"depth.glslv","depth.glslf");break;case "COLOR_ID":K(a,"color_id.glslv","color_id.glslf");break;default:K(a,"main_stack.glslv","main_stack.glslf")}v(a,"SHADELESS",1);y(a,"a_position");y(a,"a_normal");ca.set(1,0,1,1,a.diffuse_color);if(b){var c=b.game_settings.alpha_blend;v(a,"ALPHA","OPAQUE"===c?0:1);v(a,"ALPHA_CLIP","CLIP"===
c?1:0);v(a,"VERTEX_COLOR",0);a.offset_z=b.offset_z;e(a,b)}return!0}function D(a,b){if("PHYSICS"!==a.type){"DYNAMIC"==b.type?(b.is_hair_particles?v(a,"AU_QUALIFIER","attribute"):v(a,"AU_QUALIFIER","uniform"),v(a,"STATIC_BATCH",0)):(v(a,"AU_QUALIFIER","attribute"),v(a,"STATIC_BATCH",1));"WIREFRAME"==a.type&&(U.get_standard_derivatives()?v(a,"WIREFRAME_QUALITY",1):v(a,"WIREFRAME_QUALITY",0),a.debug_sphere?(v(a,"DEBUG_SPHERE",1),a.debug_sphere_dynamic?v(a,"DEBUG_SPHERE_DYNAMIC",1):v(a,"DEBUG_SPHERE_DYNAMIC",
0)):v(a,"DEBUG_SPHERE",0),v(a,"ALPHA",1));b.use_shape_keys&&(a.use_shape_keys=b.use_shape_keys);b.wind_bending?(""!==b.main_bend_col?(a.vertex_colors_usage.a_bending_col_main={generate_buffer:!0,src:[{name:b.main_bend_col,mask:4}]},y(a,"a_bending_col_main"),""!==b.detail_bend_col.leaves_stiffness&&""!==b.detail_bend_col.leaves_phase&&""!==b.detail_bend_col.overall_stiffness?(a.vertex_colors_usage.a_bending_col_detail={generate_buffer:!0,src:[{name:b.detail_bend_col.leaves_stiffness,mask:4},{name:b.detail_bend_col.leaves_phase,
mask:2},{name:b.detail_bend_col.overall_stiffness,mask:1}]},y(a,"a_bending_col_detail"),y(a,"a_normal"),v(a,"DETAIL_BEND",1)):v(a,"DETAIL_BEND",0),v(a,"MAIN_BEND_COL",1)):v(a,"MAIN_BEND_COL",0),v(a,"WIND_BEND",1)):v(a,"WIND_BEND",0);b.bend_center_only?v(a,"BEND_CENTER_ONLY",1):v(a,"BEND_CENTER_ONLY",0);v(a,"BILLBOARD_PRES_GLOB_ORIENTATION",b.billboard_pres_glob_orientation|0);b.billboard?v(a,"BILLBOARD",1):v(a,"BILLBOARD",0);b.billboard&&b.is_hair_particles?v(a,"HAIR_BILLBOARD",1):v(a,"HAIR_BILLBOARD",
0);b.billboard_spherical?v(a,"BILLBOARD_SPHERICAL",1):v(a,"BILLBOARD_SPHERICAL",0);switch(b.billboard_type){case "RANDOM":v(a,"BILLBOARD_RANDOM",1);v(a,"BILLBOARD_JITTERED",0);break;case "JITTERED":v(a,"BILLBOARD_RANDOM",0);v(a,"BILLBOARD_JITTERED",1);break;default:v(a,"BILLBOARD_RANDOM",0),v(a,"BILLBOARD_JITTERED",0)}b.dynamic_grass&&Z.allow_vertex_textures?v(a,"DYNAMIC_GRASS",1):v(a,"DYNAMIC_GRASS",0);a.dynamic_grass=b.dynamic_grass;a.dynamic_geometry=b.dynamic_geometry;a.shadow_cast=b.shadow_cast;
a.shadow_cast_only=b.shadow_cast_only;a.shadow_receive=b.shadow_receive&&!a.use_shadeless&&!(a.blend&&Z.disable_blend_shadows_hack);a.reflexible=b.reflexible;a.reflexible_only=b.reflexible_only;a.reflective=b.reflective;b.is_skinning?(y(a,"a_influence"),v(a,"SKINNED",1),b.frames_blending?v(a,"FRAMES_BLENDING",1):v(a,"FRAMES_BLENDING",0),v(a,"MAX_BONES",b.max_bones)):(v(a,"SKINNED",0),v(a,"FRAMES_BLENDING",0));b.vertex_anim?(v(a,"VERTEX_ANIM",1),Z.vert_anim_mix_normals_hack?v(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR",
.5):v(a,"VERTEX_ANIM_MIX_NORMALS_FACTOR","u_va_frame_factor")):v(a,"VERTEX_ANIM",0);if(b.is_skinning&&b.vertex_anim)throw"Skinning and vertex animation are mutually exlusive";b.disable_fogging?v(a,"DISABLE_FOG",1):v(a,"DISABLE_FOG",0);if(a.has_nodes){for(var c=a.shaders_info.node_elements,d=b.mats_value_inds,e=b.mats_rgb_inds,g=0;g<c.length;g++){var f=c[g];switch(f.id){case "VALUE":var k=f.param_values[0];if(k)for(var h=0;h<d.length;h+=2)if(d[h]==k){f.dirs.push(["VALUE_IND",d[h+1]]);break}break;case "RGB":if(k=
f.param_values[0])for(h=0;h<e.length;h+=2)if(e[h]==k){f.dirs.push(["RGB_IND",e[h+1]]);break}}}v(a,"NUM_VALUES",b.mats_values.length);v(a,"NUM_RGBS",b.mats_rgbs.length)}}}function p(a,b,c){if(b.length){for(var d=pa.get_first_lamp_with_shadows(b)||b[0],e=a.shaders_info,f=0,k=0;k<a.shaders_info.node_elements.length;k++){var h=a.shaders_info.node_elements[k];if("LIGHTING_LAMP"==h.id){var m=b[f++%b.length],l=m.light;"AREA"==l.type&&(m=b[f++%b.length],l=m.light);var p=pa.get_scene_data(m,c);if("SPOT"==
l.type||"POINT"==l.type)var n=Math.cos(l.spot_size/2);if("SPOT"==l.type)var q=l.spot_blend*(1-n);p=p.light_index;m=m==d?0:-1;h.dirs=[["LAMP_TYPE",l.type],["LAMP_IND",p],["LAMP_LIGHT_FACT_IND",Math.floor(p/2)],["LAMP_FAC_CHANNELS",0==p%2?"rg":"ba"],["LAMP_SPOT_SIZE",O.glsl_value(n||.01)],["LAMP_SPOT_BLEND",O.glsl_value(q||.01)],["LAMP_LIGHT_DIST",O.glsl_value(l.distance)],["LAMP_SHADOW_MAP_IND",m]]}}if(a.lamp_uuid_indexes){c=0;for(var t in a.lamp_uuid_indexes)c++;a.lamp_light_positions=new Float32Array(3*
c);a.lamp_light_directions=new Float32Array(3*c);a.lamp_light_color_intensities=new Float32Array(3*c);a.lamp_light_factors=new Float32Array(4*c);O.set_directive(e,"NUM_LAMP_LIGHTS",c);for(k=0;k<b.length;k++)g(a,b[k])}}}function g(a,b){var c=b.temp_bpy_obj.uuid;if(c in a.lamp_uuid_indexes){c=a.lamp_uuid_indexes[c];a.lamp_light_positions.set(b.render.trans,3*c);a.lamp_light_directions.set(b.light.direction,3*c);a.lamp_light_color_intensities.set(b.light.color_intensity,3*c);var d=la,e=b.light;d[0]=
-1;d[1]=-1;d[2]=-1;d[3]=e.use_specular?1:0;switch(e.type){case "POINT":d[2]=e.distance;break;case "SPOT":d[2]=e.distance;var g=d[0]=Math.cos(e.spot_size/2);d[1]=e.spot_blend*(1-g)}a.lamp_light_factors.set(d,4*c)}}function y(a,b){var c=a.common_attributes;-1==c.indexOf(b)&&c.push(b)}function v(a,b,c){O.set_directive(a.shaders_info,b,c)}function I(a,b){if("PHYSICS"==a.type)a.submesh=b;else{var c=a.zsort_type,d=a.draw_mode;a.halo&&(b=ba.extract_halo_submesh(b));a.water_generated_mesh&&(b=V.generate_multigrid(a.water_num_cascads,
a.water_subdivs,a.water_detailed_dist));c=ba.submesh_to_bufs_data(b,c,d,a.vertex_colors_usage);a.bufs_data=c;a.dynamic_geometry||c.info_for_z_sort_updates||a.use_shape_keys||(c.ibo_array=null,c.vbo_array=null);c=b.va_frames.length;a.num_vertices=b.base_length*c;a:switch(a.draw_mode){case ba.DM_DEFAULT:case ba.DM_TRIANGLES:case ba.DM_DYNAMIC_TRIANGLES:d=!0;break a;default:d=!1}d?ba.is_indexed(b)?a.num_triangles=b.indices.length/3*c:a.num_triangles=b.base_length/3*c:a.num_triangles=0}}function z(a,
b,c,d,e,g,f,k,h,m,l,p){var n=[],q=k.b4w_dynamic_grass;if(!m&&q)return n;for(var t="INSTANCE"==k.b4w_wind_bend_inheritance,v="INSTANCE"==k.b4w_shadow_inheritance,A="INSTANCE"==k.b4w_reflection_inheritance,r=[],B=[],x=0;x<e.length;x++){var w=e[x],y=ia.clone_object_nr(b);y.billboard=k.b4w_hair_billboard;y.billboard_type=k.b4w_hair_billboard_type;y.billboard_spherical="SPHERICAL"==k.b4w_hair_billboard_geometry;y.dynamic_grass=q;y.is_hair_particles=!0;y.mats_values=w.render.mats_values;y.mats_value_inds=
w.render.mats_value_inds;y.mats_rgbs=w.render.mats_rgbs;y.mats_rgb_inds=w.render.mats_rgb_inds;t?(y.wind_bending=w.render.wind_bending,y.wind_bending_angle=w.render.wind_bending_angle,y.wind_bending_freq=w.render.wind_bending_freq,y.detail_bending_freq=w.render.detail_bending_freq,y.main_bend_col=w.render.main_bend_col,y.detail_bending_amp=w.render.detail_bending_amp,y.branch_bending_amp=w.render.branch_bending_amp,y.wind_bending_amp=w.render.wind_bending_amp,y.detail_bend_col=w.render.detail_bend_col,
y.bend_center_only=!1):(y.wind_bending=a.render.wind_bending,y.wind_bending_angle=a.render.wind_bending_angle,y.wind_bending_freq=a.render.wind_bending_freq,y.detail_bending_freq=a.render.detail_bending_freq,y.main_bend_col=a.render.main_bend_col,y.detail_bending_amp=a.render.detail_bending_amp,y.branch_bending_amp=a.render.branch_bending_amp,y.wind_bending_amp=a.render.wind_bending_amp,y.detail_bend_col=a.render.detail_bend_col,y.bend_center_only=!0);v?(y.shadow_cast=w.render.shadow_cast,y.shadow_cast_only=
w.render.shadow_cast_only,y.shadow_receive=w.render.shadow_receive):(y.shadow_cast=a.render.shadow_cast,y.shadow_cast_only=a.render.shadow_cast_only,y.shadow_receive=a.render.shadow_receive);A?(y.reflexible=w.render.reflexible,y.reflexible_only=w.render.reflexible_only,y.reflective=w.render.reflective,y.cube_reflection_id=w.render.cube_reflection_id,y.plane_reflection_id=w.render.plane_reflection_id,y.reflection_type=w.render.reflection_type):(y.reflexible=a.render.reflexible,y.reflexible_only=a.render.reflexible_only,
y.reflective=a.render.reflective,y.cube_reflection_id=a.render.cube_reflection_id,y.plane_reflection_id=a.render.plane_reflection_id,y.reflection_type=a.render.reflection_type);r.push(y);var z=f[x];z||(z=new Float32Array);p&&ia.init_rand_r_seed(h.seed,l);var da=new Float32Array(3),C=new Float32Array([0,0,0,1]),O=[],P=T.check_particles_bin_format(Z.loaded_data_version)&&!k.b4w_initial_rand_rotation&&!k.b4w_hair_billboard,K=4;P&&(K=8);for(var G=0;G<z.length;G+=K){da[0]=z[G];da[1]=z[G+1];da[2]=z[G+2];
var qa=z[G+3]*w.render.scale;if(k.b4w_initial_rand_rotation){switch(k.b4w_rotation_type){case "XYZ":var S=new Float32Array([ia.rand_r(l),ia.rand_r(l),ia.rand_r(l)]);ma.normalize(S,S);break;case "Z":S=new Float32Array([0,1,0]);break;default:throw"Unsupported random rotation type: "+k.b4w_rotation_type;}E.setAxisAngle(S,k.b4w_rand_rotation_strength*(2*Math.PI*ia.rand_r(l)-Math.PI),C)}else P&&(C.set(z.subarray(G+4,G+8)),ia.quat_bpy_b4w(C,C),k.use_whole_group||(k.use_rotation_dupli?E.multiply(C,w.render.quat,
C):E.multiply(C,M,C)));var N=ha.create_sep(da,qa,C);O.push(N)}B.push(O)}for(var I={},x=0;x<e.length;x++){var w=e[x],ga=w.temp_bpy_obj,ea=g[x],y=r[x],aa={};y.wind_bending&&(aa.au_wind_bending_amp=[y.wind_bending_amp],aa.au_wind_bending_freq=[y.wind_bending_freq],aa.au_detail_bending_freq=[y.detail_bending_freq],aa.au_detail_bending_amp=[y.detail_bending_amp],aa.au_branch_bending_amp=[y.branch_bending_amp],y.wind_bending_amp=0,y.wind_bending_freq=0,y.detail_bending_freq=0,y.detail_bending_amp=0,y.branch_bending_amp=
0);var pa=L(y),O=B[x];if(O.length)for(var V=ga.data,Q=V.materials,na=Array(Q.length),G=0;G<Q.length;G++)if(!ba.has_empty_submesh(V,G))for(var Y=0;Y<ea.length;Y++){var U=ea[Y],X=u(U),ja=Q[G];"COLOR_ID"==U&&(X.can_fork_outline=!(ga.b4w_do_not_render||ja.b4w_do_not_render));"MAIN"==U&&(na[G]=X);if(H(X,ja)){"DEPTH"==U&&na[G]&&(X.use_shadeless=na[G].use_shadeless);X.draw_mode=ba.DM_DEFAULT;D(X,y);X.odd_id_prop=k.uuid;"JITTERED"==k.b4w_hair_billboard_type&&(X.jitter_amp=k.b4w_hair_billboard_jitter_amp,
X.jitter_freq=k.b4w_hair_billboard_jitter_freq);q&&(X.grass_scale_threshold=k.b4w_dynamic_grass_scale_threshold);t||(delete X.vertex_colors_usage.a_bending_col_main,delete X.vertex_colors_usage.a_bending_col_detail);F(X,pa);var la=ba.extract_submesh(V,G,X.common_attributes,b.bone_skinning_info,X.vertex_colors_usage,X.uv_maps_usage),fa=ba.make_clone_submesh(la,aa,O),oa=fa,ta=O;oa.va_common.au_center_pos=new Float32Array(3*oa.base_length);for(var yb=ta.length,za=oa.base_length/yb,qc=0;qc<yb;qc++)for(var W=
ta[qc],qb=3*za*qc,Ka=0;Ka<za;Ka++)oa.va_common.au_center_pos[qb+3*Ka]=W[0],oa.va_common.au_center_pos[qb+3*Ka+1]=W[1],oa.va_common.au_center_pos[qb+3*Ka+2]=W[2];fa=oa;if(y.wind_bending&&y.bend_center_only){var sa=fa,Aa=a.render.world_matrix;sa.va_common.a_emitter_center=new Float32Array(3*sa.base_length);var Ha=ca.fromValues(0,0,0,1);ca.transformMat4(Ha,Aa,Ha);for(var Ub=0;Ub<sa.base_length;Ub++)sa.va_common.a_emitter_center[3*Ub]=Ha[0],sa.va_common.a_emitter_center[3*Ub+1]=Ha[1],sa.va_common.a_emitter_center[3*
Ub+2]=Ha[2];fa=sa}var bb=k.b4w_vcol_from_name,gb=k.b4w_vcol_to_name,Ib=X,ub=c,rc=!t,sc=V,cc=[];if(""!==bb&&""!==gb){var Qa,Cb=gb,Vb=Ib.vertex_colors_usage,Nc=[],Jb=void 0;for(Jb in Vb)for(var rb=Vb[Jb].src,Db=0,Ma=0;Ma<rb.length;Ma++){var hb=rb[Ma].mask;Cb==rb[Ma].name&&Nc.push(Jb,hb,Db);Db+=ia.rgb_mask_get_channels_count(hb)}Qa=Nc;if(0<Qa.length)for(var Kb=0;Kb<Qa.length;Kb+=3)cc.push({emitter_attr:bb,emitter_mask:7,particle_attr:Qa[Kb],particle_mask:Qa[Kb+1],dst_channel_offset:Qa[Kb+2]});else ba.has_attr(Ib.common_attributes,
"a_color")&&gb==sc.active_vcol_name&&cc.push({emitter_attr:bb,emitter_mask:7,particle_attr:"a_color",particle_mask:7,dst_channel_offset:0})}rc&&("a_bending_col_main"in ub&&cc.push({emitter_attr:"a_bending_col_main",emitter_mask:4,particle_attr:"a_bending_col_main",particle_mask:4,dst_channel_offset:0}),"a_bending_col_detail"in ub&&cc.push({emitter_attr:"a_bending_col_detail",emitter_mask:7,particle_attr:"a_bending_col_detail",particle_mask:7,dst_channel_offset:0}));for(var vb=fa,tc=O,Eb=d,Lb=cc,kc=
X.vertex_colors_usage,uc=!1,Da=0;Da<Lb.length;Da++){var sb=Lb[Da].emitter_attr,cb=Eb.va_common[sb];if(cb&&0<cb.length){uc=!0;break}}if(uc){var Pb,La=a.render.bb_local,ib=Eb.va_frames[0].a_position,dc=tc,wa=I,db=new Float32Array(3),Xa=new Float32Array(3),jb=new Uint32Array(dc.length);if(!("verts_indices"in wa)){wa.cell_size=new Float32Array(3);wa.base_point=new Float32Array(3);wa.verts_indices=new Uint32Array(ib.length/3);wa.octs_indices=new Uint32Array(ib.length/3);wa.cell_size[0]=(La.max_x-La.min_x)/
20;wa.cell_size[1]=(La.max_y-La.min_y)/20;wa.cell_size[2]=(La.max_z-La.min_z)/20;wa.base_point[0]=La.min_x;wa.base_point[1]=La.min_y;wa.base_point[2]=La.min_z;for(var Na=0;Na<ib.length/3;Na++){var lb=ib[3*Na+1],zc=ib[3*Na+2],Wb=ia.trunc((ib[3*Na]-wa.base_point[0])/wa.cell_size[0]),wb=ia.trunc((lb-wa.base_point[1])/wa.cell_size[1]),Ac=ia.trunc((zc-wa.base_point[2])/wa.cell_size[2]),Wb=ia.clamp(Wb,0,19),wb=ia.clamp(wb,0,19),Ac=ia.clamp(Ac,0,19);wa.verts_indices[Na]=Na;wa.octs_indices[Na]=Ac*Math.pow(20,
2)+20*wb+Wb}ba.sort_two_arrays(wa.octs_indices,wa.verts_indices,ba.SORT_NUMERIC,!0);wa.verts_offsets=new Uint32Array(Math.pow(20,3));for(Na=0;Na<wa.octs_indices.length;Na++)wa.verts_offsets[wa.octs_indices[Na]]++;delete wa.octs_indices;for(Na=1;Na<wa.verts_offsets.length;Na++)wa.verts_offsets[Na]+=wa.verts_offsets[Na-1]}for(var Ya=0;Ya<dc.length;Ya++){db[0]=dc[Ya][0];db[1]=dc[Ya][1];db[2]=dc[Ya][2];for(var Qb=1E10,Fb=-1,tb=ia.trunc((db[0]-wa.base_point[0])/wa.cell_size[0]),Ra=ia.trunc((db[1]-wa.base_point[1])/
wa.cell_size[1]),mb=ia.trunc((db[2]-wa.base_point[2])/wa.cell_size[2]),tb=ia.clamp(tb,0,19),Ra=ia.clamp(Ra,0,19),mb=ia.clamp(mb,0,19),Mb=mb*Math.pow(20,2)+20*Ra+tb,Oc=wa.verts_offsets[Mb],eb=0==Mb?0:wa.verts_offsets[Mb-1];eb<Oc;eb++){var Pa=wa.verts_indices[eb];Xa[0]=ib[3*Pa];Xa[1]=ib[3*Pa+1];Xa[2]=ib[3*Pa+2];ma.sub(Xa,db,Xa);var Gb=ma.sqrLen(Xa);Gb<=Qb&&(Qb=Gb,Fb=Pa)}if(-1==Fb)for(eb=0;eb<ib.length/3;eb++)Xa[0]=ib[3*eb],Xa[1]=ib[3*eb+1],Xa[2]=ib[3*eb+2],ma.sub(Xa,db,Xa),Gb=ma.sqrLen(Xa),Gb<=Qb&&
(Qb=Gb,Fb=eb);jb[Ya]=Fb}Pb=jb;for(var Nb=vb.base_length/tc.length,Da=0;Da<Lb.length;Da++){var Sa=Lb[Da].particle_attr,zb=Lb[Da].particle_mask,sb=Lb[Da].emitter_attr,nb=Lb[Da].emitter_mask,cb=Eb.va_common[sb];switch(Sa){case "a_bending_col_main":var Hb=1;break;case "a_bending_col_detail":Hb=3;break;case "a_color":Hb=3;break;default:for(var Ab=Hb=0;Ab<kc[Sa].src.length;Ab++)Hb+=ia.rgb_mask_get_channels_count(kc[Sa].src[Ab].mask)}if(cb&&0<cb.length){var vc=ia.rgb_mask_get_channels_count(nb),Bc=ia.rgb_mask_get_channels_count(zb),
wc=nb&zb,ec=ia.rgb_mask_get_channels_presence(wc);wc!=zb&&R.error("Wrong color extraction from "+sb+" to "+Sa+".");if("a_bending_col_main"==Sa||"a_bending_col_detail"==Sa)vb.va_common[Sa]=new Float32Array(vb.base_length*Bc);for(Ab=0;Ab<tc.length;Ab++){var Rb=Pb[Ab],Xb=Rb*vc,xc=Ab*Nb*Hb;if(-1!=Rb)for(var Ta=0;Ta<Nb;Ta++)for(var $a=Ta*Hb,fc=0;fc<ec.length;fc++)if(ec[fc]){var Cc=ia.rgb_mask_get_channel_presence_index(nb,fc),Yb=Lb[Da].dst_channel_offset+ia.rgb_mask_get_channel_presence_index(zb,fc);vb.va_common[Sa][xc+
$a+Yb]=cb[Xb+Cc]}}}else vb.va_common[Sa]=new Float32Array(0)}}fa=vb;n.push({batch:X,submesh:fa,mat_names:[ja.name],render:y,rel_objects:[a]})}}}return n}function H(a,b){var c=!0;"NODES_GLOW"==a.type&&(c=ja.check_material_glow_output(b));return c=c&&d(a,b)}function F(a,b){for(var c=null,d=null,e=0;e<a.textures.length;e++){var g=a.textures[e].canvas_context;g&&(c||(c={}),c[e]=g,a.textures[e].canvas_context=null);if(g=a.textures[e].video_file)d||(d={}),d[e]=g,a.textures[e].video_file=null}a.id=0;a.render_id=
b;a.id=ia.calc_variable_id(a,b);if(c)for(var f in c)a.textures[f].canvas_context=c[f];if(d)for(f in d)a.textures[f].video_file=d[f]}function L(a){var b=a.bone_pointers;a.bone_pointers=null;var c=ia.calc_variable_id(a,0);a.bone_pointers=b;return c}function x(a,b,c,d,e){var g=u("WIREFRAME");K(g,"wireframe.glslv","wireframe.glslf");g.wireframe_mode=0;g.debug_sphere=!0;g.depth_mask=!0;g.odd_id_prop=c;e&&(g.debug_sphere_dynamic=!0);D(g,b);b=L(b);F(g,b);d?(d=V.generate_uv_sphere(16,8,1,a.center,!1,!1),
ba.scale_submesh_xyz(d,[a.axis_x[0],a.axis_y[1],a.axis_z[2]],a.center)):d=V.generate_uv_sphere(16,8,a.radius,a.center,!1,!1);ba.submesh_drop_indices(d,1,!0);d.va_common.a_polyindex=ba.extract_polyindices(d);I(g,d);return g}function K(a,b,c){a.shaders_info.vert=b;a.shaders_info.frag=c;O.set_default_directives(a.shaders_info)}function A(a,b,c){1==a.textures.length&&0==a.texture_names.length&&a.texture_names.push("default0");c=c||"default"+String(a.textures.length);-1==a.texture_names.indexOf(c)&&(a.textures.push(b),
a.texture_names.push(c));a.shader&&da.assign_texture_uniforms(a)}function P(a){if(!a.shaders_info)throw"No shaders info for batch "+a.name;a.shader=O.get_compiled_shader(a.shaders_info);da.assign_uniform_setters(a.shader);da.assign_attribute_setters(a);da.assign_texture_uniforms(a)}function S(a,b,c){a=a.scenes_data[0].batches;for(var d=0;d<a.length;d++)if(a[d].type==c&&!a[d].forked_batch&&-1!=a[d].material_names.indexOf(b))return a[d];return null}function ea(a,b,c){a=a.scenes_data[0].batches;for(var d=
0;d<a.length;d++)if(a[d].type==c&&a[d].forked_batch&&-1!=a[d].material_names.indexOf(b))return a[d];return null}function aa(a,b){a.diffuse_color.set(b.diffuse_color);a.diffuse_intensity=b.diffuse_intensity;a.specular_color.set(b.specular_color);a.specular_color_factor=b.specular_color_factor;a.specular_params.set(b.specular_params);a.emit=b.emit;a.ambient=b.ambient;a.diffuse_color_factor=b.diffuse_color_factor;a.alpha_factor=b.alpha_factor;a.reflect_factor=b.reflect_factor;a.fresnel_params.set(b.fresnel_params);
a.parallax_scale=b.parallax_scale;a.shallow_water_col.set(b.shallow_water_col);a.shallow_water_col_fac=b.shallow_water_col_fac;a.shore_water_col.set(b.shore_water_col);a.shore_water_col_fac=b.shore_water_col_fac;a.foam_factor=b.foam_factor;a.water_norm_uv_velocity=b.water_norm_uv_velocity}var Y=r("__boundings"),Q=r("__camera"),X=r("__config"),R=r("__print"),U=r("__extensions"),ba=r("__geometry"),fa=r("__graph"),ja=r("__nodemat"),pa=r("__obj_util"),na=r("__particles"),V=r("__primitives"),E=r("__quat"),
T=r("__reformer"),da=r("__renderer"),qa=r("__scenegraph"),O=r("__shaders"),ga=r("__textures"),ha=r("__tsr"),ia=r("__util"),ma=r("__vec3"),ca=r("__vec4"),Z=X.defaults,ta=["MAIN"],M=new Float32Array([0,-Math.sqrt(.5),0,Math.sqrt(.5)]),la=new Float32Array(4);a.BATCH_INHERITED_TEXTURES=oa;var oa="u_colormap0 u_colormap1 u_stencil0 u_specmap0 u_normalmap0 u_mirrormap".split(" ");a.init_batch=u;a.generate_main_batches=function(a,b,d,e){for(var g=a._render.graph,f=[],k=[],m=0;m<b.length;m++){var n=b[m];
n.is_hair_dupli||(pa.is_dynamic(n)?f.push(n):k.push(n))}for(var m=[],m=m.concat(l(f,g)),k=m=m.concat(c(k,g,a.b4w_batch_grid_size)),g=[],m=[],q={},n=0;n<k.length;n++){var t=k[n].batch,v=k[n].render,E=null;if(t.id in q){for(var A=q[t.id],u=m[A].batch,r=m[A].render,B=null,w=null,f=0;f<t.textures.length;f++){var y=t.textures[f].canvas_context;y&&(B||(B={}),B[f]=y,t.textures[f].canvas_context=null);if(y=t.textures[f].video_file)w||(w={}),w[f]=y,t.textures[f].video_file=null}ia.strict_objs_is_equal(t,u,
!0)&&ia.strict_objs_is_equal(v,r,!0)&&(E=m[A]);if(B)for(f in B)t.textures[f].canvas_context=B[f];if(w)for(f in w)t.textures[f].video_file=w[f];if(!E){do t.id++;while(q[t.id])}}E||(E={batch:t,render:k[n].render,rel_objects:[],submeshes:[],mat_names:[]},q[t.id]=m.length,m.push(E));E.rel_objects=E.rel_objects.concat(k[n].rel_objects);k[n].submesh&&k[n].submesh.base_length&&E.submeshes.push(k[n].submesh);if(E.mat_names.length)for(f=0;f<k[n].mat_names.length;f++)t=k[n].mat_names[f],-1==E.mat_names.indexOf(t)&&
E.mat_names.push(t);else E.mat_names=k[n].mat_names;ba.sort_two_arrays(E.mat_names,E.submeshes,ba.SORT_STRING,!1)}for(n=0;n<m.length;n++){k=m[n].submeshes;if(0==k.length)f=ia.create_empty_submesh(ia.unique_name("%empty"));else if(1==k.length)f=k[0];else{q=[];for(f=0;f<k.length;f++)ba.is_long_submesh(k[f])||q.push(f);if(q.length<k.length)for(f=0;f<q.length;f++)ba.submesh_drop_indices(k[q[f]]);f=ba.submesh_list_join(k)}g.push({batch:m[n].batch,render:m[n].render,submesh:f,mat_names:m[n].mat_names,rel_objects:m[n].rel_objects})}for(m=
0;m<g.length;m++)if(k=g[m].batch,k.material_names=g[m].mat_names,I(k,g[m].submesh),p(k,d,a),"STATIC"==g[m].render.type&&"COLOR_ID"!=k.type)n=ia.unique_name("%meta%"+k.type+"%"+k.material_names.join("%")+"%"),n=pa.create_meta_object(n,"MESH"),n.render=g[m].render,pa.append_scene_data(n,a),pa.append_batch(n,a,k),e.push(n);else for(q=[],f=0;f<g[m].rel_objects.length;f++)n=g[m].rel_objects[f],-1==q.indexOf(n.name)&&(pa.append_batch(n,a,k),q.push(n.name));if(Z.wireframe_debug){for(m=0;m<g.length;m++)if(d=
g[m].render,"DYNAMIC"==d.type&&(n=g[m].rel_objects[0],-1<ta.indexOf(g[m].batch.type))){f=pa.get_scene_data(n,a);k=f.batches;q=!1;for(f=0;f<k.length;f++)k[f].debug_sphere&&(q=!0);q||(d=x(d.be_local,d,n.name,!0,!0),pa.append_batch(n,a,d))}for(m=0;m<e.length;m++)n=e[m],d=n.render,f=pa.get_scene_data(n,a),k=f.batches,-1<ta.indexOf(k[0].type)&&(d=x(d.bs_local,d,n.name,!1),pa.append_batch(n,a,d))}for(m=0;m<b.length;m++)for(f=pa.get_scene_data(b[m],a),k=f.batches,f=0;f<k.length;f++)h(k[f]);for(m=0;m<e.length;m++)for(f=
pa.get_scene_data(e[m],a),k=f.batches,f=0;f<k.length;f++)h(k[f])};a.generate_sky_meta_obj=function(a,b){var c=a._render.world_light_set,d=u("MAIN");K(d,"special_skydome.glslv","special_skydome.glslf");if(b.procedural_skydome)v(d,"PROCEDURAL_SKYDOME",1),d.procedural_sky=!0;else{var e=c.sky_texture_param;if(e){v(d,"WO_SKYTEX",1);var g=m(c.sky_texture_slot,null);A(d,g,"u_sky");e.invert&&v(d,"MTEX_NEGATIVE",1);e.use_rgb_to_intensity&&v(d,"MTEX_RGBTOINT",1);v(d,"BLENDTYPE",e.blend_type);e.use_map_blend&&
v(d,"WOMAP_BLEND",1);e.use_map_horizon&&v(d,"WOMAP_HORIZ",1);e.use_map_zenith_up&&v(d,"WOMAP_ZENUP",1);e.use_map_zenith_down&&v(d,"WOMAP_ZENDOWN",1)}c.use_sky_blend&&v(d,"WO_SKYBLEND",1);c.use_sky_paper&&v(d,"WO_SKYPAPER",1);c.use_sky_real&&v(d,"WO_SKYREAL",1)}b.reflexible&&(d.reflexible=!0,b.reflexible_only&&(d.reflexible_only=!0));d.offset_z=99999;y(d,"a_position");c=V.generate_fullscreen_quad();I(d,c);h(d);c=ia.unique_name("%meta_sky%");c=pa.create_meta_object(c,"MESH");pa.append_scene_data(c,
a);e=pa.get_scene_data(c,a);c.render=pa.create_render("STATIC");c.render.do_not_cull=!0;c.render.bb_local=Y.zero_bounding_box();c.render.bs_local=Y.zero_bounding_sphere();c.render.bb_world=Y.zero_bounding_box();c.render.bs_world=Y.zero_bounding_sphere();e.batches.push(d);return c};a.create_forked_batches=function(a,c,d){d=pa.get_scene_data(a,d).batches;var e=[],g=qa.find_subs(c,"SHADOW_CAST"),f=qa.find_subs(c,"MAIN_PLANE_REFLECT"),k=qa.find_subs(c,"MAIN_CUBE_REFLECT"),h=qa.find_subs(c,"OUTLINE_MASK");
c=qa.find_subs(c,"COLOR_PICKING");for(var m=0;m<d.length;m++){var l=d[m],p=null;"DEPTH"==l.type&&g&&l.shadow_cast&&(p=b(l),p.subtype="SHADOW_CAST");"MAIN"!=l.type&&"PARTICLES"!=l.type||!f&&!k||l.blend||!l.reflexible||(p=b(l),p.subtype="REFLECT");"COLOR_ID"==l.type&&l.can_fork_outline&&h&&a.render.outlining&&(c&&a.render.selectable?(p=b(l),p.subtype="OUTLINE"):l.subtype="OUTLINE");p&&(p.forked_batch=!0,F(p,a.render.id),e.push(p))}d.push.apply(d,e)};a.set_local_cylinder_capsule=n;a.wb_angle_to_amp=
function(a,b,c){if(b)b=c*(b.max_y-b.min_y);else throw"No bounding box for mesh";if(0==b)return 0;a=b*Math.tan(a/180*Math.PI);return.5*(Math.sqrt(2*Math.sqrt(4*a+1)+2)/2-1)/b};a.bb_bpy_to_b4w=function(a){return{max_x:a.max_x,min_x:a.min_x,max_y:a.max_y,min_y:a.min_y,max_z:a.max_z,min_z:a.min_z}};a.get_batch_texture=m;a.update_batch_material_debug=C;a.update_batch_lights=p;a.set_lamp_data=g;a.assign_shadow_receive_dirs=function(a,b,c){c&&c.camera.type==Q.TYPE_PERSP&&v(a,"PERSPECTIVE_SHADOW_CAST",1);
v(a,"CSM_SECTION0",0);v(a,"CSM_SECTION1",0);v(a,"CSM_SECTION2",0);v(a,"CSM_SECTION3",0);if(b){for(c=0;c<b.csm_num;c++)v(a,"CSM_SECTION"+String(c),1);v(a,"SHADOW_TEX_RES",O.glsl_value(b.csm_resolution));v(a,"CSM_FADE_LAST_CASCADE",b.fade_last_cascade?1:0);v(a,"CSM_BLEND_BETWEEN_CASCADES",b.blend_between_cascades?1:0)}else v(a,"SHADOW_TEX_RES",0),v(a,"CSM_FADE_LAST_CASCADE",0),v(a,"CSM_BLEND_BETWEEN_CASCADES",0)};a.set_batch_directive=v;a.get_batch_directive=function(a,b){return O.get_directive(a.shaders_info,
b)};a.update_batch_geometry=I;a.update_batch_id=F;a.calculate_render_id=L;a.create_bounding_ellipsoid_batch=x;a.append_texture=A;a.replace_texture=function(a,b,c){c=a.texture_names.indexOf(c);-1<c&&(a.textures[c]=b)};a.create_shadeless_batch=function(a,b,c){var d=u("MAIN");1>c&&(d.blend=!0);ca.set(b[0],b[1],b[2],c,d.diffuse_color);d.draw_mode=ba.DM_TRIANGLES;I(d,a);K(d,"main_stack.glslv","main_stack.glslf");v(d,"SHADELESS",1);P(d);return d};a.update_shader=P;a.check_batch_perm_uniform=function(a,
b){return a.shader.permanent_uniform_setters.length?a.shader.permanent_uniform_setters_table[b]?!0:!1:!1};a.create_depth_pack_batch=function(a){a=u("DEPTH_PACK");a.use_backface_culling=!0;a.depth_mask=!1;var b=V.generate_fullscreen_tri();I(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/depth_pack.glslf");P(a);return a};a.create_postprocessing_batch=function(a){var b=u("POSTPROCESSING");K(b,"postprocessing/postprocessing.glslv","postprocessing/postprocessing.glslf");switch(a){case "NONE":v(b,
"POST_EFFECT","POST_EFFECT_NONE");break;case "GRAYSCALE":v(b,"POST_EFFECT","POST_EFFECT_GRAYSCALE");break;case "X_BLUR":v(b,"POST_EFFECT","POST_EFFECT_X_BLUR");break;case "Y_BLUR":v(b,"POST_EFFECT","POST_EFFECT_Y_BLUR");break;case "X_GLOW_BLUR":v(b,"POST_EFFECT","POST_EFFECT_X_GLOW_BLUR");break;case "Y_GLOW_BLUR":v(b,"POST_EFFECT","POST_EFFECT_Y_GLOW_BLUR");break;case "X_EXTEND":v(b,"POST_EFFECT","POST_EFFECT_X_EXTEND");break;case "Y_EXTEND":v(b,"POST_EFFECT","POST_EFFECT_Y_EXTEND");break;default:throw"Wrong postprocessing effect: "+
a;}b.use_backface_culling=!0;b.depth_mask=!1;a=V.generate_fullscreen_tri();I(b,a);P(b);return b};a.create_ssao_batch=function(a){var b=u("SSAO");b.depth_mask=!1;b.use_backface_culling=!0;var c=V.generate_fullscreen_tri();I(b,c);K(b,"postprocessing/postprocessing.glslv","postprocessing/ssao.glslf");v(b,"SSAO_QUALITY","SSAO_QUALITY_"+a.ssao_samples);v(b,"SSAO_HEMISPHERE",a.ssao_hemisphere?1:0);a={texture:ga.generate_texture("SSAO_TEXTURE",a)};c={width:4,height:4,data:new Uint8Array([150,123,254,0,127,
3,97,0,164,246,99,0,155,177,14,0,54,83,221,0,2,142,143,0,32,57,79,0,49,160,32,0,57,232,115,0,178,216,203,0,70,196,218,0,241,164,82,0,225,58,85,0,233,88,189,0,144,25,203,0,117,73,12,0])};a=m(a,c);A(b,a,"u_ssao_special_tex");P(b);return b};a.create_ssao_blur_batch=function(a){var b=u("SSAO_BLUR");b.depth_mask=!1;b.use_backface_culling=!0;var c=V.generate_fullscreen_tri();I(b,c);K(b,"postprocessing/postprocessing.glslv","postprocessing/ssao_blur.glslf");v(b,"SSAO_BLUR_DEPTH",a.ssao_blur_depth?1:0);P(b);
return b};a.create_dof_batch=function(a){a=u("DOF");a.depth_mask=!1;a.use_backface_culling=!0;var b=V.generate_fullscreen_tri();I(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/dof.glslf");v(a,"DEPTH_RGBA",1);P(a);return a};a.create_outline_batch=function(){var a=u("OUTLINE");a.depth_mask=!1;a.use_backface_culling=!0;var b=V.generate_fullscreen_tri();I(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/outline.glslf");P(a);return a};a.create_glow_combine_batch=function(){var a=
u("GLOW_COMBINE");a.depth_mask=!1;a.use_backface_culling=!0;var b=V.generate_fullscreen_tri();I(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/glow.glslf");P(a);return a};a.create_god_rays_batch=function(a,b,c,d){a=u("GOD_RAYS");a.depth_mask=!1;a.use_backface_culling=!0;var e=V.generate_billboard();I(a,e);K(a,"postprocessing/god_rays.glslv","postprocessing/god_rays.glslf");v(a,"DEPTH_RGBA",b?1:0);v(a,"WATER_EFFECTS",c?1:0);v(a,"STEPS_PER_PASS",O.glsl_value(d,1));P(a);return a};a.create_god_rays_combine_batch=
function(a,b){var c=u("GOD_RAYS_COM");c.depth_mask=!1;c.use_backface_culling=!0;var d=V.generate_fullscreen_tri();I(c,d);K(c,"postprocessing/postprocessing.glslv","postprocessing/god_rays_combine.glslf");P(c);return c};a.create_procedural_sky_batch=function(){var a=u("SKY");a.depth_mask=!1;a.use_backface_culling=!0;var b=V.generate_cube();I(a,b);K(a,"procedural_skydome.glslv","procedural_skydome.glslf");v(a,"WATER_EFFECTS",1);P(a);return a};a.create_antialiasing_batch=function(){var a=u("ANTIALIASING");
a.depth_mask=!1;a.use_backface_culling=!0;var b=V.generate_fullscreen_tri();I(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/antialiasing.glslf");Z.quality_aa?v(a,"AA_METHOD","AA_METHOD_FXAA_QUALITY"):v(a,"AA_METHOD","AA_METHOD_FXAA_LIGHT");P(a);return a};a.create_smaa_batch=function(a){var b=u("SMAA"),c=V.generate_fullscreen_tri();I(b,c);K(b,"postprocessing/smaa.glslv","postprocessing/smaa.glslf");v(b,"AA_METHOD","AA_METHOD_SMAA_HIGH");v(b,"SMAA_PASS",a);v(b,"SMAA_PREDICATION",0);
v(b,"SMAA_REPROJECTION",0);P(b);b.depth_mask=!1;b.use_backface_culling=!0;return b};a.create_compositing_batch=function(){var a=u("COMPOSITING");a.depth_mask=!1;a.use_backface_culling=!0;var b=V.generate_fullscreen_tri();I(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/compositing.glslf");P(a);return a};a.create_motion_blur_batch=function(a){a=u("MOTION_BLUR");a.use_backface_culling=!0;a.depth_mask=!1;var b=V.generate_fullscreen_tri();I(a,b);K(a,"postprocessing/postprocessing.glslv",
"postprocessing/motion_blur.glslf");P(a);return a};a.create_anaglyph_batch=function(a){a=u("ANAGLYPH");a.use_backface_culling=!0;a.depth_mask=!1;var b=V.generate_fullscreen_tri();I(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/anaglyph.glslf");P(a);return a};a.create_luminance_batch=function(){var a=u("LUMINANCE");a.depth_mask=!1;a.use_backface_culling=!0;var b=V.generate_fullscreen_tri();I(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/luminance.glslf");P(a);return a};
a.create_average_luminance_batch=function(){var a=u("LUMINANCE");a.depth_mask=!1;a.use_backface_culling=!0;var b=V.generate_fullscreen_tri();I(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/luminance_av.glslf");P(a);return a};a.create_luminance_trunced_batch=function(){var a=u("LUMINANCE_X_BLUR");a.depth_mask=!1;a.use_backface_culling=!0;var b=V.generate_fullscreen_tri();I(a,b);K(a,"postprocessing/luminance_trunced.glslv","postprocessing/luminance_trunced.glslf");P(a);return a};a.create_bloom_blur_batch=
function(){var a=u("POSTPROCESSING");a.use_backface_culling=!0;a.depth_mask=!1;var b=V.generate_fullscreen_tri();I(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_blur.glslf");P(a);return a};a.create_bloom_combine_batch=function(){var a=u("BLOOM");a.depth_mask=!1;a.use_backface_culling=!0;var b=V.generate_fullscreen_tri();I(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/bloom_combine.glslf");P(a);return a};a.create_velocity_batch=function(){var a=u("VELOCITY");
a.depth_mask=!1;a.use_backface_culling=!0;var b=V.generate_fullscreen_tri();I(a,b);K(a,"postprocessing/postprocessing.glslv","postprocessing/velocity.glslf");P(a);return a};a.create_anchor_visibility_batch=function(){var a=u("ANCHOR_VISIBILITY");a.depth_mask=!0;a.use_backface_culling=!0;a.draw_mode=ba.DM_POINTS;K(a,"anchors.glslv","anchors.glslf");var b=V.generate_index(1);I(a,b);v(a,"ANCHOR_NUM",1);P(a);a.positions=new Float32Array([0,0,0]);return a};a.update_anchor_visibility_batch=function(a,b){var c=
b.length/3;if(c!=a.positions.length/3){var d=V.generate_index(c);I(a,d);v(a,"ANCHOR_NUM",c);P(a)}a.positions=b};a.find_batch_material=S;a.find_batch_material_forked=ea;a.set_material_props=aa;a.check_batch_type=function(a,b){for(var c=a.scenes_data[0].batches,d=0;d<c.length;d++)if(c[d].type==b)return!0;return!1};a.clear_batch=function(a){for(var b=a.textures,c=0;c<b.length;c++)ga.delete_texture(b[c].w_texture);ba.cleanup_bufs_data(a.bufs_data)};a.inherit_material=function(a,b,c,d){for(var e=["MAIN",
"DEPTH","COLOR_ID"],g=!1,f=0;f<e.length;f++){var k=e[f],h=S(a,b,k),m=S(c,d,k);if(h&&m){var g=!0,l=ea(c,d,k);"MAIN"==k&&(aa(m,h),l&&aa(l,h));for(k=0;k<m.texture_names.length;k++){var p=m.texture_names[k];if(-1!==oa.indexOf(p)){var n=h.texture_names.indexOf(p);-1!==n&&(m.textures[k]=h.textures[n],l&&(p=l.texture_names.indexOf(p),-1!==p&&(l.textures[p]=h.textures[n])))}}}}g||R.error("Wrong objects for inheriting material!")}};b4w.module.__nodemat=function(a,r){function u(a,b,d,g,l){var p=Z.get_active(),p=c(b,l,p.uuid);if(p in oa)return oa[p];if("DEPTH"!=l&&"COLOR_ID"!=l){var t=O.create(),E=a.nodes,A=a.links;b=a.animation_data;for(var r=0;r<E.length;r++)if(null==z(t,E[r],0,b,g,l))return oa[p]=null;if(d&&-1==v(a,t,"GROUP_OUTPUT","group"))return null;r=ja(t);if(!pa(t,A,r))return null;if(d)return t;for(r=0;r<A.length;r++){d=A[r];for(var E=m(d.from_node,t),x=m(d.to_node,t),w=0;w<E.length;w++)for(var T=0;T<x.length;T++){var F=
E[w],J=x[T],da=O.get_node_attr(t,F),D=O.get_node_attr(t,J);if(!ba(t,F,J,da,D,d))return oa[p]=null}}e(t);a="GLOW"==l?v(a,t,"B4W_GLOW_OUTPUT","material",!0):v(a,t,"OUTPUT","material",!1,!0);-1==a&&(t=n(),a=0);B(t);a=O.subgraph_node_conn(t,a,O.BACKWARD_DIR);h(a,b,g,l);q(a);G(a);y(a);k(a,b,g,l)}else g=u(a,b,d,g,"MAIN"),g=O.clone(g,function(a){var b=ta.clone_object_nr(a);b.inputs=ta.clone_object_r(a.inputs);b.outputs=ta.clone_object_r(a.outputs);return b}),a=v(a,g,"OUTPUT","material",!1,!0),f(g,a),a=O.subgraph_node_conn(g,
a,O.BACKWARD_DIR),q(a);return oa[p]=a}function h(a,c,d,e){var g=[];O.traverse(a,function(a,b){"MATERIAL"!=b.type&&"MATERIAL_EXT"!=b.type||g.push({node_id:a,node:b})});for(e=0;e<g.length;++e){var f=g[e].node_id,k=g[e].node,h=O.gen_node_id(a);O.append_node(a,h,k.data.material_begin);var m=O.gen_node_id(a);O.append_node(a,m,k.data.material_end);O.append_edge(a,h,m,[4,2]);for(var l={5:["LIGHTING_APPLY",10],6:["LIGHTING_APPLY",6],7:["MATERIAL_END",3],8:["MATERIAL_END",4],9:["MATERIAL_END",5]},p=O.in_edge_count(a,
f),n=[],q=[],t=[],v={},E=0;E<p;E++){var A=O.get_in_edge(a,f,E);A in v||(v[A]=0);var r=O.get_edge_attr(a,A,f,v[A]++);n.push([A,f,r]);var u=l[r[1]];if(u)switch(u[0]){case "MATERIAL_END":q.push([A,m,[r[0],u[1]]]);break;case "LIGHTING_APPLY":t.push([A,[r[0],u[1]]])}else q.push([A,h,r])}b(a,k.data.value,h,m,t,c,d);for(E=0;E<n.length;E++)O.remove_edge_by_attr(a,n[E][0],n[E][1],n[E][2]);for(E=0;E<q.length;E++)O.append_edge(a,q[E][0],q[E][1],q[E][2]);k=O.out_edge_count(a,f);h=[];l=[];p={};for(E=0;E<k;E++)n=
O.get_out_edge(a,f,E),n in p||(p[n]=0),r=O.get_edge_attr(a,f,n,p[n]++),h.push([f,n,r]),l.push([m,n,r]);for(E=0;E<h.length;E++)O.remove_edge_by_attr(a,h[E][0],h[E][1],h[E][2]);for(E=0;E<l.length;E++)O.append_edge(a,l[E][0],l[E][1],l[E][2]);O.remove_node(a,f)}}function b(a,b,c,d,e,g,f){var k={name:"LIGHTING_AMBIENT",type:"LIGHTING_AMBIENT"},h=z(a,k,0,g,f,null),m=h;l(a,c,h,"E");l(a,c,h,"A");l(a,c,h,"D");h=Z.get_active();h=ia.get_scene_objs(h,"LAMP",ia.DATA_ID_ALL);if(!b.use_shadeless)for(var p,n,q=0;q<
h.length;q++){var t=h[q].light,k={name:"LIGHTING_LAMP",type:"LIGHTING_LAMP"};p=z(a,k,0,g,f,null);k={name:"LIGHTING_APPLY",type:"LIGHTING_APPLY"};n=z(a,k,0,g,f,null);l(a,m,n,"color");l(a,m,n,"specular");l(a,p,n,"ldir");l(a,c,n,"normal");l(a,c,n,"D");l(a,c,n,"S");l(a,p,n,"lcolorint");l(a,c,p,"shadow_factor");m="COOKTORR"==b.specular_shader?"SPECULAR_PHONG":"SPECULAR_"+b.specular_shader;k={name:m,type:m};k=z(a,k,0,g,f,null);l(a,p,k,"ldir");l(a,p,k,"lfac");l(a,c,k,"normal");l(a,k,n,"sfactor");"SPECULAR_PHONG"!=
m&&"SPECULAR_BLINN"!=m||l(a,p,k,"norm_fac");l(a,c,k,"sp_params");m="HEMI"==t.type?"DIFFUSE_LAMBERT":"DIFFUSE_"+b.diffuse_shader;k={name:m,type:m};k=z(a,k,0,g,f,null);l(a,p,k,"ldir");l(a,p,k,"lfac");l(a,c,k,"normal");l(a,p,k,"norm_fac");l(a,k,n,"lfactor");"DIFFUSE_LAMBERT"!=m&&l(a,c,k,"dif_params");for(p=0;p<e.length;p++)O.append_edge(a,e[p][0],n,e[p][1]);m=n}l(a,m,d,"color");l(a,m,d,"specular")}function l(a,b,c,d){for(var e=O.get_node_attr(a,b),g=O.get_node_attr(a,c),f,k=0;k<g.inputs.length;k++)if(d==
g.inputs[k].identifier){f=k;break}for(var h,k=0;k<e.outputs.length;k++)if(d==e.outputs[k].identifier){h=k;break}void 0!=f&&void 0!=h&&O.append_edge(a,b,c,[h,f])}function c(a,b,c){switch(b){case "GLOW":return a+c+"11";case "COLOR_ID":case "DEPTH":return a+c+"00";default:return a+c+"10"}}function f(a,b){O.traverse_edges(a,function(c,d,e){var g=O.get_node_attr(a,d);d==b&&"Color"==g.inputs[e[1]].identifier&&O.remove_edge_by_attr(a,c,d,e)})}function n(){var a=O.create(),b={data:null,dirs:[],params:[],
inputs:[{default_value:new Float32Array([0,0,0]),identifier:"Color",is_linked:!1,name:"Color"},{default_value:1,identifier:"Alpha",is_linked:!1,name:"Alpha"}],outputs:[],type:"OUTPUT",vparams:[]};O.append_node(a,0,b);return a}function q(a){O.traverse(a,function(b,c){for(var e=c.inputs,g=c.outputs,f=0;f<e.length;f++)d(a,e[f],b,f,1);for(f=0;f<g.length;f++)d(a,g[f],b,f,0)})}function d(a,b,c,d,e){if(b.is_linked){var g=!0;O.traverse_edges(a,function(a,b,f){if(!e&&a==c&&f[0]==d||e&&b==c&&f[1]==d)g=!1});
g&&(b.is_linked=!1)}}function k(a,b,c,d){var e=[];O.traverse_edges(a,function(g,f,k){var h=O.get_node_attr(a,g),m=O.get_node_attr(a,f),h=ta.is_vector(h.outputs[k[0]].default_value),m=ta.is_vector(m.inputs[k[1]].default_value);if(h!=m){var l,p={default_value:[0,0,0],identifier:"Vector",is_linked:!0,name:"Vector"},n={default_value:0,identifier:"Value",is_linked:!0,name:"Value"};h&&!m?l=I("vector_to_scalar","B4W_VECTOSCAL",[p],[n]):!h&&m&&(l=I("scalar_to_vector","B4W_SCALTOVEC",[n],[p]));z(a,l,0,b,c,
d);e.push([g,f,a.nodes[a.nodes.length-2],k])}});for(var g=0;g<e.length;++g)O.remove_edge_by_attr(a,e[g][0],e[g][1],e[g][3]),O.append_edge(a,e[g][0],e[g][2],[e[g][3][0],0]),O.append_edge(a,e[g][2],e[g][1],[0,e[g][3][1]])}function e(a){var b=[];O.traverse(a,function(c,d){switch(d.type){case "B4W_TRANSLUCENCY":O.traverse_edges(a,function(a,e,g){a==c&&"Translucency"==d.outputs[g[0]].name&&b.push(a,e,[g[0]+1,g[1]+1])})}});for(var c=0;c<b.length;c+=3)O.append_edge(a,b[c],b[c+1],b[c+2])}function m(a,b){var c=
[];O.traverse(b,function(b,d){d.name==a.name&&c.push(b)});if(c.length)return c;throw"Node not found";}function B(a){var b=[];O.traverse(a,function(a,c){"B4W_PARALLAX"!=c.type&&"REROUTE"!=c.type||b.push(a,c)});for(var c=0;c<b.length;c+=2){var d=b[c],e=b[c+1];if("B4W_PARALLAX"==e.type){var g=N(a,d,1);if(-1!=g){var f=O.get_in_edge(a,g,0);O.remove_edge(a,g,d,-1);-1!=f&&O.remove_edge(a,f,g,-1);d=O.get_node_attr(a,g);e.data=d.data;e.params[0]=d.params[0];O.remove_node(a,g)}e.inputs.splice(1,1)}else if("REROUTE"==
e.type){for(var e=O.get_in_edge(a,d,0),k=O.out_edge_count(a,d),g=[],f=[],h=[],m=0;m<k;m++){var l=O.get_out_edge(a,d,m),p=f.indexOf(l);-1!=p?h[p]+=1:(f.push(l),h.push(1),g.push(d,l))}if(-1!=e)for(k=O.get_edge_attr(a,e,d,0)[0],m=0;m<f.length;m++)for(l=0;l<h[m];l++)p=O.get_edge_attr(a,d,f[m],l)[1],O.append_edge(a,e,f[m],[k,p]);for(m=0;m<g.length;m+=2)O.remove_edge(a,g[m],g[m+1],-1)}}}function N(a,b,c){a=a.edges;for(var d=0;d<a.length;d+=3)if(a[d+1]==b&&a[d+2][1]==c)return a[d];return-1}function G(a){t(a);
D(a);w(a)}function w(a,b){var c=[],d="",e="",f={};O.traverse(a,function(a,b){if("GEOMETRY_UV"==b.type||"UVMAP"==b.type||"TEX_COORD_UV"==b.type){c.push(a,b);var g=b.data.value;d?d==g||e||(e=g,f[e]=0):(d=g,f[d]=0);f[g]++}});for(var k in f)if(2>f[k]){for(var h=0;h<c.length;h+=2)c[h+1].data.value==k&&c.splice(h,2);delete f[k];d==k&&(d=e,e="");e==k&&(e="")}if(!(3>c.length)){var h={default_value:[0,0,0],identifier:"UV_geom",is_linked:!1,name:"UV_geom"},m={default_value:[0,0,0],identifier:"UV_cycles",is_linked:!1,
name:"UV_cycles"};k=I("merged_uv","UV_MERGED",[],[h,m]);k.uv_layer=d;z(a,k,0,null,"",b);var l=a.nodes[a.nodes.length-2];k=a.nodes[a.nodes.length-1];if(e){m=I("merged_uv","UV_MERGED",[],[h,m]);m.uv_layer=e;z(a,m,0,null,"",b);var p=a.nodes[a.nodes.length-2],m=a.nodes[a.nodes.length-1]}else m=null;for(var n=-1,q=null,h=0;h<c.length;h+=2){var t=c[h],E=c[h+1];g(E,c[1])?(n=l,q=k):m&&(n=p,q=m);for(var v=[],A=O.out_edge_count(a,t),r={},u=0;u<A;u++){var B=O.get_out_edge(a,t,u);B in r||(r[B]=0);var x=O.get_edge_attr(a,
t,B,r[B]++);v.push(t,B,x);x=x.splice(0,x.length);switch(E.type){case "GEOMETRY_UV":x[0]=0;q.outputs[0].is_linked=!0;break;case "UVMAP":case "TEX_COORD_UV":x[0]=1,q.outputs[1].is_linked=!0}O.append_edge(a,n,B,x)}for(var u=0;u<v.length;u+=3)O.remove_edge(a,v[u],v[u+1],0);O.remove_node(a,t)}}}function t(a){var b=[];O.traverse(a,function(a,c){"GEOMETRY_VC"!=c.type&&"GEOMETRY_NO"!=c.type&&"GEOMETRY_FB"!=c.type&&"GEOMETRY_VW"!=c.type&&"GEOMETRY_GL"!=c.type&&"GEOMETRY_LO"!=c.type&&"GEOMETRY_OR"!=c.type||
b.push(a,c)});for(var c=[],d=0;d<b.length;d+=2){for(var e=b[d],g=b[d+1],f=!0,k=0;k<c.length;k++){var h=c[k];if(p(g,h.attr)){f=[];k=O.out_edge_count(a,e);for(n=0;n<k;n++){var m=O.get_out_edge(a,e,n),l=O.get_edge_attr(a,e,m,0);f.push(e,m,l);O.append_edge(a,h.id,m,l)}for(var n=0;n<f.length;n+=3)O.remove_edge(a,f[n],f[n+1],0);O.remove_node(a,e);f=!1;break}}f&&(h={id:e,attr:g},c.push(h))}}function C(a){for(var b={},c=0;c<a.nodes.length;c+=2)b[a.nodes[c]]=[];for(c=0;c<a.edges.length;c+=3){var d=a.edges[c],
e=a.edges[c+1];a:for(var g=b[e],f=d,k=0;k<=g.length;k++){if(k>=g.length||g[k]>f)g.splice(k,0,f);else if(g[k]!=f)continue;break a}for(var e=b[e],d=b[d],f=g=0,k=e.length+d.length,h=[],m=0;m<k;m++)g>e.length||e[g]>d[f]?h.push(d[f++]):h.push(e[g++])}return b}function D(a){var b=[];O.traverse(a,function(a,c){"TEXTURE_COLOR"!=c.type&&"TEXTURE_NORMAL"!=c.type||b.push(a,c)});if(b.length){for(var c=C(a),d=[],e=0;e<b.length;e+=2){for(var g=b[e],f=b[e+1],k=!0,h=0;h<d.length;h++){var m=d[h];if(!(3<=m.merged_nodes.length||
!p(f,m.attr)||-1<c[g].indexOf(m.id)||-1<c[m.id].indexOf(g))){for(var l=!1,n=0;n<m.merged_nodes.length;n++){var q=m.merged_nodes[n].id;if(-1<c[g].indexOf(q)||-1<c[q].indexOf(g)){l=!0;break}}if(!l){for(var h=[],q=O.in_edge_count(a,g),t={},n=0;n<q;n++)l=O.get_in_edge(a,g,n),l in t||(t[l]=0),k=O.get_edge_attr(a,l,g,t[l]++),h.push(l,g,k);for(var q=[],t=O.out_edge_count(a,g),E={},n=0;n<t;n++)l=O.get_out_edge(a,g,n),l in E||(E[l]=0),k=O.get_edge_attr(a,g,l,E[l]++),q.push(g,l,k);k=h.concat(q);for(n=0;n<k.length;n+=
3)O.remove_edge(a,k[n],k[n+1],0);O.remove_node(a,g);n={id:g,attr:f,edges_in:h,edges_out:q};m.merged_nodes.push(n);k=!1;break}}}k&&(m={id:g,attr:f,merged_nodes:[]},d.push(m))}for(e=0;e<d.length;e++){m=d[e];c=m.merged_nodes.length;for(h=0;h<c;h++){f=m.merged_nodes[h];n=f.attr;g=f.edges_in;f=f.edges_out;m.attr.inputs[h+1].is_linked=n.inputs[0].is_linked;m.attr.inputs[h+1].default_value=n.inputs[0].default_value;m.attr.outputs[2*(h+1)].is_linked=n.outputs[0].is_linked;m.attr.outputs[2*(h+1)].default_value=
n.outputs[0].default_value;m.attr.outputs[2*(h+1)+1].is_linked=n.outputs[1].is_linked;m.attr.outputs[2*(h+1)+1].default_value=n.outputs[1].default_value;for(n=0;n<g.length;n+=3)l=g[n],k=g[n+2],k[1]+=h+1,O.append_edge(a,l,m.id,k);for(n=0;n<f.length;n+=3)l=f[n+1],k=f[n+2],k[0]+=2*(h+1),O.append_edge(a,m.id,l,k);m.attr.dirs.push(["USE_uv"+(h+2),1])}O.remove_node(a,m.id);O.append_node(a,m.id,m.attr)}}}function p(a,b){if(a.type!==b.type)return!1;switch(a.type){case "GEOMETRY_VC":return a.data.value==b.data.value;
case "GEOMETRY_NO":case "GEOMETRY_FB":case "GEOMETRY_VW":case "GEOMETRY_GL":case "GEOMETRY_LO":case "GEOMETRY_OR":return!0;case "TEXTURE_COLOR":case "TEXTURE_NORMAL":return a.data.value==b.data.value;default:return!1}}function g(a,b){var c=["GEOMETRY_UV","TEX_COORD_UV","UVMAP"];return-1!=c.indexOf(a.type)&&-1!=c.indexOf(b.type)?a.data.value==b.data.value:!1}function y(a){var b=[];O.traverse(a,function(a,c){"GEOMETRY_VC"==c.type&&b.push(a,c)});for(var c=0;c<b.length;c+=2){for(var d=b[c],e=b[c+1],g=
!1,f=[],k=[],h=[[],[],[]],m=O.out_edge_count(a,d),l=0;l<m;l++){var p=O.get_out_edge(a,d,l);if("SEPRGB"!=O.get_node_attr(a,p).type){g=!1;break}f.push(d,p);for(var n={},q=O.out_edge_count(a,p),g=0;g<q;g++){var t=O.get_out_edge(a,p,g);t in n||(n[t]=0);var E=O.get_edge_attr(a,p,t,n[t]++);f.push(p,t);h[E[0]].push(d,t,E)}k.push(p);g=!0}if(g){for(l=d=m=0;l<h.length;l++)h[l].length&&(m++,d|=1<<2-l);if(m){e.type+=m;e.outputs=[];for(l=0;l<h.length;l++)if(h[l].length)for(e.outputs.push({default_value:0,identifier:"RGB"[l],
is_linked:!0,name:"RGB"[l]}),g=0;g<h[l].length;g+=3)h[l][g+2][0]=ta.rgb_mask_get_channel_presence_index(d,l);for(l=0;l<f.length;l+=2)O.remove_edge(a,f[l],f[l+1],0);for(l=0;l<k.length;l++)O.remove_node(a,k[l]);for(l=0;l<h.length;l++)for(g=0;g<h[l].length;g+=3)O.append_edge(a,h[l][g],h[l][g+1],h[l][g+2])}}}}function v(a,b,c,d,e,g){a=a.nodes;for(var f=null,k=0;k<a.length;k++){var h=a[k];e?"GROUP"==h.type&&h.node_tree_name==c&&(f=h):h.type==c&&(f=h)}return f?m(f,b)[0]:(g||ma.error('No "'+c+'" node in node '+
d),-1)}function I(a,b,c,d){return{name:a,type:b,inputs:c,outputs:d}}function z(a,b,c,d,e,g){var f=b.name,k=b.type,h=[],m=[],l=[],p=[],n=null,q=[];switch(k){case "BSDF_ANISOTROPIC":case "BSDF_DIFFUSE":case "BSDF_GLOSSY":case "BSDF_GLASS":case "BSDF_HAIR":case "BSDF_TRANSPARENT":case "BSDF_TRANSLUCENT":case "BSDF_REFRACTION":case "BSDF_TOON":case "BSDF_VELVET":case "SUBSURFACE_SCATTERING":case "EMISSION":case "AMBIENT_OCCLUSION":case "VOLUME_ABSORPTION":case "VOLUME_SCATTER":case "BUMP":case "NORMAL_MAP":case "VECT_TRANSFORM":case "BLACKBODY":case "WAVELENGTH":case "SEPXYZ":case "COMBXYZ":case "LIGHT_FALLOFF":case "TEX_IMAGE":case "TEX_ENVIRONMENT":case "TEX_SKY":case "TEX_NOISE":case "TEX_WAVE":case "TEX_MUSGRAVE":case "TEX_GRADIENT":case "TEX_MAGIC":case "TEX_CHECKER":case "TEX_BRICK":case "WIREFRAME":case "LAYER_WEIGHT":case "TANGENT":case "LIGHT_PATH":case "ATTRIBUTE":case "HOLDOUT":case "PARTICLE_INFO":case "HAIR_INFO":case "OBJECT_INFO":case "SCRIPT":case "NEW_GEOMETRY":m=
X(b);l=R(b);ma.warn(k+" node is not fully supported.");break;case "BRIGHTCONTRAST":case "ADD_SHADER":case "MIX_SHADER":m=X(b);l=R(b);break;case "UVMAP":var t=b.uv_layer;t||(k="EMPTY_UV");if("EMPTY_UV"!=k){var n=x("param_"+k+"_a"),E=x("param_"+k+"_v");h.push(U(n));h.push(U(E));p.push(U(E));n={name:n,value:t}}l=R(b);break;case "UV_MERGED":n=x("param_UV_MERGED_a");E=x("param_UV_MERGED_v");h.push(U(n));h.push(U(E));l.push(aa(b,"UV_geom"));l.push(aa(b,"UV_cycles"));p.push(U(E));n={name:n,value:b.uv_layer};
break;case "CAMERA":m=[];l=R(b);break;case "COMBRGB":case "COMBHSV":m=X(b);l=R(b);break;case "CURVE_RGB":m=X(b);l=R(b);ma.warn("CURVE_RGB node is not fully supported.");break;case "CURVE_VEC":m=X(b);l=R(b);ma.warn("CURVE_VEC node is not fully supported.");break;case "GEOMETRY":if(!K(b))return!0;k=A(b,c);if(!k)return ma.error("Geometry output is not supported"),null;switch(k){case "GEOMETRY_UV":(t=b.uv_layer)||(k="EMPTY_UV");"EMPTY_UV"!=k&&(n=x("param_GEOMETRY_UV_a"),E=x("param_GEOMETRY_UV_v"),h.push(U(n)),
h.push(U(E)),p.push(U(E)),n={name:n,value:t});l.push(aa(b,"UV"));break;case "GEOMETRY_VC":(t=b.color_layer)||(k="EMPTY_VC");"EMPTY_VC"!=k&&(n=x("param_GEOMETRY_VC_a"),E=x("param_GEOMETRY_VC_v"),h.push(U(n)),h.push(U(E)),p.push(U(E)),n={name:n,value:t});l.push(aa(b,"Vertex Color"));break;case "GEOMETRY_NO":l.push(aa(b,"Normal"));break;case "GEOMETRY_FB":l.push(aa(b,"Front/Back"));break;case "GEOMETRY_VW":l.push(aa(b,"View"));break;case "GEOMETRY_GL":l.push(aa(b,"Global"));break;case "GEOMETRY_LO":l.push(aa(b,
"Local"));break;case "GEOMETRY_OR":t=x("param_GEOMETRY_OR_v"),h.push(U(t)),l.push(aa(b,"Orco")),p.push(U(t))}break;case "TEX_COORD":if(!K(b))return!0;k=P(b,c);if(!k)return ma.error("Texture coordinate output is not supported"),null;switch(k){case "TEX_COORD_UV":(t=b.uv_layer)||(k="EMPTY_UV");"EMPTY_UV"!=k&&(n=x("param_TEX_COORD_UV_a"),E=x("param_TEX_COORD_UV_v"),h.push(U(n)),h.push(U(E)),p.push(U(E)),n={name:n,value:b.uv_layer});l.push(aa(b,"UV"));break;case "TEX_COORD_NO":l.push(aa(b,"Normal"));
break;case "TEX_COORD_GE":t=x("param_TEX_COORD_GE_v");h.push(U(t));l.push(aa(b,"Generated"));p.push(U(t));break;case "TEX_COORD_OB":l.push(aa(b,"Object"));ma.warn('Output "Object" of node "Texture Coordinate" doesn\'t supported fully.');break;case "TEX_COORD_CA":l.push(aa(b,"Camera"));break;case "TEX_COORD_WI":l.push(aa(b,"Window"));ma.warn('Output "Window" of node "Texture Coordinate" doesn\'t supported fully.');break;case "TEX_COORD_RE":l.push(aa(b,"Reflection")),ma.warn('Output "Reflection" of node "Texture Coordinate" doesn\'t supported fully.')}break;
case "GROUP":t=b.node_tree_name;switch(t){case "B4W_LINEAR_TO_SRGB":if(!H(b,[1],[1])){n=F(b,e,g);break}k="B4W_LINEAR_TO_SRGB";break;case "B4W_NORMAL_VIEW":case "B4W_VECTOR_VIEW":if(!H(b,[1],[1])){n=F(b,e,g);break}k="B4W_VECTOR_VIEW";break;case "B4W_SRGB_TO_LINEAR":if(!H(b,[1],[1])){n=F(b,e,g);break}k="B4W_SRGB_TO_LINEAR";break;case "B4W_REFLECT":if(!H(b,[1,1],[1])){n=F(b,e,g);break}k="B4W_REFLECT";break;case "B4W_REFRACTION":if(!H(b,[1,0],[1])){n=F(b,e,g);break}k="B4W_REFRACTION";break;case "B4W_PARALLAX":if(!H(b,
[1,1,0,0,0],[1])){n=F(b,e,g);break}k="B4W_PARALLAX";E=x("temp_texture");p.push(U(E));break;case "B4W_CLAMP":if(!H(b,[1],[1])){n=F(b,e,g);break}k="B4W_CLAMP";break;case "B4W_TRANSLUCENCY":if(!H(b,[0,0,0,0,0],[0])){n=F(b,e,g);break}k="B4W_TRANSLUCENCY";break;case "B4W_TIME":if(!H(b,[],[0])){n=F(b,e,g);break}k="B4W_TIME";break;case "B4W_SMOOTHSTEP":if(!H(b,[0,0,0],[0])){n=F(b,e,g);break}k="B4W_SMOOTHSTEP";break;case "B4W_GLOW_OUTPUT":k="B4W_GLOW_OUTPUT";break;default:n=F(b,e,g)}m=X(b);l=R(b);"B4W_TRANSLUCENCY"==
t&&(t=Q("TranslucencyParams","TranslucencyParams",[0,0,0,0]),t.is_linked=l[0].is_linked,l.push(t));break;case "LAMP":n=b.lamp;if(!n)return ma.error("There is no lamp in node: "+b.name),null;l.push(aa(b,"Color"));l.push(aa(b,"Light Vector"));l.push(aa(b,"Distance"));l.push(aa(b,"Visibility Factor"));n.uuid in J?q.push(["LAMP_INDEX",String(J[n.uuid])]):(J[n.uuid]=Ua,q.push(["LAMP_INDEX",String(Ua++)]));n=J;break;case "LIGHTING_AMBIENT":m=[Q("E","E",[0,0,0],!0),Q("A","A",[0,0,0],!0),Q("D","D",[0,0,0],
!0)];l=[Q("color","color",[0,0,0],!0),Q("specular","specular",[0,0,0],!0)];break;case "LIGHTING_BEGIN":l=[Q("E","E",[0,0,0],!0),Q("A","A",[0,0,0],!0),Q("D","D",[0,0,0],!0),Q("S","S",[0,0,0],!0),Q("normal","normal",[0,0,0],!0),Q("dif_params","dif_params",[0,0],!0),Q("sp_params","sp_params",[0,0],!0),Q("shadow_factor","shadow_factor",0,!0),Q("translucency_color","translucency_color",0,!0),Q("translucency_params","translucency_params",[0,0,0,0],!0)];break;case "LIGHTING_END":m=[Q("color","color",[0,
0,0],!0),Q("specular","specular",[0,0,0],!0)];break;case "LIGHTING_LAMP":m=[Q("shadow_factor","shadow_factor",0,!0)];l=[Q("ldir","ldir",[0,0,0],!0),Q("lfac","lfac",[0,0],!0),Q("lcolorint","lcolorint",[0,0,0],!0),Q("norm_fac","norm_fac",0,!0)];break;case "DIFFUSE_LAMBERT":m=[Q("ldir","ldir",[0,0,0],!0),Q("lfac","lfac",[0,0],!0),Q("normal","normal",[0,0,0],!0),Q("norm_fac","norm_fac",0,!0)];l=[Q("lfactor","lfactor",0,!0)];break;case "DIFFUSE_FRESNEL":case "DIFFUSE_MINNAERT":case "DIFFUSE_OREN_NAYAR":case "DIFFUSE_TOON":m=
[Q("ldir","ldir",[0,0,0],!0),Q("lfac","lfac",[0,0],!0),Q("normal","normal",[0,0,0],!0),Q("norm_fac","norm_fac",0,!0),Q("dif_params","dif_params",[0,0],!0)];l=[Q("lfactor","lfactor",0,!0)];break;case "SPECULAR_BLINN":case "SPECULAR_PHONG":m=[Q("ldir","ldir",[0,0,0],!0),Q("lfac","lfac",[0,0],!0),Q("normal","normal",[0,0,0],!0),Q("norm_fac","norm_fac",0,!0),Q("sp_params","sp_params",[0,0],!0)];l=[Q("sfactor","sfactor",0,!0)];break;case "SPECULAR_TOON":case "SPECULAR_WARDISO":m=[Q("ldir","ldir",[0,0,
0],!0),Q("lfac","lfac",[0,0],!0),Q("normal","normal",[0,0,0],!0),Q("sp_params","sp_params",[0,0],!0)];l=[Q("sfactor","sfactor",0,!0)];break;case "LIGHTING_APPLY":m=[Q("color","color",[0,0,0,0],!0),Q("specular","specular",[0,0,0],!0),Q("lfactor","lfactor",0,!0),Q("sfactor","sfactor",0,!0),Q("ldir","ldir",[0,0,0],!0),Q("normal","normal",[0,0,0],!0),Q("translucency_params","translucency_params",[0,0,0,0],!0),Q("D","D",[0,0,0],!0),Q("S","S",[0,0,0],!0),Q("lcolorint","lcolorint",[0,0,0],!0),Q("translucency_color",
"translucency_color",0,!0)];l=[Q("color","color",[0,0,0,0],!0),Q("specular","specular",[0,0,0],!0)];break;case "NORMAL":m=X(b);l=R(b);t=aa(b,"Normal");p.push(U(x("param_NORMAL_Normal"),t.default_value,3));break;case "MAPPING":t=b.vector_type;k="MAPPING";m.push(ea(b,"Vector"));l.push(aa(b,"Vector"));var E=b.rotation,v=b.scale,r=b.translation,u=ga.create(),B=ta.euler_to_rotation_matrix(E);"TEXTURE"==t&&(v[0]=v[0]||1,v[1]=v[1]||1,v[2]=v[2]||1);var w=new Float32Array([v[0],0,0,0,v[1],0,0,0,v[2]]);ga.multiply(B,
w,u);u=ta.mat3_to_mat4(u,ha.create());switch(t){case "POINT":u[12]=r[0];u[13]=r[1];u[14]=r[2];break;case "TEXTURE":u[12]=r[0];u[13]=r[1];u[14]=r[2];u=ha.invert(u,u);break;case "NORMAL":ha.invert(u,u),ha.transpose(u,u)}switch(t){case "NORMAL":q.push(["MAPPING_IS_NORMAL",1]);case "TEXTURE":q.push(["MAPPING_TRS_MATRIX",ca.glsl_value(u,16)]);break;case "POINT":0!==M.length(E)?q.push(["MAPPING_TRS_MATRIX",ca.glsl_value(u,16)]):(0!==M.length(v)&&q.push(["MAPPING_SCALE",ca.glsl_value(v,3)]),0!==M.length(r)&&
q.push(["MAPPING_TRANSLATION",ca.glsl_value(r,3)]));break;case "VECTOR":0!==M.length(E)?q.push(["MAPPING_TRS_MATRIX",ca.glsl_value(u,16)]):0!==M.length(v)&&q.push(["MAPPING_SCALE",ca.glsl_value(v,3)])}b.use_min&&q.push(["MAPPING_MIN_CLIP",ca.glsl_value(b.min,3)]);b.use_max&&q.push(["MAPPING_MAX_CLIP",ca.glsl_value(b.max,3)]);break;case "MATERIAL":case "MATERIAL_EXT":n=[];t=[];E=[];v=[Q("E","E",[0,0,0],!0),Q("A","A",[0,0,0],!0),Q("D","D",[0,0,0],!0),Q("S","S",[0,0,0],!0),Q("normal","normal",[0,0,0],
!0),Q("dif_params","dif_params",[0,0],!0),Q("sp_params","sp_params",[0,0],!0),Q("shadow_factor","shadow_factor",0,!0)];r=[Q("color","color",[0,0,0],!0),Q("specular","specular",[0,0,0],!0),Q("normal","normal",[0,0,0],!0)];u=[aa(b,"Color"),aa(b,"Alpha"),aa(b,"Normal")];B=[];w=ea(b,"Color");w.default_value.splice(3);E.push(w);m.push(w);w=ea(b,"Spec");w.default_value.splice(3);E.push(w);m.push(w);E.push(Q("DiffuseIntensity","DiffuseIntensity",b.diffuse_intensity));m.push(w);var y=ea(b,"Normal");y.default_value.splice(3);
E.push(y);m.push(y);"MATERIAL_EXT"==k?((w=ea(b,"Emit"))||(w=Q("Emit","Emit",0)),E.push(w),m.push(w),(w=ea(b,"Translucency"))?(w.default_value=0,w.name="Translucency",w.identifier="Translucency"):w=Q("Translucency","Translucency",0),m.push(w),(w=ea(b,"Translucency"))?(w.default_value=[0,0,0,0],w.name="TranslucencyParams",w.identifier="TranslucencyParams"):w=Q("TranslucencyParams","TranslucencyParams",[0,0,0,0]),m.push(w),l=ea(b,"Reflectivity"),w=ea(b,"Ray Mirror"),l?(w=l,l="Reflectivity"):w?l="Ray Mirror":
(w=l,l="Reflectivity"),w||(w=Q(l,l,0)),m.push(w),r.push(w),(w=ea(b,"SpecTra"))||(w=Q("SpecTra","SpecTra",0)),m.push(w),r.push(w),(w=ea(b,"Alpha"))||(w=Q("Alpha","Alpha",b.alpha)),m.push(w),r.push(w),u.push(aa(b,"Diffuse")),u.push(aa(b,"Spec")),n.push(["MATERIAL_EXT",1]),t.push(["MATERIAL_EXT",1])):(E.push(Q("emit_intensity","emit_intensity",0)),r.push(Q("reflect_factor","reflect_factor",0)),r.push(Q("specular_alpha","specular_alpha",0)),r.push(Q("alpha_in","alpha_in",0)),u.push(Q("diffuse_out","diffuse_out",
0)),u.push(Q("spec_out","spec_out",0)),n.push(["MATERIAL_EXT",0]),t.push(["MATERIAL_EXT",0]));B.push(U(x("param_MATERIAL_alpha"),b.alpha));B.push(U(x("param_MATERIAL_spec_alpha"),b.specular_alpha));l=u;y.is_linked&&n.push(["USE_MATERIAL_NORMAL",1]);b.use_diffuse&&(n.push(["USE_MATERIAL_DIFFUSE",1]),t.push(["USE_MATERIAL_DIFFUSE",1]));b.use_specular&&t.push(["USE_MATERIAL_SPECULAR",1]);var w=[],T=0;switch(b.specular_shader){case "COOKTORR":case "PHONG":y=b.specular_hardness;break;case "WARDISO":y=
b.specular_slope;break;case "TOON":y=b.specular_toon_size;T=b.specular_toon_smooth;break;case "BLINN":y=b.specular_ior;T=b.specular_hardness;break;default:ma.error("unsupported specular shader: "+b.specular_shader+' (material "'+b.material_name+'")'),y=b.specular_hardness}var da,D;switch(b.diffuse_shader){case "LAMBERT":D=da=0;break;case "OREN_NAYAR":da=b.roughness;D=0;break;case "FRESNEL":da=b.diffuse_fresnel;D=b.diffuse_fresnel_factor;break;case "MINNAERT":da=b.darkness;D=0;break;case "TOON":da=
b.diffuse_toon_size;D=b.diffuse_toon_smooth;break;default:ma.error("unsupported diffuse shader: "+b.diffuse_shader+' (material "'+b.material_name+'")'),D=da=0}w.push(U(x("param_MATERIAL_diffuse"),[da,D],2));w.push(U(x("param_MATERIAL_spec"),[b.specular_intensity,y,T],3));n.push(["SHADELESS_MAT",b.use_shadeless?1:0]);y={name:b.name,value:{specular_shader:b.specular_shader,diffuse_shader:b.diffuse_shader,use_shadeless:b.use_shadeless}};n={name:b.name,value:{specular_shader:b.specular_shader,diffuse_shader:b.diffuse_shader,
use_shadeless:b.use_shadeless},material_begin:{name:"material_begin",type:"MATERIAL_BEGIN",inputs:E,outputs:v,params:w,data:y,dirs:n,vparams:[]},material_end:{name:"material_end",type:"MATERIAL_END",inputs:r,outputs:u,params:B,data:y,dirs:t,vparams:[]}};break;case "MATH":switch(b.operation){case "ADD":k="MATH_ADD";break;case "SUBTRACT":k="MATH_SUBTRACT";break;case "MULTIPLY":k="MATH_MULTIPLY";break;case "DIVIDE":k="MATH_DIVIDE";break;case "SINE":k="MATH_SINE";break;case "COSINE":k="MATH_COSINE";break;
case "TANGENT":k="MATH_TANGENT";break;case "ARCSINE":k="MATH_ARCSINE";break;case "ARCCOSINE":k="MATH_ARCCOSINE";break;case "ARCTANGENT":k="MATH_ARCTANGENT";break;case "POWER":k="MATH_POWER";break;case "LOGARITHM":k="MATH_LOGARITHM";break;case "MINIMUM":k="MATH_MINIMUM";break;case "MAXIMUM":k="MATH_MAXIMUM";break;case "ROUND":k="MATH_ROUND";break;case "LESS_THAN":k="MATH_LESS_THAN";break;case "GREATER_THAN":k="MATH_GREATER_THAN";break;case "MODULO":k="MATH_MODULO";break;case "ABSOLUTE":k="MATH_ABSOLUTE";
break;default:return ma.error("Unsupported MATH operation: "+b.operation),null}q.push(["MATH_USE_CLAMP",Number(b.use_clamp)]);m=X(b);l=R(b);break;case "MIX_RGB":switch(b.blend_type){case "MIX":k="MIX_RGB_MIX";break;case "ADD":k="MIX_RGB_ADD";break;case "MULTIPLY":k="MIX_RGB_MULTIPLY";break;case "SUBTRACT":k="MIX_RGB_SUBTRACT";break;case "SCREEN":k="MIX_RGB_SCREEN";break;case "DIVIDE":k="MIX_RGB_DIVIDE";break;case "DIFFERENCE":k="MIX_RGB_DIFFERENCE";break;case "DARKEN":k="MIX_RGB_DARKEN";break;case "LIGHTEN":k=
"MIX_RGB_LIGHTEN";break;case "OVERLAY":k="MIX_RGB_OVERLAY";break;case "DODGE":k="MIX_RGB_DODGE";break;case "BURN":k="MIX_RGB_BURN";break;case "HUE":k="MIX_RGB_HUE";break;case "SATURATION":k="MIX_RGB_SATURATION";break;case "VALUE":k="MIX_RGB_VALUE";break;case "COLOR":k="MIX_RGB_COLOR";break;case "SOFT_LIGHT":k="MIX_RGB_SOFT_LIGHT";break;case "LINEAR_LIGHT":k="MIX_RGB_LINEAR_LIGHT";break;default:return ma.error("Unsupported MIX_RGB blend type: "+b.blend_type),null}q.push(["MIX_RGB_USE_CLAMP",Number(b.use_clamp)]);
m=X(b);l=R(b);break;case "OUTPUT":m=X(b);l=[];break;case "RGB":t=e+"%join%"+b.name;t={name:"-1",value:t};p.push(t);l.push(aa(b,"Color"));break;case "SEPRGB":case "SEPHSV":m=X(b);l=R(b);break;case "TEXTURE":k=S(b);if("TEXTURE_EMPTY"==k)l.push(aa(b,"Color")),l.push(aa(b,"Normal")),l.push(aa(b,"Value"));else if("TEXTURE_ENVIRONMENT"==k)m.push(ea(b,"Vector")),l.push(aa(b,"Color")),l.push(aa(b,"Value"));else{if("TEXTURE_NORMAL"==k&&"ENVIRONMENT_MAP"==b.texture.type)return ma.error("Wrong output for ENVIRONMENT_MAP texture: "+
b.name),null;for(n=0;4>n;++n)n?(w=Q("Vector"+n,"Vector"+n,[0,0,0]),"TEXTURE_COLOR"==k&&(t=Q("Color"+n,"Color"+n,[0,0,0]),E=Q("Value"+n,"Value"+n,0)),"TEXTURE_NORMAL"==k&&(t=Q("Normal"+n,"Normal"+n,[0,0,0]),E=Q("Value"+n,"Value"+n,0))):(w=ea(b,"Vector"),"TEXTURE_COLOR"==k&&(t=aa(b,"Color"),E=aa(b,"Value")),"TEXTURE_NORMAL"==k&&(t=aa(b,"Normal"),E=aa(b,"Value"))),m.push(w),l.push(t),l.push(E)}E=x("param_TEXTURE_texture");p.push(U(E));n={name:E,value:b.texture};break;case "VALTORGB":m=X(b);l=R(b);ma.warn("VALTORGB node is not fully supported.");
break;case "VALUE":k="VALUE";t=e+"%join%"+b.name;t={name:"-1",value:t};p.push(t);l.push(aa(b,"Value"));break;case "VECT_MATH":switch(b.operation){case "ADD":k="VECT_MATH_ADD";break;case "SUBTRACT":k="VECT_MATH_SUBTRACT";break;case "AVERAGE":k="VECT_MATH_AVERAGE";break;case "DOT_PRODUCT":k="VECT_MATH_DOT_PRODUCT";break;case "CROSS_PRODUCT":k="VECT_MATH_CROSS_PRODUCT";break;case "NORMALIZE":k="VECT_MATH_NORMALIZE";break;default:return ma.error("Unsupported VECT_MATH operation: "+b.operation),null}m=
X(b);l=R(b);break;default:m=X(b),l=R(b)}k={name:f,type:k,vparams:h,inputs:m,outputs:l,params:p,data:n,dirs:q};f=O.gen_node_id(a);O.append_node(a,O.gen_node_id(a),k);if(k="GEOMETRY"==b.type||"TEX_COORD"==b.type)a:{k=b.outputs;for(m=h=0;m<k.length;m++)if(k[m].is_linked&&h++>c){k=!0;break a}k=!1}return k&&null==z(a,b,++c,d,e,g)?null:f}function H(a,b,c){for(var d=a.inputs,e=a.outputs,g=a.node_tree_name,f=0;f<b.length;f++){var k=d[f],h=b[f];if(!k||k.default_value instanceof Array!=h)return ma.warn('Wrong inputs for custom node group "'+
a.name+'" of type: "',g,'".Processing as general node group.'),!1}for(f=0;f<c.length;f++)if(b=e[f],d=c[f],!b||b.default_value instanceof Array!=d)return ma.warn('Wrong outputs for custom node group "'+a.name+'" of type: "',g,'".Processing as general node group.'),!1;return!0}function F(a,b,c){var d=a.node_group.node_tree,e={},g;for(g in d)if("links"==g||"nodes"==g){e[g]=[];for(var f=0;f<d[g].length;f++){e[g][f]={};for(var k in d[g][f])if("links"==g){e[g][f][k]={};for(var h in d[g][f][k])e[g][f][k][h]=
L(d[g][f][k][h])}else e[g][f][k]=L(d[g][f][k])}}else e[g]=L(d[g]);d=a.node_tree_name;if("B4W_REPLACE"==d||"B4W_LEVELS_OF_QUALITY"==d)g=I("Group input","GROUP_INPUT",[],a.inputs),f=I("Group output","GROUP_OUTPUT",a.outputs,[]),k=null,k="B4W_REPLACE"==d||"B4W_LEVELS_OF_QUALITY"==d&&(Ea.quality==qa.P_LOW||Ea.force_low_quality_nodes)?{from_node:g,from_socket:g.outputs[1],to_node:f,to_socket:f.inputs[0]}:{from_node:g,from_socket:g.outputs[0],to_node:f,to_socket:f.inputs[0]},e.nodes=[g,f],e.links=[k];d=
a.name;g=e.nodes;f=e.links;for(k=0;k<g.length;k++)g[k].name=fa(g[k].type,d,g[k].name);for(k=0;k<f.length;k++)f[k].from_node.name=fa(f[k].from_node.type,d,f[k].from_node.name),f[k].to_node.name=fa(f[k].to_node.type,d,f[k].to_node.name);return{node_group_graph:u(e,a.node_group.uuid,!0,b,c),node_group_links:e.links}}function L(a){var b=typeof a;return"string"!=b&&"number"!=b&&"boolean"!=b&&a?ta.clone_object_nr(a):a}function x(a){la[a]||(la[a]=0);var b=a+la[a],b=b.replace(/ /g,"_").replace(/\//g,"_");
la[a]++;return b}function K(a){a=a.outputs;for(var b=0;b<a.length;b++)if(a[b].is_linked)return!0;return!1}function A(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var g=c[e];if(g.is_linked&&!(d++<b))switch(g.identifier){case "UV":return"GEOMETRY_UV";case "Vertex Color":return"GEOMETRY_VC";case "Normal":return"GEOMETRY_NO";case "Front/Back":return"GEOMETRY_FB";case "View":return"GEOMETRY_VW";case "Global":return"GEOMETRY_GL";case "Local":return"GEOMETRY_LO";case "Orco":return"GEOMETRY_OR";default:return null}}}
function P(a,b){for(var c=a.outputs,d=0,e=0;e<c.length;e++){var g=c[e];if(g.is_linked&&!(d++<b))switch(g.identifier){case "Camera":return"TEX_COORD_CA";case "Generated":return"TEX_COORD_GE";case "Normal":return"TEX_COORD_NO";case "Object":return"TEX_COORD_OB";case "Reflection":return"TEX_COORD_RE";case "UV":return"TEX_COORD_UV";case "Window":return"TEX_COORD_WI";default:return null}}}function S(a){if(!a.texture)return"TEXTURE_EMPTY";for(var b=a.outputs,c=!1,d=!1,e=!1,g=0;g<b.length;g++){var f=b[g];
if(f.is_linked)switch(f.identifier){case "Color":c=!0;break;case "Normal":d=!0;break;case "Value":e=!0;break;default:throw"Unknown texture output";}}if(c)return d&&ma.warn('Node "'+a.name+'" has both Color and Normal outputs. Normal will be omitted'),"ENVIRONMENT_MAP"==a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR";if(d)return"TEXTURE_NORMAL";if(e)return"ENVIRONMENT_MAP"==a.texture.type?"TEXTURE_ENVIRONMENT":"TEXTURE_COLOR"}function ea(a,b){for(var c=a.inputs,d=0;d<c.length;d++){var e=c[d];
if(e.identifier==b)return Y(e)}return null}function aa(a,b){for(var c=a.outputs,d=0;d<c.length;d++){var e=c[d];if(e.identifier==b)return Y(e)}return null}function Y(a){var b=a.name,c=a.identifier,d=a.is_linked;a=a.default_value;a=ta.is_vector(a)?a.slice(0):a;return{name:b,identifier:c,is_linked:d,default_value:a}}function Q(a,b,c,d){return{name:a,identifier:b,is_linked:d||!1,default_value:c}}function X(a){for(var b=[],c=0;c<a.inputs.length;c++){var d=Y(a.inputs[c]);d.default_value.length&&d.default_value.splice(3);
b.push(d)}return b}function R(a){for(var b=[],c=0;c<a.outputs.length;c++){var d=Y(a.outputs[c]);b.push(d)}return b}function U(a,b,c){b=null===b||void 0===b?null:ca.glsl_value(b,c);return{name:a,value:b}}function ba(a,b,c,d,e,g){var f=[],k=g.from_socket.identifier;g=g.to_socket.identifier;var h=d.outputs;for(d=0;d<h.length;d++)if(h[d].identifier==k){f.push(d);break}e=e.inputs;for(d=0;d<e.length;d++)if(e[d].identifier==g){f.push(d);break}2==f.length&&O.append_edge(a,b,c,f);return!0}function fa(a,b,
c){return"GROUP_INPUT"==a?b+"*GI*"+c:"GROUP_OUTPUT"==a?b+"*GO*"+c:b+"%join%"+c}function ja(a){var b=[];O.traverse(a,function(a,c){"GROUP"==c.type&&b.push(c)});return b}function pa(a,b,c){for(var d=0;d<c.length;d++){var e=c[d].data.node_group_graph,g=c[d].data.node_group_links;if(!e)return!1;O.traverse(e,function(b,c){O.append_node(a,O.gen_node_id(a),c)});for(e=0;e<g.length;e++)b.push(g[e]);da(c[d],b,a)}return!0}function na(a,b,c,d,e,g){switch(a.type){case "GROUP":a.name==b&&d.push(c);break;case "GROUP_INPUT":a.name.indexOf(b+
"*GI*")||e.push(c);break;case "GROUP_OUTPUT":a.name.indexOf(b+"*GO*")||g.push(c)}}function V(a,b,c){for(var d=[],e=0;e<c.length;e++){for(var g=c[e],f=null,k=0;k<b.length;k++)if(g.from_socket.identifier==b[k].to_socket.identifier){f=b[k];break}f?(g.from_node=f.from_node,g.from_socket=f.from_socket):d.push(g)}for(e=0;e<b.length;e++)a.splice(a.indexOf(b[e]),1);return d}function E(a,b){if(b.length)for(var c=b[0].from_node.name,d=0;d<a.length;d++)a[d].from_node.name==c&&b.push(a[d])}function T(a,b,c,d){for(var e=
0;e<d.length;e++){for(var g=d[e],f,k=0;k<c.inputs.length;k++)if(g.from_socket.identifier==c.inputs[k].identifier){f=c.inputs[k].default_value;break}for(var k=g,h=b,l=f,p=m(k.to_node,h),n=0;n<p.length;n++)for(var q=O.get_node_attr(h,p[n]),t=0;t<q.inputs.length;t++)if(q.inputs[t].identifier==k.to_socket.identifier){q.inputs[t].default_value=l;break}g=a.indexOf(g);-1!=g&&a.splice(g,1)}}function da(a,b,c){for(var d=a.name,e=[],g=[],f=[],k=[],h=0;h<b.length;h++){var m=b[h];na(m.from_node,d,m,e,f,k);na(m.to_node,
d,m,g,f,k)}g=V(b,g,f);e=V(b,k,e);E(b,g);T(b,c,a,g);if(e.length){var l;O.traverse(c,function(a,b){"GROUP_OUTPUT"!=b.type||b.name.indexOf(d+"*GO*")||(l=b)});T(b,c,l,e)}}var qa=r("__config"),O=r("__graph"),ga=r("__mat3"),ha=r("__mat4"),ia=r("__objects"),ma=r("__print"),ca=r("__shaders"),Z=r("__scenes"),ta=r("__util"),M=r("__vec3"),la={},oa={},J={},Ua=0;new Float32Array(4);var Ea=qa.defaults;a.compose_nmat_graph=u;a.create_lighting_graph=function(a,d,e){var g=Z.get_active();if(c(a,"MAIN",g.uuid)in oa)return oa[a];
var g=O.create(),f={name:"LIGHTING_BEGIN",type:"LIGHTING_BEGIN"},k=z(g,f,0,null,d,null),f={name:"LIGHTING_END",type:"LIGHTING_END"},f=z(g,f,0,null,d,null);b(g,e,k,f,[[k,[8,10]],[k,[9,6]]],null,d);q(g);return oa[a]=g};a.compose_node_elements=function(a){var b=[],c={};la={};var d=O.topsort(a);O.traverse(d,function(a,d){var e;e=[];for(var g=[],f=[],k=[],h=[],m=[],l=0;l<d.inputs.length;l++){var p=d.inputs[l];if(p.is_linked)e.push(null),g.push(null);else{e.push(x("in_"+d.type+"_"+p.identifier));var n=
ca.glsl_value(p.default_value,0);Ea.shader_constants_hack&&(0<=d.type.indexOf("MIX_RGB_")&&("Color1"==p.identifier||"Color2"==p.identifier||"Fac"==p.identifier)||0<=d.type.indexOf("MATH_")&&("Value"==p.identifier||"Value_001"==p.identifier)||0<=d.type.indexOf("VECT_MATH_")&&"Vector_001"==p.identifier)&&(p=n,p=p.replace(/(,)/g,"$1 "),p=p.replace(/(^|[^0-9]|\s)(0\.0)($|[^0-9]|\s)/g,"$1ZERO_VALUE_NODES$3"),p=p.replace(/(^|[^0-9]|\s)(1\.0)($|[^0-9]|\s)/g,"$1UNITY_VALUE_NODES$3"),n=p=p.replace(/\s+/g,
""));g.push(n)}}for(l=0;l<d.outputs.length;l++)p=d.outputs[l],p.is_linked?f.push(null):f.push(x("out_"+d.type+"_"+p.identifier));for(l=0;l<d.params.length;l++)p=d.params[l],k.push(p.name),h.push(p.value);for(l=0;l<d.vparams.length;l++)m.push(d.vparams[l].name);e={id:d.type,inputs:e,input_values:g,outputs:f,params:k,param_values:h,vparams:m,dirs:JSON.parse(JSON.stringify(d.dirs))};b.push(e);c[a]=e});O.traverse_edges(d,function(a,b,e){var g=O.get_node_attr(d,a);O.get_node_attr(d,b);var f=g.outputs[e[0]];
a=c[a].outputs;b=c[b].inputs;g=a[e[0]]||x("out_"+g.type+"_"+f.identifier);a[e[0]]=g;b[e[1]]=g});return b};a.check_material_glow_output=function(a){if(a.node_tree)for(var b=0;b<a.node_tree.nodes.length;b++){var c=a.node_tree.nodes[b];if("GROUP"==c.type&&"B4W_GLOW_OUTPUT"==c.node_tree_name)return!0}return!1};a.cleanup=function(){for(var a in oa)delete oa[a];for(var b in J)delete J[b];Ua=0}};b4w.module.__animation=function(a,r){function u(a,b){var c=a.anim_slots[b];c&&c.finish_callback&&c.exec_finish_callback&&(c.exec_finish_callback=!1,c.finish_callback(a,b))}function h(a,b,c){c=a.anim_slots[c];c.type=30;var d=b.frame_start,e=b.frame_end-d+1;c.start=d;c.length=e;c.current_frame_float=d;c.animation_name=b.name;for(e=d=0;e<a.vertex_anim.length;e++){var g=a.vertex_anim[e];if(g==b)break;else d+=g.frame_end-g.frame_start+1}c.va_frame_offset=d}function b(a,b,c){for(var d=a.scenes_data,e=0;e<
d.length;e++)for(var g=d[e].batches,f=0;f<g.length;f++){var k=g[f].particles_data;if(k&&k.name==b){var h=a.anim_slots[c];h.type=50;h.animation_name=k.name;h.start=k.frame_start;h.length=k.frame_end-h.start;k.cyclic||(h.length+=k.lifetime_frames)}}}function l(a){return a.replace(/_B4W_BAKED$/,"")}function c(a,b){if(a.animation_data){var d=a.animation_data.action;d&&d._render.type==ga&&b.push(d)}for(var d=a.nodes,e=0;e<d.length;e++){var g=d[e];g.node_group&&(g=g.node_group.node_tree)&&c(g,b)}}function f(a){return S.is_mesh(a)&&
a.render.vertex_anim?!0:!1}function n(a,b,c){var e=a.anim_slots;if(-1==c)for(c=0;8>c;c++){var g=e[c];g&&(g.current_frame_float=b,d(a,0,c,!0))}else if(g=e[c])g.current_frame_float=b,d(a,0,c,!0)}function q(a,b,c){if(-1==b)for(b=0;8>b;b++){var d=a[b];d&&c(d)}else(d=a[b])&&c(d)}function d(a,b,c,d){w(a,b,c,d);u(a,c);a.render.anim_mixing&&(D(a,b),C(a,b))}function k(a,b,c){var d=b.frame_range;if(d[0]>d[1])return Y.warn('Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),!1;var f=
b._render,k=a.anim_slots[c];k.animation_name=b.name;k.action_frame_range=d;k.action_step=f.pierce_step;k.action_bflags=f.bflags;k.channels_mask.set(f.channels_mask);k.start=d[0];k.length=d[1]-d[0];k.current_frame_float=d[0];switch(f.type){case da:if(S.is_armature(a)){k.type=10;var h=e(a,b);if(!h){for(var h=a.render.bone_pointers,d=[],l=[],n=b._render.num_pierced,q=0;q<n;q++){for(var t in h){var E=h[t],v=E.tsr_basis,u=b._render.bones[t];u?fa.copy(u.subarray(8*q,8*q+8),v):fa.identity(v);E.tsr_channel_cache_valid=
!1}E=p(h);d.push(E.trans);l.push(E.quats)}h={trans:d,quats:l};a.action_anim_cache.push(b,h)}k.trans=h.trans;k.quats=h.quats;k=h;t=a.render;h=t.skinned_renders;l=a.anim_slots[c];d=l.skinning_data;a:{n=t.skinning_data_cache;for(q=0;q<n.length;q+=2)if(b==n[q]){n=n[q+1];break a}n=null}if(n)l.skinning_data=n;else{for(l=0;l<h.length;l++){for(var n=h[l].bone_skinning_info,q=[],E=[],v=k.trans,u=k.quats,r=0;r<v.length;r++){var A=g(v[r],u[r],n);q.push(A.trans);E.push(A.quats)}d.push({trans:q,quats:E})}t.skinning_data_cache.push(b,
d)}t.anim_mixing&&(b=t.two_last_skeletal_slots,c>b[1]?(k=b[1],b[1]=c,b[0]=k):c>b[0]&&c<b[1]&&(b[0]=c),m(a))}break;case qa:S.is_speaker(a)&&(k.volume=f.params.volume||null,k.pitch=f.params.pitch||null,k.type=40);break;case ga:if("MESH"==a.type){k.type=60;t=e(a,b);if(!t){t=[];d=[];l=[];n=[];q=b._render;E=a.render.mats_anim_inds;v=a.render.mats_rgb_anim_inds;for(h in q.params)u=b.name+"%join%"+h,N(h,u,q,d,t,E),N(h,u,q,n,l,v);t={val_inds:t,values:d,rgb_inds:l,rgbs:n};a.action_anim_cache.push(b,t)}k.node_value_inds=
t.val_inds;k.nodemat_values=t.values;k.node_rgb_inds=t.rgb_inds;k.nodemat_rgbs=t.rgbs}break;case O:if(t=f.params.tsr){k.type=20;h=e(a,b);if(!h){h=b._render.num_pierced;d=[];l=[];for(n=0;n<h;n++)d.push(t.subarray(8*n,8*n+4)),l.push(t.subarray(8*n+4,8*n+8));h={trans:d,quats:l};a.action_anim_cache.push(b,h)}k.trans=h.trans;k.quats=h.quats;ea.obj_has_particles(a)&&ea.update_start_pos(a,k.trans[0],k.quats[0])}else return Y.warn('Incompatible action "'+b.name+'" has been applied to object "'+a.name+'"'),
!1}S.is_armature(a)&&f.type!=da&&B(a,c);return!0}function e(a,b){for(var c=a.action_anim_cache,d=0;d<c.length;d+=2)if(b==c[d])return c[d+1];return null}function m(a){var b=a.render.two_last_skeletal_slots;if(-1!=b[0]&&-1!=b[1]){var c=a.anim_slots;a=c[b[1]].current_frame_float;var d=Math.floor(a),e=a-d,b=c[b[0]];a=b.current_frame_float;d=Math.floor(a);b.current_frame_float=d+e}}function B(a,b){var c=a.render.two_last_skeletal_slots,d=c[1];c[0]=-1;c[1]=-1;if(-1!=b)for(var e=a.anim_slots;0<=d;d--){var g=
e[d];if(g&&10==g.type)if(d>c[1])c[1]=d;else{d>c[0]&&(c[1]=d);break}}}function N(a,b,c,d,e,g){for(var f=0;f<g.length;f+=2)b==g[f]&&(e.push(g[f+1]),d.push(new Float32Array(c.params[a])))}function G(a){a=a._render;for(var b in a.params)if(-1!=b.indexOf("nodes"))return!0;return!1}function w(a,b,c,d){if((c=a.anim_slots[c])&&null!=c.type&&(c.play||d)){var e=a.render,g=c.current_frame_float,f=c.start,k=c.length,g=g+c.speed*b*U.get_framerate(),h=c.type,m=c.speed;if(0<=m&&g>=f+k||0>m&&g<f)switch(d||(c.exec_finish_callback=
!0),c.behavior){case 10:g=0<=m?(g-f)%k+f:f+k-1E-6;break;case 20:g=0<=m?f:f+k-1E-6;c.play=!1;break;case 30:g=0<=m?f+k-1E-6:f,c.play=!1}c.current_frame_float=g;switch(h){case 10:if(!e.anim_mixing){d=t(c,g,ha);b=d[0];g=d[1];d=d[2];e.quats_before=c.quats[b];e.quats_after=c.quats[g];e.trans_before=c.trans[b];e.trans_after=c.trans[g];e.frame_factor=d;d=e.skinned_renders;c=c.skinning_data;for(f=0;f<d.length;f++)k=d[f],h=c[f],k.quats_before=h.quats[b],k.quats_after=h.quats[g],k.trans_before=h.trans[b],k.trans_after=
h.trans[g],k.frame_factor=e.frame_factor;ba.update_transform(a)}break;case 20:d=t(c,g,ha);var e=ia,g=d[0],f=d[1],k=d[2],h=c.trans,m=h[g][1],l=h[g][2],p=h[f][1],n=h[f][2];e[0]=(1-k)*h[g][0]+k*h[f][0];e[1]=(1-k)*m+k*p;e[2]=(1-k)*l+k*n;g=ca;l=d[0];f=d[1];k=d[2];h=c.quats;m=Z;m[0]=h[l][0];m[1]=h[l][1];m[2]=h[l][2];m[3]=h[l][3];l=ta;l[0]=h[f][0];l[1]=h[f][1];l[2]=h[f][2];l[3]=h[f][3];Q.slerp(m,l,k,g);f=d[2];k=c.trans;d=(1-f)*k[d[0]][3]+f*k[d[1]][3];c.trans_smooth_period&&(f=ma,ba.get_translation(a,f),
ja.smooth_v(e,f,b,c.trans_smooth_period,e));c.quat_smooth_period&&(f=Z,ba.get_rotation(a,f),ja.smooth_q(g,f,b,c.quat_smooth_period,g));c=c.channels_mask;c[0]&&ba.set_translation_rel(a,e);c[1]&&ba.set_rotation_rel(a,g);c[2]&&ba.set_scale_rel(a,d);ba.update_transform(a);aa.sync_transform(a);break;case 30:(a=ha)||(a=Array(3));g-=c.start;0>g&&(g=0);g>=c.length&&(g=c.length);b=Math.floor(g);d=b+1;g-=b;10!=c.behavior&&d==c.length&&(d=--b,g=1);c=c.va_frame_offset;a[0]=b+c;a[1]=d+c;a[2]=g;d=ha;e.va_frame=
d[0];e.va_frame_factor=d[2];break;case 40:d=t(c,g,ha);b=d[0];e=d[1];d=d[2];c.volume&&R.set_volume(a,(1-d)*c.volume[b]+d*c.volume[e]);c.pitch&&R.playrate(a,(1-d)*c.pitch[b]+d*c.pitch[e]);break;case 50:b=g/U.get_framerate();ea.set_time(a,c.animation_name,b);break;case 60:d=t(c,g,ha);b=d[0];e=d[1];d=d[2];h=c.nodemat_values;m=c.node_value_inds;g=c.nodemat_rgbs;c=c.node_rgb_inds;for(f=0;f<m.length;f++)l=h[f],k=m[f],a.render.mats_values[k]=(1-d)*l[b]+d*l[e];for(f=0;f<c.length;f++)m=g[f],k=c[f],h=m.subarray(3*
b,3*b+3),m=m.subarray(3*e,3*e+3),h=pa.lerp(h,m,d,ia),a.render.mats_rgbs[k]=h[0],a.render.mats_rgbs[k+1]=h[1],a.render.mats_rgbs[k+2]=h[2];break;default:ja.panic("Unknown animation type:"+h)}}}function t(a,b,c){c||(c=Array(3));var d=a.action_frame_range[0],e=a.action_frame_range[1]-d;b-=d;0>b&&(b=0);b>=e&&(b=e);b/=a.action_step;e=Math.floor(b);a=a.action_bflags[e]?b-e:0;b=Math.ceil(e+a);c[0]=e;c[1]=b;c[2]=a;return c}function C(a,b){var c=a.render,d=c.anim_mix_factor,e=c.two_last_skeletal_slots,g=e[0],
e=e[1];if(-1!=e){if(-1!=g){var f=a.anim_slots[g];if(f.play||0==b){var k=t(f,f.current_frame_float,ha),h=k[0],m=k[1];c.frame_factor=k[2];var k=f.quats[h],l=f.quats[m],h=f.trans[h],m=f.trans[m]}else d=1}else d=1;e=a.anim_slots[e];if(e.play||0==b){var g=t(e,e.current_frame_float,ha),p=g[0],n=g[1];c.frame_factor=g[2]}else if(-1!=g&&f.play)d=0;else return;g=e.quats[p];f=e.quats[n];p=e.trans[p];n=e.trans[n];if(1==d)c.quats_before.set(g),c.quats_after.set(f),c.trans_before.set(p),c.trans_after.set(n);else if(0==
d)c.quats_before.set(k),c.quats_after.set(l),c.trans_before.set(h),c.trans_after.set(m);else{for(e=0;e<k.length;e+=4){for(var q=ca,E=Z,v=0;4>v;v++)q[v]=k[e+v],E[v]=g[e+v];Q.slerp(q,E,d,q);for(v=0;4>v;v++)c.quats_before[e+v]=q[v];for(v=0;4>v;v++)q[v]=l[e+v],E[v]=f[e+v];Q.slerp(q,E,d,q);for(v=0;4>v;v++)c.quats_after[e+v]=q[v]}ja.blend_arrays(h,p,d,c.trans_before);ja.blend_arrays(m,n,d,c.trans_after)}ba.update_transform(a);na.update_skinned_renders(a)}}function D(a,b){var c=a.render,d=c.anim_mix_factor,
e=c.anim_mix_factor_change_speed;if(0!=e){var d=c.anim_destination_mix_factor-d,g=e*b;ja.sign(d)==ja.sign(e)&&Math.abs(g)<Math.abs(d)?c.anim_mix_factor+=g:(c.anim_mix_factor=c.anim_destination_mix_factor,c.anim_mix_factor_change_speed=0)}}function p(a){var b=[],c=[],d=new Float32Array(4),e=new Float32Array(4),g;for(g in a){var f=a[g],k=d,h=e,m=f.chain,l=m[m.length-1],p=l.tsr_channel_cache;l.tsr_channel_cache_valid||fa.identity(p);for(l=m.length-1;0<=l;l--){var n=m[l],q=n.tsr_channel_cache;if(n.tsr_channel_cache_valid)p=
q;else{var t=n.tsr_local_rest,E=n.tsr_basis;fa.invert(t,M);fa.multiply(E,M,M);fa.multiply(t,M,M);fa.multiply(p,M,q);p=q;n.tsr_channel_cache_valid=!0}}m=n.tsr_channel_cache;k[0]=m[0];k[1]=m[1];k[2]=m[2];k[3]=m[3];h[0]=m[4];h[1]=m[5];h[2]=m[6];h[3]=m[7];Q.normalize(h,h);f=f.bone_index;for(k=0;4>k;k++)h=4*f+k,b[h]=d[k],c[h]=e[k]}return{trans:b,quats:c}}function g(a,b,c){var d=[],e=[];new Float32Array(4);new Float32Array(4);for(var g in c)for(var f=c[g],k=f.bone_index,f=f.deform_bone_index,h=0;4>h;h++){var m=
4*f+h,l=4*k+h;d[m]=a[l];e[m]=b[l]}d=new Float32Array(d);e=new Float32Array(e);return{trans:d,quats:e}}function y(a){var b=a._render;b.bones?b.type=da:b.params?"volume"in b.params||"pitch"in b.params?b.type=qa:G(a)?b.type=ga:b.type=O:b.type=T}function G(a){if(a=a._render.params)for(var b in a)if(-1!=b.indexOf("nodes"))return!0;return!1}function v(a,b){b[0]=b[1]=b[2]=0;for(var c in a)"location"==c?b[0]=1:"rotation_quaternion"==c?b[1]=1:"scale"==c&&(b[2]=1)}function I(a,b,c,d,e,g,f){var k=a+(b-a)/2,
h=z(k,d,e,g,f)-c;return.02>Math.abs(h)?k:0<h?I(a,k,c,d,e,g,f):I(k,b,c,d,e,g,f)}function z(a,b,c,d,e){var g=1-a;return b*g*g*g+3*c*g*g*a+3*d*g*a*a+e*a*a*a}function H(a,b){var c={type:null,animation_name:null,action_frame_range:null,action_step:0,action_bflags:null,channels_mask:new Int8Array(3),quats:null,trans:null,skinning_data:[],play:!1,behavior:20,current_frame_float:0,start:0,length:0,trans_smooth_period:0,quat_smooth_period:0,exec_finish_callback:!1,va_frame_offset:null,speed:1,volume:null,
pitch:null,nodemat_values:[],node_value_inds:[],nodemat_rgbs:[],node_rgb_inds:[]};if(!a.anim_slots.length)for(var d=0;8>d;d++)a.anim_slots.push(null);a.anim_slots[b]=c;-1==la.indexOf(a)&&la.push(a)}function F(a,b){ba.update_transform(a);aa.sync_transform(a);d(a,0,b,!0)}function L(a,c,d){d=d||0;if(S.is_mesh(a)){var e=x(a,c);if(e)return H(a,d),h(a,e,d),F(a,d),!0;if((e=K(a,c))&&"EMITTER"==e.p_type)return H(a,d),b(a,e.name,d),F(a,d),!0}if(e=ja.keysearch("name",c,oa)||ja.keysearch("name",c+"_B4W_BAKED",
oa)){H(a,d);if(k(a,e,d))return F(a,d),!0;a.anim_slots[d]=null}Y.error('Unsupported object: "'+a.name+'" or animation name: "'+c+'"');return!1}function x(a,b){for(var c=0;c<a.vertex_anim.length;c++){var d=a.vertex_anim[c];if(d.name===b)return d}return null}function K(a,b){for(var c=a.scenes_data,d=0;d<c.length;d++)for(var e=c[d].batches,g=0;g<e.length;g++){var f=e[g].particles_data;if(f&&f.name===b)return f}return null}function A(a){a=a.modifiers;for(var b=0;b<a.length;b++){var c=a[b];if("ARMATURE"==
c.type)return c.object}return null}var P=r("__config"),S=r("__obj_util"),ea=r("__particles"),aa=r("__physics"),Y=r("__print"),Q=r("__quat"),X=r("__reformer"),R=r("__sfx"),U=r("__time"),ba=r("__transform"),fa=r("__tsr"),ja=r("__util"),pa=r("__vec3"),na=r("__armature"),V=P.animation,E=P.defaults;a.LAST_FRAME_EPSILON=1E-6;a.OBJ_ANIM_TYPE_NONE=0;a.OBJ_ANIM_TYPE_ARMATURE=10;a.OBJ_ANIM_TYPE_OBJECT=20;a.OBJ_ANIM_TYPE_VERTEX=30;a.OBJ_ANIM_TYPE_SOUND=40;a.OBJ_ANIM_TYPE_PARTICLES=50;a.OBJ_ANIM_TYPE_MATERIAL=
60;a.SLOT_0=0;a.SLOT_1=1;a.SLOT_2=2;a.SLOT_3=3;a.SLOT_4=4;a.SLOT_5=5;a.SLOT_6=6;a.SLOT_7=7;a.SLOT_ALL=-1;a.AB_CYCLIC=10;a.AB_FINISH_RESET=20;a.AB_FINISH_STOP=30;var T=a.AT_NONE=0,da=a.AT_ARMATURE=1,qa=a.AT_SPEAKER=2,O=a.AT_OBJECT=3,ga=a.AT_MATERIAL=4,ha=Array(3),ia=new Float32Array(3),ma=new Float32Array(3),ca=new Float32Array(4),Z=new Float32Array(4),ta=new Float32Array(4),M=new Float32Array(8);new Float32Array(16);var la=[],oa=[];a.get_max_bones=function(){return ja.trunc((E.max_vertex_uniform_vectors-
50)/4)};a.frame_to_sec=function(a){return a/U.get_framerate()};a.update=function(a){for(var b=0;b<la.length;b++){for(var c=la[b],d=0;8>d;d++)w(c,a,d);c.render.anim_mixing&&(D(c,a),C(c,a))}for(b=0;b<la.length;b++)for(c=la[b],d=0;8>d&&c.anim_slots.length;d++)u(c,d)};a.get_all_actions=function(){return oa};a.get_anim_names=function(a){var b=[];if(f(a))for(var c=0;c<a.vertex_anim.length;c++)b.push(a.vertex_anim[c].name);for(var d=[],c=0;c<oa.length;c++){var e=oa[c],g=e._render;g.type==O?d.push(e):g.type==
da&&"ARMATURE"==a.type?d.push(e):g.type==qa&&"SPEAKER"==a.type&&d.push(e)}if("MESH"==a.type)for(c=0;c<a.actions.length;c++)e=a.actions[c],e._render.type==ga&&d.push(e);for(c=0;c<d.length;c++)b.push(l(d[c].name));if(ea.obj_has_particles(a)&&ea.obj_has_anim_particles(a))for(a=a.scenes_data,c=0;c<a.length;c++)for(d=a[c].batches,e=0;e<d.length;e++)(g=d[e].particles_data)&&b.push(g.name);return b};a.strip_baked_suffix=l;a.get_anim_type=function(a,b){var c=a.anim_slots[b];return c?c.type:0};a.apply_def=
function(a){for(var c=0,d=a.scenes_data,e=0;e<d.length;e++)for(var g=d[e].batches,m=0;m<g.length;m++){var l=g[m].particles_data;l&&"EMITTER"==l.p_type&&(H(a,c),b(a,l.name,c),F(a,c),a.anim_slots[c].behavior=a.anim_behavior_def,l.cyclic&&(a.anim_slots[c].behavior=10),c++)}d=a.actions.slice();for(e=0;e<d.length;e++)g=d[e],H(a,c),k(a,g,c)?(F(a,c),a.anim_slots[c].behavior=a.anim_behavior_def,c++):a.anim_slots[c]=null;f(a)&&(H(a,c),h(a,a.vertex_anim[0],c),F(a,c),a.anim_slots[c].behavior=a.anim_behavior_def)};
a.anim_behavior_bpy_b4w=function(a){switch(a){case "CYCLIC":return 10;case "FINISH_RESET":return 20;case "FINISH_STOP":return 30;default:ja.panic("Wrong animation behavior")}};a.get_bpy_material_actions=function(a){var b=[];a=a.data.materials;for(var d=0;d<a.length;d++){var e=a[d].node_tree;e&&c(e,b)}return b};a.play=function(a,b,c){q(a.anim_slots,c,function(a){a.play=!0;a.finish_callback=b?b:null;a.exec_finish_callback=!1});a.render.anim_mixing&&m(a)};a.stop=function(a,b){q(a.anim_slots,b,function(a){a.play=
!1;a.finish_callback=null;a.exec_finish_callback=!1})};a.is_play=function(a,b){var c=a.anim_slots;if(-1==b)for(var d=0;8>d;d++){if(c[d]&&c[d].play)return!0}else if(c=c[b])return c.play;return!1};a.set_frame=n;a.set_first_frame=function(a,b){b=b||0;q(a.anim_slots,b,function(c){n(a,c.start,b)})};a.get_current_frame_float=function(a,b){var c=a.anim_slots[b];return c&&c.current_frame_float?c.current_frame_float:0};a.is_cyclic=function(a,b){var c=a.anim_slots[b];return c&&10==c.behavior};a.set_behavior=
function(a,b,c){q(a.anim_slots,c,function(a){a.behavior=b})};a.get_behavior=function(a,b){var c=a.anim_slots[b];return c&&c.behavior};a.apply_smoothing=function(a,b,c,d){q(a.anim_slots,d,function(a){a.trans_smooth_period=b||0;a.quat_smooth_period=c||0})};a.remove_slot_animation=function(a,b){if(-1==b)for(var c=0;8>c;c++)a.anim_slots[c]=null;else a.anim_slots[b]=null;a.render.anim_mixing&&B(a,b)};a.update_object_animation=d;a.obj_is_animatable=function(a){if("ARMATURE"==a.type||a.armobj)return!0;for(var b=
0;b<a.actions.length;b++){var c=a.actions[b]._render.type;if(c==O||c==da||c==qa&&"SPEAKER"==a.type||c==ga&&"MESH"==a.type)return!0}return ea.obj_has_particles(a)&&ea.obj_has_anim_particles(a)||"MESH"==a.type&&a.vertex_anim.length?!0:!1};a.bpy_obj_is_animatable=function(a,b){if("ARMATURE"==b.type||A(a))return!0;for(var c=0;c<b.actions.length;c++){var d=b.actions[c]._render.type;if(d==O||d==da||d==qa&&"SPEAKER"==b.type||d==ga&&"MESH"==b.type)return!0}return ea.bpy_obj_has_particles(a)&&ea.bpy_obj_has_anim_particles(a)||
"MESH"==b.type&&a.data.b4w_vertex_anim.length?!0:!1};a.is_animated=function(a){return Boolean(a.anim_slots.length)};a.calc_pose_data=p;a.extract_skinned_pose_data=g;a.append_action=function(a){var b=new RegExp(/pose.bones\[\".+\"\]/g),c=fa.create(),d=function(a,d,e,g,f){if(-1<e.search(b)){a=d;e=e.split('"')[1];var k=c}else 8==f?(e="tsr",k=c):k=1<f?new Float32Array(f):0;if(!a[e]){f=a;d=e;if("object"==typeof k&&k.length)for(var h=k.length,m=new Float32Array(g*h),l=0;l<g;l++)for(var p=0;p<h;p++)m[l*
h+p]=k[p];else if("number"==typeof k)for(m=new Float32Array(g),l=0;l<g;l++)m[l]=k;else ja.panic("Wrong storage default value");f[d]=m}return a[e]},e=function(a,b){if(-1<a.indexOf("location"))var c=0,d=b;else-1<a.indexOf("rotation_quaternion")?(c=4,d=0==b?3:b-1):-1<a.indexOf("scale")?(c=3,d=0):(c=0,d=b);return c+d},g=function(a,b){for(var c=0;c<b;c++){var d=a.subarray(8*c+4,8*c+8);Q.normalize(d,d)}},f=a._render={type:T,num_pierced:0,pierce_step:0,params:null,bones:null,bflags:null,channels_mask:new Int8Array(3)};
f.pierce_step=1/V.frame_steps;var k=a.fcurves,h={},m={},l=0,p;for(p in k){var n=k[p],q;for(q in n){var t=n[q],E=t._pierced_points;X.check_anim_fcurve_completeness(t,a);t=t.num_channels;l||(l=E.length);for(var t=d(h,m,p,l,t),u=t.length/l,r=e(p,q|0),A=0;A<l;A++)t[A*u+r]=E[A]}}if(ja.get_dict_length(h)){for(var B in h)"tsr"==B&&g(h[B],l);f.params=h}if(ja.get_dict_length(m)){for(var x in m)g(m[x],l);f.bones=m}f.num_pierced=l;f.bflags=a._bflags;"tsr"in h&&v(k,f.channels_mask);y(a);oa.push(a)};a.get_approx_curve_length=
function(a,b){return(b-a)*V.frame_steps+1};a.approximate_curve=function(a,b,c,d,e,g){var f,k,h=new Float32Array(2),m=new Float32Array(2),l=new Float32Array(2),p=new Float32Array(2),n=b[1],q=b[2],t=b[a.last_frame_offset+1];a=b[a.last_frame_offset+2];for(var E=0,v=0,u=null;e<=g;e++)if(e<n)for(var r=0;r<V.frame_steps;r++)c[E++]=q;else if(e>t)for(r=0;r<V.frame_steps;r++)c[E++]=a;else{var A=b[v],B=3;0===A&&(B+=2);0===u&&(B+=2);var x=2===A?0:1;if(b[v+1]==b[v+B+1])u=A,v+=B;else{r=0;e==b[v+1]&&(x&&(d[E]=
1),c[E]=b[v+2],E++,r++);if(e==t)for(;r<V.frame_steps;r++)c[E++]=a;else for(h[0]=b[v+1],h[1]=b[v+2],0!==A?(m[0]=0,m[1]=0):0===u?(m[0]=b[v+5],m[1]=b[v+6]):(m[0]=b[v+3],m[1]=b[v+4]),0!==A?(l[0]=0,l[1]=0):(l[0]=b[v+B+3],l[1]=b[v+B+4]),p[0]=b[v+B+1],p[1]=b[v+B+2];r<V.frame_steps;r++){var w=e+r/V.frame_steps;switch(A){case 0:f=h;k=m;var y=l,T=p,F=[],da=[],D=void 0,C=void 0,L=void 0,D=void 0;F[0]=f[0]-k[0];F[1]=f[1]-k[1];da[0]=T[0]-y[0];da[1]=T[1]-y[1];L=T[0]-f[0];D=Math.abs(F[0]);C=Math.abs(da[0]);0!=D+
C&&D+C>L&&(D=L/(D+C),k[0]=f[0]-D*F[0],k[1]=f[1]-D*F[1],y[0]=T[0]-D*da[0],y[1]=T[1]-D*da[1]);x&&(d[E]=1);f=E;k=h;y=m;T=l;F=p;w=I(0,1,w,k[0],y[0],T[0],F[0]);w=z(w,k[1],y[1],T[1],F[1]);c[f]=w;E++;break;case 1:k=h[0];y=h[1];f=T=(p[1]-y)/(p[0]-k);k=y-T*k;x&&(d[E]=1);c[E]=f*w+k;E++;break;case 2:x&&(d[E]=1);c[E]=b[v+2];E++;break;default:ja.panic("Unknown keyframe intepolation mode: "+A)}}e+1==b[v+B+1]&&(u=A,v+=B)}}};a.apply=L;a.apply_by_uuid=function(a,b,c){c=c||0;var d=ja.keysearch("uuid",b,oa);if(d){H(a,
c);if(k(a,d,c))return F(a,c),!0;a.anim_slots[c]=null}Y.error('Unsupported object: "'+a.name+'" or animation uuid: "'+b+'"');return!1};a.validate_action_by_name=function(a,b){var c=ja.keysearch("name",b,oa)||ja.keysearch("name",b+"_B4W_BAKED",oa);if(c){if(c._render.type==T)return!1}else if(!(K(a,b)||S.is_mesh(a)&&x(a,b)))return!1;return!0};a.get_slot_num_by_anim=function(a,b){for(var c=a.anim_slots,d=0;d<c.length;d++){var e=c[d];if(e&&l(e.animation_name)==l(b))return d}return-1};a.get_anim_by_slot_num=
function(a,b){var c=a.anim_slots[b];return c&&c.animation_name?l(c.animation_name):null};a.remove=function(a){a.anim_slots.length=0;a=la.indexOf(a);-1!=a&&la.splice(a,1)};a.remove_actions=function(a){for(var b=oa.length-1;0<=b;b--)oa[b]._data_id==a&&oa.splice(b,1)};a.apply_to_first_empty_slot=function(a,b){if(!a.anim_slots.length)return L(a,b,0)?0:-1;for(var c=0;c<a.anim_slots.length;c++)if(!a.anim_slots[c])return L(a,b,c)?c:-1};a.set_skel_mix_factor=function(a,b,c){a.render.anim_mix_factor_change_speed=
(b-a.render.anim_mix_factor)/c;a.render.anim_destination_mix_factor=b};a.set_speed=function(a,b,c){q(a.anim_slots,c,function(a){a.speed=b})};a.get_speed=function(a,b){return a.anim_slots[b].speed};a.get_anim_start_frame=function(a,b){return a.anim_slots[b].start};a.get_anim_length=function(a,b){return a.anim_slots[b].length};a.cleanup=function(){la.length=0;oa.length=0};a.fcurve_replace_euler_by_quat=function(a){var b=(a[0]||a[1]||a[2])._pierced_points.length,c=ca,d=ia,e=Boolean(a[0]);e||(a[0]={_pierced_points:new Float32Array(b),
num_channels:8});var g=Boolean(a[1]);g||(a[1]={_pierced_points:new Float32Array(b),num_channels:8});var f=Boolean(a[2]);f||(a[2]={_pierced_points:new Float32Array(b),num_channels:8});a[3]={_pierced_points:new Float32Array(b),num_channels:8};for(var k=0;k<b;k++)d[0]=e?a[0]._pierced_points[k]:0,d[1]=g?a[1]._pierced_points[k]:0,d[2]=f?a[2]._pierced_points[k]:0,ja.euler_to_quat(d,c),a[0]._pierced_points[k]=c[3],a[1]._pierced_points[k]=c[0],a[2]._pierced_points[k]=c[1],a[3]._pierced_points[k]=c[2]};a.get_bpy_armobj=
A};b4w.module.__time=function(a,r){var u=r("__config");r("__print");r("__util");var h=0,b=0,l=[],c=0,f=0,n=[],q=-1;a.set_timeline=function(a){h=a;b=performance.now();for(a=0;a<l.length;a++){var c=l[a];h>c.expire_time&&(l.splice(a,1),a--,c.callback())}for(a=0;a<n.length;a++){var c=n[a],e=1-(c.expire_time-h)/c.duration,e=Math.min(e,1);c.callback(c.from+e*(c.to-c.from));1==e&&(n.splice(a,1),a--)}};a.get_timeline=function(){return h};a.set_timeout=function(a,f){var e;c++;e=c;var m={id:e,callback:a,expire_time:h+
(performance.now()-b+f)/1E3};l.push(m);return e};a.clear_timeout=function(a){for(var b=0;b<l.length;b++)if(l[b].id==a){l.splice(b,1);break}};a.clear_animation=function(a){for(var b=n.length;b--;)if(n[b].id==a){n.splice(b,1);break}};a.animate=function(a,b,c,m){c/=1E3;var l;f++;l=f;n.push({id:l,callback:m,from:a,to:b,expire_time:h+c,duration:c});m(a);return l};a.reset=function(a){b=h=0;l.length=0;f=c=n.length=0};a.get_framerate=function(){return-1!==u.animation.framerate?u.animation.framerate:q};a.set_framerate=
function(a){q=a}};b4w.module.__transform=function(a,r){function u(a,b){if(k.has_child_of(a)){var c=k.get_child_of_offset(a);t.set_trans(b,c)}else g.copy(b,a.render.trans)}function h(a,b){var c=a.render;if(k.has_child_of(a)){t.set_quat(b,c.tsr);var d=k.get_child_of_parent_tsr(a),d=t.invert(d,z),e=k.get_child_of_offset(a);t.multiply(d,c.tsr,e)}else N.copy(b,c.quat)}function b(a,b){if(k.has_child_of(a)){var c=k.get_child_of_offset(a);t.set_quat(b,c)}else N.copy(b,a.render.quat)}function l(a,b){if(k.has_child_of(a)){var d=
k.get_child_of_offset(a);t.copy(b,d)}else c(a,b)}function c(a,b){var c=a.render;c.trans[0]=b[0];c.trans[1]=b[1];c.trans[2]=b[2];c.scale=b[3];c.quat[0]=b[4];c.quat[1]=b[5];c.quat[2]=b[6];c.quat[3]=b[7]}function f(a,b){if(k.has_child_of(a)){var c=k.get_child_of_offset(a);t.copy(c,b)}else c=a.render,t.set_sep(c.trans,c.scale,c.quat,b);return b}function n(a){var b=a.render,c=a.scenes_data,g=a.type;"CAMERA"==g&&d.update_camera_upside_down(a);k.update_constraint(a,F);"CAMERA"==g&&d.update_camera(a);var f=
b.trans,h=b.scale,l=b.quat;t.set_sep(f,h,l,b.tsr);var v=b.world_matrix;m.fromQuat(l,v);"CAMERA"!=g&&p.scale_mat4(v,h,v);v[12]=f[0];v[13]=f[1];v[14]=f[2];m.invert(v,b.inv_world_matrix);b.bb_local&&b.bb_world&&(q.bounding_box_transform(b.bb_local,v,b.bb_world),q.bounding_sphere_transform(b.bs_local,v,b.bs_world),q.bounding_ellipsoid_transform(b.be_local,b.tsr,b.be_world));switch(g){case "SPEAKER":w.speaker_update_transform(a,F);break;case "MESH":if(v=a.armobj)t.invert(v.render.tsr,z),t.multiply(z,b.tsr,
z),y.set(z[0],z[1],z[2],z[3],b.arm_rel_trans),N.set(z[4],z[5],z[6],z[7],b.arm_rel_quat);break;case "CAMERA":d.update_camera_transform(a);G.check_active()&&(h=G.get_active(),G.get_camera(h)==a&&w.listener_update_transform(h,f,l,F));break;case "LAMP":e.update_light_transform(a)}for(h=0;h<c.length;h++){var r=c[h];if(r.is_active){var v=r.scene,u=v._render,H=r.batches;switch(g){case "LAMP":G.update_lamp_scene(a,v);break;case "CAMERA":G.schedule_grass_map_update(v);u.shadow_params&&u.shadow_params.enable_csm&&
G.schedule_shadow_update(v);break;case "MESH":b.bb_local&&b.bb_world&&(b.shadow_cast&&G.schedule_shadow_update(v),u=r.cube_refl_subs,null!=b.cube_reflection_id&&u&&G.update_cube_reflect_subs(u,f));a.anim_slots.length&&B.obj_has_anim_particles(a)&&B.update_emitter_transform(a,H);break;case "EMPTY":C.update_force(a)}r=r.plane_refl_subs;H=a.reflective_objs;H.length&&r&&(u=r.camera,G.update_plane_reflect_subs(r,f,l),D.update_refl_objects(H,u.reflection_plane),d.set_view(u,G.get_camera(v)),p.extract_frustum_planes(u.view_proj_matrix,
u.frustum_planes))}}c=a.cons_descends;for(h=0;h<c.length;h++)n(c[h]);a=a.cons_armat_bone_descends;for(h=0;h<a.length;h++)c=a[h],v=c[0],k.update_bone_constraint(v,c[1]);b.force_zsort=!0}var q=r("__boundings"),d=r("__camera"),k=r("__constraints"),e=r("__lights");r("__mat3");var m=r("__mat4"),B=r("__particles"),N=r("__quat"),G=r("__scenes"),w=r("__sfx"),t=r("__tsr"),C=r("__objects"),D=r("__obj_util"),p=r("__util"),g=r("__vec3"),y=r("__vec4"),v=new Float32Array(3),I=new Float32Array(4);new Float32Array(9);
var z=t.create(),H=t.create(),F=0;a.SPACE_WORLD=0;a.SPACE_LOCAL=1;a.SPACE_PARENT=2;a.update=function(a){F=a};a.set_translation=function(a,b){var c=a.render;if(k.has_child_of(a)){t.set_trans(b,c.tsr);var d=k.get_child_of_parent_tsr(a),d=t.invert(d,z),e=k.get_child_of_offset(a);t.multiply(d,c.tsr,e)}else g.copy(b,c.trans)};a.set_translation_rel=u;a.get_translation=function(a,b){g.copy(a.render.trans,b);return b};a.get_translation_rel=function(a,b){if(k.has_child_of(a)){var c=k.get_child_of_offset(a);
g.copy(t.get_trans_view(c),b)}else g.copy(a.render.trans,b);return b};a.set_rotation=h;a.set_rotation_rel=b;a.get_rotation=function(a,b){N.copy(a.render.quat,b);return b};a.get_rotation_rel=function(a,b){if(k.has_child_of(a)){var c=k.get_child_of_offset(a);N.copy(t.get_quat_view(c),b)}else N.copy(a.render.quat,b);return b};a.set_rotation_euler=function(a,b){var c=p.euler_to_quat(b,I);h(a,c)};a.set_rotation_euler_rel=function(a,c){var d=p.euler_to_quat(c,I);b(a,d)};a.set_scale=function(a,b){var c=
a.render;if(k.has_child_of(a)){var c=k.get_child_of_offset(a),d=t.get_scale(k.get_child_of_parent_tsr(a));t.set_scale(b/d,c)}else c.scale=b};a.set_scale_rel=function(a,b){if(k.has_child_of(a)){var c=k.get_child_of_offset(a);t.set_scale(b,c)}else a.render.scale=b};a.get_scale=function(a){return a.render.scale};a.get_scale_rel=function(a){return k.has_child_of(a)?(a=k.get_child_of_offset(a),t.get_scale(a)):a.render.scale};a.set_tsr=function(a,b){var d=a.render;if(k.has_child_of(a)){t.set_trans(trans,
d.tsr);var e=k.get_child_of_parent_tsr(a),e=t.invert(e,z),g=k.get_child_of_offset(a);t.multiply(e,d.tsr,g)}else c(a,b)};a.set_tsr_rel=l;a.get_tsr=function(a,b){var c=a.render;t.set_sep(c.trans,c.scale,c.quat,b);return b};a.get_tsr_rel=f;a.get_object_size=function(a){var b=a.render,c=b.bb_original;a=b.scale*(c.max_x-c.min_x);var d=b.scale*(c.max_y-c.min_y),b=b.scale*(c.max_z-c.min_z);return.5*Math.sqrt(a*a+d*d+b*b)};a.get_object_center=function(a,b,c){c||(c=new Float32Array(3));b?(a=a.render,g.copy(a.bs_world.center,
c)):(a=a.render,b=a.bb_original,c[0]=(b.max_x+b.min_x)/2,c[1]=(b.max_y+b.min_y)/2,c[2]=(b.max_z+b.min_z)/2,g.transformMat4(c,a.world_matrix,c));return c};a.move_local=function(a,b,c,d){var e=f(a,z);v[0]=b;v[1]=c;v[2]=d;t.transform_vec3(v,e,v);u(a,v)};a.rotate_local=function(a,b){var c=f(a,z),d=t.set_quat(b,t.identity(H));t.multiply(c,d,d);l(a,d)};a.update_transform=n;a.distance=function(a,b){return g.dist(a.render.trans,b.render.trans)};a.obj_point_distance=function(a,b){return g.dist(a.render.trans,
b)};a.get_object_bounding_box=function(a){return{max_x:a.render.bb_world.max_x,min_x:a.render.bb_world.min_x,max_y:a.render.bb_world.max_y,min_y:a.render.bb_world.min_y,max_z:a.render.bb_world.max_z,min_z:a.render.bb_world.min_z}}};b4w.module.__tsr=function(a,r){function u(a,b,c,f){f[0]=a[0];f[1]=a[1];f[2]=a[2];f[3]=b;f[4]=c[0];f[5]=c[1];f[6]=c[2];f[7]=c[3];return f}function h(a,b,c){var f=b[0],h=b[1],l=b[2],n=b[3],q=b[4],t=b[5],u=b[6];b=b[7];var r=a[0]*n,p=a[1]*n,g=a[2]*n;a=b*r+t*g-u*p;var n=b*p+u*r-q*g,y=b*g+q*p-t*r,r=-q*r-t*p-u*g;c[0]=a*b+r*-q+n*-u-y*-t;c[1]=n*b+r*-t+y*-q-a*-u;c[2]=y*b+r*-u+a*-t-n*-q;c[0]+=f;c[1]+=h;c[2]+=l;return c}var b=r("__mat4"),l=r("__quat"),c=r("__util"),f=r("__vec3"),n=new Float32Array(3),q=new Float32Array(4);
new Float32Array(16);a.create=function(){var a=new Float32Array(8);a[3]=1;a[7]=1;return a};a.from_values=function(a,b,c,f,h,l,n,q){var t=new Float32Array(8);t[0]=a;t[1]=b;t[2]=c;t[3]=f;t[4]=h;t[5]=l;t[6]=n;t[7]=q;return t};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];return b};a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=1;return a};a.create_sep=function(a,b,c,f){f||(f=new Float32Array(8));u(a,b,c,f);return f};
a.set_sep=u;a.set_trans=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};a.set_scale=function(a,b){b[3]=a;return b};a.set_transcale=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};a.set_quat=function(a,b){b[4]=a[0];b[5]=a[1];b[6]=a[2];b[7]=a[3];return b};a.get_trans_view=function(a){return a.subarray(0,3)};a.get_scale=function(a){return a[3]};a.get_quat_view=function(a){return a.subarray(4)};a.invert=function(a,b){var c=1/a[3];if(!c)return null;var f=a[0],h=a[1],n=a[2];q[0]=a[4];
q[1]=a[5];q[2]=a[6];q[3]=a[7];l.invert(q,q);var r=q[0],u=q[1],t=q[2],C=q[3],f=f*c,h=h*c,D=n*c,n=C*f+u*D-t*h,p=C*h+t*f-r*D,g=C*D+r*h-u*f,f=-r*f-u*h-t*D;b[0]=-(n*C+f*-r+p*-t-g*-u);b[1]=-(p*C+f*-u+g*-r-n*-t);b[2]=-(g*C+f*-t+n*-u-p*-r);b[3]=c;b[4]=r;b[5]=u;b[6]=t;b[7]=C;return b};a.to_mat4=function(a,c){var e=a.subarray(0,3),f=a[3],h=a.subarray(4);b.fromRotationTranslation(h,e,c);for(e=0;12>e;e++)c[e]*=f;return c};a.from_mat4=function(a,b){var e=c.matrix_to_trans(a,n),f=c.matrix_to_scale(a),h=c.matrix_to_quat(a,
q);u(e,f,h,b);return b};a.multiply=function(a,b,c){h(b,a,c);c[3]=a[3]*b[3];var f=a[4],l=a[5],n=a[6];a=a[7];var q=b[4],r=b[5],t=b[6];b=b[7];c[4]=f*b+a*q+l*t-n*r;c[5]=l*b+a*r+n*q-f*t;c[6]=n*b+a*t+f*r-l*q;c[7]=a*b-f*q-l*r-n*t;return c};a.transform_vec3=h;a.transform_vec3_inv=function(a,b,c){var f=b[3],h=a[0]-b[0],l=a[1]-b[1],n=a[2]-b[2];a=b[4];var q=b[5],t=b[6];b=b[7];var r=a*a+q*q+t*t+b*b,r=r?1/r:0;a=-a*r;q=-q*r;t=-t*r;b*=r;var r=b*h+q*n-t*l,u=b*l+t*h-a*n,p=b*n+a*l-q*h,h=-a*h-q*l-t*n;c[0]=r*b+h*-a+
u*-t-p*-q;c[1]=u*b+h*-q+p*-a-r*-t;c[2]=p*b+h*-t+r*-q-u*-a;c[0]/=f;c[1]/=f;c[2]/=f;return c};a.transform_vectors=function(a,b,c,f){f||(f=0);var h=a.length,l=b[0],n=b[1],q=b[2],t=b[3],r=b[4],u=b[5],p=b[6];b=b[7];for(var g=0;g<h;g+=3){var y=a[g]*t,v=a[g+1]*t,I=a[g+2]*t,z=b*y+u*I-p*v,H=b*v+p*y-r*I,F=b*I+r*v-u*y,y=-r*y-u*v-p*I;c[f+g]=z*b+y*-r+H*-p-F*-u;c[f+g+1]=H*b+y*-u+F*-r-z*-p;c[f+g+2]=F*b+y*-p+z*-u-H*-r;c[f+g]+=l;c[f+g+1]+=n;c[f+g+2]+=q}return c};a.transform_dir_vectors=function(a,b,c,f){f||(f=0);
var h=a.length,l=b[3],n=b[4],q=b[5],t=b[6];b=b[7];for(var r=0;r<h;r+=3){var u=a[r]*l,p=a[r+1]*l,g=a[r+2]*l,y=b*u+q*g-t*p,v=b*p+t*u-n*g,I=b*g+n*p-q*u,u=-n*u-q*p-t*g;c[f+r]=y*b+u*-n+v*-t-I*-q;c[f+r+1]=v*b+u*-q+I*-n-y*-t;c[f+r+2]=I*b+u*-t+y*-q-v*-n}return c};a.transform_dir_vec3=function(a,b,c){var f=b[3],h=b[4],l=b[5],n=b[6];b=b[7];var q=a[0]*f,t=a[1]*f,r=a[2]*f;a=b*q+l*r-n*t;var f=b*t+n*q-h*r,u=b*r+h*t-l*q,q=-h*q-l*t-n*r;c[0]=a*b+q*-h+f*-n-u*-l;c[1]=f*b+q*-l+u*-h-a*-n;c[2]=u*b+q*-n+a*-l-f*-h;return c};
a.transform_tangents=function(a,b,c,f){f||(f=0);var h=a.length,l=b[3],n=b[4],q=b[5],t=b[6];b=b[7];for(var r=0;r<h;r+=4){var u=a[r]*l,p=a[r+1]*l,g=a[r+2]*l,y=b*u+q*g-t*p,v=b*p+t*u-n*g,I=b*g+n*p-q*u,u=-n*u-q*p-t*g;c[f+r]=y*b+u*-n+v*-t-I*-q;c[f+r+1]=v*b+u*-q+I*-n-y*-t;c[f+r+2]=I*b+u*-t+y*-q-v*-n;c[f+r+3]=a[r+3]}return c};a.translate=function(a,b,c){var f=a[3],h=a[4],l=a[5],n=a[6],q=a[7],t=b[0]*f,r=b[1]*f,u=b[2]*f;b=q*t+l*u-n*r;var f=q*r+n*t-h*u,p=q*u+h*r-l*t,t=-h*t-l*r-n*u;c[0]=a[0]+b*q+t*-h+f*-n-p*
-l;c[1]=a[1]+f*q+t*-l+p*-h-b*-n;c[2]=a[2]+p*q+t*-n+b*-l-f*-h;c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];return c};a.interpolate=function(a,b,c,h){h||(h=new Float32Array(8));var n=a.subarray(0,3),q=b.subarray(0,3),r=h.subarray(0,3);f.lerp(n,q,c,r);n=a[3];h[3]=n+c*(b[3]-n);a=a.subarray(4);b=b.subarray(4);n=h.subarray(4);l.slerp(a,b,c,n);return h};a.extrapolate=function(a,b,c,f){f||(f=new Float32Array(8));var h=a.subarray(0,3),n=b.subarray(0,3),q=f.subarray(0,3);q[0]=n[0]*(c+1)-h[0]*c;q[1]=n[1]*
(c+1)-h[1]*c;q[2]=n[2]*(c+1)-h[2]*c;f[3]=b[3]*(c+1)-a[3]*c;a=a.subarray(4);b=b.subarray(4);h=f.subarray(4);h[0]=b[0]*(c+1)-a[0]*c;h[1]=b[1]*(c+1)-a[1]*c;h[2]=b[2]*(c+1)-a[2]*c;h[3]=b[3]*(c+1)-a[3]*c;l.normalize(h,h);return f};a.integrate=function(a,b,c,f,h){h[0]=a[0]+b*c[0];h[1]=a[1]+b*c[1];h[2]=a[2]+b*c[2];h[3]=a[3];c=f[0];var l=f[1];f=f[2];var n=a[4],q=a[5],t=a[6],r=a[7];h[4]=.5*(c*r+l*t-f*q);h[5]=.5*(l*r+f*n-c*t);h[6]=.5*(f*r+c*q-l*n);h[7]=.5*(-c*n-l*q-f*t);h[4]=a[4]+h[4]*b;h[5]=a[5]+h[5]*b;h[6]=
a[6]+h[6]*b;h[7]=a[7]+h[7]*b;a=h[4];b=h[5];c=h[6];l=h[7];a=a*a+b*b+c*c+l*l;0<a&&(a=1/Math.sqrt(a),h[4]*=a,h[5]*=a,h[6]*=a,h[7]*=a)}};b4w.module.__util=function(a,r){function u(a){return 0<a?1:0>a?-1:0}function h(a){var b=a[0],c=a[1],d=a[2],e=a[3],g=Math.sqrt(b*b+c*c+d*d),g=1/g;a[0]=b*g;a[1]=c*g;a[2]=d*g;a[3]=e*g}function b(a,b){return b[0]*a[0]+b[1]*a[1]+b[2]*a[2]+b[3]}function l(a,b){var d=b;switch(typeof a){case "number":return c(a,d);case "string":return f(a,d);case "boolean":return c(a|0,d);case "function":case "undefined":return c(0,d);case "object":if(a){var e=a instanceof Array;if(a.buffer instanceof ArrayBuffer&&"undefined"!==
a.byteLength)for(e=0;e<a.length;e++)d=c(a[e],d);else if(e)for(e=0;e<a.length;e++)d=l(a[e],d);else for(var g in a)d=l(a[g],d)}else d=c(0,d)}return d}function c(a,b){var c=b;P[0]=a;c=(c<<5)-c+S[0];c&=c;c=(c<<5)-c+S[1];return c&c}function f(a,b){for(var c=b,d=0;d<a.length;d++)var e=a.charCodeAt(d),c=(c<<5)-c+e,c=c&c;return c}function n(a){return(34*a+1)*a%289}function q(a){return a-Math.floor(a)}function d(a){return k((34*a+5)*a)}function k(a){return a-289*Math.floor(a/289)}function e(a){return a-7*
Math.floor(a/7)}function m(a,b,c){a-=b;c-=b;return b+(a-Math.floor(a/c)*c)}function B(a){return m(a,0,2*Math.PI)}function N(a,b){if(a&&b){var c=a instanceof Array,d=a.buffer instanceof ArrayBuffer&&"undefined"!==a.byteLength,e=b.buffer instanceof ArrayBuffer&&"undefined"!==b.byteLength;if(c!=b instanceof Array||d!=e)return!1;if(c){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(!G(a[c],b[c]))return!1}else if(d){if(a.length!=b.length)return!1;for(c=0;c<a.length;c++)if(a[c]!=b[c])return!1}else{for(var g in a)if(!G(a[g],
b[g]))return!1;for(g in b)if(!(g in a))return!1}return!0}return!(a||b)}function G(a,b){if(typeof a!=typeof b)return!1;switch(typeof a){case "number":case "string":case "boolean":return a==b;case "object":return N(a,b);default:return!0}}function w(a){if(""==a)return".";var b=0==a.indexOf("/")|0;b&&0==a.indexOf("//")&&0!=a.indexOf("///")&&(b=2);a=a.split("/");for(var c=[],d=0;d<a.length;d++){var e=a[d];""!=e&&"."!=e&&(".."!=e||!b&&!c.length||c.length&&".."==c[c.length-1]?c.push(e):c.length&&c.pop())}a=
c.join("/");for(d=0;d<b;d++)a="/"+a;return a||"."}var t=r("__mat3"),C=r("__mat4"),D=r("__print"),p=r("__quat"),g=r("__vec3"),y=r("__vec4"),v=0,I={},z=new Float32Array(3),H=new Float32Array(3),F=new Float32Array(4),L=new Float32Array(4),x=new Float32Array(9),K=new Float32Array(16),A=new Float32Array(16),P=new Float64Array(1),S=new Uint32Array(P.buffer),ea=new Float32Array([0,0,0]),aa=new Float32Array([0,0,0,1]),Y=new Float32Array([0,0,0,1,0,0,0,1]),Q=new Float32Array([1,1,1]),X=new Float32Array([1,
0,0]),R=new Float32Array([0,1,0]),U=new Float32Array([0,0,1]),ba=new Float32Array([-1,0,0]),fa=new Float32Array([0,-1,0]),ja=new Float32Array([0,0,-1]),pa=Math.floor(44488.07041494893),na=[new Float32Array([0,0,-1,0,0,-1,0,0,-1,0,0,0,0,0,0,1]),new Float32Array([0,0,1,0,0,-1,0,0,1,0,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1]),new Float32Array([1,0,0,0,0,-1,0,0,0,0,-1,0,0,0,0,1]),new Float32Array([-1,0,0,0,0,-1,0,0,0,0,1,0,
0,0,0,1])];a.VEC3_IDENT=ea;a.QUAT4_IDENT=aa;a.TSR8_IDENT=Y;a.VEC3_UNIT=Q;a.AXIS_X=X;a.AXIS_Y=R;a.AXIS_Z=U;a.AXIS_MX=ba;a.AXIS_MY=fa;a.AXIS_MZ=ja;a.INV_CUBE_VIEW_MATRS=na;a.keyfind=function(a,b,c){for(var d=[],e=c.length,g=0;g<e;g++){var f=c[g];f[a]==b&&d.push(f)}return d};a.float32_concat=function(a,b){var c=a.length,d=new Float32Array(c+b.length);d.set(a);d.set(b,c);return d};a.uint32_concat=function(a,b){var c=a.length,d=new Uint32Array(c+b.length);d.set(a);d.set(b,c);return d};a.check_endians=
function(){var a=new Uint16Array([255]);return 255==(new DataView(a.buffer)).getUint16(0,!0)};a.array_intersect=function(a,b){var c=[],d={},e=b.length,g,f;for(g=0;g<e;g++)d[b[g]]=!0;e=a.length;for(g=0;g<e;g++)f=a[g],f in d&&c.push(f);return c};a.sign=u;a.keycheck=function(a,b,c){for(var d=c.length,e=0;e<d;e++)if(c[e][a]==b)return!0;return!1};a.keysearch=function(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e[a]===b)return e}return null};a.key2search=function(a,b,c,d,e){for(var g=0;g<e.length;g++){var f=
e[g];if(f[a]==b&&f[c]==d)return f}return null};a.get_index_for_key_value=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]==c)return d;return-1};a.append_unique=function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return;a.push(b)};a.check_uniqueness=function(a){for(var b=0;b<a.length-1;b++)for(var c=a[b],d=b+1;d<a.length;d++)if(c==a[d])return!1;return!0};a.trans_matrix=function(a,b,c,d){d||(d=new Float32Array(16));C.identity(d);d[12]=a;d[13]=b;d[14]=c;return d};var V=1;a.rand=function(){V=(69069*
V+5)%Math.pow(2,32);return Math.round(V/65536)%32768/32767};a.srand=function(a){V=a};a.rand_r=function(a){var b=a[0]%pa*48271-3399*Math.floor(a[0]/pa);a[0]=0<b?b:b+2147483647;return(a[0]-1)/2147483646};a.init_rand_r_seed=function(a,b){b||(b=[]);b[0]=5E4+Math.floor(a);return b};a.euler_to_quat=function(a,b){b||(b=new Float32Array(4));var c=Math.cos(a[1]/2),d=Math.cos(a[2]/2),e=Math.cos(a[0]/2),g=Math.sin(a[1]/2),f=Math.sin(a[2]/2),h=Math.sin(a[0]/2);b[0]=g*f*e+c*d*h;b[1]=g*d*e+c*f*h;b[2]=c*f*e-g*d*
h;b[3]=c*d*e-g*f*h;return b};a.euler_to_rotation_matrix=function(a){var b=t.create(),c=Math.cos(a[0]),d=Math.cos(a[1]),e=Math.cos(a[2]),g=Math.sin(a[0]),f=Math.sin(a[1]);a=Math.sin(a[2]);var h=c*e,k=c*a,m=g*e,l=g*a;b[0]=d*e;b[1]=d*a;b[2]=-f;b[3]=f*m-k;b[4]=f*l+h;b[5]=d*g;b[6]=f*h+l;b[7]=f*k-m;b[8]=d*c;return b};a.quat_to_euler=function(a,b){var c=a[0],d=a[1],e=a[2],g=a[3],f=c*c,h=d*d,k=e*e,m=c*d+e*g;.499999<m?(b[0]=0,b[1]=2*Math.atan2(c,g),b[2]=Math.PI/2):-.499999>m?(b[0]=0,b[1]=-2*Math.atan2(c,g),
b[2]=-Math.PI/2):(b[0]=Math.atan2(2*c*g-2*d*e,1-2*f-2*k),b[1]=Math.atan2(2*d*g-2*c*e,1-2*h-2*k),b[2]=Math.asin(2*c*d+2*e*g));return b};a.quat_to_dir=function(a,b,c){c||(c=new Float32Array(3));g.transformQuat(b,a,c);return c};a.dir_to_quat=function(a,b,c){c||(c=new Float32Array(4));a=g.normalize(a,z);var d=g.dot(b,a);a=g.cross(b,a,H);d=Math.acos(d);c[0]=a[0]*Math.sin(d/2);c[1]=a[1]*Math.sin(d/2);c[2]=a[2]*Math.sin(d/2);c[3]=Math.cos(d/2);return c};a.trans_quat_to_plane=function(a,b,c,d){d||(d=new Float32Array(4));
g.transformQuat(c,b,d);d[3]=-g.dot(a,d);return d};a.dir_ground_proj_angle=function(a){var b=a.render.quat;switch(a.type){case "CAMERA":z[0]=0;z[1]=-1;z[2]=0;g.transformQuat(z,b,z);H[0]=0;H[1]=0;H[2]=-1;break;case "MESH":z[0]=0;z[1]=0;z[2]=1;g.transformQuat(z,b,z);H[0]=0;H[1]=0;H[2]=1;break;case "EMPTY":z[0]=0,z[1]=1,z[2]=0,g.transformQuat(z,b,z),H[0]=0,H[1]=1,H[2]=0}z[1]=0;g.normalize(z,z);a=g.dot(z,H);b=0<-z[0]*H[2]?-1:1;return Math.acos(a)*b};a.blend_arrays=function(a,b,c,d){if(0==c)return a;d=
d||[];for(var e=0;e<a.length;e++)d[e]=(1-c)*a[e]+c*b[e];return d};a.unique_id=function(){v++;return v.toString(16)};a.unique_name=function(a){I[a]||(I[a]=0);var b=a+I[a];I[a]++;return b};a.create_empty_va_frame=function(){return{a_position:new Float32Array(0),a_tangent:new Float32Array(0),a_normal:new Float32Array(0)}};a.create_empty_submesh=function(a){var b={a_influence:new Float32Array(0),a_color:new Float32Array(0),a_texcoord:new Float32Array(0)};return{name:a,base_length:0,indices:null,va_frames:[],
va_common:b,shape_keys:[]}};a.clone_object_json=function(a){return JSON.parse(JSON.stringify(a))};a.clone_object_r=function(b){if(!(b instanceof Object))return b;var c;c=b.constructor;switch(c){case Float32Array:case Uint32Array:case Uint16Array:c=new c(b);break;case Array:c=new c(b.length);for(var d=0;d<b.length;d++)c[d]=a.clone_object_r(b[d]);break;default:for(d in c=new c,b)c[d]=a.clone_object_r(b[d])}return c};a.clone_object_nr=function(a){var b=a instanceof Array?[]:{},c;for(c in a)if(a[c]instanceof
Object){var d=a[c].constructor;switch(d){case Float32Array:case Uint32Array:case Uint16Array:b[c]=new d(a[c]);break;case Array:b[c]=a[c].slice(0);break;default:b[c]=a[c]}}else b[c]=a[c];return b};a.matrix_to_quat=function(a,b){b||(b=new Float32Array(4));t.fromMat4(a,x);var c=x[0],d=x[3],e=x[6],g=x[1],f=x[4],h=x[7],k=x[2],m=x[5],l=x[8],c=Math.sqrt(c*c+d*d+e*e)||1,g=Math.sqrt(g*g+f*f+h*h)||1,k=Math.sqrt(k*k+m*m+l*l)||1;x[0]/=c;x[3]/=c;x[6]/=c;x[1]/=g;x[4]/=g;x[7]/=g;x[2]/=k;x[5]/=k;x[8]/=k;p.fromMat3(x,
b);return b};a.matrix_to_trans=function(a,b){b||(b=new Float32Array(3));b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};a.matrix_to_scale=function(a){F[0]=.577350269189626;F[1]=.577350269189626;F[2]=.577350269189626;F[3]=0;y.transformMat4(F,a,F);return y.length(F)};a.extract_frustum_planes=function(a,b){var c=b.left,d=b.right,e=b.top,g=b.bottom,f=b.near,k=b.far;c[0]=a[3]+a[0];c[1]=a[7]+a[4];c[2]=a[11]+a[8];c[3]=a[15]+a[12];d[0]=a[3]-a[0];d[1]=a[7]-a[4];d[2]=a[11]-a[8];d[3]=a[15]-a[12];e[0]=a[3]-a[1];e[1]=
a[7]-a[5];e[2]=a[11]-a[9];e[3]=a[15]-a[13];g[0]=a[3]+a[1];g[1]=a[7]+a[5];g[2]=a[11]+a[9];g[3]=a[15]+a[13];f[0]=a[3]+a[2];f[1]=a[7]+a[6];f[2]=a[11]+a[10];f[3]=a[15]+a[14];k[0]=a[3]-a[2];k[1]=a[7]-a[6];k[2]=a[11]-a[10];k[3]=a[15]-a[14];h(c);h(d);h(e);h(g);h(f);h(k);return b};a.sphere_is_out_of_frustum=function(a,c,d){return d<-b(a,c.left)||d<-b(a,c.right)||d<-b(a,c.top)||d<-b(a,c.bottom)||d<-b(a,c.near)||d<-b(a,c.far)?!0:!1};a.ellipsoid_is_out_of_frustum=function(a,c,d,e,f){h=g.dot(d,c.far);k=g.dot(e,
c.far);m=g.dot(f,c.far);h=Math.sqrt(h*h+k*k+m*m);if(h<-b(a,c.near)||h<-b(a,c.far))return!0;var h=g.dot(d,c.left),k=g.dot(e,c.left),m=g.dot(f,c.left);if(Math.sqrt(h*h+k*k+m*m)<-b(a,c.left))return!0;h=g.dot(d,c.right);k=g.dot(e,c.right);m=g.dot(f,c.right);if(Math.sqrt(h*h+k*k+m*m)<-b(a,c.right))return!0;h=g.dot(d,c.top);k=g.dot(e,c.top);m=g.dot(f,c.top);if(Math.sqrt(h*h+k*k+m*m)<-b(a,c.top))return!0;h=g.dot(d,c.bottom);k=g.dot(e,c.bottom);m=g.dot(f,c.bottom);return Math.sqrt(h*h+k*k+m*m)<-b(a,c.bottom)?
!0:!1};a.positions_multiply_matrix=function(a,b,c,d){d||(d=0);for(var e=a.length,g=0;g<e;g+=3){var f=a[g],h=a[g+1],k=a[g+2];c[d+g]=b[0]*f+b[4]*h+b[8]*k+b[12];c[d+g+1]=b[1]*f+b[5]*h+b[9]*k+b[13];c[d+g+2]=b[2]*f+b[6]*h+b[10]*k+b[14]}return c};a.vectors_multiply_matrix=function(a,b,c,d){d||(d=0);for(var e=a.length,g=0;g<e;g+=3){var f=a[g],h=a[g+1],k=a[g+2];c[d+g]=b[0]*f+b[4]*h+b[8]*k;c[d+g+1]=b[1]*f+b[5]*h+b[9]*k;c[d+g+2]=b[2]*f+b[6]*h+b[10]*k}return c};a.tangents_multiply_matrix=function(a,b,c,d){d||
(d=0);for(var e=a.length,g=0;g<e;g+=4){var f=a[g],h=a[g+1],k=a[g+2];c[d+g]=b[0]*f+b[4]*h+b[8]*k;c[d+g+1]=b[1]*f+b[5]*h+b[9]*k;c[d+g+2]=b[2]*f+b[6]*h+b[10]*k;c[d+g+3]=a[g+3]}return c};a.vecdir_multiply_matrix=function(a,b,c){c||(c=new Float32Array(3));F[0]=a[0];F[1]=a[1];F[2]=a[2];F[3]=0;y.transformMat4(F,b,F);c[0]=F[0];c[1]=F[1];c[2]=F[2]};a.flatten=function(a,b){var c=a.length;if(!c)throw"flatten(): Wrong or empty array";var d=a[0].length;if(!d)throw"flatten(): Wrong or empty subarray";b||(b=new Float32Array(c*
d));for(var e=0;e<c;e++)for(var g=0;g<d;g++)b[e*d+g]=a[e][g];return b};a.vectorize=function(a,b){b||(b=[]);for(var c=0;c<a.length;c+=3){var d=new Float32Array([a[c],a[c+1],a[c+2]]);b[c/3]=d}return b};a.binary_search_max=function(b,c,d,e){if(e<d)return d;var g=d+Math.floor((e-d)/2);return b[g]>c?a.binary_search_max(b,c,d,g-1):b[g]<c?a.binary_search_max(b,c,g+1,e):g};a.cmp_arr=function(a,b){for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!1;return!0};a.cmp_arr_float=function(a,b,c){for(var d=0;d<a.length;d++)if(Math.abs(a[d]-
b[d])>c)return!1;return!0};a.scale_mat4=function(a,b,c){c||(c=new Float32Array(16));for(var d=0;12>d;d++)c[d]=a[d]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};a.transform_mat4=function(a,b,c,d,e){e||(e=new Float32Array(16));b=C.fromRotationTranslation(c,d,K);C.multiply(b,a,e);return e};a.transform_vec3=function(a,b,c,d,e){e||(e=new Float32Array(3));c=C.fromRotationTranslation(c,d,K);1!==b&&(d=C.identity(A),b=g.set(b,b,b,z),C.scale(d,b,d),C.multiply(c,d,c));g.transformMat4(a,c,e);return e};
a.transform_vec4=function(a,b,c,d,e){e||(e=new Float32Array(4));b=C.fromRotationTranslation(c,d,K);y.transformMat4(a,b,e);return e};a.inverse_transform_vec3=function(a,b,c,d,e){e||(e=new Float32Array(3));b=C.fromRotationTranslation(c,d,K);C.invert(b,b);g.transformMat4(a,b,e);return e};a.transcale_quat_to_matrix=function(a,b,c){c||(c=new Float32Array(16));C.fromRotationTranslation(b,a,c);a=a[3];for(b=0;12>b;b++)c[b]*=a;return c};a.matrix_to_transcale_quat=function(b,c,d){a.matrix_to_trans(b,c);c[3]=
a.matrix_to_scale(b);a.matrix_to_quat(b,d)};a.array_stringify=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return JSON.stringify(b)};a.rotate_point_pivot=function(a,b,c,d){d||(d=new Float32Array(3));g.subtract(b,a,z);g.transformQuat(z,c,z);g.subtract(b,z,d)};a.generate_cubemap_matrices=function(){z[0]=0;z[1]=0;z[2]=0;var a=new Float32Array(16),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),g=new Float32Array(16);C.lookAt(z,[-1,0,0],[0,-1,0],
a);C.scale(a,[-1,1,1],a);C.scale(a,[-1,1,-1],b);C.lookAt(z,[0,-1,0],[0,0,-1],c);C.scale(c,[1,1,-1],c);C.scale(c,[1,-1,-1],d);C.lookAt(z,[0,0,-1],[0,-1,0],e);C.scale(e,[-1,1,1],e);C.scale(e,[-1,1,-1],g);return[a,b,c,d,e,g]};a.generate_inv_cubemap_matrices=function(){z[0]=0;z[1]=0;z[2]=0;var a=new Float32Array(16),b=new Float32Array(16),c=new Float32Array(16),d=new Float32Array(16),e=new Float32Array(16),g=new Float32Array(16);C.lookAt(z,[1,0,0],[0,-1,0],a);C.scale(a,[-1,1,-1],b);C.lookAt(z,[0,1,0],
[0,0,1],c);C.scale(c,[1,-1,-1],d);C.lookAt(z,[0,0,1],[0,-1,0],e);C.scale(e,[-1,1,-1],g);return[a,b,c,d,e,g]};a.calc_variable_id=function(a,b){return l(a,b)};a.hash_code=l;a.hash_code_string=f;a.mat4_translate=function(a,b,c){var d=b[0],e=b[1];b=b[2];var g,f,h,k,m,l,n,p,q,t,v,r;if(!c||a===c)return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a;g=a[0];f=a[1];h=a[2];k=a[3];m=a[4];l=a[5];n=a[6];p=a[7];q=a[8];t=a[9];
v=a[10];r=a[11];c[0]=g;c[1]=f;c[2]=h;c[3]=k;c[4]=m;c[5]=l;c[6]=n;c[7]=p;c[8]=q;c[9]=t;c[10]=v;c[11]=r;c[12]=g*d+m*e+q*b+a[12];c[13]=f*d+l*e+t*b+a[13];c[14]=h*d+n*e+v*b+a[14];c[15]=k*d+p*e+r*b+a[15];return c};a.mat3_to_mat4=function(a,b){b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};a.quat_to_angle_axis=function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];0<c?(b[3]=2*Math.acos(a[3]),c=
1/Math.sqrt(c),b[0]=a[0]*c,b[1]=a[1]*c,b[2]=a[2]*c):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};a.trunc=function(a){return isNaN(a)||"undefined"==typeof a?NaN:a|0};a.rad=function(a){return a*Math.PI/180};a.deg=function(a){return 180*a/Math.PI};a.snoise=function(a){var b=.366025403784439*a[0]+.366025403784439*a[1],c=Math.floor(a[0]+b),d=Math.floor(a[1]+b),e=.211324865405187*c+.211324865405187*d,b=a[0]-c+e;a=a[1]-d+e;var g=b>a?1:0,f=1-g,e=b+.211324865405187-g,h=a+.211324865405187-f,k=b+-.577350269189626,
m=a+-.577350269189626,c=c%289,d=d%289,l=n(n(d)+c),f=n(n(d+f)+c+g),p=n(n(d+1)+c+1),c=Math.max(.5-(b*b+a*a),0),d=Math.max(.5-(e*e+h*h),0),g=Math.max(.5-(k*k+m*m),0),c=c*c*c*c,d=d*d*d*d,g=g*g*g*g,t=2*q(.024390243902439*l)-1,v=2*q(.024390243902439*f)-1,r=2*q(.024390243902439*p)-1,l=Math.abs(t)-.5,f=Math.abs(v)-.5,p=Math.abs(r)-.5,t=t-Math.floor(t+.5),v=v-Math.floor(v+.5),r=r-Math.floor(r+.5);return 130*(c*(1.79284291400159-.85373472095314*(t*t+l*l))*(t*b+l*a)+d*(1.79284291400159-.85373472095314*(v*v+
f*f))*(v*e+f*h)+g*(1.79284291400159-.85373472095314*(r*r+p*p))*(r*k+p*m))};a.cellular2x2=function(a){var b=1/7,c=b/2,g=k(Math.floor(a[0])),f=k(Math.floor(a[1])),h=q(a[0]);a=q(a[1]);var m=h-.5,l=h-1.5,h=a-.5;a-=1.5;var n=d(g),g=d(g+1),p=n,t=g,n=d(n+f),g=d(g+f),p=d(p+f+1),t=d(t+f+1),v=e(n)*b+c,r=e(g)*b+c,u=e(p)*b+c,f=e(t)*b+c,n=e(Math.floor(n*b))*b+c,g=e(Math.floor(g*b))*b+c,p=e(Math.floor(p*b))*b+c,b=e(Math.floor(t*b))*b+c,c=m+.7*v,r=l+.7*r,m=m+.7*u,l=l+.7*f,f=h+.7*n,h=h+.7*g,n=a+.7*p;a+=.7*b;return Math.min(c*
c+f*f,r*r+h*h,m*m+n*n,l*l+a*a)};a.quat_project=function(a,b,c,d,e){e||(e=new Float32Array(4));a=g.transformQuat(b,a,z);b=c[0];var f=c[1];c=c[2];x[0]=f*f+c*c;x[1]=-f*b;x[2]=-c*b;x[3]=-b*f;x[4]=b*b+c*c;x[5]=-c*f;x[6]=-b*c;x[7]=-f*c;x[8]=b*b+f*f;g.transformMat3(a,x,a);g.normalize(a,a);p.rotationTo(d,a,e);return e};a.cam_quat_to_mesh_quat=function(a,b){b||(b=new Float32Array(4));var c=F,d=L,c=p.setAxisAngle([0,1,0],Math.PI,p.create()),d=p.setAxisAngle([1,0,0],Math.PI/2,p.create());p.multiply(c,d,c);p.multiply(a,
c,b);return b};a.cleanup=function(){v=0;I={}};a.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};a.smooth=function(a,b,c,d){c=Math.exp(-c/d);return(1-c)*a+c*b};a.smooth_v=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);for(d=0;d<e.length;d++)e[d]=(1-c)*a[d]+c*b[d];return e};a.smooth_q=function(a,b,c,d,e){e||(e=new Float32Array(a.length));c=Math.exp(-c/d);p.slerp(a,b,c,e);return e};a.is_arr_buf_view=function(a){return"object"===typeof a&&a.buffer&&a.buffer instanceof ArrayBuffer?
!0:!1};a.is_vector=function(a,b){if(a instanceof Array||a.buffer&&a.buffer instanceof ArrayBuffer)if(b&&b==a.length||!b)return!0;return!1};a.correct_cam_quat_up=function(a,b){var c=t.fromQuat(a,x);H[0]=0;H[1]=1;H[2]=0;z[0]=c[3];z[1]=c[4];z[2]=c[5];var d=g.cross(H,z,z);g.normalize(d,d);var e=c[7];!b&&0<e&&(d[0]*=-1,d[1]*=-1,d[2]*=-1);H[0]=c[0];H[1]=c[1];H[2]=c[2];g.normalize(H,H);p.rotationTo(H,d,L);p.multiply(L,a,a)};a.get_array_smooth_value=function(a,b,c,d){c=c*b-.5;var e=d*b-.5;d=c-Math.floor(c);
var g=e-Math.floor(e);c=Math.floor(c);var e=Math.floor(e),f=b-1,h=a[e*b+c],k=a[e*b+Math.min(c+1,f)],m=a[Math.min(e+1,f)*b+c];a=a[Math.min(e+1,f)*b+Math.min(c+1,f)];return(h*(1-d)+k*d)*(1-g)+(m*(1-d)+a*d)*g};a.rgb_mask_get_channels_count=function(a){for(var b=0,c=0;3>c;c++)0<(a&1<<c)&&b++;return b};a.rgb_mask_get_channels_presence=function(a){for(var b=[0,0,0],c=0;3>c;c++)0<(a&1<<c)&&(b[2-c]=1);return b};a.rgb_mask_get_channel_presence_index=function(a,b){var c=0;(1==b||2==b)&&0<(a&4)&&c++;2==b&&0<
(a&2)&&c++;return c};a.gen_uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};a.get_dict_length=function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};a.random_from_array=function(a){if(!a.length)return null;var b=Math.floor(Math.random()*a.length);return a[b]};a.xz_direction=function(a,b,c){c||(c=new Float32Array(3));c[0]=a[0]-b[0];c[1]=0;c[2]=a[2]-b[2];g.normalize(c,c)};a.transformQuatFast=
function(a,b,c){var d=a[0],e=a[1];a=a[2];var g=b[0],f=b[1],h=b[2];b=b[3];var k=f*a-h*e,m=h*d-g*a,l=g*e-f*d,n=f*l-h*m,h=h*k-g*l,g=g*m-f*k;c[0]=d+2*k*b+2*n;c[1]=e+2*m*b+2*h;c[2]=a+2*l*b+2*g;return c};a.assert=function(a){if(!a)throw Error("Assertion failed");};a.panic=function(a){a&&D.error.apply(D,arguments);throw"panic: see above for possible error messages";};a.angle_wrap_periodic=m;a.angle_wrap_0_2pi=B;a.get_file_extension=function(a){return/(?:\.([^.]+))?$/.exec(a)[1]};a.strict_objs_is_equal=function(a,
b){for(var c in a){var d=!0,e=a[c],g=b[c];switch(typeof e){case "number":case "string":case "boolean":d=e==g;break;case "object":d=N(e,g)}if(!d)return!1}return!0};a.quat_bpy_b4w=function(a,b){var c=a[0],d=a[2],e=a[3];b[0]=a[1];b[1]=d;b[2]=e;b[3]=c;return b};a.gen_color_id=function(a){a+=1;132651<a&&D.error("Color ID pool depleted");var b=Math.floor(a/2601);a%=2601;var c=Math.floor(a/51);return new Float32Array([b/51,c/51,a%51/51])};a.line_plane_intersect=function(a,b,c,d,e){F.set(a);F[3]=b;L.set(d);
L[3]=0;a=y.dot(F,L);if(0==a)return null;L.set(c);L[3]=1;a=-y.dot(F,L)/a;e[0]=c[0]+a*d[0];e[1]=c[1]+a*d[1];e[2]=c[2]+a*d[2];return e};a.get_plane_normal=function(a,b,c,d){var e=b[0]-a[0],g=c[0]-a[0],f=b[1]-a[1],h=c[1]-a[1];b=b[2]-a[2];a=c[2]-a[2];d[0]=f*a-b*h;d[1]=g*b-e*a;d[2]=e*h-f*g;return d};a.copy_array=function(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b};a.rotation_to_stable=function(a,b,c){var d=g.dot(a,b);-.9999999>d?(g.cross(X,a,z),1E-6>g.length(z)&&g.cross(R,a,z),g.normalize(z,z),
p.setAxisAngle(z,Math.PI,c)):(g.cross(a,b,z),c.set(z),c[3]=1+d,p.normalize(c,c));return c};a.calc_returning_angle=function(a,b,c){if(b==c)return c-a;a=B(a);b=B(b);c=B(c);var d=Math.abs(b-c);if(.001>d||.001>Math.abs(d-2*Math.PI))return 0;b=2*Math.PI-b;c=B(c+b);a=B(a+b);return a>c?(c-=a,a=2*Math.PI-a,-c>a?a:c):0};a.smooth_step=function(a,b,c){isFinite(b)&&isFinite(c)&&(a=clamp(a,b,c));return a*a*(3-2*a)};a.lerp=function(a,b,c){return b+a*(c-b)};a.arrays_have_common=function(a,b){for(var c=0;c<a.length;c++)for(var d=
0;d<b.length;d++)if(b[d]==a[c])return!0;return!1};a.create_zero_array=function(a){for(var b=Array(a),c=0;c<a;c++)b[c]=0;return b};a.version_cmp=function(a,b){for(var c=Math.max(a.length,b.length),d=0;d<c;d++){var e=u((d>=a.length?0:a[d])-(d>=b.length?0:b[d]));if(e)return e}return 0};a.version_to_str=function(a){return a.join(".")};a.str_to_version=function(a){return a.split(".").map(function(a){return a|0})};a.srgb_to_lin=function(a,b){b[0]=Math.pow(a[0],2.2);b[1]=Math.pow(a[1],2.2);b[2]=Math.pow(a[2],
2.2);return b};a.lin_to_srgb=function(a,b){b[0]=Math.pow(a[0],1/2.2);b[1]=Math.pow(a[1],1/2.2);b[2]=Math.pow(a[2],1/2.2);return b};a.normpath_preserve_protocol=function(a){var b=a.split("://",2);return 1<b.length?(b[1]=w(b[1]),b.join("://")):w(a)}};b4w.module.__sfx=function(a,r){function u(){var a=window.AudioContext||window.webkitAudioContext;if(a){a=new a;if(a.createGain)return a;G.warn("deprecated WebAudio implementation");return null}G.warn("WebAudio is not supported");return null}function h(a,d,e){var g=a.sfx;if("NONE"!=g.behavior){e||(e=0);var h=g.loop,k=g.pitch;if(g.src&&(h||0<=e)){g.base_seed=Math.floor(5E4*Math.random());var m=H.currentTime+d;g.start_time=m;g.state=20;b(a);"POSITIONAL"==g.behavior||"BACKGROUND_SOUND"==g.behavior?(d=
H.createBufferSource(),d.buffer=g.src,d.playbackRate.value=k,h?(g.source_node&&g.source_node.disconnect(),d.loop=!0,d.start(m),g.duration=0):(h=d.buffer?d.buffer.duration:0,e>h?(h=m+e+g.fade_out,d.loop=!0,d.start(m),d.stop(h),g.duration=e):(d.loop=!1,d.start(m),g.duration=h)),d.connect(g.proc_chain_in),g.source_node=d,c(g),f(g)):"BACKGROUND_MUSIC"==g.behavior&&(w.clear_timeout(g.bgm_start_timeout),w.clear_timeout(g.bgm_stop_timeout),e=function(){var b=a.sfx,c=b.src;c&&(c.volume=1,c.loop=b.loop,b.source_node=
b.source_node||H.createMediaElementSource(c),b.source_node.connect(b.proc_chain_in),20==b.state&&(c.currentTime&&(c.currentTime=0),c.play()))},0==d?e():g.bgm_start_timeout=w.set_timeout(e,1E3*d),h?g.duration=0:(e=B(a),g.duration=e));n(g,m)}}}function b(a){var b=a.sfx;if(!b.proc_chain_in){var c=a.render.trans;a=a.render.quat;if(p.mix_mode){var d=H.createBiquadFilter();d.type="peaking"}else d=null;var e=H.createGain();switch(b.behavior){case "POSITIONAL":var f=H.createPanner();"string"!=typeof f.panningModel?
(f.panningModel=f.EQUALPOWER,f.distanceModel=f.INVERSE_DISTANCE):(f.panningModel="equalpower",f.distanceModel="inverse");f.setPosition(c[0],c[1],c[2]);C.copy(c,b.last_position);c=g;t.quat_to_dir(a,t.AXIS_MY,c);f.setOrientation(c[0],c[1],c[2]);C.copy(c,b.direction);f.refDistance=b.dist_ref;f.maxDistance=b.dist_max;f.rolloffFactor=b.attenuation;f.coneInnerAngle=b.cone_angle_inner;f.coneOuterAngle=b.cone_angle_outer;f.coneOuterGain=b.cone_volume_outer;var h=H.createGain();h.gain.value=m(b);d?(f.connect(d),
d.connect(h)):f.connect(h);h.connect(e);b.proc_chain_in=f;if(b.volume_random){var k=H.createGain();e.connect(k);k.connect(H?F._sfx.proc_chain_in:null)}else k=null,e.connect(H?F._sfx.proc_chain_in:null);break;case "BACKGROUND_SOUND":f=null;h=H.createGain();h.gain.value=m(b);d?(b.proc_chain_in=d,d.connect(h)):b.proc_chain_in=h;h.connect(e);b.volume_random?(k=H.createGain(),e.connect(k),k.connect(H?F._sfx.proc_chain_in:null)):(k=null,e.connect(H?F._sfx.proc_chain_in:null));break;case "BACKGROUND_MUSIC":k=
f=null,h=H.createGain(),h.gain.value=m(b),d?(b.proc_chain_in=d,d.connect(h)):b.proc_chain_in=h,h.connect(e),e.connect(H?F._sfx.proc_chain_in:null)}b.panner_node=f;b.filter_node=d;b.gain_node=h;b.fade_gain_node=e;b.rand_gain_node=k}}function l(a){var b=a.sfx,c=b.duration,b=b.delay+b.delay_random*Math.random();h(a,b,c)}function c(a){a.volume_random&&a.rand_gain_node.gain.cancelScheduledValues(a.start_time);a.pitch_random&&a.source_node.playbackRate.cancelScheduledValues(a.start_time);a.vp_rand_end_time=
a.start_time}function f(a){if(a.volume_random||a.pitch_random){var b=a.rand_gain_node,c=a.source_node,d=c.buffer?c.buffer.duration:0;if(d){var e=a.start_time;x[0]=a.base_seed;for(var g=0;5>g;){var f=a.pitch+a.pitch_random*t.rand_r(x);if(e>=a.vp_rand_end_time){if(a.volume_random){var h=1-t.clamp(a.volume_random,0,1)*Math.random();b.gain.setValueAtTime(h,e)}a.pitch_random&&c.playbackRate.setValueAtTime(f,e);g++}e+=d/f}a.vp_rand_end_time=e-.001}}}function n(a,b){if(a.fade_in||a.fade_out){var c=a.fade_gain_node;
c.gain.cancelScheduledValues(b);a.fade_in?(c.gain.setValueAtTime(0,b),c.gain.linearRampToValueAtTime(1,b+a.fade_in)):c.gain.setValueAtTime(1,b);a.fade_out&&!a.loop&&(c.gain.setValueAtTime(1,b+a.duration),c.gain.linearRampToValueAtTime(0,b+a.duration+a.fade_out))}}function q(a){if("SPEAKER"!=a.type)throw"Wrong object type";var b=a.sfx;if(20==b.state||40==b.state){var c=b.fade_gain_node,d=H.currentTime;b.fade_out&&(c.gain.setValueAtTime(c.gain.value,d),c.gain.linearRampToValueAtTime(0,d+b.fade_out));
"BACKGROUND_MUSIC"==b.behavior?b.src&&(w.clear_timeout(b.bgm_start_timeout),w.clear_timeout(b.bgm_stop_timeout),b.bgm_stop_timeout=w.set_timeout(function(){var b=a.sfx.src;b&&(b.currentTime&&(b.currentTime=0),b.pause())},1E3*b.fade_out)):(c=b.source_node,b.duration<c.buffer.duration?b.fade_out&&20==b.state?c.stop(d+b.fade_out):20==b.state&&(c.stop(0),c.disconnect()):c.disconnect(),b.start_time=0,b.pause_time=0,b.buf_offset=0);b.state=30}}function d(a){a=a.sfx;if(20==a.state){var b=H.currentTime;a.pause_time=
b;if("BACKGROUND_MUSIC"==a.behavior){var d=a.src;d&&d.pause()}else{if(b>a.start_time){x[0]=a.base_seed;for(var e=a.source_node.buffer.duration,g=a.start_time;g<b;)d=a.pitch+a.pitch_random*t.rand_r(x),g+=e/d;a.buf_offset=(e/d-(g-b))*d}else a.buf_offset=0;a.source_node.stop(0);a.source_node.disconnect();c(a)}a.state=40}}function k(a){var b=a.sfx;if(40==b.state){var c=H.currentTime;b.start_time+=c-b.pause_time;if("BACKGROUND_MUSIC"==b.behavior)b.src.play();else{a=a.sfx;var d=H.createBufferSource();d.loop=
a.source_node.loop;d.buffer=a.source_node.buffer;d.playbackRate.value=a.source_node.playbackRate.value;a.panner_node?d.connect(a.panner_node):d.connect(a.gain_node);a.source_node=d;b.vp_rand_end_time=c;b.source_node.start(b.start_time,b.buf_offset);f(b)}n(b,b.start_time);b.state=20}}function e(a){return!a.sfx||20!=a.sfx.state&&40!=a.sfx.state&&30!=a.sfx.state?!1:!0}function m(a){return a.muted?0:a.volume}function B(a){a=a.sfx;return(a=a.src)?a.duration:0}var N=r("__config"),G=r("__print"),w=r("__time"),
t=r("__util"),C=r("__vec3"),D=N.defaults,p=N.sfx;a.AST_NONE=10;a.AST_ARRAY_BUFFER=20;a.AST_HTML_ELEMENT=30;var g=new Float32Array(3),y=new Float32Array(3),v=new Float32Array(3),I=[],z=[],H=null,F=null,L=[],x=[1],K=null;a.create_sfx=function(){return{behavior:"NONE",disable_doppler:!1,muted:!1,volume:1,pitch:1,attenuation:1,dist_ref:1,dist_max:1E4,cone_angle_inner:360,cone_angle_outer:360,cone_volume_outer:1,cyclic:!1,loop:!1,delay:0,delay_random:0,volume_random:0,pitch_random:0,fade_in:0,fade_out:0,
start_time:0,pause_time:0,buf_offset:0,duration:0,vp_rand_end_time:0,base_seed:1,src:null,state:10,last_position:new Float32Array(3),direction:new Float32Array(3),speed_avg:new Float32Array(3),bgm_start_timeout:-1,bgm_stop_timeout:-1,duck_time:0}};a.init=function(){var a=document.createElement("audio"),b=document.createElement("video");a.canPlayType&&(""!=a.canPlayType("audio/ogg")&&(I.push("ogg"),I.push("ogv")),""!=a.canPlayType("audio/mpeg")&&I.push("mp3"),""!=a.canPlayType("audio/mp4")&&(I.push("mp4"),
I.push("m4v")),""!=a.canPlayType("audio/webm")&&I.push("webm"));b.canPlayType&&(""!=b.canPlayType("video/ogg")&&z.push("ogv"),""!=b.canPlayType("video/mp4")&&z.push("m4v"),""!=b.canPlayType("video/webm")&&z.push("webm"));(H=p.webaudio?u():null)&&G.log("%cINIT WEBAUDIO: "+H.sampleRate+"Hz","color: #00a")};a.attach_scene_sfx=function(a){var b={listener_last_eye:new Float32Array(3),listener_direction:new Float32Array(3),listener_speed_avg:new Float32Array(3)};a._sfx=b;if(H){var c=H.createGain(),d=H.createGain();
b.gain_node=c;b.fade_gain_node=d;c.connect(d);d.connect(H.destination);if(a.b4w_enable_dynamic_compressor){var d=H.createDynamicsCompressor(),e=a.b4w_dynamic_compressor_settings;d.threshold.value=e.threshold;d.knee.value=e.knee;d.ratio.value=e.ratio;d.attack.value=e.attack;d.release.value=e.release;d.connect(c);b.compressor_node=d;b.proc_chain_in=d}else b.compressor_node=null,b.proc_chain_in=c;c=H.listener;b.disable_doppler=D.disable_doppler_hack;b.disable_doppler||(c.dopplerFactor=a.audio_doppler_factor,
c.speedOfSound=a.audio_doppler_speed);b.muted=!1;b.volume=1;b.duck_time=0}};a.set_active_scene=function(a){F=a};a.detect_audio_container=function(a){a||(a="ogg");return-1<I.indexOf(a)?a:"ogg"==a&&-1<I.indexOf("mp4")?"mp4":"mp3"==a&&-1<I.indexOf("ogg")?"ogg":"mp4"==a&&-1<I.indexOf("ogg")?"ogg":"ogv"==a&&-1<I.indexOf("m4v")?"m4v":"webm"==a&&-1<I.indexOf("m4v")?"m4v":"m4v"==a&&-1<I.indexOf("webm")?"webm":""};a.detect_video_container=function(a){a||(a="webm");return-1<z.indexOf(a)?a:"ogv"==a&&-1<z.indexOf("m4v")?
"m4v":"webm"==a&&-1<z.indexOf("m4v")?"m4v":"m4v"==a&&-1<z.indexOf("webm")?"webm":""};a.update_object=function(a,b){if("SPEAKER"!=b.type)throw"Wrong speaker object";var c=a.data,d=b.sfx;switch(c.b4w_behavior){case "POSITIONAL":case "BACKGROUND_SOUND":d.behavior=H?c.b4w_behavior:"NONE";break;case "BACKGROUND_MUSIC":var e;H?(window.MediaElementAudioSourceNode?e=!0:(G.warn("MediaElementAudioSourceNode not found"),e=!1),e=e?"BACKGROUND_MUSIC":"BACKGROUND_SOUND"):e="NONE";d.behavior=e;break;default:throw"Wrong speaker behavior";
}c.sound||(d.behavior="NONE");d.disable_doppler=c.b4w_disable_doppler||D.disable_doppler_hack;d.muted=c.muted;d.volume=c.volume;d.pitch=c.pitch;d.attenuation=c.attenuation;d.dist_ref=c.distance_reference;d.dist_max=c.distance_max||1E4;d.cone_angle_inner=c.cone_angle_inner;d.cone_angle_outer=c.cone_angle_outer;d.cone_volume_outer=c.cone_volume_outer;d.cyclic=c.b4w_cyclic_play;d.loop=c.b4w_loop;d.delay=c.b4w_delay;d.delay_random=c.b4w_delay_random;d.volume_random=c.b4w_volume_random;d.pitch_random=
c.b4w_pitch_random;d.fade_in=c.b4w_fade_in;d.fade_out=c.b4w_fade_out;L.push(b)};a.source_type=function(b){if("SPEAKER"!=b.type)throw"Wrong object type";switch(b.sfx.behavior){case "POSITIONAL":return a.AST_ARRAY_BUFFER;case "BACKGROUND_SOUND":return a.AST_ARRAY_BUFFER;case "BACKGROUND_MUSIC":return a.AST_HTML_ELEMENT;case "NONE":return a.AST_NONE;default:throw"Wrong speaker behavior";}};a.update_spkobj=function(a,b){var c=a.sfx;switch(c.behavior){case "POSITIONAL":case "BACKGROUND_SOUND":case "BACKGROUND_MUSIC":c.src=
b;break;case "NONE":break;default:throw"Wrong speaker behavior";}};a.play_empty_sound=function(){var a=H.createBufferSource();a.buffer=H.createBuffer(1,22050,22050);a.connect(H.destination);a.start(0)};a.decode_audio_data=function(a,b,c){H?H.decodeAudioData(a,b,c):c()};a.speaker_remove=function(a){q(a);a.sfx=null;L.splice(L.indexOf(a),1)};a.cleanup=function(){for(var a=0;a<L.length;a++){var b=L[a].sfx;"BACKGROUND_MUSIC"==b.behavior?(b=b.src)&&b.pause():b.source_node&&b.source_node.disconnect()}F&&
F._sfx&&(a=F._sfx,a.listener_last_eye[0]=0,a.listener_last_eye[1]=0,a.listener_last_eye[2]=0,a.listener_speed_avg[0]=0,a.listener_speed_avg[1]=0,a.listener_speed_avg[2]=0);F=null;L.splice(0);K=null};a.update=function(a,b){if(H&&0!=L.length){for(var c=0;c<L.length;c++){var d=L[c],e=d.sfx,g=H.currentTime;H&&!e.loop&&e.cyclic&&20==e.state&&e.duration&&e.start_time+e.duration<g&&l(d);20==e.state&&3>e.vp_rand_end_time-g&&f(e)}K&&K.speakers.length&&(-1==K.active||a>K.active_start_time+K.durations[K.active])&&
(c=K,-1<c.active&&q(c.speakers[c.active]),-1==c.active&&c.random?d=Math.round(Math.random()*(c.speakers.length-1)):c.random?(d=1+Math.round(Math.random()*(c.speakers.length-2)),d=(c.active+d)%c.speakers.length):d=(c.active+1)%c.speakers.length,l(c.speakers[d]),c.active=d,c.active_start_time=a)}};a.play=h;a.play_def=l;a.stop=q;a.is_play=function(a){return 20==a.sfx.state};a.speaker_pause=d;a.speaker_resume=k;a.playrate=function(a,b){var d=a.sfx;d.pitch=b;!e(a)||"POSITIONAL"!=d.behavior&&"BACKGROUND_SOUND"!=
d.behavior||(d.source_node.playbackRate.value=b,c(d),f(d))};a.get_playrate=function(a){return a.sfx.pitch};a.cyclic=function(a,b){a.sfx.cyclic=Boolean(b)};a.is_cyclic=function(a){return a.sfx.cyclic};a.listener_update_transform=function(a,b,c,d){if(H&&a._sfx){var e=g;e[0]=0;e[1]=-1;e[2]=0;C.transformQuat(e,c,e);y[0]=0;y[1]=0;y[2]=-1;C.transformQuat(y,c,y);c=H.listener;c.setPosition(b[0],b[1],b[2]);c.setOrientation(e[0],e[1],e[2],y[0],y[1],y[2]);C.copy(e,a._sfx.listener_direction);!a._sfx.disable_doppler&&
d&&(v[0]=(b[0]-a._sfx.listener_last_eye[0])/d,v[1]=(b[1]-a._sfx.listener_last_eye[1])/d,v[2]=(b[2]-a._sfx.listener_last_eye[2])/d,t.smooth_v(v,a._sfx.listener_speed_avg,d,.3,v),c.setVelocity(v[0],v[1],v[2]),C.copy(v,a._sfx.listener_speed_avg));C.copy(b,a._sfx.listener_last_eye)}};a.listener_reset_speed=function(a,b){if(H&&F._sfx&&!F._sfx.disable_doppler){var c=g;b?C.copy(b,c):C.copy(F._sfx.listener_direction,c);C.scale(c,a,c);H.listener.setVelocity(c[0],c[1],c[2]);C.copy(c,F._sfx.listener_speed_avg)}};
a.speaker_update_transform=function(a,b){var c=a.sfx;if(e(a)&&"POSITIONAL"==c.behavior){var d=a.render.trans,f=c.panner_node;f.setPosition(d[0],d[1],d[2]);var h=g;t.quat_to_dir(a.render.quat,t.AXIS_MY,h);f.setOrientation(h[0],h[1],h[2]);h=c.last_position;!c.disable_doppler&&b&&(y[0]=(d[0]-h[0])/b,y[1]=(d[1]-h[1])/b,y[2]=(d[2]-h[2])/b,t.smooth_v(y,c.speed_avg,b,.3,y),f.setVelocity(y[0],y[1],y[2]),C.copy(y,c.speed_avg));C.copy(d,h)}};a.speaker_reset_speed=function(a,b,c){var d=a.sfx;if(e(a)&&"POSITIONAL"==
d.behavior&&!d.disable_doppler){var f=g;c?C.copy(c,f):C.copy(d.direction,f);C.scale(f,b,f);d.panner_node.setVelocity(f[0],f[1],f[2]);C.copy(f,d.speed_avg);C.copy(a.render.trans,d.last_position)}};a.get_spk_behavior=function(a){return a.sfx.behavior};a.check_active_speakers=function(){for(var a=0;a<L.length;a++)if(e(L[a]))return!0;return!1};a.set_master_volume=function(a){var b=F._sfx;b&&(b.volume=a,H&&(b.gain_node.gain.value=m(b)))};a.get_master_volume=function(){var a=F._sfx;return a?a.volume:0};
a.set_volume=function(a,b){var c=a.sfx;c.volume=b;e(a)&&(c.gain_node.gain.value=m(c))};a.get_volume=function(a){return a.sfx.volume};a.mute=function(a,b){a.sfx.muted=Boolean(b);e(a)&&(a.sfx.gain_node.gain.value=m(a.sfx))};a.is_muted=function(a){return a.sfx.muted};a.mute_master=function(a){var b=F._sfx;b&&(b.muted=Boolean(a),H&&(b.gain_node.gain.value=m(b)))};a.is_master_muted=function(){var a=F._sfx;return a?a.muted:!1};a.get_speaker_objects=function(){return L};a.pause=function(){for(var a=0;a<
L.length;a++)d(L[a])};a.resume=function(){for(var a=0;a<L.length;a++)k(L[a])};a.set_compressor_params=function(a,b){if(a._sfx&&a._sfx.compressor_node){var c=a._sfx.compressor_node;c.threshold.value=b.threshold;c.knee.value=b.knee;c.ratio.value=b.ratio;c.attack.value=b.attack;c.release.value=b.release}};a.get_compressor_params=function(a){if(!a._sfx||!a._sfx.compressor_node)return null;a=a._sfx.compressor_node;return{threshold:a.threshold.value,knee:a.knee.value,ratio:a.ratio.value,attack:a.attack.value,
release:a.release.value}};a.duck=function(a,b,c){if(e(a)){a=a.sfx;var d=a.fade_gain_node,g=H.currentTime;d.gain.setValueAtTime(d.gain.value,g);d.gain.linearRampToValueAtTime(b,g+c);a.duck_time=c}};a.unduck=function(a){if(e(a)){a=a.sfx;var b=a.fade_gain_node,c=H.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.duck_time);a.duck_time=0}};a.duck_master=function(a,b){if(H){var c=F._sfx,d=c.fade_gain_node,e=H.currentTime;d.gain.setValueAtTime(d.gain.value,e);d.gain.linearRampToValueAtTime(a,
e+b);c.duck_time=b}};a.unduck_master=function(){if(H){var a=F._sfx,b=a.fade_gain_node,c=H.currentTime;b.gain.setValueAtTime(b.gain.value,c);b.gain.linearRampToValueAtTime(1,c+a.duck_time);a.duck_time=0}};a.apply_playlist=function(a,b,c){K={active:-1,active_start_time:0,random:c,speakers:[],durations:[]};for(c=0;c<a.length;c++){var d=a[c],e=B(d);0==e?G.warn("Ignoring speaker with zero duration: "+d.name):(q(d),d.sfx.cyclic=!1,K.speakers.push(d),K.durations.push(e+b))}};a.get_duration=B;a.clear_playlist=
function(){if(K)for(var a=K.speakers,b=0;b<a.length;b++)q(a[b]);K=null};a.get_positional_params=function(a){return(a=a.sfx)&&"POSITIONAL"==a.behavior?{dist_ref:a.dist_ref,dist_max:a.dist_max,attenuation:a.attenuation}:null};a.set_positional_params=function(a,b){var c=a.sfx;if(c&&"POSITIONAL"==c.behavior){c.dist_ref=b.dist_ref;c.dist_max=b.dist_max;c.attenuation=b.attenuation;var d=c.panner_node;d&&(d.refDistance=c.dist_ref,d.maxDistance=c.dist_max,d.rolloffFactor=c.attenuation)}};a.set_filter_params=
function(a,b){var c=a.sfx;c&&c.filter_node&&(c.filter_node.frequency.value=b.freq,c.filter_node.Q.value=b.Q,c.filter_node.gain.value=b.gain)};a.get_filter_params=function(a){return(a=a.sfx)&&a.filter_node?{freq:a.filter_node.frequency.value,Q:a.filter_node.Q.value,gain:a.filter_node.gain.value}:null};a.get_filter_freq_response=function(a,b,c,d){a=a.sfx;if(!a||!a.filter_node)return null;a.filter_node.getFrequencyResponse(b,c,d)}};b4w.module.__vec3=function(a,r){var u="undefined"!==typeof Float32Array?Float32Array:Array,h=Math.random;a.create=function(){var a=new u(3);a[0]=0;a[1]=0;a[2]=0;return a};a.clone=function(a){var h=new u(3);h[0]=a[0];h[1]=a[1];h[2]=a[2];return h};a.fromValues=function(a,h,c){var f=new u(3);f[0]=a;f[1]=h;f[2]=c;return f};a.copy=function(a,h){h[0]=a[0];h[1]=a[1];h[2]=a[2];return h};a.set=function(a,h,c,f){f[0]=a;f[1]=h;f[2]=c;return f};a.add=function(a,h,c){c[0]=a[0]+h[0];c[1]=a[1]+h[1];c[2]=a[2]+h[2];
return c};a.subtract=function(a,h,c){c[0]=a[0]-h[0];c[1]=a[1]-h[1];c[2]=a[2]-h[2];return c};a.sub=a.subtract;a.multiply=function(a,h,c){c[0]=a[0]*h[0];c[1]=a[1]*h[1];c[2]=a[2]*h[2];return c};a.mul=a.multiply;a.divide=function(a,h,c){c[0]=a[0]/h[0];c[1]=a[1]/h[1];c[2]=a[2]/h[2];return c};a.div=a.divide;a.min=function(a,h,c){c[0]=Math.min(a[0],h[0]);c[1]=Math.min(a[1],h[1]);c[2]=Math.min(a[2],h[2]);return c};a.max=function(a,h,c){c[0]=Math.max(a[0],h[0]);c[1]=Math.max(a[1],h[1]);c[2]=Math.max(a[2],
h[2]);return c};a.scale=function(a,h,c){c[0]=a[0]*h;c[1]=a[1]*h;c[2]=a[2]*h;return c};a.scaleAndAdd=function(a,h,c,f){f[0]=a[0]+h[0]*c;f[1]=a[1]+h[1]*c;f[2]=a[2]+h[2]*c;return f};a.distance=function(a,h){var c=h[0]-a[0],f=h[1]-a[1],n=h[2]-a[2];return Math.sqrt(c*c+f*f+n*n)};a.dist=a.distance;a.squaredDistance=function(a,h){var c=h[0]-a[0],f=h[1]-a[1],n=h[2]-a[2];return c*c+f*f+n*n};a.sqrDist=a.squaredDistance;a.length=function(a){var h=a[0],c=a[1];a=a[2];return Math.sqrt(h*h+c*c+a*a)};a.len=a.length;
a.squaredLength=function(a){var h=a[0],c=a[1];a=a[2];return h*h+c*c+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,h){h[0]=-a[0];h[1]=-a[1];h[2]=-a[2];return h};a.inverse=function(a,h){h[0]=1/a[0];h[1]=1/a[1];h[2]=1/a[2];return h};a.normalize=function(a,h){var c=a[0],f=a[1],n=a[2],c=c*c+f*f+n*n;0<c&&(c=1/Math.sqrt(c),h[0]=a[0]*c,h[1]=a[1]*c,h[2]=a[2]*c);return h};a.dot=function(a,h){return a[0]*h[0]+a[1]*h[1]+a[2]*h[2]};a.cross=function(a,h,c){var f=a[0],n=a[1];a=a[2];var q=h[0],d=h[1];h=h[2];
c[0]=n*h-a*d;c[1]=a*q-f*h;c[2]=f*d-n*q;return c};a.lerp=function(a,h,c,f){var n=a[0],q=a[1];a=a[2];f[0]=n+c*(h[0]-n);f[1]=q+c*(h[1]-q);f[2]=a+c*(h[2]-a);return f};a.random=function(a,l){a=a||1;var c=2*h()*Math.PI,f=2*h()-1,n=Math.sqrt(1-f*f)*a;l[0]=Math.cos(c)*n;l[1]=Math.sin(c)*n;l[2]=f*a;return l};a.transformMat4=function(a,h,c){var f=a[0],n=a[1];a=a[2];var q=h[3]*f+h[7]*n+h[11]*a+h[15],q=q||1;c[0]=(h[0]*f+h[4]*n+h[8]*a+h[12])/q;c[1]=(h[1]*f+h[5]*n+h[9]*a+h[13])/q;c[2]=(h[2]*f+h[6]*n+h[10]*a+h[14])/
q;return c};a.transformMat3=function(a,h,c){var f=a[0],n=a[1];a=a[2];c[0]=f*h[0]+n*h[3]+a*h[6];c[1]=f*h[1]+n*h[4]+a*h[7];c[2]=f*h[2]+n*h[5]+a*h[8];return c};a.transformQuat=function(a,h,c){var f=a[0],n=a[1],q=a[2];a=h[0];var d=h[1],k=h[2];h=h[3];var e=h*f+d*q-k*n,m=h*n+k*f-a*q,r=h*q+a*n-d*f,f=-a*f-d*n-k*q;c[0]=e*h+f*-a+m*-k-r*-d;c[1]=m*h+f*-d+r*-a-e*-k;c[2]=r*h+f*-k+e*-d-m*-a;return c};a.rotateX=function(a,h,c,f){var n=[],q=[];n[0]=a[0]-h[0];n[1]=a[1]-h[1];n[2]=a[2]-h[2];q[0]=n[0];q[1]=n[1]*Math.cos(c)-
n[2]*Math.sin(c);q[2]=n[1]*Math.sin(c)+n[2]*Math.cos(c);f[0]=q[0]+h[0];f[1]=q[1]+h[1];f[2]=q[2]+h[2];return f};a.rotateY=function(a,h,c,f){var n=[],q=[];n[0]=a[0]-h[0];n[1]=a[1]-h[1];n[2]=a[2]-h[2];q[0]=n[2]*Math.sin(c)+n[0]*Math.cos(c);q[1]=n[1];q[2]=n[2]*Math.cos(c)-n[0]*Math.sin(c);f[0]=q[0]+h[0];f[1]=q[1]+h[1];f[2]=q[2]+h[2];return f};a.rotateZ=function(a,h,c,f){var n=[],q=[];n[0]=a[0]-h[0];n[1]=a[1]-h[1];n[2]=a[2]-h[2];q[0]=n[0]*Math.cos(c)-n[1]*Math.sin(c);q[1]=n[0]*Math.sin(c)+n[1]*Math.cos(c);
q[2]=n[2];f[0]=q[0]+h[0];f[1]=q[1]+h[1];f[2]=q[2]+h[2];return f};a.forEach=function(){var b=a.create();return function(a,c,f,h,q,d){c||(c=3);f||(f=0);for(h=h?Math.min(h*c+f,a.length):a.length;f<h;f+=c)b[0]=a[f],b[1]=a[f+1],b[2]=a[f+2],q(b,d,b),a[f]=b[0],a[f+1]=b[1],a[f+2]=b[2];return a}}();a.angle=function(b,h){var c=a.fromValues(b[0],b[1],b[2]),f=a.fromValues(h[0],h[1],h[2]);a.normalize(c,c);a.normalize(f,f);c=a.dot(c,f);return 1<c?0:Math.acos(c)};a.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+
a[2]+")"};"undefined"!==typeof a&&(a.vec3=a)};b4w.module.vec3=b4w.module.__vec3;
b4w.module.__vec4=function(a,r){var u="undefined"!==typeof Float32Array?Float32Array:Array,h=Math.random;a.create=function(){var a=new u(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};a.clone=function(a){var h=new u(4);h[0]=a[0];h[1]=a[1];h[2]=a[2];h[3]=a[3];return h};a.fromValues=function(a,h,c,f){var n=new u(4);n[0]=a;n[1]=h;n[2]=c;n[3]=f;return n};a.copy=function(a,h){h[0]=a[0];h[1]=a[1];h[2]=a[2];h[3]=a[3];return h};a.set=function(a,h,c,f,n){n[0]=a;n[1]=h;n[2]=c;n[3]=f;return n};a.add=function(a,h,
c){c[0]=a[0]+h[0];c[1]=a[1]+h[1];c[2]=a[2]+h[2];c[3]=a[3]+h[3];return c};a.subtract=function(a,h,c){c[0]=a[0]-h[0];c[1]=a[1]-h[1];c[2]=a[2]-h[2];c[3]=a[3]-h[3];return c};a.sub=a.subtract;a.multiply=function(a,h,c){c[0]=a[0]*h[0];c[1]=a[1]*h[1];c[2]=a[2]*h[2];c[3]=a[3]*h[3];return c};a.mul=a.multiply;a.divide=function(a,h,c){c[0]=a[0]/h[0];c[1]=a[1]/h[1];c[2]=a[2]/h[2];c[3]=a[3]/h[3];return c};a.div=a.divide;a.min=function(a,h,c){c[0]=Math.min(a[0],h[0]);c[1]=Math.min(a[1],h[1]);c[2]=Math.min(a[2],
h[2]);c[3]=Math.min(a[3],h[3]);return c};a.max=function(a,h,c){c[0]=Math.max(a[0],h[0]);c[1]=Math.max(a[1],h[1]);c[2]=Math.max(a[2],h[2]);c[3]=Math.max(a[3],h[3]);return c};a.scale=function(a,h,c){c[0]=a[0]*h;c[1]=a[1]*h;c[2]=a[2]*h;c[3]=a[3]*h;return c};a.scaleAndAdd=function(a,h,c,f){f[0]=a[0]+h[0]*c;f[1]=a[1]+h[1]*c;f[2]=a[2]+h[2]*c;f[3]=a[3]+h[3]*c;return f};a.distance=function(a,h){var c=h[0]-a[0],f=h[1]-a[1],n=h[2]-a[2],q=h[3]-a[3];return Math.sqrt(c*c+f*f+n*n+q*q)};a.dist=a.distance;a.squaredDistance=
function(a,h){var c=h[0]-a[0],f=h[1]-a[1],n=h[2]-a[2],q=h[3]-a[3];return c*c+f*f+n*n+q*q};a.sqrDist=a.squaredDistance;a.length=function(a){var h=a[0],c=a[1],f=a[2];a=a[3];return Math.sqrt(h*h+c*c+f*f+a*a)};a.len=a.length;a.squaredLength=function(a){var h=a[0],c=a[1],f=a[2];a=a[3];return h*h+c*c+f*f+a*a};a.sqrLen=a.squaredLength;a.negate=function(a,h){h[0]=-a[0];h[1]=-a[1];h[2]=-a[2];h[3]=-a[3];return h};a.inverse=function(a,h){h[0]=1/a[0];h[1]=1/a[1];h[2]=1/a[2];h[3]=1/a[3];return h};a.normalize=
function(a,h){var c=a[0],f=a[1],n=a[2],q=a[3],c=c*c+f*f+n*n+q*q;0<c&&(c=1/Math.sqrt(c),h[0]=a[0]*c,h[1]=a[1]*c,h[2]=a[2]*c,h[3]=a[3]*c);return h};a.dot=function(a,h){return a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]};a.lerp=function(a,h,c,f){var n=a[0],q=a[1],d=a[2];a=a[3];f[0]=n+c*(h[0]-n);f[1]=q+c*(h[1]-q);f[2]=d+c*(h[2]-d);f[3]=a+c*(h[3]-a);return f};a.random=function(b,l){b=b||1;l[0]=h();l[1]=h();l[2]=h();l[3]=h();a.normalize(l,l);a.scale(l,b,l);return l};a.transformMat4=function(a,h,c){var f=a[0],
n=a[1],q=a[2];a=a[3];c[0]=h[0]*f+h[4]*n+h[8]*q+h[12]*a;c[1]=h[1]*f+h[5]*n+h[9]*q+h[13]*a;c[2]=h[2]*f+h[6]*n+h[10]*q+h[14]*a;c[3]=h[3]*f+h[7]*n+h[11]*q+h[15]*a;return c};a.transformQuat=function(a,h,c){var f=a[0],n=a[1],q=a[2],d=h[0],k=h[1],e=h[2];h=h[3];var m=h*f+k*q-e*n,r=h*n+e*f-d*q,u=h*q+d*n-k*f,f=-d*f-k*n-e*q;c[0]=m*h+f*-d+r*-e-u*-k;c[1]=r*h+f*-k+u*-d-m*-e;c[2]=u*h+f*-e+m*-k-r*-d;c[3]=a[3];return c};a.forEach=function(){var b=a.create();return function(a,c,f,h,q,d){c||(c=4);f||(f=0);for(h=h?Math.min(h*
c+f,a.length):a.length;f<h;f+=c)b[0]=a[f],b[1]=a[f+1],b[2]=a[f+2],b[3]=a[f+3],q(b,d,b),a[f]=b[0],a[f+1]=b[1],a[f+2]=b[2],a[f+3]=b[3];return a}}();a.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.vec4=a)};b4w.module.vec4=b4w.module.__vec4;
b4w.module.__quat=function(a,r){var u=r("__vec3"),h=r("__vec4"),b=r("__mat3"),l="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new l(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.rotationTo=function(){var b=u.create(),f=u.fromValues(1,0,0),h=u.fromValues(0,1,0);return function(l,d,k){var e=u.dot(l,d);if(-.9999999>e)return u.cross(f,l,b),1E-6>u.length(b)&&u.cross(h,l,b),u.normalize(b,b),a.setAxisAngle(b,Math.PI,k),k;if(.9999999<e)return k[0]=0,k[1]=0,k[2]=0,k[3]=1,k;u.cross(l,
d,b);k[0]=b[0];k[1]=b[1];k[2]=b[2];k[3]=1+e;return a.normalize(k,k)}}();a.setAxes=function(){var c=b.create();return function(b,h,l,d){c[0]=h[0];c[3]=h[1];c[6]=h[2];c[1]=l[0];c[4]=l[1];c[7]=l[2];c[2]=-b[0];c[5]=-b[1];c[8]=-b[2];return a.normalize(a.fromMat3(c,d),d)}}();a.clone=h.clone;a.fromValues=h.fromValues;a.copy=h.copy;a.set=h.set;a.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};a.setAxisAngle=function(a,b,h){b*=.5;var l=Math.sin(b);h[0]=l*a[0];h[1]=l*a[1];h[2]=l*a[2];h[3]=Math.cos(b);
return h};a.add=h.add;a.multiply=function(a,b,h){var l=a[0],d=a[1],k=a[2];a=a[3];var e=b[0],m=b[1],r=b[2];b=b[3];h[0]=l*b+a*e+d*r-k*m;h[1]=d*b+a*m+k*e-l*r;h[2]=k*b+a*r+l*m-d*e;h[3]=a*b-l*e-d*m-k*r;return h};a.mul=a.multiply;a.scale=h.scale;a.rotateX=function(a,b,h){b*=.5;var l=a[0],d=a[1],k=a[2];a=a[3];var e=Math.sin(b);b=Math.cos(b);h[0]=l*b+a*e;h[1]=d*b+k*e;h[2]=k*b-d*e;h[3]=a*b-l*e;return h};a.rotateY=function(a,b,h){b*=.5;var l=a[0],d=a[1],k=a[2];a=a[3];var e=Math.sin(b);b=Math.cos(b);h[0]=l*
b-k*e;h[1]=d*b+a*e;h[2]=k*b+l*e;h[3]=a*b-d*e;return h};a.rotateZ=function(a,b,h){b*=.5;var l=a[0],d=a[1],k=a[2];a=a[3];var e=Math.sin(b);b=Math.cos(b);h[0]=l*b+d*e;h[1]=d*b-l*e;h[2]=k*b+a*e;h[3]=a*b-k*e;return h};a.calculateW=function(a,b){var h=a[0],l=a[1],d=a[2];b[0]=h;b[1]=l;b[2]=d;b[3]=Math.sqrt(Math.abs(1-h*h-l*l-d*d));return b};a.dot=h.dot;a.lerp=h.lerp;a.slerp=function(a,b,h,l){var d=a[0],k=a[1],e=a[2];a=a[3];var m=b[0],r=b[1],u=b[2];b=b[3];var G,w,t;w=d*m+k*r+e*u+a*b;0>w&&(w=-w,m=-m,r=-r,
u=-u,b=-b);1E-6<1-w?(G=Math.acos(w),t=Math.sin(G),w=Math.sin((1-h)*G)/t,h=Math.sin(h*G)/t):w=1-h;l[0]=w*d+h*m;l[1]=w*k+h*r;l[2]=w*e+h*u;l[3]=w*a+h*b;return l};a.invert=function(a,b){var h=a[0],l=a[1],d=a[2],k=a[3],e=h*h+l*l+d*d+k*k,e=e?1/e:0;b[0]=-h*e;b[1]=-l*e;b[2]=-d*e;b[3]=k*e;return b};a.conjugate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};a.length=h.length;a.len=a.length;a.squaredLength=h.squaredLength;a.sqrLen=a.squaredLength;a.normalize=h.normalize;a.fromMat3=function(a,
b){var h=a[0]+a[4]+a[8];if(0<h)h=Math.sqrt(h+1),b[3]=.5*h,h=.5/h,b[0]=(a[5]-a[7])*h,b[1]=(a[6]-a[2])*h,b[2]=(a[1]-a[3])*h;else{var l=0;a[4]>a[0]&&(l=1);a[8]>a[3*l+l]&&(l=2);var d=(l+1)%3,k=(l+2)%3,h=Math.sqrt(a[3*l+l]-a[3*d+d]-a[3*k+k]+1);b[l]=.5*h;h=.5/h;b[3]=(a[3*d+k]-a[3*k+d])*h;b[d]=(a[3*d+l]+a[3*l+d])*h;b[k]=(a[3*k+l]+a[3*l+k])*h}return b};a.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof a&&(a.quat=a)};b4w.module.quat=b4w.module.__quat;
b4w.module.__mat3=function(a,r){var u="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new u(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.fromMat4=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b};a.clone=function(a){var b=new u(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.copy=function(a,b){b[0]=a[0];b[1]=a[1];
b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};a.transpose=function(a,b){if(b===a){var l=a[1],c=a[2],f=a[5];b[1]=a[3];b[2]=a[6];b[3]=l;b[5]=a[7];b[6]=c;b[7]=f}else b[0]=a[0],b[1]=a[3],b[2]=a[6],b[3]=a[1],b[4]=a[4],b[5]=a[7],b[6]=a[2],b[7]=a[5],b[8]=a[8];return b};a.invert=function(a,b){var l=a[0],c=a[1],f=a[2],n=a[3],q=a[4],d=a[5],k=a[6],e=a[7],m=a[8],r=m*q-d*e,u=-m*n+d*
k,G=e*n-q*k,w=l*r+c*u+f*G;if(!w)return null;w=1/w;b[0]=r*w;b[1]=(-m*c+f*e)*w;b[2]=(d*c-f*q)*w;b[3]=u*w;b[4]=(m*l-f*k)*w;b[5]=(-d*l+f*n)*w;b[6]=G*w;b[7]=(-e*l+c*k)*w;b[8]=(q*l-c*n)*w;return b};a.adjoint=function(a,b){var l=a[0],c=a[1],f=a[2],n=a[3],q=a[4],d=a[5],k=a[6],e=a[7],m=a[8];b[0]=q*m-d*e;b[1]=f*e-c*m;b[2]=c*d-f*q;b[3]=d*k-n*m;b[4]=l*m-f*k;b[5]=f*n-l*d;b[6]=n*e-q*k;b[7]=c*k-l*e;b[8]=l*q-c*n;return b};a.determinant=function(a){var b=a[3],l=a[4],c=a[5],f=a[6],n=a[7],q=a[8];return a[0]*(q*l-c*
n)+a[1]*(-q*b+c*f)+a[2]*(n*b-l*f)};a.multiply=function(a,b,l){var c=a[0],f=a[1],n=a[2],q=a[3],d=a[4],k=a[5],e=a[6],m=a[7];a=a[8];var r=b[0],u=b[1],G=b[2],w=b[3],t=b[4],C=b[5],D=b[6],p=b[7];b=b[8];l[0]=r*c+u*q+G*e;l[1]=r*f+u*d+G*m;l[2]=r*n+u*k+G*a;l[3]=w*c+t*q+C*e;l[4]=w*f+t*d+C*m;l[5]=w*n+t*k+C*a;l[6]=D*c+p*q+b*e;l[7]=D*f+p*d+b*m;l[8]=D*n+p*k+b*a;return l};a.mul=a.multiply;a.translate=function(a,b,l){var c=a[0],f=a[1],n=a[2],q=a[3],d=a[4],k=a[5],e=a[6],m=a[7];a=a[8];var r=b[0];b=b[1];l[0]=c;l[1]=
f;l[2]=n;l[3]=q;l[4]=d;l[5]=k;l[6]=r*c+b*q+e;l[7]=r*f+b*d+m;l[8]=r*n+b*k+a;return l};a.rotate=function(a,b,l){var c=a[0],f=a[1],n=a[2],q=a[3],d=a[4],k=a[5],e=a[6],m=a[7];a=a[8];var r=Math.sin(b);b=Math.cos(b);l[0]=b*c+r*q;l[1]=b*f+r*d;l[2]=b*n+r*k;l[3]=b*q-r*c;l[4]=b*d-r*f;l[5]=b*k-r*n;l[6]=e;l[7]=m;l[8]=a;return l};a.scale=function(a,b,l){var c=b[0];b=b[1];l[0]=c*a[0];l[1]=c*a[1];l[2]=c*a[2];l[3]=b*a[3];l[4]=b*a[4];l[5]=b*a[5];l[6]=a[6];l[7]=a[7];l[8]=a[8];return l};a.fromTranslation=function(a,
b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=a[0];b[7]=a[1];b[8]=1;return b};a.fromRotation=function(a,b){var l=Math.sin(a),c=Math.cos(a);b[0]=c;b[1]=l;b[2]=0;b[3]=-l;b[4]=c;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.fromScaling=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=a[1];b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};a.fromMat2d=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=0;b[3]=a[2];b[4]=a[3];b[5]=0;b[6]=a[4];b[7]=a[5];b[8]=1;return b};a.fromQuat=function(a,b){var l=a[0],c=a[1],f=a[2],n=a[3],q=l+
l,d=c+c,k=f+f,l=l*q,e=c*q,c=c*d,m=f*q,r=f*d,f=f*k,q=n*q,d=n*d,n=n*k;b[0]=1-c-f;b[3]=e-n;b[6]=m+d;b[1]=e+n;b[4]=1-l-f;b[7]=r-q;b[2]=m-d;b[5]=r+q;b[8]=1-l-c;return b};a.normalFromMat4=function(a,b){var l=a[0],c=a[1],f=a[2],n=a[3],q=a[4],d=a[5],k=a[6],e=a[7],m=a[8],r=a[9],u=a[10],G=a[11],w=a[12],t=a[13],C=a[14],D=a[15],p=l*d-c*q,g=l*k-f*q,y=l*e-n*q,v=c*k-f*d,I=c*e-n*d,z=f*e-n*k,H=m*t-r*w,F=m*C-u*w,m=m*D-G*w,L=r*C-u*t,r=r*D-G*t,u=u*D-G*C,G=p*u-g*r+y*L+v*m-I*F+z*H;if(!G)return null;G=1/G;b[0]=(d*u-k*r+
e*L)*G;b[1]=(k*m-q*u-e*F)*G;b[2]=(q*r-d*m+e*H)*G;b[3]=(f*r-c*u-n*L)*G;b[4]=(l*u-f*m+n*F)*G;b[5]=(c*m-l*r-n*H)*G;b[6]=(t*z-C*I+D*v)*G;b[7]=(C*y-w*z-D*g)*G;b[8]=(w*I-t*y+D*p)*G;return b};a.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};a.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==
typeof a&&(a.mat3=a)};b4w.module.mat3=b4w.module.__mat3;
b4w.module.__mat4=function(a,r){var u="undefined"!==typeof Float32Array?Float32Array:Array;a.create=function(){var a=new u(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.clone=function(a){var b=new u(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.copy=function(a,b){b[0]=a[0];
b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};a.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};a.transpose=function(a,b){if(b===a){var l=a[1],c=a[2],f=a[3],n=a[6],q=a[7],d=a[11];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=l;b[6]=a[9];b[7]=a[13];b[8]=c;b[9]=n;b[11]=a[14];b[12]=f;b[13]=
q;b[14]=d}else b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15];return b};a.invert=function(a,b){var l=a[0],c=a[1],f=a[2],n=a[3],q=a[4],d=a[5],k=a[6],e=a[7],m=a[8],r=a[9],u=a[10],G=a[11],w=a[12],t=a[13],C=a[14],D=a[15],p=l*d-c*q,g=l*k-f*q,y=l*e-n*q,v=c*k-f*d,I=c*e-n*d,z=f*e-n*k,H=m*t-r*w,F=m*C-u*w,L=m*D-G*w,x=r*C-u*t,K=r*D-G*t,A=u*D-G*C,P=p*A-g*K+y*x+v*L-I*F+z*H;if(!P)return null;
P=1/P;b[0]=(d*A-k*K+e*x)*P;b[1]=(f*K-c*A-n*x)*P;b[2]=(t*z-C*I+D*v)*P;b[3]=(u*I-r*z-G*v)*P;b[4]=(k*L-q*A-e*F)*P;b[5]=(l*A-f*L+n*F)*P;b[6]=(C*y-w*z-D*g)*P;b[7]=(m*z-u*y+G*g)*P;b[8]=(q*K-d*L+e*H)*P;b[9]=(c*L-l*K-n*H)*P;b[10]=(w*I-t*y+D*p)*P;b[11]=(r*y-m*I-G*p)*P;b[12]=(d*F-q*x-k*H)*P;b[13]=(l*x-c*F+f*H)*P;b[14]=(t*g-w*v-C*p)*P;b[15]=(m*v-r*g+u*p)*P;return b};a.adjoint=function(a,b){var l=a[0],c=a[1],f=a[2],n=a[3],q=a[4],d=a[5],k=a[6],e=a[7],m=a[8],r=a[9],u=a[10],G=a[11],w=a[12],t=a[13],C=a[14],D=a[15];
b[0]=d*(u*D-G*C)-r*(k*D-e*C)+t*(k*G-e*u);b[1]=-(c*(u*D-G*C)-r*(f*D-n*C)+t*(f*G-n*u));b[2]=c*(k*D-e*C)-d*(f*D-n*C)+t*(f*e-n*k);b[3]=-(c*(k*G-e*u)-d*(f*G-n*u)+r*(f*e-n*k));b[4]=-(q*(u*D-G*C)-m*(k*D-e*C)+w*(k*G-e*u));b[5]=l*(u*D-G*C)-m*(f*D-n*C)+w*(f*G-n*u);b[6]=-(l*(k*D-e*C)-q*(f*D-n*C)+w*(f*e-n*k));b[7]=l*(k*G-e*u)-q*(f*G-n*u)+m*(f*e-n*k);b[8]=q*(r*D-G*t)-m*(d*D-e*t)+w*(d*G-e*r);b[9]=-(l*(r*D-G*t)-m*(c*D-n*t)+w*(c*G-n*r));b[10]=l*(d*D-e*t)-q*(c*D-n*t)+w*(c*e-n*d);b[11]=-(l*(d*G-e*r)-q*(c*G-n*r)+m*
(c*e-n*d));b[12]=-(q*(r*C-u*t)-m*(d*C-k*t)+w*(d*u-k*r));b[13]=l*(r*C-u*t)-m*(c*C-f*t)+w*(c*u-f*r);b[14]=-(l*(d*C-k*t)-q*(c*C-f*t)+w*(c*k-f*d));b[15]=l*(d*u-k*r)-q*(c*u-f*r)+m*(c*k-f*d);return b};a.determinant=function(a){var b=a[0],l=a[1],c=a[2],f=a[3],n=a[4],q=a[5],d=a[6],k=a[7],e=a[8],m=a[9],r=a[10],u=a[11],G=a[12],w=a[13],t=a[14];a=a[15];return(b*q-l*n)*(r*a-u*t)-(b*d-c*n)*(m*a-u*w)+(b*k-f*n)*(m*t-r*w)+(l*d-c*q)*(e*a-u*G)-(l*k-f*q)*(e*t-r*G)+(c*k-f*d)*(e*w-m*G)};a.multiply=function(a,b,l){var c=
a[0],f=a[1],n=a[2],q=a[3],d=a[4],k=a[5],e=a[6],m=a[7],r=a[8],u=a[9],G=a[10],w=a[11],t=a[12],C=a[13],D=a[14];a=a[15];var p=b[0],g=b[1],y=b[2],v=b[3];l[0]=p*c+g*d+y*r+v*t;l[1]=p*f+g*k+y*u+v*C;l[2]=p*n+g*e+y*G+v*D;l[3]=p*q+g*m+y*w+v*a;p=b[4];g=b[5];y=b[6];v=b[7];l[4]=p*c+g*d+y*r+v*t;l[5]=p*f+g*k+y*u+v*C;l[6]=p*n+g*e+y*G+v*D;l[7]=p*q+g*m+y*w+v*a;p=b[8];g=b[9];y=b[10];v=b[11];l[8]=p*c+g*d+y*r+v*t;l[9]=p*f+g*k+y*u+v*C;l[10]=p*n+g*e+y*G+v*D;l[11]=p*q+g*m+y*w+v*a;p=b[12];g=b[13];y=b[14];v=b[15];l[12]=p*c+
g*d+y*r+v*t;l[13]=p*f+g*k+y*u+v*C;l[14]=p*n+g*e+y*G+v*D;l[15]=p*q+g*m+y*w+v*a;return l};a.mul=a.multiply;a.translate=function(a,b,l){var c=b[0],f=b[1];b=b[2];var n,q,d,k,e,m,r,u,G,w,t,C;a===l?(l[12]=a[0]*c+a[4]*f+a[8]*b+a[12],l[13]=a[1]*c+a[5]*f+a[9]*b+a[13],l[14]=a[2]*c+a[6]*f+a[10]*b+a[14],l[15]=a[3]*c+a[7]*f+a[11]*b+a[15]):(n=a[0],q=a[1],d=a[2],k=a[3],e=a[4],m=a[5],r=a[6],u=a[7],G=a[8],w=a[9],t=a[10],C=a[11],l[0]=n,l[1]=q,l[2]=d,l[3]=k,l[4]=e,l[5]=m,l[6]=r,l[7]=u,l[8]=G,l[9]=w,l[10]=t,l[11]=C,
l[12]=n*c+e*f+G*b+a[12],l[13]=q*c+m*f+w*b+a[13],l[14]=d*c+r*f+t*b+a[14],l[15]=k*c+u*f+C*b+a[15]);return l};a.scale=function(a,b,l){var c=b[0],f=b[1];b=b[2];l[0]=a[0]*c;l[1]=a[1]*c;l[2]=a[2]*c;l[3]=a[3]*c;l[4]=a[4]*f;l[5]=a[5]*f;l[6]=a[6]*f;l[7]=a[7]*f;l[8]=a[8]*b;l[9]=a[9]*b;l[10]=a[10]*b;l[11]=a[11]*b;l[12]=a[12];l[13]=a[13];l[14]=a[14];l[15]=a[15];return l};a.rotate=function(a,b,l,c){var f=l[0],n=l[1];l=l[2];var q=Math.sqrt(f*f+n*n+l*l),d,k,e,m,r,u,G,w,t,C,D,p,g,y,v,I,z,H,F,L;if(1E-7>Math.abs(q))return null;
q=1/q;f*=q;n*=q;l*=q;d=Math.sin(b);k=Math.cos(b);e=1-k;b=a[0];q=a[1];m=a[2];r=a[3];u=a[4];G=a[5];w=a[6];t=a[7];C=a[8];D=a[9];p=a[10];g=a[11];y=f*f*e+k;v=n*f*e+l*d;I=l*f*e-n*d;z=f*n*e-l*d;H=n*n*e+k;F=l*n*e+f*d;L=f*l*e+n*d;f=n*l*e-f*d;n=l*l*e+k;c[0]=b*y+u*v+C*I;c[1]=q*y+G*v+D*I;c[2]=m*y+w*v+p*I;c[3]=r*y+t*v+g*I;c[4]=b*z+u*H+C*F;c[5]=q*z+G*H+D*F;c[6]=m*z+w*H+p*F;c[7]=r*z+t*H+g*F;c[8]=b*L+u*f+C*n;c[9]=q*L+G*f+D*n;c[10]=m*L+w*f+p*n;c[11]=r*L+t*f+g*n;a!==c&&(c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);
return c};a.rotateX=function(a,b,l){var c=Math.sin(b);b=Math.cos(b);var f=a[4],n=a[5],q=a[6],d=a[7],k=a[8],e=a[9],m=a[10],r=a[11];a!==l&&(l[0]=a[0],l[1]=a[1],l[2]=a[2],l[3]=a[3],l[12]=a[12],l[13]=a[13],l[14]=a[14],l[15]=a[15]);l[4]=f*b+k*c;l[5]=n*b+e*c;l[6]=q*b+m*c;l[7]=d*b+r*c;l[8]=k*b-f*c;l[9]=e*b-n*c;l[10]=m*b-q*c;l[11]=r*b-d*c;return l};a.rotateY=function(a,b,l){var c=Math.sin(b);b=Math.cos(b);var f=a[0],n=a[1],q=a[2],d=a[3],k=a[8],e=a[9],m=a[10],r=a[11];a!==l&&(l[4]=a[4],l[5]=a[5],l[6]=a[6],
l[7]=a[7],l[12]=a[12],l[13]=a[13],l[14]=a[14],l[15]=a[15]);l[0]=f*b-k*c;l[1]=n*b-e*c;l[2]=q*b-m*c;l[3]=d*b-r*c;l[8]=f*c+k*b;l[9]=n*c+e*b;l[10]=q*c+m*b;l[11]=d*c+r*b;return l};a.rotateZ=function(a,b,l){var c=Math.sin(b);b=Math.cos(b);var f=a[0],n=a[1],q=a[2],d=a[3],k=a[4],e=a[5],m=a[6],r=a[7];a!==l&&(l[8]=a[8],l[9]=a[9],l[10]=a[10],l[11]=a[11],l[12]=a[12],l[13]=a[13],l[14]=a[14],l[15]=a[15]);l[0]=f*b+k*c;l[1]=n*b+e*c;l[2]=q*b+m*c;l[3]=d*b+r*c;l[4]=k*b-f*c;l[5]=e*b-n*c;l[6]=m*b-q*c;l[7]=r*b-d*c;return l};
a.fromTranslation=function(a,b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=a[0];b[13]=a[1];b[14]=a[2];b[15]=1;return b};a.fromScaling=function(a,b){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=a[1];b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=a[2];b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromRotation=function(a,b,l){var c=b[0],f=b[1];b=b[2];var n=Math.sqrt(c*c+f*f+b*b),q;if(1E-7>Math.abs(n))return null;n=1/n;c*=n;f*=n;b*=n;n=Math.sin(a);a=Math.cos(a);
q=1-a;l[0]=c*c*q+a;l[1]=f*c*q+b*n;l[2]=b*c*q-f*n;l[3]=0;l[4]=c*f*q-b*n;l[5]=f*f*q+a;l[6]=b*f*q+c*n;l[7]=0;l[8]=c*b*q+f*n;l[9]=f*b*q-c*n;l[10]=b*b*q+a;l[11]=0;l[12]=0;l[13]=0;l[14]=0;l[15]=1;return l};a.fromXRotation=function(a,b){var l=Math.sin(a),c=Math.cos(a);b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=c;b[6]=l;b[7]=0;b[8]=0;b[9]=-l;b[10]=c;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromYRotation=function(a,b){var l=Math.sin(a),c=Math.cos(a);b[0]=c;b[1]=0;b[2]=-l;b[3]=0;b[4]=0;b[5]=1;b[6]=
0;b[7]=0;b[8]=l;b[9]=0;b[10]=c;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromZRotation=function(a,b){var l=Math.sin(a),c=Math.cos(a);b[0]=c;b[1]=l;b[2]=0;b[3]=0;b[4]=-l;b[5]=c;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.fromRotationTranslation=function(a,b,l){var c=a[0],f=a[1],n=a[2],q=a[3],d=c+c,k=f+f,e=n+n;a=c*d;var m=c*k,c=c*e,r=f*k,f=f*e,n=n*e,d=q*d,k=q*k,q=q*e;l[0]=1-(r+n);l[1]=m+q;l[2]=c-k;l[3]=0;l[4]=m-q;l[5]=1-(a+n);l[6]=f+d;l[7]=0;l[8]=
c+k;l[9]=f-d;l[10]=1-(a+r);l[11]=0;l[12]=b[0];l[13]=b[1];l[14]=b[2];l[15]=1;return l};a.fromQuat=function(a,b){var l=a[0],c=a[1],f=a[2],n=a[3],q=l+l,d=c+c,k=f+f,l=l*q,e=c*q,c=c*d,m=f*q,r=f*d,f=f*k,q=n*q,d=n*d,n=n*k;b[0]=1-c-f;b[1]=e+n;b[2]=m-d;b[3]=0;b[4]=e-n;b[5]=1-l-f;b[6]=r+q;b[7]=0;b[8]=m+d;b[9]=r-q;b[10]=1-l-c;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};a.frustum=function(a,b,l,c,f,n,q){var d=1/(b-a),k=1/(c-l),e=1/(f-n);q[0]=2*f*d;q[1]=0;q[2]=0;q[3]=0;q[4]=0;q[5]=2*f*k;q[6]=0;q[7]=0;q[8]=
(b+a)*d;q[9]=(c+l)*k;q[10]=(n+f)*e;q[11]=-1;q[12]=0;q[13]=0;q[14]=n*f*2*e;q[15]=0;return q};a.perspective=function(a,b,l,c,f){a=1/Math.tan(a/2);var n=1/(l-c);f[0]=a/b;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=a;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=(c+l)*n;f[11]=-1;f[12]=0;f[13]=0;f[14]=2*c*l*n;f[15]=0;return f};a.perspectiveFromFieldOfView=function(a,b,l,c){var f=Math.tan(a.upDegrees*Math.PI/180),n=Math.tan(a.downDegrees*Math.PI/180),q=Math.tan(a.leftDegrees*Math.PI/180);a=Math.tan(a.rightDegrees*Math.PI/180);
var d=2/(q+a),k=2/(f+n);c[0]=d;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=k;c[6]=0;c[7]=0;c[8]=-((q-a)*d*.5);c[9]=(f-n)*k*.5;c[10]=l/(b-l);c[11]=-1;c[12]=0;c[13]=0;c[14]=l*b/(b-l);c[15]=0;return c};a.ortho=function(a,b,l,c,f,n,q){var d=1/(a-b),k=1/(l-c),e=1/(f-n);q[0]=-2*d;q[1]=0;q[2]=0;q[3]=0;q[4]=0;q[5]=-2*k;q[6]=0;q[7]=0;q[8]=0;q[9]=0;q[10]=2*e;q[11]=0;q[12]=(a+b)*d;q[13]=(c+l)*k;q[14]=(n+f)*e;q[15]=1;return q};a.lookAt=function(h,b,l,c){var f,n,q,d,k,e,m,r,u=h[0],G=h[1];h=h[2];q=l[0];d=l[1];n=l[2];m=b[0];
l=b[1];f=b[2];if(1E-7>Math.abs(u-m)&&1E-7>Math.abs(G-l)&&1E-7>Math.abs(h-f))return a.identity(c);b=u-m;l=G-l;m=h-f;r=1/Math.sqrt(b*b+l*l+m*m);b*=r;l*=r;m*=r;f=d*m-n*l;n=n*b-q*m;q=q*l-d*b;(r=Math.sqrt(f*f+n*n+q*q))?(r=1/r,f*=r,n*=r,q*=r):q=n=f=0;d=l*q-m*n;k=m*f-b*q;e=b*n-l*f;(r=Math.sqrt(d*d+k*k+e*e))?(r=1/r,d*=r,k*=r,e*=r):e=k=d=0;c[0]=f;c[1]=d;c[2]=b;c[3]=0;c[4]=n;c[5]=k;c[6]=l;c[7]=0;c[8]=q;c[9]=e;c[10]=m;c[11]=0;c[12]=-(f*u+n*G+q*h);c[13]=-(d*u+k*G+e*h);c[14]=-(b*u+l*G+m*h);c[15]=1;return c};a.str=
function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};a.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],
2))};"undefined"!==typeof a&&(a.mat4=a)};b4w.module.mat4=b4w.module.__mat4;b4w.module.__md5=function(a,r){function u(a,f){var d=a[0],k=a[1],e=a[2],m=a[3],d=b(d,k,e,m,f[0],7,-680876936),m=b(m,d,k,e,f[1],12,-389564586),e=b(e,m,d,k,f[2],17,606105819),k=b(k,e,m,d,f[3],22,-1044525330),d=b(d,k,e,m,f[4],7,-176418897),m=b(m,d,k,e,f[5],12,1200080426),e=b(e,m,d,k,f[6],17,-1473231341),k=b(k,e,m,d,f[7],22,-45705983),d=b(d,k,e,m,f[8],7,1770035416),m=b(m,d,k,e,f[9],12,-1958414417),e=b(e,m,d,k,f[10],17,-42063),k=b(k,e,m,d,f[11],22,-1990404162),d=b(d,k,e,m,f[12],7,1804603682),m=b(m,d,k,
e,f[13],12,-40341101),e=b(e,m,d,k,f[14],17,-1502002290),k=b(k,e,m,d,f[15],22,1236535329),d=l(d,k,e,m,f[1],5,-165796510),m=l(m,d,k,e,f[6],9,-1069501632),e=l(e,m,d,k,f[11],14,643717713),k=l(k,e,m,d,f[0],20,-373897302),d=l(d,k,e,m,f[5],5,-701558691),m=l(m,d,k,e,f[10],9,38016083),e=l(e,m,d,k,f[15],14,-660478335),k=l(k,e,m,d,f[4],20,-405537848),d=l(d,k,e,m,f[9],5,568446438),m=l(m,d,k,e,f[14],9,-1019803690),e=l(e,m,d,k,f[3],14,-187363961),k=l(k,e,m,d,f[8],20,1163531501),d=l(d,k,e,m,f[13],5,-1444681467),
m=l(m,d,k,e,f[2],9,-51403784),e=l(e,m,d,k,f[7],14,1735328473),k=l(k,e,m,d,f[12],20,-1926607734),d=h(k^e^m,d,k,f[5],4,-378558),m=h(d^k^e,m,d,f[8],11,-2022574463),e=h(m^d^k,e,m,f[11],16,1839030562),k=h(e^m^d,k,e,f[14],23,-35309556),d=h(k^e^m,d,k,f[1],4,-1530992060),m=h(d^k^e,m,d,f[4],11,1272893353),e=h(m^d^k,e,m,f[7],16,-155497632),k=h(e^m^d,k,e,f[10],23,-1094730640),d=h(k^e^m,d,k,f[13],4,681279174),m=h(d^k^e,m,d,f[0],11,-358537222),e=h(m^d^k,e,m,f[3],16,-722521979),k=h(e^m^d,k,e,f[6],23,76029189),
d=h(k^e^m,d,k,f[9],4,-640364487),m=h(d^k^e,m,d,f[12],11,-421815835),e=h(m^d^k,e,m,f[15],16,530742520),k=h(e^m^d,k,e,f[2],23,-995338651),d=c(d,k,e,m,f[0],6,-198630844),m=c(m,d,k,e,f[7],10,1126891415),e=c(e,m,d,k,f[14],15,-1416354905),k=c(k,e,m,d,f[5],21,-57434055),d=c(d,k,e,m,f[12],6,1700485571),m=c(m,d,k,e,f[3],10,-1894986606),e=c(e,m,d,k,f[10],15,-1051523),k=c(k,e,m,d,f[1],21,-2054922799),d=c(d,k,e,m,f[8],6,1873313359),m=c(m,d,k,e,f[15],10,-30611744),e=c(e,m,d,k,f[6],15,-1560198380),k=c(k,e,m,d,
f[13],21,1309151649),d=c(d,k,e,m,f[4],6,-145523070),m=c(m,d,k,e,f[11],10,-1120210379),e=c(e,m,d,k,f[2],15,718787259),k=c(k,e,m,d,f[9],21,-343485551);a[0]=d+a[0]&4294967295;a[1]=k+a[1]&4294967295;a[2]=e+a[2]&4294967295;a[3]=m+a[3]&4294967295}function h(a,b,c,f,e,h){b=(b+a&4294967295)+(f+h&4294967295)&4294967295;return(b<<e|b>>>32-e)+c&4294967295}function b(a,b,c,f,e,m,l){return h(b&c|~b&f,a,b,e,m,l)}function l(a,b,c,f,e,m,l){return h(b&f|c&~f,a,b,e,m,l)}function c(a,b,c,f,e,m,l){return h(c^(b|~f),
a,b,e,m,l)}var f="0123456789abcdef".split("");a.hexdigest=function(a){var b=a,c=b.length;a=[1732584193,-271733879,-1732584194,271733878];var k;for(k=64;k<=b.length;k+=64){for(var e=b.substring(k-64,k),h=[],l=void 0,l=0;64>l;l+=4)h[l>>2]=e.charCodeAt(l)+(e.charCodeAt(l+1)<<8)+(e.charCodeAt(l+2)<<16)+(e.charCodeAt(l+3)<<24);u(a,h)}b=b.substring(k-64);e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(k=0;k<b.length;k++)e[k>>2]|=b.charCodeAt(k)<<(k%4<<3);e[k>>2]|=128<<(k%4<<3);if(55<k)for(u(a,e),k=0;16>k;k++)e[k]=
0;e[14]=8*c;u(a,e);for(b=0;b<a.length;b++){c=a;k=b;e=a[b];h="";for(l=0;4>l;l++)h+=f[e>>8*l+4&15]+f[e>>8*l&15];c[k]=h}return a.join("")}};b4w.module.shader_texts=function(a,r){a["anchors.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"void main ( ) { gl_FragColor = vec4 ( 1.0 ) ; }".split(" ")}]};a["anchors.glslv"]={type:"group",parts:[{type:"var",name:"ANCHOR_NUM",tokens:["0"]},{type:"textline",tokens:"attribute float a_index ; uniform vec3 u_position [ ANCHOR_NUM ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec4 a = u_view_matrix * vec4 ( u_position [ int ( a_index ) ] , 1.0 ) ; gl_Position = u_proj_matrix * a ; gl_PointSize = 4.0 ; }".split(" ")}]};
a["color_id.glslf"]={type:"group",parts:[{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",tokens:["0"]},{type:"var",name:"NUM_VALUES",tokens:["0"]},{type:"var",name:"NUM_RGBS",tokens:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",tokens:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",
tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",tokens:["0.0"]},{type:"var",name:"RGB_IND",tokens:["0"]},{type:"var",name:"VALUE_IND",tokens:["0"]},{type:"var",name:"LAMP_INDEX",tokens:["0"]},{type:"var",name:"NUM_LIGHTS",tokens:["0"]},{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},
{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"var",name:"NUM_LFACTORS",tokens:["0"]},{type:"include",file:"precision_statement.glslf"},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"pack.glslf"},{type:"include",file:"procedural.glslf"},{type:"condition",
parts:[{type:"if",expression:["CAUSTICS"],group:{type:"group",parts:[{type:"include",file:"caustics.glslf"}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_LIGHTS",0,{type:"g_expr",places:2}],
group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"textline",tokens:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_VECTOR_VIEW","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],
group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",expression:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_diffuse_color",";"]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_sampler",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_OUTLINE",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_color_id",";"]}]}}]},{type:"condition",parts:[{type:"if",
expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",
expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",parts:[{type:"if",expression:["USE_REFRACTION"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_scene_depth",
";"]}]}}]}]}}]},{type:"textline",tokens:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_mirror_factor",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_refl_plane",
";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_LAMP"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_VALUE"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_RGB"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_OUTLINE"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_outline_intensity",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"varying vec3 bQ ; varying vec4 bR ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bS",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bT",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},
"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bU",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bV",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"uniform float u_perspective_cast_far_bound ; varying vec4 bW ; varying vec4 bX ; varying vec4 bY ; varying vec4 bZ ; uniform float u_perspective_cast_far_bound ; uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform sampler2D u_shadow_map0 ; uniform sampler2D u_shadow_map1 ; uniform sampler2D u_shadow_map2 ; uniform sampler2D u_shadow_map3 ; uniform sampler2D u_shadow_mask ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",
expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","b_",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"shadow.glslf"},{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_REFRACTION"],
group:{type:"group",parts:[{type:"include",file:"refraction.glslf"}]}}]}]}}]},{type:"include",file:"nodes.glslf"}]}}]},{type:"textline",tokens:["void","main","(",")","{"]},{type:"condition",parts:[{type:"if",expression:["ALPHA"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NODES"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 tA = u_camera_eye_frag - bQ ; vec3 tB = normalize ( tA ) ; vec3 tC ; vec3 tD ; vec3 tE ; float tF ; float tG ; tz ( tB , tC , tD , tE , tF , tG ) ; float tH = tG ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:"float tH = ( texture2D ( u_sampler , b_ ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"float tH = u_diffuse_color . a ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"if ( tH < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_OUTLINE"],group:{type:"group",parts:[{type:"textline",
tokens:"gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , u_outline_intensity ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( u_color_id , 1.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]};a["color_id.glslv"]={type:"group",parts:[{type:"var",name:"AU_QUALIFIER",tokens:["uniform"]},{type:"var",name:"MAX_BONES",tokens:["0"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",tokens:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},
{type:"include",file:"precision_statement.glslf"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",tokens:["attribute","vec3","a_position",";"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:5}],group:{type:"group",parts:[{type:"textline",
tokens:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_tangent",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MAIN_BEND_COL"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","float","a_bending_col_main",";"]},{type:"condition",parts:[{type:"if",expression:["DETAIL_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",tokens:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BEND_CENTER_ONLY"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},
{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_position_next",";"]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["attribute",
"vec3","a_normal_next",";"]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["STATIC_BATCH"],group:{type:"group",parts:[{type:"textline",tokens:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",tokens:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",
parts:[{type:"if",expression:["SMAA_JITTER"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["BILLBOARD_JITTERED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},
{type:"textline",tokens:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:"varying vec3 bQ ; varying vec4 bR ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:5}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bS",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",
parts:[{type:"textline",tokens:["varying","vec4","bT",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bU",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying",
"float","bV",";"]}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","b_",";"]}]}}]}]}}]},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",tokens:"void main ( ) { vec3 wB = a_position ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA","CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:5},{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["vec3","wC","=","a_normal",";"]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 wD = vec3 ( a_tangent ) ; vec3 wE = a_tangent [ 3 ] * cross ( wC , wD ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec3 wD = vec3 ( 0.0 ) ; vec3 wE = vec3 ( 0.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec3 wC = vec3 ( 0.0 ) ; vec3 wD = vec3 ( 0.0 ) ; vec3 wE = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:"wB = mix ( wB , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",parts:[{type:"if",
expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:"wC = mix ( wC , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 wF = vec3 ( a_tangent ) ; vec3 wG = a_tangent_next [ 3 ] * cross ( a_normal_next , wF ) ; wD = mix ( wD , wF , u_va_frame_factor ) ; wE = mix ( wE , wG , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"vD ( wB , wD , wE , wC ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["vec3","wH","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec3 wH = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],
group:{type:"group",parts:[{type:"textline",tokens:"vec3 wI = ( u_model_matrix * vec4 ( wH , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"mat4 wJ = um ( u_camera_eye , wI , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"mat4 wJ = ug ( u_camera_eye , wI , u_view_matrix ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 wK = ( u_model_matrix * vec4 ( wH , 1.0 ) ) . xyz ; wJ = wJ * tW ( u_wind , u_time , u_jitter_amp , u_jitter_freq , wK ) ;".split(" ")}]}}]},{type:"textline",tokens:"bh wL = ut ( wB - wH , wH , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , wJ ) ; wL . b = wI ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",
tokens:"bh wL = ut ( wB , wH , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"wv ( wL . a , wL . b , wC ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MAIN_BEND_COL",
"DETAIL_BEND",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["vec3","wM","=","a_normal",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec3 wM = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:"wv ( wL . a , wL . b , wM ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2},{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",
parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:"b_ = uw ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bQ = wL . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",
{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:5}],group:{type:"group",parts:[{type:"textline",tokens:"bS = wL . e ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"float wN = ( dot ( cross ( wL . e , wL . c ) , wL . d ) < 0.0 ) ? - 1.0 : 1.0 ; bT = vec4 ( wL . c , wN ) ;".split(" ")}]}}]},{type:"textline",tokens:"bR = u_view_matrix * vec4 ( wL . a , 1.0 ) ; vec4 wO = u_proj_matrix * bR ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SMAA_JITTER"],group:{type:"group",parts:[{type:"textline",tokens:"wO . xy += u_subpixel_jitter * wO . w ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"float wP = wO . x ; float wQ = wO . y ; float wR = wO . w ; bU . x = ( wP + wR ) / 2.0 ; bU . y = ( wQ + wR ) / 2.0 ; bU . z = wR ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bV = - bR . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",tokens:["wA","(",")",";"]}]}}]},{type:"textline",tokens:"gl_Position = u_proj_matrix * u_view_matrix * vec4 ( wL . a , 1.0 ) ; }".split(" ")}]};a["depth.glslf"]={type:"group",parts:[{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",name:"WAVES_HEIGHT",
tokens:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",tokens:["0"]},{type:"var",name:"NUM_VALUES",tokens:["0"]},{type:"var",name:"NUM_RGBS",tokens:["0"]},{type:"var",name:"MAPPING_TRS_MATRIX",tokens:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",
tokens:["0.0"]},{type:"var",name:"RGB_IND",tokens:["0"]},{type:"var",name:"VALUE_IND",tokens:["0"]},{type:"var",name:"LAMP_INDEX",tokens:["0"]},{type:"var",name:"NUM_LIGHTS",tokens:["0"]},{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",
tokens:["0"]},{type:"var",name:"NUM_LFACTORS",tokens:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1},"NODES","ALPHA",{type:"logical_and_expr",places:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"include",file:"procedural.glslf"}]}}]},{type:"condition",parts:[{type:"if",
expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"pack.glslf"},{type:"condition",parts:[{type:"if",expression:["CAUSTICS"],group:{type:"group",parts:[{type:"include",file:"caustics.glslf"}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_time ; uniform float u_environment_energy ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["NUM_LIGHTS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"textline",tokens:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_VECTOR_VIEW",
"REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",expression:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform",
"samplerCube","u_cube_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"textline",tokens:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:["uniform","float","u_mirror_factor",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_LAMP"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_VALUE"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_RGB"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",
tokens:["uniform","sampler2D","u_colormap0",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_diffuse_color",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_perspective_cast_far_bound",";"]}]}}]},
{type:"textline",tokens:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},
{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_shadow_mask",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION"],group:{type:"group",parts:[{type:"textline",
tokens:["uniform","sampler2D","u_refractmap",";"]},{type:"condition",parts:[{type:"if",expression:["USE_REFRACTION"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bQ",";"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO",
"CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bS",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bT",";"]}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","b_",";"]}]}}]}]}}]},{type:"condition",
parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"NODES","ALPHA",{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bR",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bW",";"]},{type:"condition",parts:[{type:"if",
expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bX",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bY",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bZ",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",
places:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bU",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bV",";"]}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1},"NODES","ALPHA",{type:"logical_and_expr",places:2},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"include",file:"shadow.glslf"}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"mirror.glslf"},{type:"include",
file:"environment.glslf"},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_REFRACTION"],group:{type:"group",parts:[{type:"include",file:"refraction.glslf"}]}}]}]}}]},{type:"include",file:"nodes.glslf"}]}}]},{type:"textline",tokens:["void","main","(",")","{"]},{type:"condition",parts:[{type:"if",expression:["ALPHA"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NODES"],
group:{type:"group",parts:[{type:"textline",tokens:"vec3 wB = u_camera_eye_frag - bQ ; vec3 wC = normalize ( wB ) ; vec3 wD ; vec3 wE ; vec3 wF ; float wG ; float wH ; tz ( wC , wD , wE , wF , wG , wH ) ; float wI = wH ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:"float wI = ( texture2D ( u_colormap0 , b_ ) ) . a ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",
tokens:"float wI = u_diffuse_color . a ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"if ( wI < 0.5 ) discard ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","NO_SHADOWS",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}},{type:"elif",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( dT ( bR . z ) , 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor . a += 0.00001 * bT . r ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:["}"]}]};a["depth.glslv"]={type:"group",
parts:[{type:"var",name:"AU_QUALIFIER",tokens:["uniform"]},{type:"var",name:"MAX_BONES",tokens:["0"]},{type:"var",name:"SHADOW_TEX_RES",tokens:["0.0"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",tokens:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",tokens:["attribute","vec3","a_position",";"]},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},"SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA","CALC_TBN_SPACE",{type:"logical_and_expr",
places:3}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MAIN_BEND_COL"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","float","a_bending_col_main",";"]},{type:"condition",parts:[{type:"if",expression:["DETAIL_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},
{type:"textline",tokens:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BEND_CENTER_ONLY"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_position_next",";"]},{type:"condition",parts:[{type:"if",expression:["NODES",
"ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_normal_next",";"]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2},{type:"logic_negative_expr",places:1},"TEXTURE_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["STATIC_BATCH"],group:{type:"group",parts:[{type:"textline",tokens:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",
tokens:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_JITTER"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"textline",tokens:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_camera_eye",
";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["BILLBOARD","SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_shadow_cast_billboard_view_matrix",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["BILLBOARD_JITTERED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",tokens:"uniform vec3 u_wind ; uniform float u_time ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float",
"u_va_frame_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2},{type:"logic_negative_expr",places:1},"TEXTURE_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",
parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bQ",";"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL",
"DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:5}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bS",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bT",";"]}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","b_",
";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"NODES","ALPHA",{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bR",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bW",";"]},
{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bX",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bY",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bZ",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE",
"REFL_PLANE",{type:"equal_expr",places:2},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bU",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float",
"bV",";"]}]}}]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",tokens:"void main ( ) { vec3 xA = a_position ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",
{type:"equal_expr",places:2},"CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:["vec3","xB","=","a_normal",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec3 xB = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA","CALC_TBN_SPACE",{type:"logical_and_expr",
places:3}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 xC = vec3 ( a_tangent ) ; vec3 xD = a_tangent [ 3 ] * cross ( xB , xC ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec3 xC = vec3 ( 0.0 ) ; vec3 xD = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:"xA = mix ( xA , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",parts:[{type:"if",
expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:"xB = mix ( xB , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 xE = vec3 ( a_tangent ) ; vec3 xF = a_tangent_next [ 3 ] * cross ( a_normal_next , xE ) ; xC = mix ( xC , xE , u_va_frame_factor ) ; xD = mix ( xD , xF , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"vD ( xA , xC , xD , xB ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["vec3","xG","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec3 xG = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",
expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"bh xH = xp ( xA , vec3 ( 0.0 ) , vec3 ( 0.0 ) , xB , xG , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 xI = ( u_model_matrix * vec4 ( xG , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",
parts:[{type:"if",expression:["HAIR_BILLBOARD",{type:"logic_negative_expr",places:1},"SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["mat4","xJ","=","u_shadow_cast_billboard_view_matrix",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["mat4","xJ","=","u_view_matrix",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",
{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"mat4 xK = um ( u_camera_eye , xI , xJ , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"mat4 xK = ug ( u_camera_eye , xI , xJ ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 xL = ( u_model_matrix * vec4 ( xG , 1.0 ) ) . xyz ; xK = xK * tW ( u_wind , u_time , u_jitter_amp , u_jitter_freq , xL ) ;".split(" ")}]}}]},
{type:"textline",tokens:"bh xH = ut ( xA - xG , xG , vec3 ( 0.0 ) , vec3 ( 0.0 ) , xB , xK ) ; xH . b = xI ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"bh xH = ut ( xA , xG , vec3 ( 0.0 ) , vec3 ( 0.0 ) , xB , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:2}],group:{type:"group",
parts:[{type:"textline",tokens:["vec3","xM","=","a_normal",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec3 xM = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:"wv ( xH . a , xH . b , xM ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bQ = xH . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN",
"USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:5}],group:{type:"group",parts:[{type:"textline",tokens:"bS = xH . e ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"float xN = ( dot ( cross ( xH . e , xH . c ) , xH . d ) < 0.0 ) ? - 1.0 : 1.0 ; bT = vec4 ( xH . c , xN ) ;".split(" ")}]}}]}]}}]},{type:"textline",
tokens:"vec4 xO = u_view_matrix * vec4 ( xH . a , 1.0 ) ; vec4 xP = u_proj_matrix * xO ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_JITTER"],group:{type:"group",parts:[{type:"textline",tokens:"xP . xy += u_subpixel_jitter * xP . w ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","ALPHA",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},
"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bU = bP ( xP ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION","REFRACTIVE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bV = - bR . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",tokens:["wA","(",")",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],
group:{type:"group",parts:[{type:"textline",tokens:"b_ = uw ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xz ( xH . a , xH . e ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"NODES","ALPHA",{type:"logical_and_expr",places:2},{type:"logical_or_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:["bR","=","xO",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_CASTING",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec2 xQ = ( u_proj_matrix * u_view_matrix [ 3 ] ) . xy ; float xR = SHADOW_TEX_RES / 2.0 ; xQ = floor ( xQ * xR + 0.5 ) / xR - xQ ; xP . xy += xQ ;".split(" ")}]}}]},{type:"textline",tokens:["gl_Position","=","xP",";","}"]}]};a["grass_map.glslf"]={type:"group",
parts:[{type:"include",file:"precision_statement.glslf"},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_SIZE"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","xA",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["varying","float","xA",";"]}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],
group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","xA",";"]}]}}]}]}}]},{type:"textline",tokens:["void","main","(",")","{"]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_SIZE"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["gl_FragColor","=","xA",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( xA , vec3 ( 1.0 ) ) ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( 1.0 , xA ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:["}"]}]};a["grass_map.glslv"]={type:"group",parts:[{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"textline",tokens:["attribute",
"vec3","a_position",";"]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_SIZE"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","float","a_grass_size",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_grass_color",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["STATIC_BATCH"],group:{type:"group",parts:[{type:"textline",tokens:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",tokens:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"uniform vec3 u_wind ; uniform float u_time ; uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_SIZE"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","xA",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["varying","float","xA",";"]}]}}]}]}},{type:"else",group:{type:"group",
parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","xA",";"]}]}}]}]}}]},{type:"textline",tokens:["void","main","(",")","{"]},{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 xB = ( u_model_matrix * vec4 ( vec3 ( 0.0 ) , 1.0 ) ) . xyz ; mat4 xC = ug ( u_camera_eye , xB , u_view_matrix ) ;".split(" ")},{type:"condition",parts:[{type:"if",
expression:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xC = xC * tW ( u_wind , u_time , u_jitter_amp , u_jitter_freq , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",tokens:"bh xD = ut ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , xC ) ; xD . b = xB ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"bh xD = ut ( a_position , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]},
{type:"textline",tokens:"vec4 xE = u_proj_matrix * u_view_matrix * vec4 ( xD . a , 1.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_SIZE"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:"xA = vec4 ( a_grass_size , a_grass_color ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["xA","=","a_grass_size",";"]}]}}]}]}},{type:"else",
group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["xA","=","a_grass_color",";"]}]}}]}]}}]},{type:"textline",tokens:["gl_Position","=","xE",";","}"]}]};a["halo.glslf"]={type:"group",parts:[{type:"var",name:"NUM_LINES",tokens:["0"]},{type:"var",name:"NUM_RINGS",tokens:["0"]},{type:"var",name:"NUM_STARS",tokens:["0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"include",file:"precision_statement.glslf"},
{type:"include",file:"gamma.glslf"},{type:"textline",tokens:"uniform vec4 u_diffuse_color ; uniform vec3 u_halo_rings_color ; uniform vec3 u_halo_lines_color ; uniform float u_halo_hardness ; uniform float u_halo_size ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SKY_STARS"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_sun_intensity",";"]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},
{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_halo_stars_blend ; uniform float u_halo_stars_height ; uniform float u_cam_water_depth ; varying vec4 xB ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"varying vec2 b_ ; varying float xC ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_RINGS","NUM_LINES",{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"const int xD = NUM_RINGS ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"const int xD = NUM_LINES ;".split(" ")}]}}]},{type:"textline",tokens:"float xF ( float xE ) { return xE - floor ( xE * ( 1.0 / 0.01 ) ) * 0.01 ; }".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_RINGS"],group:{type:"group",parts:[{type:"textline",tokens:"void xO ( inout float xG , in float xH [ xD ] , in float xI ) { for ( int xJ = 0 ; xJ < NUM_RINGS ; xJ ++ ) { float xK = 40.0 * xH [ xJ ] ; float xL = 300.0 * ( xF ( xK ) - 0.005 ) ; float xM = xK ; float xN = abs ( xM * ( u_halo_size * xL - xI ) ) ; xG += 1.0 - min ( xN , 1.0 ) ; } }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["NUM_LINES"],group:{type:"group",parts:[{type:"textline",tokens:"void xX ( inout float xP , in float xQ [ xD ] , in float xR ) { for ( int xS = 0 ; xS < NUM_LINES ; xS ++ ) { float xT = xQ [ xS ] ; float xU = xT ; float xV = 1000.0 * ( xF ( xT ) - 0.005 ) ; float xW = 20.0 * abs ( xU * b_ . x + xV * b_ . y ) ; xP += 1.0 - min ( xW , 1.0 ) ; } xP *= xR ; }".split(" ")}]}}]},{type:"textline",tokens:"void yd ( inout float xY , in vec2 xZ ) { float x_ , ya ; ya = atan ( xZ . y , xZ . x ) ; ya *= ( 1.0 + 0.25 * float ( NUM_STARS ) ) ; float yb = cos ( ya ) ; float yc = sin ( ya ) ; ya = ( yb * xZ . x + yc * xZ . y ) * ( yb * xZ . y - yc * xZ . x ) ; x_ = abs ( ya ) ; if ( x_ < 1.0 ) { x_ = ( 0.01 * u_halo_size ) / ( x_ ) ; xY *= sqrt ( min ( x_ , 1.0 ) ) ; } } void main ( ) { float ye = ( b_ . x * b_ . x + b_ . y * b_ . y ) ; float yf = sqrt ( ye ) ; ye = max ( 1.0 - ye , 0.0 ) ; ye = pow ( ye , u_halo_hardness ) ; float yg = u_diffuse_color . a ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["NUM_RINGS","NUM_LINES",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"float yh [ xD ] ; for ( int yi = 0 ; yi < xD ; yi ++ ) { yh [ yi ] = fract ( xC / ( float ( yi ) + 0.01 ) ) - 1.0 ; }".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_RINGS"],group:{type:"group",parts:[{type:"textline",tokens:"float yj = 0.0 ; xO ( yj , yh , yf ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",
expression:["NUM_LINES"],group:{type:"group",parts:[{type:"textline",tokens:"float yk = 0.0 ; xX ( yk , yh , ye ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_STARS"],group:{type:"group",parts:[{type:"textline",tokens:"yd ( ye , b_ ) ;".split(" ")}]}}]},{type:"textline",tokens:"ye *= yg ; vec3 yl = u_diffuse_color . rgb ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_RINGS"],group:{type:"group",parts:[{type:"textline",tokens:"yj *= ye ; yl += u_halo_rings_color * yj ; ye += yj ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["NUM_LINES"],group:{type:"group",parts:[{type:"textline",tokens:"yk *= yg ; yl += u_halo_lines_color * yk ; ye += yk ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SKY_STARS"],group:{type:"group",parts:[{type:"textline",tokens:"ye *= max ( 1.0 - 2.0 * u_sun_intensity . x , 0.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:"float ym = u_halo_stars_blend * ( xB . y - u_halo_stars_height ) ; ye *= clamp ( ym , 0.0 , 1.0 ) ; ye *= min ( u_cam_water_depth + 2.0 * WAVES_HEIGHT , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"bb ( yl ) ; be ( yl , ye ) ; gl_FragColor = vec4 ( yl , ye ) ; }".split(" ")}]};a["halo.glslv"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},
{type:"textline",tokens:"attribute vec3 a_position ; attribute vec2 a_halo_bb_vertex ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform PRECISION float u_halo_size ; varying vec2 b_ ; varying float xC ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["STATIC_BATCH"],group:{type:"group",parts:[{type:"textline",tokens:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_model_matrix",
";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","xB",";"]}]}}]},{type:"textline",tokens:"void main ( ) { vec3 xD = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; b_ = a_halo_bb_vertex * 2.0 ; xC = fract ( xD . x + xD . y + xD . z ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SKY_STARS"],group:{type:"group",
parts:[{type:"textline",tokens:"mat4 xE = tG ( xD , u_view_matrix ) ; mat4 xF = u_view_matrix ; xF [ 3 ] [ 0 ] = 0.0 ; xF [ 3 ] [ 1 ] = 0.0 ; xF [ 3 ] [ 2 ] = 0.0 ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"mat4 xE = tG ( xD , u_view_matrix ) ;".split(" ")}]}}]},{type:"textline",tokens:"vec4 xG = vec4 ( a_halo_bb_vertex * 2.0 * u_halo_size , 0.0 , 1.0 ) ; vec4 xH = xE * xG ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SKY_STARS"],group:{type:"group",
parts:[{type:"textline",tokens:"vec4 xI = u_proj_matrix * xF * xH ; xI . z = 0.99999 * xI . w ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["xB","=","xH",";"]}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec4 xI = u_proj_matrix * u_view_matrix * xH ;".split(" ")}]}}]},{type:"textline",tokens:["gl_Position",
"=","xI",";","}"]}]};a["line.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform vec4 u_diffuse_color ; void main ( ) { gl_FragColor = u_diffuse_color ; }".split(" ")}]};a["line.glslv"]={type:"group",parts:[{type:"var",name:"NUM_POINTS",tokens:["0"]},{type:"textline",tokens:"attribute float a_point ; uniform vec3 u_line_points [ NUM_POINTS ] ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; void main ( ) { vec3 xD = u_line_points [ int ( a_point ) ] ; gl_Position = u_proj_matrix * u_view_matrix * vec4 ( xD , 1.0 ) ; }".split(" ")}]};
a["main.glslf"]={type:"group",parts:[{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",tokens:["0"]},{type:"var",name:"NUM_VALUES",tokens:["0"]},{type:"var",name:"NUM_RGBS",tokens:["0"]},{type:"var",name:"PARALLAX_STEPS",tokens:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",tokens:["0.0"]},{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"var",name:"NUM_LIGHTS",tokens:["0"]},
{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"var",name:"NUM_LFACTORS",tokens:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},
{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"procedural.glslf"},{type:"condition",parts:[{type:"if",expression:["CAUSTICS"],group:{type:"group",parts:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",tokens:["uniform","float","u_time",";"]},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT",
"SKY_TEXTURE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",expression:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",tokens:["uniform","float","u_environment_energy",";"]},{type:"condition",parts:[{type:"if",expression:["SHADELESS",
{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NUM_LIGHTS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","CAUSTICS",
{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"textline",tokens:["uniform","vec3","u_camera_eye_frag",";"]},{type:"condition",parts:[{type:"if",expression:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"USE_NODE_B4W_VECTOR_VIEW",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_FOG"],group:{type:"group",parts:[{type:"textline",
tokens:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_FOG"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS",
"CAUSTICS",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform",
"samplerCube","u_cube_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_perspective_cast_far_bound",";"]}]}}]},{type:"textline",tokens:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:["uniform",
"PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION","USE_REFRACTION","REFRACTIVE","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{type:"textline",tokens:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_LAMP"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_lamp_light_positions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_directions [ NUM_LAMP_LIGHTS ] ; uniform vec3 u_lamp_light_color_intensities [ NUM_LAMP_LIGHTS ] ; uniform vec4 u_lamp_light_factors [ NUM_LAMP_LIGHTS ] ;".split(" ")}]}}]},{type:"condition",
parts:[{type:"if",expression:["USE_NODE_VALUE"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_node_values [ NUM_VALUES ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_RGB"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_node_rgbs [ NUM_RGBS ] ;".split(" ")}]}}]},{type:"textline",tokens:["varying","vec3","bQ",";"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",
"WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bS",";"]}]}}]},{type:"textline",tokens:["varying","vec4","bR",";"]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bT",";"]}]}}]},{type:"condition",parts:[{type:"if",
expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bW",";"]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bX",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bY",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],
group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bZ",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bU",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","USE_NODE_B4W_REFRACTION",
{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bV",";"]}]}}]},{type:"include",file:"mirror.glslf"},{type:"include",file:"environment.glslf"},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"shadow.glslf"}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION","USE_REFRACTION",{type:"logical_and_expr",places:2}],group:{type:"group",
parts:[{type:"include",file:"refraction.glslf"}]}}]},{type:"include",file:"nodes.glslf"},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"fog.glslf"}]}}]},{type:"textline",tokens:"void main ( ) { float yx = length ( bR ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"float yy = bQ . y - WATER_LEVEL ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},"CAUSTICS","WATER_EFFECTS",{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["vec3","yz","=","u_sun_intensity",";"]}]}}]},{type:"textline",tokens:"vec3 yA = normalize ( u_camera_eye_frag - bQ ) ; vec3 yB ; vec3 yC ; vec3 yD ; float yE ; float yF ; tz ( yA , yB , yC , yD , yE , yF ) ; vec3 yG = yB ; float yH = yF ; vec3 yI = yD ; float yJ = yE ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WETTABLE"],group:{type:"group",parts:[{type:"textline",tokens:"yG = max ( yG - sqrt ( 0.01 * - min ( yy , 0.0 ) ) , 0.5 * yG ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CAUSTICS"],group:{type:"group",parts:[{type:"textline",
tokens:"aY ( yG , yy , u_time , yJ , yI , u_sun_direction , yz , u_sun_quaternion , bQ , yx ) ;".split(" ")}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["ALPHA"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["ALPHA_CLIP"],group:{type:"group",parts:[{type:"textline",tokens:"if ( yH <= 0.5 ) discard ; yH = 1.0 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NODES_GLOW",{type:"logic_negative_expr",
places:1}],group:{type:"group",parts:[{type:"textline",tokens:["yH","=","1.0",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"yw ( yG , length ( bR ) , yA , yy ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"yw ( yG , length ( bR ) , yA , 1.0 ) ;".split(" ")}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["SSAO_ONLY","SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec2 yK = texture2DProj ( u_shadow_mask , bU ) . rg ; float yL = yK . g ; yG = vec3 ( yL ) ;".split(" ")}]}}]},{type:"textline",tokens:["bb","(","yG",")",";"]},{type:"condition",parts:[{type:"if",expression:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",
places:2},"NODES_GLOW",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"be ( yG , yH ) ;".split(" ")}]}}]},{type:"textline",tokens:"gl_FragColor = vec4 ( yG , yH ) ; }".split(" ")}]};a["main.glslv"]={type:"group",parts:[{type:"var",name:"AU_QUALIFIER",tokens:["uniform"]},{type:"var",name:"MAX_BONES",tokens:["0"]},{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",tokens:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},
{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",tokens:["attribute","vec3","a_position",";"]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",places:7}],group:{type:"group",
parts:[{type:"textline",tokens:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_tangent",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","DYNAMIC_GRASS",
"BILLBOARD",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MAIN_BEND_COL"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","float","a_bending_col_main",";"]},{type:"condition",parts:[{type:"if",expression:["DETAIL_BEND"],group:{type:"group",parts:[{type:"textline",
tokens:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BEND_CENTER_ONLY"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",
parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_position_next",";"]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_normal_next",";"]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO",
"CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_COLOR"],
group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_color",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["STATIC_BATCH"],group:{type:"group",parts:[{type:"textline",tokens:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",tokens:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",parts:[{type:"if",
expression:["NODES",{type:"logic_negative_expr",places:1},"BILLBOARD",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_JITTER"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["BILLBOARD_JITTERED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",tokens:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["uniform",
"float","u_va_frame_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",
parts:[{type:"if",expression:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",tokens:["varying","vec3","bQ",";"]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",
places:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",places:7}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bS",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","DISABLE_FOG",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bR",";"]}]}}]},
{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bT",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","yx",";"]},{type:"condition",parts:[{type:"if",expression:["TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2",
"b_",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","yy",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bW",";"]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",
tokens:["varying","vec4","bX",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bY",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bZ",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",
places:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bU",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","NODES",{type:"logic_negative_expr",places:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bV",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},
{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"condition",parts:[{type:"if",expression:["NODES"],group:{type:"group",parts:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",tokens:"void main ( ) { vec3 yz = a_position ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",
places:3},"NODES",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:["vec3","yA","=","a_normal",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec3 yA = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE","NODES",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",places:2},{type:"logical_and_expr",places:2},
{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 yB = vec3 ( a_tangent ) ; vec3 yC = a_tangent [ 3 ] * cross ( yA , yB ) ;".split(" ")}]}},{type:"elif",expression:["NODES",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 yD = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; vec3 yE = normalize ( ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ) ; vec3 yF = yD - u_camera_eye ; vec3 yC = cross ( yF , yE ) ; vec3 yB = cross ( yE , yC ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec3 yB = vec3 ( 0.0 ) ; vec3 yC = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:"yz = mix ( yz , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",
places:5}],group:{type:"group",parts:[{type:"textline",tokens:"yA = mix ( yA , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 yG = vec3 ( a_tangent ) ; vec3 yH = a_tangent_next [ 3 ] * cross ( a_normal_next , yG ) ; yB = mix ( yB , yG , u_va_frame_factor ) ; yC = mix ( yC , yH , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",
expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"vD ( yz , yB , yC , yA ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["vec3","yI","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec3 yI = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],
group:{type:"group",parts:[{type:"textline",tokens:"bh yJ = xp ( yz , yB , yC , yA , yI , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 yK = ( u_model_matrix * vec4 ( yI , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_PRES_GLOB_ORIENTATION",
"STATIC_BATCH",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"mat4 yL = um ( u_camera_eye , yK , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"mat4 yL = ug ( u_camera_eye , yK , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"vec3 yM = ( u_model_matrix * vec4 ( yI , 1.0 ) ) . xyz ; yL = yL * tW ( u_wind , u_time , u_jitter_amp , u_jitter_freq , yM ) ;".split(" ")}]}}]},{type:"textline",tokens:"bh yJ = ut ( yz - yI , yI , yB , yC , yA , yL ) ; yJ . b = yK ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"bh yJ = ut ( yz , yI , yB , yC , yA , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:"float yN = ( dot ( cross ( yJ . e , yJ . c ) , yJ . d ) < 0.0 ) ? - 1.0 : 1.0 ; bT = vec4 ( yJ . c , yN ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"wv ( yJ . a , yJ . b , yA ) ;".split(" ")}]}}]},{type:"textline",tokens:"bQ = yJ . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN",
"USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:"bS = yJ . e ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"yx = u_camera_eye - yJ . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXCOORD"],group:{type:"group",
parts:[{type:"textline",tokens:"b_ = uw ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"yy = yJ . f ;".split(" ")}]}},{type:"elif",expression:["VERTEX_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["yy","=","a_color",";"]}]}}]}]}}]},{type:"textline",tokens:"vec4 yO = u_view_matrix * vec4 ( yJ . a , 1.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NODES",
"DISABLE_FOG",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["bR","=","yO",";"]}]}}]},{type:"textline",tokens:"vec4 yP = u_proj_matrix * yO ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_JITTER"],group:{type:"group",parts:[{type:"textline",tokens:"yP . xy += u_subpixel_jitter * yP . w ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:"bU = bP ( yP ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xz ( yJ . a , yJ . e ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","NODES",{type:"logic_negative_expr",places:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bV = - yO . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES"],group:{type:"group",parts:[{type:"textline",tokens:["wA","(",")",";"]}]}}]},{type:"textline",tokens:["gl_Position","=","yP",";","}"]}]};
a["main_stack.glslf"]={type:"group",parts:[{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"var",name:"NUM_LAMP_LIGHTS",tokens:["0"]},{type:"var",name:"NUM_VALUES",tokens:["0"]},{type:"var",name:"NUM_RGBS",tokens:["0"]},{type:"var",name:"PARALLAX_STEPS",tokens:["0.0"]},{type:"var",name:"PARALLAX_LOD_DIST",tokens:["0.0"]},{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"var",name:"NUM_LIGHTS",
tokens:["0"]},{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"var",name:"NUM_LFACTORS",tokens:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",
file:"pack.glslf"},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"procedural.glslf"},{type:"condition",parts:[{type:"if",expression:["CAUSTICS"],group:{type:"group",parts:[{type:"include",file:"caustics.glslf"}]}}]}]}}]},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"textline",tokens:["uniform","float","u_time",";"]},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT",
"SKY_TEXTURE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",expression:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",tokens:["uniform","float","u_environment_energy",";"]},{type:"condition",parts:[{type:"if",expression:["SHADELESS",
{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NUM_LIGHTS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","CAUSTICS",
{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_sun_quaternion",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NORMAL_TEXCOORD","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_view_matrix_frag",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],
group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_FOG"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",parts:[{type:"if",
expression:["USE_FOG"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_sun_intensity",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2}],group:{type:"group",
parts:[{type:"textline",tokens:["uniform","vec3","u_sun_direction",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR0_CO"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_colormap0",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_SPEC","ALPHA_AS_SPEC",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_specmap0",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["TEXTURE_NORM_CO"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",parts:[{type:"textline",tokens:"uniform sampler2D u_colormap1 ; uniform sampler2D u_stencil0 ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_cube_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE",
"SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_shadow_mask",";"]}]}},{type:"elif",expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_perspective_cast_far_bound",";"]}]}}]},{type:"textline",tokens:"uniform vec4 u_pcf_blur_radii ; uniform vec4 u_csm_center_dists ; uniform PRECISION sampler2D u_shadow_map0 ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_shadow_map1",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_shadow_map2",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D",
"u_shadow_map3",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{type:"textline",tokens:"uniform float u_emit ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform float u_specular_alpha ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_reflect_factor",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_mirror_factor",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_refl_plane",";"]}]}}]},{type:"textline",tokens:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_normal_factor",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["TEXTURE_COLOR0_CO"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_diffuse_color_factor ; uniform float u_alpha_factor ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_SPEC"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_specular_color_factor",";"]}]}}]},{type:"textline",tokens:"uniform vec3 u_specular_color ; uniform vec3 u_specular_params ;".split(" ")},{type:"condition",parts:[{type:"if",
expression:["TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_parallax_scale",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_refr_bump",";"]}]}}]},{type:"textline",tokens:"varying vec3 bQ ; varying vec3 bS ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1},
"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bR",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bT",";"]}]}}]},{type:"textline",tokens:["varying","vec3","yx",";"]},
{type:"condition",parts:[{type:"if",expression:["TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","b_",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","yy",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:["varying","vec4","bW",";"]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bX",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bY",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bZ",";"]}]}}]}]}}]},{type:"condition",
parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2},"REFRACTIVE",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bU",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bV",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",
places:1}],group:{type:"group",parts:[{type:"include",file:"shadow.glslf"}]}}]},{type:"include",file:"mirror.glslf"},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"include",file:"refraction.glslf"}]}}]},{type:"include",file:"environment.glslf"},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"lighting_nodes.glslf"}]}}]},{type:"condition",parts:[{type:"if",
expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"fog.glslf"}]}}]},{type:"textline",tokens:["void","main","(",")","{"]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:"float Br = length ( bR ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"float Bs = bQ . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},"CAUSTICS","WATER_EFFECTS",{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["vec3","Bt","=","u_sun_intensity",";"]}]}}]},{type:"condition",parts:[{type:"if",
expression:["TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:["vec2","Bu","=","b_",";"]}]}}]},{type:"textline",tokens:"vec3 Bv = normalize ( bS ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",parts:[{type:"textline",tokens:"if ( gl_FrontFacing ) Bv = Bv ; else Bv = - Bv ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 Bw = cross ( Bv , bT . xyz ) * bT . w ; mat3 Bx = mat3 ( bT . xyz , Bw , Bv ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["NORMAL_TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:"vec2 By = normalize ( u_view_matrix_frag * vec4 ( bS , 0.0 ) ) . st ; By = By * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( Br < PARALLAX_LOD_DIST ) { float Bz = clamp ( 0.5 * ( PARALLAX_LOD_DIST - Br ) , 0.0 , 1.0 ) ; float BA = u_parallax_scale * Bz ; vec3 BB = normalize ( yx * Bx ) ; float BC = 1.0 / PARALLAX_STEPS ; vec2 BD = BB . xy * BA / ( PARALLAX_STEPS * BB . z ) ; float BE = 1.0 ; float BF ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["vec2","BG","=","By",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["vec2","BG","=","Bu",";"]}]}}]},{type:"textline",tokens:"BF = texture2D ( u_normalmap0 , BG ) . a ; for ( float BH = 1.0 ; BH <= PARALLAX_STEPS ; BH ++ ) { if ( BF < BE ) { BE -= BC ; BG -= BD ; BF = texture2D ( u_normalmap0 , BG ) . a ; } } vec2 BI = BG + BD ; float BJ = texture2D ( u_normalmap0 , BI ) . a - ( BE + BC ) ; float BK = BF - BE ; float BL = BK / ( BK - BJ ) ; BG = BL * BI + ( 1.0 - BL ) * BG ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:"Bu += BG - By ;".split(" ")}]}}]},{type:"textline",tokens:["By","=","BG",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NORMAL_TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:"By += BG - Bu ;".split(" ")}]}}]},
{type:"textline",tokens:["Bu","=","BG",";"]}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO"],group:{type:"group",parts:[{type:"textline",tokens:["vec4","BM",";"]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"BM = texture2D ( u_normalmap0 , By ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",
tokens:"BM = texture2D ( u_normalmap0 , Bu ) ;".split(" ")}]}}]},{type:"textline",tokens:"vec3 BN = BM . rgb - 0.5 ; BN = mix ( vec3 ( 0.0 , 0.0 , 1.0 ) , BN , u_normal_factor ) ; vec3 BO = Bx * BN ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["vec3","BO","=","Bv",";"]}]}}]},{type:"textline",tokens:"BO = normalize ( BO ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NORMAL_TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:"By = normalize ( u_view_matrix_frag * vec4 ( BO , 0.0 ) ) . st ; By = By * vec2 ( 0.495 ) + vec2 ( 0.5 ) ;".split(" ")}]}}]},
{type:"textline",tokens:"vec3 BP = normalize ( yx ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 BQ = yy ; a_ ( BQ ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_COLOR","DYNAMIC_GRASS",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec4 BR = vec4 ( BQ , 1.0 ) ;".split(" ")}]}},{type:"else",
group:{type:"group",parts:[{type:"textline",tokens:["vec4","BR","=","u_diffuse_color",";"]}]}}]},{type:"textline",tokens:["float","BS","=","1.0",";"]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec4 BT = texture2D ( u_colormap0 , By ) ;".split(" ")}]}},{type:"elif",expression:["TEXTURE_COLOR0_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",places:2}],group:{type:"group",
parts:[{type:"textline",tokens:"vec4 BT = texture2D ( u_colormap0 , Bu ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR0_CO"],group:{type:"group",parts:[{type:"textline",tokens:"a_ ( BT . rgb ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXTURE_STENCIL_ALPHA_MASK"],group:{type:"group",parts:[{type:"textline",tokens:["vec4","BU",";"]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR1_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:"BU = texture2D ( u_colormap1 , By ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"BU = texture2D ( u_colormap1 , Bu ) ;".split(" ")}]}}]},{type:"textline",tokens:"a_ ( BU . rgb ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXTURE_STENCIL_ALPHA_MASK_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec4 BV = texture2D ( u_stencil0 , By ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec4 BV = texture2D ( u_stencil0 , Bu ) ;".split(" ")}]}}]},{type:"textline",tokens:"BT = mix ( BT , BU , BV . r ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"BR . rgb = mix ( BR . rgb , BT . rgb , u_diffuse_color_factor ) ; float BW = u_alpha_factor * BT . a ; BW += ( 1.0 - step ( 0.0 , BW ) ) ; BR . a = mix ( BW , 1.0 , u_diffuse_color . a ) ; BS = BT . a ;".split(" ")}]}},
{type:"elif",expression:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"BR . rgb *= mix ( vec3 ( 1.0 ) , BT . rgb , u_diffuse_color_factor ) ; BR . a = BT . a ; BS = BT . a ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"vec3 BX = u_diffuse_intensity * BR . rgb ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SHADELESS"],group:{type:"group",parts:[{type:"textline",tokens:["vec3","BY","=","BX",";"]}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec3 BZ = u_environment_energy * ew ( BO ) ; vec3 B_ = u_ambient * BZ ; float Ca = dY ( BX ) ; vec3 Cb = u_emit * BR . rgb ; vec3 Cc = u_specular_color ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXTURE_SPEC"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["ALPHA_AS_SPEC"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 Cd = vec3 ( BS ) ;".split(" ")}]}},{type:"elif",expression:["TEXTURE_SPEC_CO",
"TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 Cd = texture2D ( u_specmap0 , By ) . rgb ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec3 Cd = texture2D ( u_specmap0 , Bu ) . rgb ;".split(" ")}]}}]},{type:"textline",tokens:"a_ ( Cd . rgb ) ; Cc = mix ( Cc , Cd , u_specular_color_factor ) ;".split(" ")}]}}]},{type:"textline",tokens:"float Ce = u_specular_params [ 0 ] ; vec2 Cf = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 Cg = Ce * Cc ; vec3 BY ; vec3 Ch ; Bq ( Cb , B_ , BX , Cg , bQ , BO , BP , Cf , u_diffuse_params , Ca , 0.0 , vec4 ( 0.0 ) , BY , Ch ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"et ( BY , BP , BO , u_reflect_factor ) ;".split(" ")}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"et ( BY , BP , BO , 0.0 ) ;".split(" ")}]}}]},{type:"condition",
parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["BY","+=","Ch",";"]}]}}]},{type:"textline",tokens:"float Ci = BR . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WETTABLE"],group:{type:"group",
parts:[{type:"textline",tokens:"BY = max ( BY - sqrt ( 0.01 * - min ( Bs , 0.0 ) ) , 0.5 * BY ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CAUSTICS"],group:{type:"group",parts:[{type:"textline",tokens:"aY ( BY , Bs , u_time , Ca , BO , u_sun_direction , Bt , u_sun_quaternion , bQ , Br ) ;".split(" ")}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["ALPHA"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["ALPHA_CLIP"],group:{type:"group",
parts:[{type:"textline",tokens:"if ( Ci <= 0.5 ) discard ; Ci = 1.0 ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"float Cj = max ( max ( Ch . r , Ch . g ) , Ch . b ) * u_specular_alpha ; Ci = BR . a * ( 1.0 - Cj ) + Cj ;".split(" ")}]}}]}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["Ci","=","1.0",";"]}]}}]},
{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:"BY = mix ( eK ( bU , BO . xz * u_refr_bump ) , BY , Ci ) ; Ci = 1.0 ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"yw ( BY , Br , BP , Bs ) ;".split(" ")}]}},{type:"else",
group:{type:"group",parts:[{type:"textline",tokens:"yw ( BY , Br , BP , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:["bb","(","BY",")",";"]},{type:"condition",parts:[{type:"if",expression:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"be ( BY , Ci ) ;".split(" ")}]}}]},{type:"textline",tokens:"gl_FragColor = vec4 ( BY , Ci ) ; }".split(" ")}]};a["main_stack.glslv"]={type:"group",parts:[{type:"var",
name:"AU_QUALIFIER",tokens:["uniform"]},{type:"var",name:"MAX_BONES",tokens:["0"]},{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"var",name:"VERTEX_ANIM_MIX_NORMALS_FACTOR",tokens:["u_va_frame_factor"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"textline",tokens:["attribute","vec3","a_position",";"]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",
places:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",places:7}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_normal",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4",
"a_tangent",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_influence",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",
parts:[{type:"if",expression:["MAIN_BEND_COL"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","float","a_bending_col_main",";"]},{type:"condition",parts:[{type:"if",expression:["DETAIL_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["BEND_CENTER_ONLY"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_position_next",";"]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",
"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_normal_next",";"]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_tangent_next",";"]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",
parts:[{type:"if",expression:["TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_color",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["STATIC_BATCH"],group:{type:"group",parts:[{type:"textline",tokens:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",
parts:[{type:"textline",tokens:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",tokens:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"BILLBOARD",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_JITTER"],group:{type:"group",parts:[{type:"textline",
tokens:["uniform","vec2","u_subpixel_jitter",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",
tokens:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",
parts:[{type:"if",expression:["BILLBOARD_JITTERED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]},{type:"textline",tokens:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",
places:1}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_texture_scale",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_normal_offset ; uniform mat4 u_v_light_matrix ; uniform mat4 u_b_light_matrix ; uniform mat4 u_p_light_matrix0 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",
parts:[{type:"textline",tokens:["uniform","mat4","u_p_light_matrix1",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_p_light_matrix2",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_p_light_matrix3",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"textline",tokens:["varying","vec3","bQ",";"]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},"USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",places:7}],group:{type:"group",
parts:[{type:"textline",tokens:["varying","vec3","bS",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES","DISABLE_FOG",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bR",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",
{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bT",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","yx",";"]},{type:"condition",parts:[{type:"if",expression:["TEXCOORD"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","b_",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_COLOR",
"DYNAMIC_GRASS",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","yy",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bW",";"]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bX",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bY",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","bZ",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",
places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bU",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","NODES",{type:"logic_negative_expr",places:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bV",";"]}]}}]},{type:"include",file:"dynamic_grass.glslv"},{type:"include",file:"shadow.glslv"},{type:"include",file:"skin.glslv"},
{type:"include",file:"wind_bending.glslv"},{type:"condition",parts:[{type:"if",expression:["NODES"],group:{type:"group",parts:[{type:"include",file:"nodes.glslv"}]}}]},{type:"textline",tokens:"void main ( ) { vec3 Br = a_position ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE","USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},"NODES",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",
places:6}],group:{type:"group",parts:[{type:"textline",tokens:["vec3","Bs","=","a_normal",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec3 Bs = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE","NODES",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_UV_ORCO",{type:"equal_expr",places:2},{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"vec3 Bt = vec3 ( a_tangent ) ; vec3 Bu = a_tangent [ 3 ] * cross ( Bs , Bt ) ;".split(" ")}]}},{type:"elif",expression:["NODES",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","TEXTURE_COORDS_NORMAL",{type:"equal_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 Bv = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; vec3 Bw = normalize ( ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ) ; vec3 Bx = Bv - u_camera_eye ; vec3 Bu = cross ( Bx , Bw ) ; vec3 Bt = cross ( Bw , Bu ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec3 Bt = vec3 ( 0.0 ) ; vec3 Bu = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:"Br = mix ( Br , a_position_next , u_va_frame_factor ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE",{type:"logical_or_expr",
places:5}],group:{type:"group",parts:[{type:"textline",tokens:"Bs = mix ( Bs , a_normal_next , VERTEX_ANIM_MIX_NORMALS_FACTOR ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 By = vec3 ( a_tangent ) ; vec3 Bz = a_tangent_next [ 3 ] * cross ( a_normal_next , By ) ; Bt = mix ( Bt , By , u_va_frame_factor ) ; Bu = mix ( Bu , Bz , u_va_frame_factor ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",
expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"vD ( Br , Bt , Bu , Bs ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["vec3","BA","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec3 BA = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],
group:{type:"group",parts:[{type:"textline",tokens:"bh BB = xp ( Br , Bt , Bu , Bs , BA , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 BC = ( u_model_matrix * vec4 ( BA , 1.0 ) ) . xyz ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_PRES_GLOB_ORIENTATION",
"STATIC_BATCH",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"mat4 BD = um ( u_camera_eye , BC , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"mat4 BD = ug ( u_camera_eye , BC , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","BILLBOARD_JITTERED",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"vec3 BE = ( u_model_matrix * vec4 ( BA , 1.0 ) ) . xyz ; BD = BD * tW ( u_wind , u_time , u_jitter_amp , u_jitter_freq , BE ) ;".split(" ")}]}}]},{type:"textline",tokens:"bh BB = ut ( Br - BA , BA , Bt , Bu , Bs , BD ) ; BB . b = BC ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"bh BB = ut ( Br , BA , Bt , Bu , Bs , u_model_matrix ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_NORM_CO","CALC_TBN_SPACE",{type:"logical_or_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:"float BF = ( dot ( cross ( BB . e , BB . c ) , BB . d ) < 0.0 ) ? - 1.0 : 1.0 ; bT = vec4 ( BB . c , BF ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"wv ( BB . a , BB . b , Bs ) ;".split(" ")}]}}]},{type:"textline",tokens:"bQ = BB . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1},"USE_NODE_MATERIAL_BEGIN",
"USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","WIND_BEND","MAIN_BEND_COL","DETAIL_BEND",{type:"logical_and_expr",places:3},{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:"bS = BB . e ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"yx = u_camera_eye - BB . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXCOORD"],group:{type:"group",
parts:[{type:"textline",tokens:"b_ = uw ( a_texcoord , u_texture_scale ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"yy = BB . f ;".split(" ")}]}},{type:"elif",expression:["VERTEX_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["yy","=","a_color",";"]}]}}]}]}}]},{type:"textline",tokens:"vec4 BG = u_view_matrix * vec4 ( BB . a , 1.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NODES",
"DISABLE_FOG",{type:"logic_negative_expr",places:1},"TEXTURE_NORM_CO","PARALLAX",{type:"logical_and_expr",places:2},"WATER_EFFECTS","CAUSTICS",{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["bR","=","BG",";"]}]}}]},{type:"textline",tokens:"vec4 BH = u_proj_matrix * BG ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_JITTER"],group:{type:"group",parts:[{type:"textline",tokens:"BH . xy += u_subpixel_jitter * BH . w ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:"bU = bP ( BH ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xz ( BB . a , BB . e ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","NODES",{type:"logic_negative_expr",places:1},"USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"bV = - BG . z / u_view_max_depth ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NODES"],group:{type:"group",parts:[{type:"textline",tokens:["wA","(",")",";"]}]}}]},{type:"textline",tokens:["gl_Position","=","BH",";","}"]}]};
a["particles_color.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"include",file:"pack.glslf"}]}}]},{type:"var",name:"SOFT_STRENGTH",tokens:["1.0"]},{type:"textline",tokens:"uniform vec4 u_diffuse_color ; uniform float u_p_alpha_start ; uniform float u_p_alpha_end ; uniform vec2 u_texel_size ;".split(" ")},{type:"condition",parts:[{type:"if",
expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"uniform PRECISION sampler2D u_scene_depth ; uniform float u_view_max_depth ;".split(" ")}]}}]},{type:"textline",tokens:"varying float Br ; varying vec3 yy ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"varying vec4 bR ; varying vec3 bU ; varying float Bs ;".split(" ")}]}}]},{type:"textline",tokens:"void main ( ) { vec2 Bt = gl_PointCoord - 0.5 ; float Bu = 2.0 * length ( Bt ) ; float Bv = smoothstep ( u_p_alpha_start , u_p_alpha_end , Bu ) ; float Bw = u_diffuse_color . a * Br * ( 1.0 - Bv ) ; vec3 Bx = yy * u_diffuse_color . rgb ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"vec2 By = bU . xy / bU . z ; vec2 Bz = vec2 ( Bt . x , - Bt . y ) * Bs * u_texel_size ; vec2 BA = vec2 ( By + Bz ) ; vec4 BB = texture2D ( u_scene_depth , BA ) ; float BC = l ( BB ) ; float BD = - bR . z / u_view_max_depth ; float BE = BC - BD ; float BF = u_view_max_depth / SOFT_STRENGTH * BE ; Bw = Bw * min ( BF , 1.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:["bb","(","Bx",
")",";"]},{type:"condition",parts:[{type:"if",expression:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"be ( Bx , Bw ) ;".split(" ")}]}}]},{type:"textline",tokens:"gl_FragColor = vec4 ( Bx , Bw ) ; }".split(" ")}]};a["particles_color.glslv"]={type:"group",parts:[{type:"var",name:"COLOR_RAMP_LENGTH",tokens:["0"]},{type:"var",name:"SIZE_RAMP_LENGTH",tokens:["0"]},{type:"textline",tokens:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SIZE_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",tokens:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform float u_p_wind_fac ; uniform float u_p_max_lifetime ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_wind ; uniform float u_height ; uniform float u_p_size ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["WORLD_SPACE",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",tokens:"varying float Br ; varying vec3 yy ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"varying vec4 bR ; varying vec3 bU ; varying float Bs ;".split(" ")}]}}]},{type:"include",file:"particles.glslv"},
{type:"textline",tokens:"void main ( ) { Bt Ci ; Ci = Ch ( ) ; vec4 Cj = u_view_matrix * vec4 ( Ci . b , 1.0 ) ; vec4 Ck = u_proj_matrix * Cj ; gl_Position = Ck ; Br = Ci . c ; yy = Ci . d ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:["bR","=","Cj",";"]}]}}]},{type:"textline",tokens:"float Cl = u_height * u_proj_matrix [ 1 ] [ 1 ] * u_p_size / gl_Position . z ; float Cm = Ci . a * Cl ;".split(" ")},{type:"condition",
parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"float Cn = Ck . x ; float Co = Ck . y ; float Cp = Ck . w ; bU . x = ( Cn + Cp ) / 2.0 ; bU . y = ( Co + Cp ) / 2.0 ; bU . z = Cp ; Bs = Cm ;".split(" ")}]}}]},{type:"textline",tokens:["gl_PointSize","=","Cm",";","}"]}]};a["particles_texture.glslf"]={type:"group",parts:[{type:"var",name:"NUM_LIGHTS",tokens:["0"]},{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},
{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"var",name:"NUM_LFACTORS",tokens:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",
parts:[{type:"include",file:"pack.glslf"}]}}]},{type:"var",name:"PARTICLES_SHADELESS",tokens:["0"]},{type:"var",name:"SOFT_STRENGTH",tokens:["1.0"]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_sampler",";"]}]}}]},{type:"textline",tokens:["uniform","float","u_environment_energy",";"]},{type:"condition",parts:[{type:"if",expression:["NUM_LIGHTS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",
parts:[{type:"textline",tokens:"uniform vec4 u_underwater_fog_color_density ; uniform float u_cam_water_depth ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_FOG"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_FOG"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],
group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_diffuse_color_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT","SKY_TEXTURE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",expression:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"uniform PRECISION sampler2D u_scene_depth ; uniform float u_view_max_depth ;".split(" ")}]}}]},{type:"textline",tokens:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_emit ; uniform float u_ambient ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; varying float Br ; varying vec3 yy ; varying vec2 b_ ; varying vec3 bQ ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["PARTICLES_SHADELESS",{type:"logic_negative_expr",places:1},"DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","yx",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1},"SOFT_PARTICLES",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4",
"bR",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bU",";"]}]}}]},{type:"include",file:"environment.glslf"},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"fog.glslf"}]}}]},{type:"condition",parts:[{type:"if",expression:["PARTICLES_SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",
parts:[{type:"include",file:"lighting_nodes.glslf"}]}}]},{type:"textline",tokens:"void main ( ) { vec4 Ci = u_diffuse_color ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXTURE_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:"vec4 Cj = texture2D ( u_sampler , b_ ) ; a_ ( Cj . rgb ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MIX",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Ci . rgb = mix ( Ci . rgb , Cj . rgb , u_diffuse_color_factor ) ;".split(" ")}]}},
{type:"elif",expression:["TEXTURE_BLEND_TYPE","TEXTURE_BLEND_TYPE_MULTIPLY",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Ci . rgb *= mix ( vec3 ( 1.0 ) , Cj . rgb , u_diffuse_color_factor ) ;".split(" ")}]}}]},{type:"textline",tokens:"Ci . a = Cj . a ;".split(" ")}]}}]},{type:"textline",tokens:"Ci . rgb *= yy ; vec3 Ck = u_diffuse_intensity * Ci . rgb ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["PARTICLES_SHADELESS",{type:"logic_negative_expr",
places:1},"DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 Cl = normalize ( yx ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["PARTICLES_SHADELESS",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 Cm = u_emit * Ci . rgb ; vec3 Cn = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT",
"SKY_TEXTURE",{type:"logic_negative_expr",places:1},"SKY_COLOR",{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 Co = u_environment_energy * ew ( vec3 ( 0.0 ) ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec3 Co = u_environment_energy * ew ( Cn ) ;".split(" ")}]}}]},{type:"textline",tokens:"vec3 Cp = u_ambient * Co ; float Cq = u_specular_params [ 0 ] ; vec2 Cr = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 Cs = Cq * u_specular_color ; vec3 Ct ; vec3 Cu ; Bq ( Cm , Cp , Ck , Cs , bQ , Cn , Cl , Cr , u_diffuse_params , 1.0 , 0.0 , vec4 ( 0.0 ) , Ct , Cu ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["vec3","Ct","=","Ck",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"yw ( Ct , length ( bR ) , Cl , 1.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:"float Cv = Ci . a * Br ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"float Cw = - bR . z / u_view_max_depth ; vec4 Cx = texture2DProj ( u_scene_depth , bU ) ; float Cy = l ( Cx ) ; float Cz = Cy - Cw ; float CA = u_view_max_depth / SOFT_STRENGTH * Cz ; Cv = Cv * min ( CA , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",tokens:["bb","(","Ct",")",";"]},{type:"condition",parts:[{type:"if",expression:["ALPHA","ALPHA_CLIP",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"be ( Ct , Cv ) ;".split(" ")}]}}]},{type:"textline",tokens:"gl_FragColor = vec4 ( Ct , Cv ) ; }".split(" ")}]};a["particles_texture.glslv"]={type:"group",parts:[{type:"var",name:"BILLBOARD_ALIGN",tokens:["0"]},{type:"var",name:"COLOR_RAMP_LENGTH",tokens:["0"]},
{type:"var",name:"SIZE_RAMP_LENGTH",tokens:["0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"define",name:"BILLBOARD_ALIGN_VIEW",tokens:["1"]},{type:"define",name:"BILLBOARD_ALIGN_XY",tokens:["2"]},{type:"define",name:"BILLBOARD_ALIGN_YZ",tokens:["3"]},{type:"define",name:"BILLBOARD_ALIGN_ZX",tokens:["4"]},{type:"textline",tokens:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_p_delay ; attribute float a_p_lifetime ; attribute vec4 a_p_vels ; attribute vec2 a_p_bb_vertex ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_p_color_ramp [ COLOR_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SIZE_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec2 u_p_size_ramp [ SIZE_RAMP_LENGTH ] ;".split(" ")}]}}]},{type:"textline",tokens:"uniform float u_p_time ; uniform float u_p_length ; uniform int u_p_cyclic ; uniform float u_p_fade_in ; uniform float u_p_fade_out ; uniform float u_p_nfactor ; uniform float u_p_gravity ; uniform float u_p_mass ; uniform float u_p_wind_fac ; uniform float u_p_max_lifetime ; uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ; uniform vec3 u_camera_eye ; uniform vec3 u_wind ; uniform float u_p_size ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["WORLD_SPACE",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",tokens:"varying float Br ; varying vec3 yy ; varying vec2 b_ ; varying vec3 yx ; varying vec3 bQ ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1},"SOFT_PARTICLES",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:["varying","vec4","bR",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bU",";"]}]}}]},{type:"include",file:"particles.glslv"},{type:"textline",tokens:"float Ck ( vec2 Ci , vec2 Cj ) { return ( atan ( Cj . y , Cj . x ) - atan ( Ci . y , Ci . x ) ) ; } void main ( ) { Bt Cl ; Cl = Ch ( ) ; float Cm ; mat4 Cn ; if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_VIEW ) { Cm = Cl . e ; Cn = tG ( Cl . b , u_view_matrix ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_XY ) { Cm = Cl . e ; Cn = bB ( ) ; Cn [ 3 ] = vec4 ( Cl . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_YZ ) { Cm = Cl . e ; Cn = bF ( radians ( 90.0 ) ) ; Cn [ 3 ] = vec4 ( Cl . b , 1.0 ) ; } else if ( BILLBOARD_ALIGN == BILLBOARD_ALIGN_ZX ) { Cm = Ck ( vec2 ( EPSILON , 1.0 ) , vec2 ( a_normal . x , a_normal . z ) ) + Cl . e ; Cn = bD ( radians ( - 90.0 ) ) ; Cn [ 3 ] = vec4 ( Cl . b , 1.0 ) ; } vec4 Co = vec4 ( a_p_bb_vertex * 2.0 * Cl . a * u_p_size , 0.0 , 1.0 ) ; vec4 Cp = Cn * bH ( Cm ) * Co ; vec4 Cq = u_view_matrix * Cp ; vec4 Cr = u_proj_matrix * Cq ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SOFT_PARTICLES"],group:{type:"group",parts:[{type:"textline",tokens:"float Cs = Cr . x ; float Ct = Cr . y ; float Cu = Cr . w ; bU . x = ( Cs + Cu ) / 2.0 ; bU . y = ( Ct + Cu ) / 2.0 ; bU . z = Cu ;".split(" ")}]}}]},{type:"textline",tokens:"gl_Position = Cr ; Br = Cl . c ; yy = Cl . d ; b_ = a_p_bb_vertex + 0.5 ; bQ = Cp . xyz ; yx = u_camera_eye - Cp . xyz ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",
places:1},"SOFT_PARTICLES",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["bR","=","Cq",";"]}]}}]},{type:"textline",tokens:["}"]}]};a["procedural_skydome.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",tokens:"uniform vec3 u_sky_color ; uniform vec3 u_sun_direction ; uniform float u_rayleigh_brightness ; uniform float u_mie_brightness ; uniform float u_spot_brightness ; uniform float u_scatter_strength ; uniform float u_rayleigh_strength ; uniform float u_mie_strength ; uniform float u_rayleigh_collection_power ; uniform float u_mie_collection_power ; uniform float u_mie_distribution ; varying vec3 Ci ; const float Cj = 0.99 ; const float Ck = 1.8 ; const int Cl = 8 ; float Cv ( vec3 Cm , vec3 Cn ) { float Co = dot ( Cn , Cn ) ; float Cp = 2.0 * dot ( Cn , Cm ) ; float Cq = dot ( Cm , Cm ) - 1.0 ; float Cr = Cp * Cp - 4.0 * Co * Cq ; float Cs = sqrt ( Cr ) ; float Ct = ( - Cp - Cs ) / 2.0 ; float Cu = Cq / Ct ; return Cu ; } float CC ( float Cw , float Cx ) { float Cy = 3.0 * ( 1.0 - Cx * Cx ) ; float Cz = 2.0 * ( 2.0 + Cx * Cx ) ; float CA = 1.0 + Cw * Cw ; float CB = pow ( 1.0 + Cx * Cx - 2.0 * Cx * Cw , 1.5 ) ; CB = max ( CB , 0.00001 ) ; return ( Cy / Cz ) * ( CA / CB ) ; } float CK ( vec3 CD , vec3 CE , float CF ) { float CG = dot ( CE , - CD ) ; if ( CG < 0.0 ) { return 1.0 ; } vec3 CH = CD + CG * CE ; if ( length ( CH ) < CF ) { return 0.0 ; } else if ( length ( CH ) >= CF ) { vec3 CI = normalize ( CH ) * CF - CD ; float CJ = acos ( dot ( normalize ( CI ) , CE ) ) ; return smoothstep ( 0.0 , 1.0 , pow ( CJ * 2.0 , 3.0 ) ) ; } else return 1.0 ; } vec3 CO ( float CL , vec3 CM , float CN ) { return CM - CM * pow ( u_sky_color , vec3 ( CN / CL ) ) ; } void main ( ) { vec3 CP = normalize ( Ci ) ; vec3 CQ = u_sun_direction ; float CR = dot ( CP , CQ ) ; float CS = CC ( CR , - 0.01 ) * u_rayleigh_brightness * CQ . y ; float CT = CC ( CR - 0.5 , u_mie_distribution ) * u_mie_brightness * ( 1.0 - CQ . y ) ; float CU = smoothstep ( 0.0 , 100.0 , CC ( CR , 0.9995 ) ) * u_spot_brightness ; vec3 CV = vec3 ( 0.0 , Cj , 0.0 ) ; float CW = Cv ( CV , CP ) ; float CX = CW / float ( Cl ) ; float CY = CK ( CV , CP , Cj - 0.3 ) ; vec3 CZ = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 C_ = vec3 ( 0.0 , 0.0 , 0.0 ) ; for ( int Da = 0 ; Da < Cl ; Da ++ ) { float Db = CX * float ( Da ) ; vec3 Dc = CV + CP * Db ; float Dd = CK ( Dc , CQ , Cj - 0.2 ) ; float De = Cv ( Dc , CQ ) ; vec3 Df = CO ( De , vec3 ( Ck ) , u_scatter_strength ) * Dd ; CZ += CO ( sqrt ( Db ) , u_sky_color * Df , u_rayleigh_strength ) ; C_ += CO ( Db , Df , u_mie_strength ) ; } CZ = CZ * CY * pow ( CW , u_rayleigh_collection_power ) / float ( Cl ) ; C_ = ( C_ * CY * pow ( CW , u_mie_collection_power ) ) / float ( Cl ) ; vec3 Dg = vec3 ( CU * C_ + CT * C_ + CS * CZ ) ; bb ( Dg ) ; gl_FragColor = vec4 ( Dg , 1.0 ) ; }".split(" ")}]};
a["procedural_skydome.glslv"]={type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_position ; uniform mat4 u_cube_view_matrix ; varying vec3 Ci ; void main ( ) { vec4 Cj = vec4 ( a_position . xy , 0.999999 , 1.0 ) ; vec4 Ck = u_cube_view_matrix * Cj ; Ci = Ck . xyz ; gl_Position = Cj ; }".split(" ")}]};a["special_lens_flares.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",tokens:"uniform sampler2D u_sampler ; varying vec2 b_ ; void main ( ) { vec4 Cj = texture2D ( u_sampler , b_ ) ; bb ( Cj . rgb ) ; be ( Cj . rgb , Cj . a ) ; gl_FragColor = Cj ; }".split(" ")}]};
a["special_lens_flares.glslv"]={type:"group",parts:[{type:"var",name:"NUM_LIGHTS",tokens:["0"]},{type:"define",name:"LIGHT_INDEX",tokens:["0"]},{type:"textline",tokens:"attribute float a_lf_dist ; attribute vec2 a_lf_bb_vertex ; attribute vec2 a_texcoord ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; varying vec2 b_ ; void main ( ) { b_ = a_texcoord ; vec3 Cj = normalize ( u_light_directions [ LIGHT_INDEX ] ) ; vec4 Ck = u_proj_matrix * u_view_matrix * vec4 ( Cj , 0.0 ) ; Ck . x /= Ck . w ; Ck . y /= Ck . w ; Ck += 99999.0 * step ( Ck . z , 0.0 ) ; Ck += 100.0 * ( step ( 1.0 , abs ( Ck . x ) ) + step ( 1.0 , abs ( Ck . y ) ) ) ; Ck . x = - a_lf_dist * Ck . x ; Ck . y = - a_lf_dist * Ck . y ; float Cl = u_proj_matrix [ 1 ] [ 1 ] / u_proj_matrix [ 0 ] [ 0 ] ; vec2 Cm = vec2 ( a_lf_bb_vertex . x / Cl , a_lf_bb_vertex . y ) ; if ( a_lf_dist > - 0.999 ) { const float Cn = 1.9 ; Cm *= ( 1.0 + Cn * length ( Ck . xy ) ) ; } gl_Position = vec4 ( Ck . xy + Cm , 0.999999 , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslf"]={type:"group",parts:[{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"define",name:"INV_PI",tokens:["0.318309886"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",parts:[{type:"if",expression:["WO_SKYTEX","PROCEDURAL_SKYDOME",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_sky",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_SKYDOME",
{type:"logic_negative_expr",places:1},"WO_SKYTEX",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"include",file:"std_enums.glsl"},{type:"include",file:"blending.glslf"},{type:"textline",tokens:"uniform vec4 u_sky_tex_fac ; uniform vec3 u_sky_tex_color ; uniform float u_sky_tex_dvar ; vec3 Et ( vec3 Eo , vec3 Ep , float Eq , float Er ) { float Es = Eq * Er ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BLENDTYPE","MIX",{type:"equal_expr",places:2}],group:{type:"group",
parts:[{type:"textline",tokens:"return CB ( Ep , Eo , Es ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","ADD",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return CF ( Eo , Ep , Es ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","SUBTRACT",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return CJ ( Eo , Ep , Es ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","MULTIPLY",{type:"equal_expr",places:2}],group:{type:"group",
parts:[{type:"textline",tokens:"return CO ( Eo , Ep , Es ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","SCREEN",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return CT ( Eo , Ep , Es ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","OVERLAY",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return CY ( Eo , Ep , Es ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","DIFFERENCE",{type:"equal_expr",places:2}],
group:{type:"group",parts:[{type:"textline",tokens:"return Db ( Eo , Ep , Es ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","DIVIDE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return Df ( Eo , Ep , Es ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","DARKEN",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return Dj ( Eo , Ep , Es ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","LIGHTEN",{type:"equal_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return Dn ( Eo , Ep , Es ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","HUE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return Du ( Ep , Eo , Es ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","SATURATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return DA ( Ep , Eo , Es ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","VALUE",{type:"equal_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return DG ( Ep , Eo , Es ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","COLOR",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return DN ( Ep , Eo , Es ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","SOFT_LIGHT",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return DS ( Ep , Eo , Es ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","LINEAR_LIGHT",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return DW ( Ep , Eo , Es ) ;".split(" ")}]}}]},{type:"textline",tokens:"return vec3 ( 1.0 , 0.0 , 1.0 ) ; } float EB ( float Eu , float Ev , float Ew , float Ex ) { vec3 Ey = vec3 ( Eu ) , Ez = vec3 ( Ev ) ; float EA = Ew * Ex ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BLENDTYPE","MIX",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return CB ( Ez , Ey , EA ) . x ;".split(" ")}]}},
{type:"elif",expression:["BLENDTYPE","ADD",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return CF ( Ey , Ez , EA ) . x ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","SUBTRACT",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return CJ ( Ey , Ez , EA ) . x ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","MULTIPLY",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return Eb ( Eu , Ev , EA , Ex ) ;".split(" ")}]}},
{type:"elif",expression:["BLENDTYPE","SCREEN",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return Eh ( Eu , Ev , EA , Ex ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","OVERLAY",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return En ( Eu , Ev , EA , Ex ) ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","DIFFERENCE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return Db ( Ey , Ez , EA ) . x ;".split(" ")}]}},
{type:"elif",expression:["BLENDTYPE","DIVIDE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return Df ( Ey , Ez , EA ) . x ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","DARKEN",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return Dj ( Ey , Ez , EA ) . x ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","LIGHTEN",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return Dn ( Ey , Ez , EA ) . x ;".split(" ")}]}},
{type:"elif",expression:["BLENDTYPE","SOFT_LIGHT",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return DS ( Ez , Ey , EA ) . x ;".split(" ")}]}},{type:"elif",expression:["BLENDTYPE","LINEAR_LIGHT",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return DW ( Ez , Ey , EA ) . x ;".split(" ")}]}}]},{type:"textline",tokens:["return","0.0",";","}"]}]}}]},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",
places:1}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},"REFLECTION_PASS",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_camera_eye_frag ; uniform vec3 u_sun_intensity ; uniform float u_environment_energy ; uniform vec4 u_underwater_fog_color_density ;".split(" ")}]}}]},
{type:"textline",tokens:["varying","vec3","Ci",";"]},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",places:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","b_",";"]}]}}]},{type:"textline",tokens:"void main ( ) { vec3 EC ; vec3 ED = normalize ( Ci ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_SKYDOME"],
group:{type:"group",parts:[{type:"textline",tokens:"EC = textureCube ( u_sky , ED ) . rgb ;".split(" ")}]}},{type:"elif",expression:["WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",places:2},{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"EC = u_horizon_color ; bb ( EC ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["vec3","EE",";"]},{type:"condition",parts:[{type:"if",expression:["WO_SKYPAPER"],group:{type:"group",
parts:[{type:"textline",tokens:"EE = vec3 ( b_ , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"EE = vec3 ( Ci . xy , 0.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:["float","EF","=","0.0",";"]},{type:"condition",parts:[{type:"if",expression:["WO_SKYBLEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WO_SKYPAPER"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WO_SKYREAL"],group:{type:"group",
parts:[{type:"textline",tokens:"EF = abs ( b_ . y ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"EF = ( b_ . y + 1.0 ) * 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"float EG = acos ( ED . y ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["WO_SKYREAL"],group:{type:"group",parts:[{type:"textline",tokens:"EF = abs ( EG * INV_PI - 0.5 ) * 2.0 ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",
tokens:"EF = 1.0 - EG * INV_PI ;".split(" ")}]}}]}]}}]}]}}]},{type:"textline",tokens:"vec3 EH = u_horizon_color ; vec3 EI = u_zenith_color ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["WO_SKYTEX"],group:{type:"group",parts:[{type:"textline",tokens:"float EJ = 1.0 ; vec4 EK = textureCube ( u_sky , ED ) ; a_ ( EK . rgb ) ; EJ = EK . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["MTEX_RGBTOINT"],group:{type:"group",parts:[{type:"textline",tokens:"EJ = dot ( EK . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["MTEX_NEGATIVE"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MTEX_RGBTOINT",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"EK = vec4 ( vec3 ( 1.0 ) - EK . rgb , EK . a ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"EJ = 1.0 - EJ ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WOMAP_HORIZ","WOMAP_ZENUP","WOMAP_ZENDOWN",
{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MTEX_RGBTOINT"],group:{type:"group",parts:[{type:"textline",tokens:"EK = vec4 ( u_sky_tex_color , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"EJ = EK . a ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WOMAP_HORIZ"],group:{type:"group",parts:[{type:"textline",tokens:"EH = Et ( EK . rgb , EH , EJ , u_sky_tex_fac [ 1 ] ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["WOMAP_ZENUP","WOMAP_ZENDOWN",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["float","EL","=","0.0",";"]},{type:"condition",parts:[{type:"if",expression:["WO_SKYREAL"],group:{type:"group",parts:[{type:"textline",tokens:"if ( dot ( EE , vec3 ( 0.0 , 1.0 , 0.0 ) ) >= 0.0 ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["WOMAP_ZENUP"],group:{type:"group",parts:[{type:"textline",tokens:"EL = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:[";"]}]}}]},{type:"textline",tokens:["}"]},{type:"condition",parts:[{type:"if",expression:["WOMAP_ZENDOWN"],group:{type:"group",parts:[{type:"textline",tokens:"else EL = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WOMAP_ZENUP"],group:{type:"group",parts:[{type:"textline",tokens:"EL = u_sky_tex_fac [ 2 ] ;".split(" ")}]}},{type:"elif",expression:["WOMAP_ZENDOWN"],
group:{type:"group",parts:[{type:"textline",tokens:"EL = u_sky_tex_fac [ 3 ] ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"if ( EL != 0.0 ) EI = Et ( EK . rgb , EI , EJ , EL ) ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WOMAP_BLEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MTEX_RGBTOINT",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"EJ = dot ( EK . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ;".split(" ")}]}}]},
{type:"textline",tokens:"EF = EB ( u_sky_tex_dvar , EF , EJ , u_sky_tex_fac [ 0 ] ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WO_SKYBLEND"],group:{type:"group",parts:[{type:"textline",tokens:"EC = mix ( EH , EI , EF ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["EC","=","EH",";"]}]}}]},{type:"textline",tokens:["bb","(","EC",")",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"bb ( EH ) ; bb ( EI ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["WO_SKYBLEND"],group:{type:"group",parts:[{type:"textline",tokens:"EC = mix ( EH , EI , EF ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["EC","=","EH",";"]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},"REFLECTION_PASS",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"textline",
tokens:"a_ ( EC ) ; float EM = u_camera_eye_frag . y - WATER_LEVEL ; EM = min ( - EM * 0.03 , 0.8 ) ; float EN = clamp ( length ( u_sun_intensity ) + u_environment_energy , 0.0 , 1.0 ) ; vec3 EO = vec3 ( 0.0 ) ; vec4 EP = u_underwater_fog_color_density ; EP . rgb = mix ( EP . rgb , EO , min ( - ED . y + EM , 1.0 ) ) * EN ; float EQ = clamp ( sign ( ED . y - 0.05 * EM ) , 0.0 , 1.0 ) ; EC = mix ( EP . rgb , EC , EQ ) ; bb ( EC ) ;".split(" ")}]}}]},{type:"textline",tokens:"gl_FragColor = vec4 ( EC , 1.0 ) ; }".split(" ")}]};
a["special_skydome.glslv"]={type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_position ; uniform mat4 u_sky_vp_inverse ; varying vec3 Ci ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",places:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","b_",";"]}]}}]},{type:"textline",tokens:"void main ( ) { vec4 Eo = vec4 ( a_position . xy , 0.9999999 , 1.0 ) ; vec4 Ep = u_sky_vp_inverse * Eo ; Ci = Ep . xyz ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_SKYDOME",{type:"logic_negative_expr",places:1},"WO_SKYTEX","WO_SKYBLEND",{type:"logical_or_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"b_ = a_position . xy ;".split(" ")}]}}]},{type:"textline",tokens:["gl_Position","=","Eo",";","}"]}]};a["special_water.glslf"]={type:"group",parts:[{type:"var",name:"ABSORB",tokens:["0.0"]},{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",
name:"SSS_STRENGTH",tokens:["6.0"]},{type:"var",name:"SSS_WIDTH",tokens:["0.0"]},{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"var",name:"NUM_LIGHTS",tokens:["0"]},{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",
tokens:["0"]},{type:"var",name:"NUM_LFACTORS",tokens:["0"]},{type:"include",file:"std_enums.glsl"},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"math.glslv"},{type:"define",name:"REFL_BUMP",tokens:["0.001"]},{type:"define",name:"REFR_BUMP",tokens:["0.0005"]},{type:"textline",tokens:["uniform","float","u_time",";"]},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT",
"SKY_TEXTURE",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_sky_texture",";"]}]}},{type:"elif",expression:["USE_ENVIRONMENT_LIGHT","SKY_COLOR",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_horizon_color ; uniform vec3 u_zenith_color ;".split(" ")}]}}]},{type:"textline",tokens:["uniform","float","u_environment_energy",";"]},{type:"condition",parts:[{type:"if",expression:["NUM_LIGHTS",
0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_light_positions [ NUM_LIGHTS ] ; uniform vec3 u_light_directions [ NUM_LIGHTS ] ; uniform vec3 u_light_color_intensities [ NUM_LIGHTS ] ; uniform vec4 u_light_factors [ NUM_LFACTORS ] ;".split(" ")}]}}]},{type:"textline",tokens:"uniform vec3 u_sun_intensity ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},
"SHORE_SMOOTHING","WATER_EFFECTS","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_cam_water_depth",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_color_density",";"]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],
group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_underwater_fog_color_density",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_FOG"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_cube_fog",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_FOG"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec4","u_fog_params",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_normalmap0",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_refractmap",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_plane_reflection",";"]}]}},{type:"elif",expression:["REFLECTION_TYPE",
"REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","samplerCube","u_mirrormap",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","sampler2D","u_scene_depth",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_foam",";"]}]}}]},{type:"textline",tokens:"uniform vec4 u_diffuse_color ; uniform vec2 u_diffuse_params ; uniform float u_diffuse_intensity ; uniform float u_ambient ; uniform vec4 u_fresnel_params ; uniform vec3 u_specular_color ; uniform vec3 u_specular_params ; uniform vec3 u_shallow_water_col ; uniform vec3 u_shore_water_col ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_water_norm_uv_velocity ; uniform vec2 u_normalmap0_scale ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",1,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec2","u_normalmap1_scale",";"]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",2,{type:"g_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec2","u_normalmap2_scale",";"]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",3,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec2","u_normalmap3_scale",";"]}]}}]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_mirror_factor",
";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_reflect_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_view_max_depth",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_water_shallow_col_fac ; uniform float u_water_shore_col_fac ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_foam_factor ; uniform vec2 u_foam_uv_freq ; uniform vec2 u_foam_mag ; uniform vec2 u_foam_scale ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_refr_bump",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DEBUG_WIREFRAME"],group:{type:"group",parts:[{type:"textline",
tokens:"const float Eo = 1.0 ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{type:"textline",tokens:"varying vec3 yx ; varying vec3 bQ ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",places:2},"GENERATED_MESH",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","b_",";"]}]}}]},{type:"condition",parts:[{type:"if",
expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"varying vec3 bT ; varying vec3 Ep ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC","NUM_NORMALMAPS",0,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bS",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",
places:2},"GENERATED_MESH","DYNAMIC",{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","Eq",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","Er",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE",{type:"logical_or_expr",places:3}],group:{type:"group",
parts:[{type:"textline",tokens:["varying","vec3","bU",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bV",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DEBUG_WIREFRAME"],group:{type:"group",parts:[{type:"textline",tokens:["varying",
"vec3","Es",";"]}]}}]},{type:"include",file:"environment.glslf"},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE","SHORE_SMOOTHING","USE_REFRACTION_CORRECTION",{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"include",file:"refraction.glslf"}]}}]},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"fog.glslf"}]}}]},{type:"textline",tokens:"vec3 EG ( in vec2 Et , in vec3 Eu , in vec3 Ev , in vec3 Ew , out float Ex ) { Ex = 0.0 ; vec3 Ey = reflect ( - Ev , Eu ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec2 Ez = Et . xy + Eu . xz * REFL_BUMP / bV ; Ex = u_reflect_factor ; vec3 EA ; if ( u_cam_water_depth < 0.0 ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1},"WATER_EFFECTS",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"EA = u_underwater_fog_color_density . rgb ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"EA = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"textline",tokens:"} else { EA = texture2D ( u_plane_reflection , Ez ) . rgb ; a_ ( EA ) ; }".split(" ")}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Ex = u_mirror_factor ; vec3 EA = Ew * textureCube ( u_mirrormap , Ey ) . rgb ; a_ ( EA ) ;".split(" ")}]}},{type:"else",group:{type:"group",
parts:[{type:"textline",tokens:"Ex = u_reflect_factor ; vec3 EA = Ew * vec3 ( 0.3 , 0.5 , 1.0 ) ; a_ ( EA ) ;".split(" ")}]}}]},{type:"textline",tokens:"vec3 EB = normalize ( Ey + Ev ) ; float EC = 1.0 - dot ( Ev , EB ) ; float ED = u_fresnel_params [ 3 ] ; float EE = u_fresnel_params [ 2 ] ; float EF = ED + ( 1.0 - ED ) * pow ( EC , EE ) ; Ex = min ( Ex * EF , 1.0 ) ; return EA ; }".split(" ")},{type:"include",file:"lighting_nodes.glslf"},{type:"textline",tokens:["void","main","(",")","{"]},{type:"condition",
parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"mat3 EH = mat3 ( bT , Ep , bS ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 EI = normalize ( bS ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec3 EI = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC",
"FOAM",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"float EJ = bQ . y - WATER_LEVEL ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["GENERATED_MESH"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",parts:[{type:"textline",
tokens:"vec2 EK = vec2 ( Eq . x , - Eq . z ) + 0.5 ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec2 EK = vec2 ( bQ . x , - bQ . z ) + 0.5 ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["vec2","EK","=","b_",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 EL = vec3 ( 0.0 ) ; vec3 EM = texture2D ( u_normalmap0 , EK * u_normalmap0_scale + vec2 ( 0.3 , 0.5 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; EL += EM ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 EN = vec3 ( 0.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NORM_FOAM0"],group:{type:"group",parts:[{type:"textline",tokens:["EN","+=","EM",";"]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",1,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"EM = texture2D ( u_normalmap0 , EK * u_normalmap1_scale + vec2 ( - 0.3 , 0.7 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; EL += EM ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NORM_FOAM1"],group:{type:"group",parts:[{type:"textline",tokens:["EN","+=","EM",";"]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",2,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"EM = texture2D ( u_normalmap0 , EK * u_normalmap2_scale + vec2 ( 0.0 , 1.1 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; EL += EM ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NORM_FOAM2"],group:{type:"group",parts:[{type:"textline",tokens:["EN","+=","EM",";"]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",3,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"EM = texture2D ( u_normalmap0 , EK * u_normalmap3_scale + vec2 ( - 0.66 , - 0.3 ) * u_water_norm_uv_velocity * u_time ) . xyz - 0.5 ; EL += EM ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["NORM_FOAM3"],group:{type:"group",parts:[{type:"textline",tokens:["EN","+=","EM",";"]}]}}]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 EO = EH * EN ; if ( ! bk ( EO , vec3 ( 0.0 ) ) ) EO = normalize ( EO ) ; vec3 EP = mix ( EI , EO , 0.2 ) ; EP = normalize ( EP ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",parts:[{type:"textline",tokens:"EI = mix ( EI , normalize ( EH * EL ) , 0.3 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"EI = mix ( EI , normalize ( EH * EL ) , 0.5 ) ;".split(" ")}]}}]},{type:"textline",tokens:"EI = normalize ( EI ) ;".split(" ")}]}}]},{type:"textline",tokens:"vec3 EQ = normalize ( yx ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE",
"REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec2 ER = bU . xy / bU . z ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"float ES = bV * u_view_max_depth ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING"],
group:{type:"group",parts:[{type:"textline",tokens:"float ET = u_diffuse_color . a ; vec4 EU = texture2DProj ( u_scene_depth , bU ) ; float EV = l ( EU ) ; float EW = max ( EV - bV , 0.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:"vec2 EX = ER + EI . xz * u_refr_bump / bV ; float EY = eC ( EV , EX , ER ) ; float EZ = max ( EY - bV , 0.0 ) ; float E_ = u_view_max_depth / ABSORB * EZ ; float Fa ; if ( u_cam_water_depth < 0.0 ) Fa = 0.0 ; else Fa = min ( ET * E_ , 1.0 ) ; float Fb = u_view_max_depth / ABSORB * EW ; ET = min ( 15.0 * ET * u_view_max_depth * EW , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"float Fb = u_view_max_depth / ABSORB * EW ; if ( u_cam_water_depth > 0.0 ) ET = min ( ET * Fb , 1.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:"ET *= min ( 5.0 * ES , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"float ET = u_diffuse_color . a ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:"float Fa = 1.0 - ET ; vec2 EX = ER + EI . xz * u_refr_bump / bV ;".split(" ")}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 Fc = texture2D ( u_refractmap , EX ) . rgb ; a_ ( Fc ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"float Fd = pow ( min ( Er . b / u_water_shallow_col_fac , 1.0 ) , 0.3 ) ; vec3 Fe = mix ( u_shallow_water_col , u_diffuse_color . rgb , Fd ) ; Fd = pow ( min ( Er . b / u_water_shore_col_fac , 1.0 ) , 0.3 ) ; Fe = mix ( u_shore_water_col , Fe , Fd ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec3 Fe = u_diffuse_color . rgb ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING"],group:{type:"group",parts:[{type:"textline",tokens:"float Ff = max ( 1.0 - u_view_max_depth * EW , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"float Ff = 1.0 - ET ;".split(" ")}]}}]},{type:"condition",
parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",parts:[{type:"textline",tokens:"float Fg = max ( EJ / WAVES_HEIGHT + 0.1 , 0.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 Fh = normalize ( vec3 ( Er . r , 0.0 , Er . g ) ) ; vec3 Fi = normalize ( mix ( vec3 ( 0.0 , 1.0 , 0.0 ) , Fh , 0.8 ) ) ; float Fj = 1.25 * max ( dot ( EP , Fi ) - 0.2 , 0.0 ) ; Fj += max ( dot ( EP , vec3 ( 0.0 , - 1.0 , 0.0 ) ) , 0.0 ) ; Ff += Fj * ( 1.0 - Er . b ) ; Fg *= ( 1.0 - 0.95 * pow ( Er . b , 0.1 ) ) ;".split(" ")}]}}]},
{type:"textline",tokens:"Ff += Fg ; Ff = min ( u_foam_factor * Ff , 1.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:"vec4 Fk = texture2D ( u_foam , u_foam_mag * sin ( u_foam_uv_freq * u_time ) + EK * u_foam_scale ) ;".split(" ")}]}}]},{type:"textline",tokens:"float Fl = u_specular_params [ 0 ] ; vec2 Fm = vec2 ( u_specular_params [ 1 ] , u_specular_params [ 2 ] ) ; vec3 Fn = Fl * u_specular_color ; vec3 Fo = u_environment_energy * ew ( EI ) ; vec3 Fp = u_ambient * Fo ; vec3 Fq = Fp + u_sun_intensity ; float Fr ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 Fs = EG ( ER , EI , EQ , Fq , Fr ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec3 Fs = EG ( vec2 ( 0.0 ) , EI , EQ , Fq , Fr ) ;".split(" ")}]}}]},{type:"textline",tokens:"vec3 Ft = u_diffuse_intensity * Fe ; vec3 Fu ; vec3 Fv ; Bq ( vec3 ( 0.0 ) , vec3 ( 0.0 ) , Ft , Fn , bQ , EI , EQ , Fm , u_diffuse_params , 1.0 , 0.0 , vec4 ( 0.0 ) , Fu , Fv ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",parts:[{type:"textline",tokens:"float Fw = max ( dot ( u_sun_direction , - bS ) + SSS_WIDTH , 0.0 ) * max ( dot ( - EQ , u_sun_direction ) - 0.5 , 0.0 ) * max ( 0.0 , length ( u_sun_intensity ) - 0.1 ) ; Fw = clamp ( SSS_STRENGTH * Fw , 0.0 , 1.0 ) ; Fu = mix ( Fu , u_shallow_water_col , Fw ) ; Fu = mix ( Fu , u_shore_water_col , Fw ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",
parts:[{type:"textline",tokens:"Fu = mix ( Fc , Fu , Fa ) ;".split(" ")}]}}]},{type:"textline",tokens:"Fu = mix ( Fu , Fs , Fr ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"textline",tokens:"float Fx = mix ( Fk . g , Fk . r , max ( 4.0 * ( Ff - 0.75 ) , 0.0 ) ) ; Fx = mix ( Fk . b , Fx , max ( 2.0 * Ff - 1.0 , 0.0 ) ) ; Fx = mix ( 0.0 , Fx , Ff ) ; Fu = mix ( Fu , Fq , Fx ) ;".split(" ")}]}}]},{type:"textline",tokens:["Fu","+=","Fv",";"]},
{type:"condition",parts:[{type:"if",expression:["DISABLE_FOG",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"if ( u_cam_water_depth < 0.0 ) { yp ( Fu , ES , u_cam_water_depth ) ; } else { yw ( Fu , ES , EQ , 1.0 ) ; }".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"yw ( Fu , ES , EQ , 1.0 ) ;".split(" ")}]}}]}]}}]},{type:"textline",
tokens:["bb","(","Fu",")",";"]},{type:"condition",parts:[{type:"if",expression:["REFRACTIVE",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"ET = max ( ET , Fv . r ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["FOAM"],group:{type:"group",parts:[{type:"textline",tokens:["ET","+=","Fx",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["ALPHA"],group:{type:"group",parts:[{type:"textline",tokens:"be ( Fu , ET ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["DEBUG_WIREFRAME"],group:{type:"group",parts:[{type:"extension",tokens:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",tokens:"vec3 Fy = fwidth ( Es ) ; vec3 Fz = smoothstep ( vec3 ( 0.0 ) , Fy * Eo , Es ) ; float FA = min ( min ( Fz . x , Fz . y ) , Fz . z ) ; FA = clamp ( FA , 0.0 , 1.0 ) ; Fu = mix ( u_wireframe_edge_color , Fu , FA ) ; ET = mix ( 1.0 , ET , FA ) ;".split(" ")}]}}]},{type:"textline",tokens:"gl_FragColor = vec4 ( Fu , ET ) ; }".split(" ")}]};
a["special_water.glslv"]={type:"group",parts:[{type:"var",name:"DIR_MIN_SHR_FAC",tokens:["0.0"]},{type:"var",name:"DIR_FREQ",tokens:["0.0"]},{type:"var",name:"DIR_NOISE_SCALE",tokens:["0.0"]},{type:"var",name:"DIR_NOISE_FREQ",tokens:["0.0"]},{type:"var",name:"DIR_MIN_NOISE_FAC",tokens:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_0",tokens:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_0",tokens:["0.0"]},{type:"var",name:"DST_NOISE_SCALE_1",tokens:["0.0"]},{type:"var",name:"DST_NOISE_FREQ_1",tokens:["0.0"]},
{type:"var",name:"DST_MIN_FAC",tokens:["0.0"]},{type:"var",name:"MAX_SHORE_DIST",tokens:["0.0"]},{type:"var",name:"PRECISION",tokens:["mediump"]},{type:"var",name:"SHORE_MAP_CENTER_X",tokens:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_X",tokens:["0.0"]},{type:"var",name:"SHORE_MAP_CENTER_Y",tokens:["0.0"]},{type:"var",name:"SHORE_MAP_SIZE_Y",tokens:["0.0"]},{type:"var",name:"WAVES_HOR_FAC",tokens:["0.0"]},{type:"var",name:"WATER_LEVEL",tokens:["0.0"]},{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},
{type:"var",name:"WAVES_LENGTH",tokens:["0.0"]},{type:"include",file:"math.glslv"},{type:"include",file:"to_world.glslv"},{type:"include",file:"scale_texcoord.glslv"},{type:"include",file:"procedural.glslf"},{type:"textline",tokens:["attribute","vec3","a_position",";"]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"DYNAMIC",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_normal ; attribute vec3 a_tangent ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["GENERATED_MESH",{type:"logic_negative_expr",places:1},"NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",places:2},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec2","a_texcoord",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DEBUG_WIREFRAME"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","float","a_polyindex",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["STATIC_BATCH"],group:{type:"group",parts:[{type:"textline",tokens:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",tokens:"uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_camera_eye ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",parts:[{type:"textline",tokens:"uniform PRECISION float u_time ; uniform vec3 u_wind ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","PRECISION","float","u_view_max_depth",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_shore_dist_map",";"]}]}}]},
{type:"textline",tokens:"varying vec3 yx ; varying vec3 bQ ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",places:2},"GENERATED_MESH",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","b_",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"varying vec3 bT ; varying vec3 Ep ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC","NUM_NORMALMAPS",0,{type:"g_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bS",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",places:2},"GENERATED_MESH","DYNAMIC",{type:"logical_and_expr",places:3}],group:{type:"group",parts:[{type:"textline",
tokens:["varying","vec3","Eq",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","Er",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","bU",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING",
"REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE","DISABLE_FOG",{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:["varying","float","bV",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["DEBUG_WIREFRAME"],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","Es",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",
tokens:"vec3 Ey ( in vec2 Eo ) { vec2 Et = 0.5 + vec2 ( ( Eo . x - SHORE_MAP_CENTER_X ) / SHORE_MAP_SIZE_X , - ( Eo . y + SHORE_MAP_CENTER_Y ) / SHORE_MAP_SIZE_Y ) ; vec4 Eu = texture2D ( u_shore_dist_map , Et ) ; const vec2 Ev = vec2 ( 1.0 / 255.0 , 1.0 ) ; float Ew = dot ( Eu . ba , Ev ) ; vec2 Ex = normalize ( Eu . rg * 2.0 - 1.0 ) ; return vec3 ( Ex , Ew ) ; }".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",parts:[{type:"define",name:"M_PI",tokens:["3.14159265359"]},
{type:"define",name:"SMALL_WAVES_FAC",tokens:["0.3"]},{type:"textline",tokens:"void EP ( inout vec3 Ez , in float EA , in vec3 EB ) { float EC = au ( DST_NOISE_SCALE_0 * ( Ez . xz + DST_NOISE_FREQ_0 * EA ) ) * au ( DST_NOISE_SCALE_1 * ( Ez . zx - DST_NOISE_FREQ_1 * EA ) ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"float ED = WAVES_LENGTH / MAX_SHORE_DIST / M_PI ; float EE = EB . b ; float EF = sqrt ( EE ) ; float EG = max ( EE , DIR_MIN_SHR_FAC ) * sin ( EF / ED + DIR_FREQ * EA ) ; float EH = max ( au ( DIR_NOISE_SCALE * ( Ez . xz + DIR_NOISE_FREQ * EA ) ) , DIR_MIN_NOISE_FAC ) ; EG *= EH ; float EI = WAVES_HEIGHT * mix ( EG , EC , max ( EF , DST_MIN_FAC ) ) ; vec2 EJ = EB . rg ; float EK = WAVES_HOR_FAC * EG * max ( MAX_SHORE_DIST / 35.0 * ( 0.05 - EE ) , 0.0 ) ; vec2 EL = EK * EJ ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"float EI = WAVES_HEIGHT * EC ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["GENERATED_MESH"],group:{type:"group",parts:[{type:"textline",tokens:"vec2 EM = 2.0 * ( Ez . xz - 0.1 * EA ) ; vec2 EN = 1.3 * ( Ez . zx + 0.03 * EA ) ; float EO = Q ( 0.5 * EM ) . x + Q ( 0.5 * EN ) . x - 1.0 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"Ez . xz += EL ; EO *= EE ;".split(" ")}]}}]},
{type:"textline",tokens:"EI += SMALL_WAVES_FAC * EO ;".split(" ")}]}}]},{type:"textline",tokens:"Ez . y += EI ; }".split(" ")}]}}]},{type:"textline",tokens:["void","main","(",")","{"]},{type:"condition",parts:[{type:"if",expression:["DEBUG_WIREFRAME"],group:{type:"group",parts:[{type:"textline",tokens:"if ( a_polyindex == 0.0 ) Es = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) Es = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) Es = vec3 ( 0.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",tokens:["vec3","EQ","=","a_position",";"]},{type:"condition",parts:[{type:"if",expression:["GENERATED_MESH"],group:{type:"group",parts:[{type:"textline",tokens:"float ER = abs ( EQ . y ) ; vec2 ES = u_camera_eye . xz - mod ( u_camera_eye . xz , ER ) ; EQ . y = WATER_LEVEL ; EQ . xz += ES ;".split(" ")}]}},{type:"elif",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["b_","=","a_texcoord",
";"]}]}}]},{type:"textline",tokens:"bh ET = ut ( EQ , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"Er = Ey ( ET . a . xz ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC"],group:{type:"group",parts:[{type:"textline",tokens:"float EU = length ( u_wind ) ; float EV = u_time ; EV *= EU ;".split(" ")},{type:"condition",
parts:[{type:"if",expression:["GENERATED_MESH"],group:{type:"group",parts:[{type:"textline",tokens:"float EW = ER ; vec3 EX = ET . a + vec3 ( EW , 0.0 , 0.0 ) ; vec3 EY = ET . a + vec3 ( 0.0 , 0.0 , EW ) ; if ( a_position . y < 0.0 ) { ET . a . y = WATER_LEVEL - 1.0 ; EX . y = ET . a . y ; EY . y = ET . a . y ; }".split(" ")},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",0,{type:"g_expr",places:2},"FOAM",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"Eq = ET . a ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec3 EX = ET . a + vec3 ( 0.05 , 0.0 , 0.0 ) ; vec3 EY = ET . a + vec3 ( 0.0 , 0.0 , 0.05 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_PARAMS"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 EZ = Ey ( EX . xz ) ; vec3 E_ = Ey ( EY . xz ) ; EP ( EX , EV , EZ ) ; EP ( EY , EV , E_ ) ; EP ( ET . a , EV , Er ) ;".split(" ")}]}},{type:"else",group:{type:"group",
parts:[{type:"textline",tokens:"EP ( EX , EV , vec3 ( 0.0 ) ) ; EP ( EY , EV , vec3 ( 0.0 ) ) ; EP ( ET . a , EV , vec3 ( 0.0 ) ) ;".split(" ")}]}}]},{type:"textline",tokens:"vec3 Fa = normalize ( EX - ET . a ) ; vec3 Fb = normalize ( EY - ET . a ) ; bS = normalize ( cross ( Fb , Fa ) ) ; float Fc = dot ( bS , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float Fd = clamp ( 0.8 - Fc , 0.0 , 1.0 ) ; bS = mix ( bS , vec3 ( 0.0 , 1.0 , 0.0 ) , Fd ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["NUM_NORMALMAPS",
0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DYNAMIC",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 Fb = a_tangent ; bS = a_normal ;".split(" ")}]}}]},{type:"textline",tokens:"bT = Fb ; Ep = cross ( bS , bT ) ;".split(" ")}]}}]},{type:"textline",tokens:"bQ = ET . a ; yx = u_camera_eye - ET . a ; vec4 Fe = u_view_matrix * vec4 ( ET . a , 1.0 ) ; vec4 Ff = u_proj_matrix * Fe ;".split(" ")},{type:"condition",
parts:[{type:"if",expression:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:"float Fg = Ff . x ; float Fh = Ff . y ; float Fi = Ff . w ; bU . x = ( Fg + Fi ) / 2.0 ; bU . y = ( Fh + Fi ) / 2.0 ; bU . z = Fi ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SHORE_SMOOTHING","REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"REFRACTIVE","DISABLE_FOG",
{type:"logic_negative_expr",places:1},{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:"bV = - Fe . z / u_view_max_depth ;".split(" ")}]}}]},{type:"textline",tokens:["gl_Position","=","Ff",";","}"]}]};a["wireframe.glslf"]={type:"group",parts:[{type:"define",name:"WM_NONE",tokens:["0"]},{type:"define",name:"WM_OPAQUE_WIREFRAME",tokens:["1"]},{type:"define",name:"WM_TRANSPARENT_WIREFRAME",tokens:["2"]},{type:"define",name:"WM_FRONT_BACK_VIEW",tokens:["3"]},{type:"define",
name:"WM_DEBUG_SPHERES",tokens:["4"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"uniform int u_wireframe_mode ; uniform vec3 u_wireframe_edge_color ;".split(" ")}]}}]},{type:"textline",tokens:"varying vec3 Es ; const float Eo = 1.0 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE"],
group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE_DYNAMIC"],group:{type:"group",parts:[{type:"textline",tokens:"const vec3 Et = vec3 ( 1.0 , 0.05 , 0.05 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"const vec3 Et = vec3 ( 0.05 , 0.05 , 1.0 ) ;".split(" ")}]}}]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"const vec3 Eu = vec3 ( 0.4 , 0.4 , 1.0 ) ; const vec3 Ev = vec3 ( 1.0 , 0.4 , 0.4 ) ; const vec3 Ew = vec3 ( 1.0 , 1.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",tokens:"void main ( ) { vec3 Ex = vec3 ( 0.0 ) ; float Ey = 0.0 ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 Ez = sign ( Es - vec3 ( 0.02 * Eo ) ) ; if ( Ez . x < 0.0 || Ez . y < 0.0 || Ez . z < 0.0 ) { Ex = Et ; Ey = 1.0 ; } else discard ;".split(" ")}]}},{type:"elif",expression:["WIREFRAME_QUALITY",0,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 Ez = sign ( Es - vec3 ( 0.02 * Eo ) ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { if ( Ez . x < 0.0 || Ez . y < 0.0 || Ez . z < 0.0 ) Ex = u_wireframe_edge_color ; else Ex = Ew ; Ey = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { if ( Ez . x < 0.0 || Ez . y < 0.0 || Ez . z < 0.0 ) Ey = 1.0 ; else Ey = 0.0 ; Ex = u_wireframe_edge_color ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( Ez . x < 0.0 || Ez . y < 0.0 || Ez . z < 0.0 ) Ex = u_wireframe_edge_color ; else if ( gl_FrontFacing ) Ex = Eu ; else Ex = Ev ; Ey = 1.0 ; }".split(" ")}]}},
{type:"elif",expression:["WIREFRAME_QUALITY",1,{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"extension",tokens:["GL_OES_standard_derivatives",":","enable"]},{type:"textline",tokens:"vec3 EA = fwidth ( Es ) ; vec3 EB = smoothstep ( vec3 ( 0.0 ) , EA * Eo , Es ) ; float EC = min ( min ( EB . x , EB . y ) , EB . z ) ; EC = clamp ( EC , 0.0 , 1.0 ) ; if ( u_wireframe_mode == WM_OPAQUE_WIREFRAME ) { Ex = vec3 ( mix ( u_wireframe_edge_color , Ew , EC ) ) ; Ey = 1.0 ; } else if ( u_wireframe_mode == WM_TRANSPARENT_WIREFRAME ) { Ex = u_wireframe_edge_color ; Ey = mix ( 1.0 , 0.0 , EC ) ; } else if ( u_wireframe_mode == WM_FRONT_BACK_VIEW ) { if ( gl_FrontFacing ) Ex = mix ( u_wireframe_edge_color , Eu , EC ) ; else Ex = mix ( u_wireframe_edge_color , Ev , EC ) ; Ey = 1.0 ; }".split(" ")}]}}]},
{type:"textline",tokens:["bb","(","Ex",")",";"]},{type:"condition",parts:[{type:"if",expression:["ALPHA"],group:{type:"group",parts:[{type:"textline",tokens:"be ( Ex , Ey ) ;".split(" ")}]}}]},{type:"textline",tokens:"gl_FragColor = vec4 ( Ex , Ey ) ; }".split(" ")}]};a["wireframe.glslv"]={type:"group",parts:[{type:"var",name:"AU_QUALIFIER",tokens:["uniform"]},{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"var",name:"MAX_BONES",tokens:["0"]},{type:"include",file:"math.glslv"},{type:"include",
file:"to_world.glslv"},{type:"textline",tokens:"attribute vec3 a_position ; attribute vec3 a_normal ; attribute float a_polyindex ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["MAIN_BEND_COL"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","float","a_bending_col_main",
";"]},{type:"condition",parts:[{type:"if",expression:["DETAIL_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"attribute vec3 a_bending_col_detail ; AU_QUALIFIER float au_detail_bending_amp ; AU_QUALIFIER float au_branch_bending_amp ; AU_QUALIFIER float au_detail_bending_freq ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"AU_QUALIFIER float au_wind_bending_amp ; AU_QUALIFIER float au_wind_bending_freq ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BEND_CENTER_ONLY"],
group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_emitter_center",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["AU_QUALIFIER","vec3","au_center_pos",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec3","a_position_next",";"]}]}}]},{type:"condition",
parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:["attribute","vec4","a_influence",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["STATIC_BATCH"],group:{type:"group",parts:[{type:"textline",tokens:"const mat4 u_model_matrix = mat4 ( 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["uniform","mat4","u_model_matrix",";"]}]}}]},{type:"textline",tokens:"uniform mat4 u_proj_matrix ; uniform mat4 u_view_matrix ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec3 u_wind ; uniform PRECISION float u_time ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD","BILLBOARD_JITTERED",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform float u_jitter_amp ; uniform float u_jitter_freq ;".split(" ")}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec3","u_camera_eye",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","float","u_va_frame_factor",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsb [ MAX_BONES ] ; uniform vec4 u_transb [ MAX_BONES ] ; uniform vec4 u_arm_rel_trans ; uniform vec4 u_arm_rel_quat ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:"uniform vec4 u_quatsa [ MAX_BONES ] ; uniform vec4 u_transa [ MAX_BONES ] ; uniform float u_frame_factor ;".split(" ")}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"uniform PRECISION sampler2D u_grass_map_depth ; uniform sampler2D u_grass_map_color ; uniform vec4 u_camera_quat ; uniform vec3 u_grass_map_dim ; uniform float u_grass_size ; uniform float u_scale_threshold ;".split(" ")}]}}]}]}}]},
{type:"textline",tokens:["varying","vec3","Es",";"]},{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"include",file:"skin.glslv"},{type:"include",file:"wind_bending.glslv"},{type:"include",file:"dynamic_grass.glslv"}]}}]},{type:"textline",tokens:"void main ( ) { if ( a_polyindex == 0.0 ) Es = vec3 ( 1.0 , 0.0 , 0.0 ) ; else if ( a_polyindex == 1.0 ) Es = vec3 ( 0.0 , 1.0 , 0.0 ) ; else if ( a_polyindex == 2.0 ) Es = vec3 ( 0.0 , 0.0 , 1.0 ) ; vec3 Eo = a_position ; vec3 Et = a_normal ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["DEBUG_SPHERE"],group:{type:"group",parts:[{type:"textline",tokens:"bh Eu = ut ( Eo , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["VERTEX_ANIM"],group:{type:"group",parts:[{type:"textline",tokens:"Eo = mix ( Eo , a_position_next , u_va_frame_factor ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],
group:{type:"group",parts:[{type:"textline",tokens:"vec3 Ev = vec3 ( 0.0 ) ; vec3 Ew = vec3 ( 0.0 ) ; vD ( Eo , Ev , Ew , Et ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND","DYNAMIC_GRASS","BILLBOARD",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:["vec3","Ex","=","au_center_pos",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec3 Ex = vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",
expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"bh Eu = xp ( Eo , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Ex , u_grass_map_depth , u_grass_map_color , u_grass_map_dim , u_grass_size , u_camera_eye , u_camera_quat , u_view_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 Ey = ( u_model_matrix * vec4 ( Ex , 1.0 ) ) . xyz ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"mat4 Ez = um ( u_camera_eye , Ey , u_view_matrix , u_model_matrix ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"mat4 Ez = ug ( u_camera_eye , Ey , u_view_matrix ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["WIND_BEND",
"BILLBOARD_JITTERED",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 EA = ( u_model_matrix * vec4 ( Ex , 1.0 ) ) . xyz ; Ez = Ez * tW ( u_wind , u_time , u_jitter_amp , u_jitter_freq , EA ) ;".split(" ")}]}}]},{type:"textline",tokens:"bh Eu = ut ( Eo - Ex , Ex , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , Ez ) ; Eu . b = Ey ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"bh Eu = ut ( Eo , Ex , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , u_model_matrix ) ;".split(" ")}]}}]}]}}]},
{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"wv ( Eu . a , Eu . b , Et ) ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"vec4 EB = u_view_matrix * vec4 ( Eu . a , 1.0 ) ; gl_Position = u_proj_matrix * EB ; }".split(" ")}]};a["postprocessing/anaglyph.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform sampler2D u_sampler_left ; uniform sampler2D u_sampler_right ; varying vec2 b_ ; void main ( ) { vec4 Eo = texture2D ( u_sampler_left , b_ ) ; vec4 Et = texture2D ( u_sampler_right , b_ ) ; gl_FragColor = vec4 ( Eo [ 0 ] , Et [ 1 ] , Et [ 2 ] , Eo [ 3 ] + Et [ 3 ] ) ; }".split(" ")}]};
a["postprocessing/antialiasing.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"AA_METHOD_PASS",tokens:["1"]},{type:"define",name:"AA_METHOD_FXAA_LIGHT",tokens:["2"]},{type:"define",name:"AA_METHOD_FXAA_QUALITY",tokens:["3"]},{type:"define",name:"FXAA_REDUCE_MIN",tokens:["(","1.0","/","128.0",")"]},{type:"define",name:"FXAA_REDUCE_MUL",tokens:["(","1.0","/","8.0",")"]},{type:"define",name:"FXAA_SPAN_MAX",tokens:["8.0"]},{type:"textline",tokens:"uniform sampler2D u_color ; uniform vec2 u_texel_size ; varying vec2 b_ ; vec4 Ev ( float Eo , float Et ) { vec2 Eu = b_ + vec2 ( Eo , Et ) * u_texel_size ; return texture2D ( u_color , Eu ) ; } float Ez ( vec4 Ew ) { vec3 Ex = vec3 ( 0.299 , 0.587 , 0.114 ) ; float Ey = dot ( Ew . rgb , Ex ) ; return Ey ; } vec4 ES ( ) { vec4 EA = Ev ( - 1.0 , - 1.0 ) ; vec4 EB = Ev ( 1.0 , - 1.0 ) ; vec4 EC = Ev ( - 1.0 , 1.0 ) ; vec4 ED = Ev ( 1.0 , 1.0 ) ; vec4 EE = Ev ( 0.0 , 0.0 ) ; float EF = Ez ( EA ) ; float EG = Ez ( EB ) ; float EH = Ez ( EC ) ; float EI = Ez ( ED ) ; float EJ = Ez ( EE ) ; float EK = min ( EJ , min ( min ( EF , EG ) , min ( EH , EI ) ) ) ; float EL = max ( EJ , max ( max ( EF , EG ) , max ( EH , EI ) ) ) ; vec2 EM ; EM . x = - ( ( EF + EG ) - ( EH + EI ) ) ; EM . y = ( ( EF + EH ) - ( EG + EI ) ) ; float EN = max ( ( EF + EG + EH + EI ) * ( 0.25 * FXAA_REDUCE_MUL ) , FXAA_REDUCE_MIN ) ; float EO = 1.0 / ( min ( abs ( EM . x ) , abs ( EM . y ) ) + EN ) ; EM = min ( vec2 ( FXAA_SPAN_MAX , FXAA_SPAN_MAX ) , max ( vec2 ( - FXAA_SPAN_MAX , - FXAA_SPAN_MAX ) , EM * EO ) ) * u_texel_size ; vec4 EP = 0.5 * ( texture2D ( u_color , b_ + EM * ( 1.0 / 3.0 - 0.5 ) ) + texture2D ( u_color , b_ + EM * ( 2.0 / 3.0 - 0.5 ) ) ) ; vec4 EQ = EP * 0.5 + 0.25 * ( texture2D ( u_color , b_ + EM * - 0.5 ) + texture2D ( u_color , b_ + EM * 0.5 ) ) ; float ER = Ez ( EQ ) ; if ( ( ER < EK ) || ( ER > EL ) ) return EP ; else return EQ ; }".split(" ")},
{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD",tokens:["(","1.0","/","6.0",")"]},{type:"define",name:"FXAA_QUALITY_EDGE_THRESHOLD_MIN",tokens:["(","1.0","/","12.0",")"]},{type:"define",name:"FXAA_QUALITY_SUBPIX",tokens:["(","3.0","/","4.0",")"]},{type:"textline",tokens:"vec4 GD ( ) { vec2 ET ; ET . x = b_ . x ; ET . y = b_ . y ; vec4 EU = texture2D ( u_color , ET ) ; vec4 EV = Ev ( 0.0 , 1.0 ) ; vec4 EW = Ev ( 1.0 , 0.0 ) ; vec4 EX = Ev ( 0.0 , - 1.0 ) ; vec4 EY = Ev ( - 1.0 , 0.0 ) ; float EZ = Ez ( EV ) ; float E_ = Ez ( EW ) ; float Fa = Ez ( EX ) ; float Fb = Ez ( EY ) ; float Fc = Ez ( EU ) ; float Fd = max ( EZ , Fc ) ; float Fe = min ( EZ , Fc ) ; float Ff = max ( E_ , Fd ) ; float Fg = min ( E_ , Fe ) ; float Fh = max ( Fa , Fb ) ; float Fi = min ( Fa , Fb ) ; float Fj = max ( Fh , Ff ) ; float Fk = min ( Fi , Fg ) ; float Fl = Fj * FXAA_QUALITY_EDGE_THRESHOLD ; float Fm = Fj - Fk ; float Fn = max ( FXAA_QUALITY_EDGE_THRESHOLD_MIN , Fl ) ; bool Fo = Fm < Fn ; if ( Fo ) return EU ; vec4 Fp = Ev ( - 1.0 , - 1.0 ) ; vec4 Fq = Ev ( 1.0 , 1.0 ) ; vec4 Fr = Ev ( 1.0 , - 1.0 ) ; vec4 Fs = Ev ( - 1.0 , 1.0 ) ; float Ft = Ez ( Fp ) ; float Fu = Ez ( Fq ) ; float Fv = Ez ( Fr ) ; float Fw = Ez ( Fs ) ; float Fx = Fa + EZ ; float Fy = Fb + E_ ; float Fz = 1.0 / Fm ; float FA = Fx + Fy ; float FB = ( - 2.0 * Fc ) + Fx ; float FC = ( - 2.0 * Fc ) + Fy ; float FD = Fv + Fu ; float FE = Ft + Fv ; float FF = ( - 2.0 * E_ ) + FD ; float FG = ( - 2.0 * Fa ) + FE ; float FH = Ft + Fw ; float FI = Fw + Fu ; float FJ = ( abs ( FB ) * 2.0 ) + abs ( FF ) ; float FK = ( abs ( FC ) * 2.0 ) + abs ( FG ) ; float FL = ( - 2.0 * Fb ) + FH ; float FM = ( - 2.0 * EZ ) + FI ; float FN = abs ( FL ) + FJ ; float FO = abs ( FM ) + FK ; float FP = FH + FD ; float FQ = u_texel_size . x ; bool FR = FN >= FO ; float FS = FA * 2.0 + FP ; if ( ! FR ) Fa = Fb ; if ( ! FR ) EZ = E_ ; if ( FR ) FQ = u_texel_size . y ; float FT = ( FS * ( 1.0 / 12.0 ) ) - Fc ; float FU = Fa - Fc ; float FV = EZ - Fc ; float FW = Fa + Fc ; float FX = EZ + Fc ; bool FY = abs ( FU ) >= abs ( FV ) ; float FZ = max ( abs ( FU ) , abs ( FV ) ) ; if ( FY ) FQ = - FQ ; float F_ = clamp ( abs ( FT ) * Fz , 0.0 , 1.0 ) ; vec2 Ga ; Ga . x = ET . x ; Ga . y = ET . y ; vec2 Gb ; Gb . x = ( ! FR ) ? 0.0 : u_texel_size . x ; Gb . y = ( FR ) ? 0.0 : u_texel_size . y ; if ( ! FR ) Ga . x += FQ * 0.5 ; if ( FR ) Ga . y += FQ * 0.5 ; vec2 Gc ; Gc . x = Ga . x - Gb . x ; Gc . y = Ga . y - Gb . y ; vec2 Gd ; Gd . x = Ga . x + Gb . x ; Gd . y = Ga . y + Gb . y ; float Ge = ( ( - 2.0 ) * F_ ) + 3.0 ; float Gf = Ez ( texture2D ( u_color , Gc ) ) ; float Gg = F_ * F_ ; float Gh = Ez ( texture2D ( u_color , Gd ) ) ; if ( ! FY ) FW = FX ; float Gi = FZ * 1.0 / 4.0 ; float Gj = Fc - FW * 0.5 ; float Gk = Ge * Gg ; bool Gl = Gj < 0.0 ; Gf -= FW * 0.5 ; Gh -= FW * 0.5 ; bool Gm = abs ( Gf ) >= Gi ; bool Gn = abs ( Gh ) >= Gi ; if ( ! Gm ) Gc . x -= Gb . x * 1.5 ; if ( ! Gm ) Gc . y -= Gb . y * 1.5 ; bool Go = ( ! Gm ) || ( ! Gn ) ; if ( ! Gn ) Gd . x += Gb . x * 1.5 ; if ( ! Gn ) Gd . y += Gb . y * 1.5 ; if ( Go ) { if ( ! Gm ) Gf = Ez ( texture2D ( u_color , Gc . xy ) ) ; if ( ! Gn ) Gh = Ez ( texture2D ( u_color , Gd . xy ) ) ; if ( ! Gm ) Gf = Gf - FW * 0.5 ; if ( ! Gn ) Gh = Gh - FW * 0.5 ; Gm = abs ( Gf ) >= Gi ; Gn = abs ( Gh ) >= Gi ; if ( ! Gm ) Gc . x -= Gb . x * 2.0 ; if ( ! Gm ) Gc . y -= Gb . y * 2.0 ; Go = ( ! Gm ) || ( ! Gn ) ; if ( ! Gn ) Gd . x += Gb . x * 2.0 ; if ( ! Gn ) Gd . y += Gb . y * 2.0 ; if ( Go ) { if ( ! Gm ) Gf = Ez ( texture2D ( u_color , Gc . xy ) ) ; if ( ! Gn ) Gh = Ez ( texture2D ( u_color , Gd . xy ) ) ; if ( ! Gm ) Gf = Gf - FW * 0.5 ; if ( ! Gn ) Gh = Gh - FW * 0.5 ; Gm = abs ( Gf ) >= Gi ; Gn = abs ( Gh ) >= Gi ; if ( ! Gm ) Gc . x -= Gb . x * 2.0 ; if ( ! Gm ) Gc . y -= Gb . y * 2.0 ; Go = ( ! Gm ) || ( ! Gn ) ; if ( ! Gn ) Gd . x += Gb . x * 2.0 ; if ( ! Gn ) Gd . y += Gb . y * 2.0 ; if ( Go ) { if ( ! Gm ) Gf = Ez ( texture2D ( u_color , Gc . xy ) ) ; if ( ! Gn ) Gh = Ez ( texture2D ( u_color , Gd . xy ) ) ; if ( ! Gm ) Gf = Gf - FW * 0.5 ; if ( ! Gn ) Gh = Gh - FW * 0.5 ; Gm = abs ( Gf ) >= Gi ; Gn = abs ( Gh ) >= Gi ; if ( ! Gm ) Gc . x -= Gb . x * 4.0 ; if ( ! Gm ) Gc . y -= Gb . y * 4.0 ; Go = ( ! Gm ) || ( ! Gn ) ; if ( ! Gn ) Gd . x += Gb . x * 4.0 ; if ( ! Gn ) Gd . y += Gb . y * 4.0 ; if ( Go ) { if ( ! Gm ) Gf = Ez ( texture2D ( u_color , Gc . xy ) ) ; if ( ! Gn ) Gh = Ez ( texture2D ( u_color , Gd . xy ) ) ; if ( ! Gm ) Gf = Gf - FW * 0.5 ; if ( ! Gn ) Gh = Gh - FW * 0.5 ; Gm = abs ( Gf ) >= Gi ; Gn = abs ( Gh ) >= Gi ; if ( ! Gm ) Gc . x -= Gb . x * 2.0 ; if ( ! Gm ) Gc . y -= Gb . y * 2.0 ; if ( ! Gn ) Gd . x += Gb . x * 2.0 ; if ( ! Gn ) Gd . y += Gb . y * 2.0 ; } } } } float Gp = ET . x - Gc . x ; float Gq = Gd . x - ET . x ; if ( ! FR ) Gp = ET . y - Gc . y ; if ( ! FR ) Gq = Gd . y - ET . y ; bool Gr = ( Gf < 0.0 ) != Gl ; float Gs = ( Gq + Gp ) ; bool Gt = ( Gh < 0.0 ) != Gl ; float Gu = 1.0 / Gs ; bool Gv = Gp < Gq ; float Gw = min ( Gp , Gq ) ; bool Gx = Gv ? Gr : Gt ; float Gy = Gk * Gk ; float Gz = ( Gw * ( - Gu ) ) + 0.5 ; float GA = Gy * FXAA_QUALITY_SUBPIX ; float GB = Gx ? Gz : 0.0 ; float GC = max ( GB , GA ) ; if ( ! FR ) ET . x += GC * FQ ; if ( FR ) ET . y += GC * FQ ; return texture2D ( u_color , ET ) ; }".split(" ")},
{type:"define",name:"FXAA_CONSOLE_EDGE_SHARPNESS",tokens:["8.0"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD",tokens:["0.125"]},{type:"define",name:"FXAA_CONSOLE_EDGE_THRESHOLD_MIN",tokens:["0.05"]},{type:"textline",tokens:["void","main","(",")","{"]},{type:"condition",parts:[{type:"if",expression:["AA_METHOD","AA_METHOD_PASS",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = texture2D ( u_color , b_ ) ;".split(" ")}]}},{type:"elif",expression:["AA_METHOD",
"AA_METHOD_FXAA_LIGHT",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = ES ( ) ;".split(" ")}]}},{type:"elif",expression:["AA_METHOD","AA_METHOD_FXAA_QUALITY",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = GD ( ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( 1.0 , 1.0 , 0.0 , 1.0 ) * texture2D ( u_color , b_ ) ;".split(" ")}]}}]},{type:"textline",
tokens:["}"]}]};a["postprocessing/bloom_blur.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 b_ ; void main ( ) { vec2 Eo = vec2 ( 0.0 , 0.0 ) ; vec2 Et = u_texel_size ; vec4 Eu = texture2D ( u_color , b_ ) ; gl_FragColor = Eu * 0.0875447373698 ; Eo += Et ; gl_FragColor += texture2D ( u_color , b_ + Eo ) * 0.0858112354248 ; gl_FragColor += texture2D ( u_color , b_ - Eo ) * 0.0858112354248 ; Eo += Et ; gl_FragColor += texture2D ( u_color , b_ + Eo ) * 0.0808139781061 ; gl_FragColor += texture2D ( u_color , b_ - Eo ) * 0.0808139781061 ; Eo += Et ; gl_FragColor += texture2D ( u_color , b_ + Eo ) * 0.0731235112908 ; gl_FragColor += texture2D ( u_color , b_ - Eo ) * 0.0731235112908 ; Eo += Et ; gl_FragColor += texture2D ( u_color , b_ + Eo ) * 0.0635705267419 ; gl_FragColor += texture2D ( u_color , b_ - Eo ) * 0.0635705267419 ; Eo += Et ; gl_FragColor += texture2D ( u_color , b_ + Eo ) * 0.0530985673112 ; gl_FragColor += texture2D ( u_color , b_ - Eo ) * 0.0530985673112 ; Eo += Et ; gl_FragColor += texture2D ( u_color , b_ + Eo ) * 0.0426125984122 ; gl_FragColor += texture2D ( u_color , b_ - Eo ) * 0.0426125984122 ; Eo += Et ; gl_FragColor += texture2D ( u_color , b_ + Eo ) * 0.0328565115809 ; gl_FragColor += texture2D ( u_color , b_ - Eo ) * 0.0328565115809 ; Eo += Et ; gl_FragColor += texture2D ( u_color , b_ + Eo ) * 0.0243407024472 ; gl_FragColor += texture2D ( u_color , b_ - Eo ) * 0.0243407024472 ; gl_FragColor = max ( 0.7 * Eu , gl_FragColor ) ; }".split(" ")}]};
a["postprocessing/bloom_combine.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform sampler2D u_main ; uniform sampler2D u_bloom ; varying vec2 b_ ; void main ( ) { vec4 Eo = texture2D ( u_main , b_ ) ; vec4 Et = texture2D ( u_bloom , b_ ) ; vec4 Eu = Eo ; Eu += Et ; gl_FragColor = vec4 ( Eu . rgb , 1.0 ) ; }".split(" ")}]};a["postprocessing/compositing.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"define",
name:"PI_4",tokens:["0.785398163"]},{type:"textline",tokens:"uniform sampler2D u_color ; uniform float u_brightness ; uniform float u_contrast ; uniform float u_exposure ; uniform float u_saturation ; varying vec2 b_ ; void main ( ) { vec4 Eo = texture2D ( u_color , b_ ) ; vec3 Et = Eo . rgb ; if ( u_brightness < 0.0 ) Et = Et * ( 1.0 + u_brightness ) ; else Et = Et + ( ( 1.0 - Et ) * u_brightness ) ; Et = ( Et - 0.5 ) * ( tan ( ( u_contrast + 1.0 ) * PI_4 ) ) + 0.5 ; Et *= u_exposure ; vec3 Eu = vec3 ( 0.299 , 0.587 , 0.114 ) ; float Ev = dot ( Et , Eu ) ; Et = mix ( vec3 ( Ev ) , Et , u_saturation ) ; gl_FragColor = vec4 ( Et , Eo . a ) ; }".split(" ")}]};
a["postprocessing/depth_pack.glslf"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"textline",tokens:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",tokens:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; varying vec2 b_ ; void main ( ) { gl_FragColor = h ( clamp ( EA ( u_depth , b_ , u_camera_range ) , 0.0 , 0.999999 ) ) ; }".split(" ")}]};
a["postprocessing/dof.glslf"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"textline",tokens:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"textline",tokens:"uniform sampler2D u_sharp ; uniform sampler2D u_blurred ; uniform sampler2D u_depth ; uniform float u_view_max_depth ; uniform float u_dof_dist ; uniform float u_dof_front ; uniform float u_dof_rear ; uniform vec2 u_camera_range ; varying vec2 b_ ; void main ( ) { vec4 Eo = texture2D ( u_sharp , b_ ) ; if ( u_dof_dist > 0.0 ) { float EB = EA ( u_depth , b_ , u_camera_range ) ; EB *= u_view_max_depth ; float EC ; if ( EB < u_dof_dist ) EC = ( u_dof_dist - EB ) / u_dof_front ; else EC = ( EB - u_dof_dist ) / u_dof_rear ; EC = clamp ( EC , 0.0 , 1.0 ) ; vec4 ED = texture2D ( u_blurred , b_ ) ; gl_FragColor = mix ( Eo , ED , EC ) ; } else gl_FragColor = Eo ; }".split(" ")}]};
a["postprocessing/glow.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform sampler2D u_src_color ; uniform sampler2D u_glow_mask_small ; uniform sampler2D u_glow_mask_large ; uniform float u_glow_mask_small_coeff ; uniform float u_glow_mask_large_coeff ; varying vec2 b_ ; void main ( ) { vec4 Eo = texture2D ( u_src_color , b_ ) ; vec4 EB = texture2D ( u_glow_mask_small , b_ ) ; vec4 EC = texture2D ( u_glow_mask_large , b_ ) ; gl_FragColor = Eo ; if ( EC . a != 0.0 ) { float ED = u_glow_mask_large_coeff * EC . a ; ED = clamp ( ED , 0.0 , 1.0 ) ; gl_FragColor . rgb = mix ( gl_FragColor . rgb , EC . rgb / EC . a , ED ) ; gl_FragColor . a = mix ( gl_FragColor . a , 1.0 , ED ) ; } if ( EB . a != 0.0 ) { float EE = u_glow_mask_small_coeff * EB . a ; EE = clamp ( EE , 0.0 , 1.0 ) ; gl_FragColor . rgb = mix ( gl_FragColor . rgb , EB . rgb / EB . a , EE ) ; gl_FragColor . a = mix ( gl_FragColor . a , 1.0 , EE ) ; } }".split(" ")}]};
a["postprocessing/god_rays.glslf"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"textline",tokens:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"include",file:"pack.glslf"},{type:"var",name:"STEPS_PER_PASS",tokens:["0.0"]},{type:"textline",tokens:"uniform float u_time ; uniform float u_radial_blur_step ; uniform sampler2D u_input ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["DEPTH_RGBA"],group:{type:"group",parts:[{type:"textline",tokens:["uniform","vec2","u_camera_range",";"]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"varying float EB ; varying vec2 EC ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"varying vec2 b_ ; varying vec4 ED ; void main ( ) { vec2 EE = ( ED . xy - b_ ) ; float EF = length ( EE ) ; vec2 EG = u_radial_blur_step * EE / EF ; float EH = EF / u_radial_blur_step ; EG *= min ( EH , STEPS_PER_PASS ) / STEPS_PER_PASS ; EH = max ( EH , STEPS_PER_PASS ) ; vec2 EI = b_ ; float EJ = 0.0 ; for ( float EK = 0.0 ; EK < STEPS_PER_PASS ; EK += 1.0 ) { if ( EK <= EH ) {".split(" ")},
{type:"condition",parts:[{type:"if",expression:["DEPTH_RGBA"],group:{type:"group",parts:[{type:"textline",tokens:"float EL = EA ( u_input , EI , u_camera_range ) ; EJ += max ( ( 1.0 - pow ( EF , 0.3 ) ) * step ( 0.9 , EL ) , 0.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec4 EM = texture2D ( u_input , EI ) ; EJ += l ( EM ) ;".split(" ")}]}}]},{type:"textline",tokens:"} EI += EG ; }".split(" ")},{type:"condition",parts:[{type:"if",expression:["DEPTH_RGBA",
"WATER_EFFECTS",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec2 EN = b_ + EC ; float EO = Q ( vec2 ( 2.5 * ( EN . x ) , 2.5 * ( EN . y ) + 1.0 * u_time ) ) . x + 0.75 * Q ( vec2 ( 5.0 * ( EN . x ) - 0.66 * u_time , 5.0 * ( EN . y ) + 0.66 * u_time ) ) . x + 0.5 * au ( vec2 ( 7.5 * ( EN . x ) + 0.33 * u_time , 7.5 * ( EN . y ) - 0.33 * u_time ) ) ; EO *= clamp ( 1.2 - sqrt ( 0.2 * EF ) , 0.0 , 1.0 ) * EB ; EJ = max ( EO , EJ ) ;".split(" ")}]}}]},{type:"textline",
tokens:"gl_FragColor = h ( EJ / STEPS_PER_PASS ) ; }".split(" ")}]};a["postprocessing/god_rays.glslv"]={type:"group",parts:[{type:"include",file:"math.glslv"},{type:"textline",tokens:"attribute vec2 a_bb_vertex ; uniform mat4 u_view_matrix ; uniform mat4 u_proj_matrix ; uniform vec3 u_sun_direction ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DEPTH_RGBA"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",
tokens:"uniform vec4 u_camera_quat ; uniform float u_cam_water_depth ; varying float EB ; varying vec2 EC ;".split(" ")}]}}]}]}}]},{type:"textline",tokens:"varying vec2 b_ ; varying vec4 ED ; void main ( ) { b_ = a_bb_vertex + 0.5 ; vec3 Eo = normalize ( u_sun_direction ) ; ED = u_proj_matrix * u_view_matrix * vec4 ( Eo , 0.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["DEPTH_RGBA","WATER_EFFECTS",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"if ( u_cam_water_depth < 0.0 ) { EB = 1.0 ; vec3 EE = vec3 ( 0.0 , 1.0 , 0.0 ) ; vec3 EF = bn ( u_camera_quat , EE ) ; EF = normalize ( EF ) ; float EG = dot ( EF , vec3 ( 0.0 , 1.0 , 0.0 ) ) ; float EH = atan ( EF . x , EF . z ) ; EC = vec2 ( - EH , acos ( EG ) ) ; } else { EB = 0.0 ; }".split(" ")}]}}]},{type:"textline",tokens:"ED . xy = 0.5 * ( ED . xy / ED . w + 1.0 ) ; ED += 99999.0 * step ( ED . z , 0.0 ) ; gl_Position = vec4 ( 2.0 * a_bb_vertex . xy , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/god_rays_combine.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",tokens:"uniform sampler2D u_main ; uniform sampler2D u_god_rays ; uniform float u_god_rays_intensity ; uniform vec3 u_sun_intensity ; varying vec2 b_ ; void main ( ) { vec4 Eo = texture2D ( u_main , b_ ) ; vec3 EE = clamp ( u_sun_intensity , 0.4 , 0.8 ) ; a_ ( Eo . rgb ) ; float EF = l ( texture2D ( u_god_rays , b_ ) ) ; vec3 EG = Eo . rgb + u_god_rays_intensity * vec3 ( EF ) * EE ; bb ( EG ) ; gl_FragColor . rgb = EG ; gl_FragColor . a = Eo . a ; }".split(" ")}]};
a["postprocessing/luminance.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform sampler2D u_input ; varying vec2 b_ ; void main ( ) { vec4 Eo = texture2D ( u_input , b_ ) ; float EE = dot ( Eo . rgb , vec3 ( 0.2126 , 0.7152 , 0.0722 ) ) ; gl_FragColor = vec4 ( vec3 ( EE ) , 1.0 ) ; }".split(" ")}]};a["postprocessing/luminance_av.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform sampler2D u_input ; void main ( ) { float Eo ; float EE = 0.0 ; for ( float EF = 0.025 ; EF < 1.0 ; EF += 0.05 ) for ( float EG = 0.025 ; EG < 1.0 ; EG += 0.05 ) { Eo = max ( texture2D ( u_input , vec2 ( EF , EG ) ) . r , 0.01 ) ; EE += log ( Eo ) ; } float EH = exp ( EE / 400.0 ) ; gl_FragColor = vec4 ( vec3 ( EH ) , 1.0 ) ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform sampler2D u_main ; uniform sampler2D u_luminance ; uniform sampler2D u_average_lum ; uniform float u_bloom_edge_lum ; varying vec2 b_ ; varying float EE ; void main ( ) { float EF = texture2D ( u_average_lum , vec2 ( 0.5 ) ) . r ; float EG = texture2D ( u_luminance , b_ ) . r ; vec4 EH = texture2D ( u_main , b_ ) ; float EI = EG / EF ; float EJ = u_bloom_edge_lum ; gl_FragColor = EH * max ( EI - EJ , 0.0 ) * EE ; }".split(" ")}]};
a["postprocessing/luminance_trunced.glslv"]={type:"group",parts:[{type:"textline",tokens:"attribute vec2 a_position ; uniform vec4 u_camera_quat ; uniform vec3 u_sun_direction ; uniform float u_bloom_key ; varying vec2 b_ ; varying float EE ; const vec3 Eo = vec3 ( 0.0 , 1.0 , 0.0 ) ; void EM ( in vec4 EF , in vec3 EG , out vec3 EH ) { float EI = EF . w * EG . x + EF . y * EG . z - EF . z * EG . y ; float EJ = EF . w * EG . y + EF . z * EG . x - EF . x * EG . z ; float EK = EF . w * EG . z + EF . x * EG . y - EF . y * EG . x ; float EL = - EF . x * EG . x - EF . y * EG . y - EF . z * EG . z ; EH . x = EI * EF . w - EL * EF . x - EJ * EF . z + EK * EF . y ; EH . y = EJ * EF . w - EL * EF . y - EK * EF . x + EI * EF . z ; EH . z = EK * EF . w - EL * EF . z - EI * EF . y + EJ * EF . x ; } void main ( ) { b_ = 2.0 * a_position ; vec3 EN ; EM ( u_camera_quat , Eo , EN ) ; EE = dot ( - EN , u_sun_direction ) * u_bloom_key ; EE *= max ( sign ( u_sun_direction . y ) , 0.0 ) ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};
a["postprocessing/motion_blur.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"textline",tokens:"uniform sampler2D u_mb_tex_curr ; uniform sampler2D u_mb_tex_accum ; uniform float u_motion_blur_exp ; uniform float u_motion_blur_decay_threshold ; varying vec2 b_ ; float Eo = 0.0042 ; void main ( ) { vec4 EF = texture2D ( u_mb_tex_curr , b_ ) ; vec4 EG = texture2D ( u_mb_tex_accum , b_ ) ; if ( length ( EF - EG ) > u_motion_blur_decay_threshold ) { vec4 EH = ( 1.0 - u_motion_blur_exp ) * EF + u_motion_blur_exp * EG ; vec4 EI = EH - EG ; vec4 EJ = EF - EG ; vec4 EK = min ( max ( abs ( EI ) , vec4 ( Eo ) ) , abs ( EJ ) ) * sign ( EI ) ; gl_FragColor = EG + EK ; } else { gl_FragColor = EF ; } }".split(" ")}]};
a["postprocessing/outline.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"textline",tokens:"uniform sampler2D u_outline_src ; uniform sampler2D u_outline_mask ; uniform sampler2D u_outline_mask_blurred ; uniform vec3 u_outline_color ; uniform float u_draw_outline ; varying vec2 b_ ; void main ( ) { vec4 Eo = texture2D ( u_outline_src , b_ ) ; gl_FragColor = Eo ; if ( u_draw_outline != 0.0 ) { vec4 EF = texture2D ( u_outline_mask , b_ ) ; vec4 EG = texture2D ( u_outline_mask_blurred , b_ ) ; float EH = EG . a - EF . a ; if ( EH != 0.0 ) { float EI = smoothstep ( 0.0 , 1.0 , EG . a ) ; if ( EF . a == 0.0 ) { vec3 EJ = u_outline_color ; bb ( EJ ) ; vec4 EK = vec4 ( clamp ( EJ , 0.0 , 1.0 ) , 1.0 ) ; gl_FragColor = mix ( Eo , EK , EI ) ; } } } }".split(" ")}]};
a["postprocessing/postprocessing.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"define",name:"POST_EFFECT_NONE",tokens:["1"]},{type:"define",name:"POST_EFFECT_GRAYSCALE",tokens:["2"]},{type:"define",name:"POST_EFFECT_X_BLUR",tokens:["3"]},{type:"define",name:"POST_EFFECT_Y_BLUR",tokens:["4"]},{type:"define",name:"POST_EFFECT_X_EXTEND",tokens:["5"]},{type:"define",name:"POST_EFFECT_Y_EXTEND",tokens:["6"]},{type:"textline",tokens:"uniform vec2 u_texel_size ; uniform sampler2D u_color ; varying vec2 b_ ; void main ( ) {".split(" ")},
{type:"condition",parts:[{type:"if",expression:["POST_EFFECT","POST_EFFECT_NONE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = texture2D ( u_color , b_ ) ;".split(" ")}]}},{type:"elif",expression:["POST_EFFECT","POST_EFFECT_GRAYSCALE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec4 Eo = texture2D ( u_color , b_ ) ; gl_FragColor . rgb = vec3 ( ( Eo . r + Eo . g + Eo . b ) / 3.0 ) ; gl_FragColor . a = 1.0 ;".split(" ")}]}},
{type:"elif",expression:["POST_EFFECT","POST_EFFECT_X_BLUR",{type:"equal_expr",places:2},"POST_EFFECT","POST_EFFECT_Y_BLUR",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec2 EF = vec2 ( 0.0 , 0.0 ) ; vec2 EG = u_texel_size ; vec4 EH ; EH = texture2D ( u_color , b_ ) ; gl_FragColor = EH * 0.2270270270 ; EF += EG ; EH = texture2D ( u_color , b_ + EF ) ; gl_FragColor += EH * 0.1945945946 ; EH = texture2D ( u_color , b_ - EF ) ; gl_FragColor += EH * 0.1945945946 ; EF += EG ; EH = texture2D ( u_color , b_ + EF ) ; gl_FragColor += EH * 0.1216216216 ; EH = texture2D ( u_color , b_ - EF ) ; gl_FragColor += EH * 0.1216216216 ; EF += EG ; EH = texture2D ( u_color , b_ + EF ) ; gl_FragColor += EH * 0.0540540541 ; EH = texture2D ( u_color , b_ - EF ) ; gl_FragColor += EH * 0.0540540541 ; EF += EG ; EH = texture2D ( u_color , b_ + EF ) ; gl_FragColor += EH * 0.0162162162 ; EH = texture2D ( u_color , b_ - EF ) ; gl_FragColor += EH * 0.0162162162 ;".split(" ")}]}},
{type:"elif",expression:["POST_EFFECT","POST_EFFECT_X_GLOW_BLUR",{type:"equal_expr",places:2},"POST_EFFECT","POST_EFFECT_Y_GLOW_BLUR",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec2 EF = vec2 ( 0.0 , 0.0 ) ; vec2 EG = u_texel_size ; vec4 EH ; EH = texture2D ( u_color , b_ ) ; gl_FragColor = EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.152507 ; EF += EG ; EH = texture2D ( u_color , b_ + EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.141763 ; EH = texture2D ( u_color , b_ - EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.141763 ; EF += EG ; EH = texture2D ( u_color , b_ + EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.113861 ; EH = texture2D ( u_color , b_ - EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.113861 ; EF += EG ; EH = texture2D ( u_color , b_ + EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.079019 ; EH = texture2D ( u_color , b_ - EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.079019 ; EF += EG ; EH = texture2D ( u_color , b_ + EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.047383 ; EH = texture2D ( u_color , b_ - EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.047383 ; EF += EG ; EH = texture2D ( u_color , b_ + EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.024549 ; EH = texture2D ( u_color , b_ - EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.024549 ; EF += EG ; EH = texture2D ( u_color , b_ + EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.01099 ; EH = texture2D ( u_color , b_ - EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.01099 ; EF += EG ; EH = texture2D ( u_color , b_ + EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.00425 ; EH = texture2D ( u_color , b_ - EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.00425 ; EF += EG ; EH = texture2D ( u_color , b_ + EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.00142 ; EH = texture2D ( u_color , b_ - EF ) ; gl_FragColor += EH * ( 1.0 - step ( 0.0 , - EH . a ) ) * 0.00142 ; gl_FragColor = clamp ( gl_FragColor , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"elif",expression:["POST_EFFECT","POST_EFFECT_X_EXTEND",{type:"equal_expr",places:2},"POST_EFFECT","POST_EFFECT_Y_EXTEND",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec2 EG = u_texel_size ; vec4 EH = texture2D ( u_color , b_ ) ; gl_FragColor = EH ; if ( EH . a == 0.0 ) { EH = texture2D ( u_color , b_ + EG ) ; if ( EH . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , EH . a ) ; else { EH = texture2D ( u_color , b_ - EG ) ; if ( EH . a > 0.0 ) gl_FragColor = vec4 ( 1.0 , 1.0 , 1.0 , EH . a ) ; } }".split(" ")}]}}]},
{type:"textline",tokens:["}"]}]};a["postprocessing/postprocessing.glslv"]={type:"group",parts:[{type:"textline",tokens:"attribute vec2 a_position ; varying vec2 b_ ; void main ( ) { b_ = 2.0 * a_position ; gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/smaa.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"gamma.glslf"},{type:"include",file:"pack.glslf"},{type:"define",name:"SMAA_RESOLVE",
tokens:["1"]},{type:"define",name:"SMAA_EDGE_DETECTION",tokens:["2"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",tokens:["3"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",tokens:["4"]},{type:"define",name:"AA_METHOD_SMAA_LOW",tokens:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",tokens:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",tokens:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",tokens:["4"]},{type:"textline",tokens:["uniform","sampler2D","u_color",";"]},{type:"condition",
parts:[{type:"if",expression:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_color_prev",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_blend",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",
tokens:["uniform","sampler2D","u_velocity_tex",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",places:2},"SMAA_PREDICATION",{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["uniform","sampler2D","u_predication_tex",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"uniform sampler2D u_search_tex ; uniform sampler2D u_area_tex ; uniform vec4 u_subsample_indices ;".split(" ")}]}}]},
{type:"textline",tokens:"uniform vec2 u_texel_size ; varying vec2 b_ ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","EF",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"varying vec4 EG ; varying vec4 EH ; varying vec4 EI ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","EJ",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["AA_METHOD","AA_METHOD_SMAA_LOW",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_THRESHOLD",tokens:["0.15"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",tokens:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",tokens:["1"]}]}},{type:"elif",expression:["AA_METHOD","AA_METHOD_SMAA_MEDIUM",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_THRESHOLD",tokens:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",tokens:["1"]},{type:"define",name:"SMAA_DISABLE_CORNER_DETECTION",tokens:["1"]}]}},{type:"elif",expression:["AA_METHOD","AA_METHOD_SMAA_HIGH",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_THRESHOLD",tokens:["0.1"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",tokens:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",
tokens:["8"]},{type:"define",name:"SMAA_CORNER_ROUNDING",tokens:["25"]}]}},{type:"elif",expression:["AA_METHOD","AA_METHOD_SMAA_ULTRA",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_THRESHOLD",tokens:["0.05"]},{type:"define",name:"SMAA_DISABLE_DIAG_DETECTION",tokens:["0"]},{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",tokens:["16"]},{type:"define",name:"SMAA_CORNER_ROUNDING",tokens:["25"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_THRESHOLD",group:{type:"group",
parts:[{type:"define",name:"SMAA_THRESHOLD",tokens:["0.1"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_DEPTH_THRESHOLD",group:{type:"group",parts:[{type:"define",name:"SMAA_DEPTH_THRESHOLD",tokens:["(","0.1","*","SMAA_THRESHOLD",")"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS_DIAG",group:{type:"group",parts:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS_DIAG",tokens:["8"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_CORNER_ROUNDING",group:{type:"group",
parts:[{type:"define",name:"SMAA_CORNER_ROUNDING",tokens:["25"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",group:{type:"group",parts:[{type:"define",name:"SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR",tokens:["2.0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_PREDICATION",group:{type:"group",parts:[{type:"define",name:"SMAA_PREDICATION",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_PREDICATION_THRESHOLD",group:{type:"group",
parts:[{type:"define",name:"SMAA_PREDICATION_THRESHOLD",tokens:["0.01"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_PREDICATION_SCALE",group:{type:"group",parts:[{type:"define",name:"SMAA_PREDICATION_SCALE",tokens:["2.0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_PREDICATION_STRENGTH",group:{type:"group",parts:[{type:"define",name:"SMAA_PREDICATION_STRENGTH",tokens:["0.4"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_REPROJECTION",group:{type:"group",parts:[{type:"define",
name:"SMAA_REPROJECTION",tokens:["0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_REPROJECTION_WEIGHT_SCALE",group:{type:"group",parts:[{type:"define",name:"SMAA_REPROJECTION_WEIGHT_SCALE",tokens:["30.0"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",parts:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",tokens:["16"]}]}}]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE",tokens:["16"]},{type:"define",name:"SMAA_AREATEX_MAX_DISTANCE_DIAG",tokens:["20"]},
{type:"define",name:"SMAA_AREATEX_PIXEL_SIZE",tokens:"( 1.0 / vec2 ( 160.0 , 560.0 ) )".split(" ")},{type:"define",name:"SMAA_AREATEX_SUBTEX_SIZE",tokens:["(","1.0","/","7.0",")"]},{type:"define",name:"SMAA_SEARCHTEX_SIZE",tokens:"vec2 ( 66.0 , 33.0 )".split(" ")},{type:"define",name:"SMAA_SEARCHTEX_PACKED_SIZE",tokens:"vec2 ( 64.0 , 16.0 )".split(" ")},{type:"define",name:"SMAA_CORNER_ROUNDING_NORM",tokens:"( float ( SMAA_CORNER_ROUNDING ) / 100.0 )".split(" ")},{type:"condition",parts:[{type:"if",
expression:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 EP ( vec2 EK , sampler2D EL ) { float EM = texture2D ( EL , EK ) . r ; float EN = texture2D ( EL , EG . xy ) . r ; float EO = texture2D ( EL , EG . zw ) . r ; return vec3 ( EM , EN , EO ) ; }".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec2 EV ( vec2 EQ , sampler2D ER ) { vec3 ES = EP ( EQ , ER ) ; vec2 ET = abs ( ES . xx - ES . yz ) ; vec2 EU = step ( SMAA_PREDICATION_THRESHOLD , ET ) ; return SMAA_PREDICATION_SCALE * SMAA_THRESHOLD * ( 1.0 - SMAA_PREDICATION_STRENGTH * EU ) ; }".split(" ")}]}}]},
{type:"textline",tokens:"void EZ ( bvec2 EW , inout vec2 EX , vec2 EY ) { if ( EW . x ) EX . x = EY . x ; if ( EW . y ) EX . y = EY . y ; } void EZ ( bvec4 E_ , inout vec4 Fa , vec4 Fb ) { EZ ( E_ . xy , Fa . xy , Fb . xy ) ; EZ ( E_ . zw , Fa . zw , Fb . zw ) ; } vec2 Fd ( vec2 Fc ) { return sign ( Fc ) * floor ( abs ( Fc ) + .5 ) ; } vec4 Fd ( vec4 Fe ) { return sign ( Fe ) * floor ( abs ( Fe ) + .5 ) ; }".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_EDGE_DETECTION",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec2 Fv ( vec2 Ff , sampler2D Fg".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_PREDICATION"],group:{type:"group",parts:[{type:"textline",tokens:[",","sampler2D","Fh"]}]}}]},{type:"textline",tokens:[")","{"]},{type:"condition",parts:[{type:"if",expression:["SMAA_PREDICATION"],group:{type:"group",parts:[{type:"textline",tokens:"vec2 Fi = EV ( Ff , Fh ) ;".split(" ")}]}},{type:"else",group:{type:"group",
parts:[{type:"textline",tokens:"vec2 Fi = vec2 ( SMAA_THRESHOLD , SMAA_THRESHOLD ) ;".split(" ")}]}}]},{type:"textline",tokens:"vec3 Fj = vec3 ( 0.2126 , 0.7152 , 0.0722 ) ; float Fk = dot ( texture2D ( Fg , Ff ) . rgb , Fj ) ; float Fl = dot ( texture2D ( Fg , EG . xy ) . rgb , Fj ) ; float Fm = dot ( texture2D ( Fg , EG . zw ) . rgb , Fj ) ; vec4 Fn ; Fn . xy = abs ( Fk - vec2 ( Fl , Fm ) ) ; vec2 Fo = step ( Fi , Fn . xy ) ; if ( dot ( Fo , vec2 ( 1.0 , 1.0 ) ) == 0.0 ) discard ; float Fp = dot ( texture2D ( Fg , EH . xy ) . rgb , Fj ) ; float Fq = dot ( texture2D ( Fg , EH . zw ) . rgb , Fj ) ; Fn . zw = abs ( Fk - vec2 ( Fp , Fq ) ) ; vec2 Fr = max ( Fn . xy , Fn . zw ) ; float Fs = dot ( texture2D ( Fg , EI . xy ) . rgb , Fj ) ; float Ft = dot ( texture2D ( Fg , EI . zw ) . rgb , Fj ) ; Fn . zw = abs ( vec2 ( Fl , Fm ) - vec2 ( Fs , Ft ) ) ; Fr = max ( Fr . xy , Fn . zw ) ; float Fu = max ( Fr . x , Fr . y ) ; Fo . xy *= step ( Fu , SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR * Fn . xy ) ; return Fo ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"vec2 Fx ( vec2 Fw ) { Fw . r = Fw . r * abs ( 5.0 * Fw . r - 5.0 * 0.75 ) ; return Fd ( Fw ) ; } vec4 Fx ( vec4 Fy ) { Fy . rb = Fy . rb * abs ( 5.0 * Fy . rb - 5.0 * 0.75 ) ; return Fd ( Fy ) ; } vec2 FG ( sampler2D Fz , vec2 FA , vec2 FB , out vec2 FC ) { vec4 FD = vec4 ( FA , - 1.0 , 1.0 ) ; vec3 FE = vec3 ( u_texel_size , 1.0 ) ; for ( int FF = 0 ; FF < SMAA_MAX_SEARCH_STEPS_DIAG ; FF ++ ) { if ( FD . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && FD . w > 0.9 ) { FD . xyz += FE * vec3 ( FB , 1.0 ) ; FC = texture2D ( Fz , FD . xy , 0.0 ) . rg ; FD . w = dot ( FC , vec2 ( 0.5 , 0.5 ) ) ; } } return FD . zw ; } vec2 FO ( sampler2D FH , vec2 FI , vec2 FJ , out vec2 FK ) { vec4 FL = vec4 ( FI , - 1.0 , 1.0 ) ; FL . x += 0.25 * u_texel_size . x ; vec3 FM = vec3 ( u_texel_size , 1.0 ) ; for ( int FN = 0 ; FN < SMAA_MAX_SEARCH_STEPS_DIAG ; FN ++ ) { if ( FL . z < float ( SMAA_MAX_SEARCH_STEPS_DIAG - 1 ) && FL . w > 0.9 ) { FL . xyz = FM * vec3 ( FJ , 1.0 ) + FL . xyz ; FK = texture2D ( FH , FL . xy , 0.0 ) . rg ; FK = Fx ( FK ) ; FL . w = dot ( FK , vec2 ( 0.5 , 0.5 ) ) ; } } return FL . zw ; } vec2 FU ( sampler2D FP , vec2 FQ , vec2 FR , float FS ) { vec2 FT = vec2 ( SMAA_AREATEX_MAX_DISTANCE_DIAG , SMAA_AREATEX_MAX_DISTANCE_DIAG ) * FR + FQ ; FT = SMAA_AREATEX_PIXEL_SIZE * FT + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; FT . x += 0.5 ; FT . y += SMAA_AREATEX_SUBTEX_SIZE * FS ; return texture2D ( FP , FT , 0.0 ) . rg ; } vec2 Gi ( sampler2D FV , sampler2D FW , vec2 FX , vec2 FY , vec4 FZ ) { vec2 F_ = vec2 ( 0.0 , 0.0 ) ; vec4 Ga ; vec2 Gb ; if ( FY . r > 0.0 ) { Ga . xz = FG ( FV , FX , vec2 ( - 1.0 , 1.0 ) , Gb ) ; Ga . x += float ( Gb . y > 0.9 ) ; } else Ga . xz = vec2 ( 0.0 , 0.0 ) ; Ga . yw = FG ( FV , FX , vec2 ( 1.0 , - 1.0 ) , Gb ) ; if ( Ga . x + Ga . y > 2.0 ) { vec4 Gc = vec4 ( - Ga . x + 0.25 , Ga . x , Ga . y , - Ga . y - 0.25 ) * u_texel_size . xyxy + FX . xyxy ; vec4 Gd ; Gd . xy = texture2D ( FV , Gc . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . rg ; Gd . zw = texture2D ( FV , Gc . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . rg ; Gd . yxwz = Fx ( Gd . xyzw ) ; vec2 Ge = vec2 ( 2.0 , 2.0 ) * Gd . xz + Gd . yw ; EZ ( bvec2 ( step ( 0.9 , Ga . zw ) ) , Ge , vec2 ( 0.0 , 0.0 ) ) ; F_ += FU ( FW , Ga . xy , Ge , FZ . z ) ; } Ga . xz = FO ( FV , FX , vec2 ( - 1 , - 1 ) , Gb ) ; if ( texture2D ( FV , FX + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r > 0.0 ) { Ga . yw = FO ( FV , FX , vec2 ( 1 , 1 ) , Gb ) ; Ga . y += float ( Gb . y > 0.9 ) ; } else Ga . yw = vec2 ( 0.0 , 0.0 ) ; if ( Ga . x + Ga . y > 2.0 ) { vec4 Gf = vec4 ( - Ga . x , - Ga . x , Ga . y , Ga . y ) * u_texel_size . xyxy + FX . xyxy ; vec4 Gg ; Gg . x = texture2D ( FV , Gf . xy + u_texel_size * vec2 ( - 1 , 0 ) , 0.0 ) . g ; Gg . y = texture2D ( FV , Gf . xy + u_texel_size * vec2 ( 0 , - 1 ) , 0.0 ) . r ; Gg . zw = texture2D ( FV , Gf . zw + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . gr ; vec2 Gh = vec2 ( 2.0 , 2.0 ) * Gg . xz + Gg . yw ; EZ ( bvec2 ( step ( 0.9 , Ga . zw ) ) , Gh , vec2 ( 0 , 0 ) ) ; F_ += FU ( FW , Ga . xy , Gh , FZ . w ) . gr ; } return F_ ; }".split(" ")}]}}]},
{type:"textline",tokens:"float Go ( sampler2D Gj , vec2 Gk , float Gl ) { vec2 Gm = SMAA_SEARCHTEX_SIZE * vec2 ( 0.5 , - 1.0 ) ; vec2 Gn = SMAA_SEARCHTEX_SIZE * vec2 ( Gl , 1.0 ) ; Gm += vec2 ( - 1.0 , 1.0 ) ; Gn += vec2 ( 0.5 , - 0.5 ) ; Gm *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; Gn *= 1.0 / SMAA_SEARCHTEX_PACKED_SIZE ; return texture2D ( Gj , Gm * Gk + Gn , 0.0 ) . r ; } float Gw ( sampler2D Gp , sampler2D Gq , vec2 Gr , float Gs ) { vec2 Gt = vec2 ( 0.0 , 1.0 ) ; for ( int Gu = 0 ; Gu < SMAA_MAX_SEARCH_STEPS ; Gu ++ ) { if ( Gr . x > Gs && Gt . g > 0.8281 && Gt . r == 0.0 ) { Gt = texture2D ( Gp , Gr , 0.0 ) . rg ; Gr = - vec2 ( 2.0 , 0.0 ) * u_texel_size + Gr ; } } float Gv = - ( 255.0 / 127.0 ) * Go ( Gq , Gt , 0.0 ) + 3.25 ; return u_texel_size . x * Gv + Gr . x ; } float GE ( sampler2D Gx , sampler2D Gy , vec2 Gz , float GA ) { vec2 GB = vec2 ( 0.0 , 1.0 ) ; for ( int GC = 0 ; GC < SMAA_MAX_SEARCH_STEPS ; GC ++ ) { if ( Gz . x < GA && GB . g > 0.8281 && GB . r == 0.0 ) { GB = texture2D ( Gx , Gz , 0.0 ) . rg ; Gz = vec2 ( 2.0 , 0.0 ) * u_texel_size + Gz ; } } float GD = - ( 255.0 / 127.0 ) * Go ( Gy , GB , 0.5 ) + 3.25 ; return - u_texel_size . x * GD + Gz . x ; } float GM ( sampler2D GF , sampler2D GG , vec2 GH , float GI ) { vec2 GJ = vec2 ( 1.0 , 0.0 ) ; for ( int GK = 0 ; GK < SMAA_MAX_SEARCH_STEPS ; GK ++ ) { if ( GH . y > GI && GJ . r > 0.8281 && GJ . g == 0.0 ) { GJ = texture2D ( GF , GH , 0.0 ) . rg ; GH = - vec2 ( 0.0 , 2.0 ) * u_texel_size + GH ; } } float GL = - ( 255.0 / 127.0 ) * Go ( GG , GJ . gr , 0.0 ) + 3.25 ; return u_texel_size . y * GL + GH . y ; } float GU ( sampler2D GN , sampler2D GO , vec2 GP , float GQ ) { vec2 GR = vec2 ( 1.0 , 0.0 ) ; for ( int GS = 0 ; GS < SMAA_MAX_SEARCH_STEPS ; GS ++ ) { if ( GP . y < GQ && GR . r > 0.8281 && GR . g == 0.0 ) { GR = texture2D ( GN , GP , 0.0 ) . rg ; GP = vec2 ( 0.0 , 2.0 ) * u_texel_size + GP ; } } float GT = - ( 255.0 / 127.0 ) * Go ( GO , GR . gr , 0.5 ) + 3.25 ; return - u_texel_size . y * GT + GP . y ; } vec2 Ha ( sampler2D GV , vec2 GW , float GX , float GY , float GZ ) { vec2 G_ = vec2 ( SMAA_AREATEX_MAX_DISTANCE , SMAA_AREATEX_MAX_DISTANCE ) * Fd ( 4.0 * vec2 ( GX , GY ) ) + GW ; G_ = SMAA_AREATEX_PIXEL_SIZE * G_ + 0.5 * SMAA_AREATEX_PIXEL_SIZE ; G_ . y = SMAA_AREATEX_SUBTEX_SIZE * GZ + G_ . y ; return texture2D ( GV , G_ , 0.0 ) . rg ; } void Hi ( sampler2D Hb , inout vec2 Hc , vec4 Hd , vec2 He ) {".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SMAA_DISABLE_CORNER_DETECTION",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"vec2 Hf = step ( He . xy , He . yx ) ; vec2 Hg = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * Hf ; Hg /= Hf . x + Hf . y ; vec2 Hh = vec2 ( 1.0 , 1.0 ) ; Hh . x -= Hg . x * texture2D ( Hb , Hd . xy + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . r ; Hh . x -= Hg . y * texture2D ( Hb , Hd . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . r ; Hh . y -= Hg . x * texture2D ( Hb , Hd . xy + u_texel_size * vec2 ( 0 , - 2 ) , 0.0 ) . r ; Hh . y -= Hg . y * texture2D ( Hb , Hd . zw + u_texel_size * vec2 ( 1 , - 2 ) , 0.0 ) . r ; Hc *= clamp ( Hh , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",tokens:"} void Hq ( sampler2D Hj , inout vec2 Hk , vec4 Hl , vec2 Hm ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_DISABLE_CORNER_DETECTION",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"vec2 Hn = step ( Hm . xy , Hm . yx ) ; vec2 Ho = ( 1.0 - SMAA_CORNER_ROUNDING_NORM ) * Hn ; Ho /= Hn . x + Hn . y ; vec2 Hp = vec2 ( 1.0 , 1.0 ) ; Hp . x -= Ho . x * texture2D ( Hj , Hl . xy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . g ; Hp . x -= Ho . y * texture2D ( Hj , Hl . zw + u_texel_size * vec2 ( 1 , 1 ) , 0.0 ) . g ; Hp . y -= Ho . x * texture2D ( Hj , Hl . xy + u_texel_size * vec2 ( - 2 , 0 ) , 0.0 ) . g ; Hp . y -= Ho . y * texture2D ( Hj , Hl . zw + u_texel_size * vec2 ( - 2 , 1 ) , 0.0 ) . g ; Hk *= clamp ( Hp , 0.0 , 1.0 ) ;".split(" ")}]}}]},
{type:"textline",tokens:["}"]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec4 HJ ( vec2 Hr , vec2 Hs , sampler2D Ht , sampler2D Hu , sampler2D Hv , vec4 Hw ) { vec4 Hx = vec4 ( 0.0 , 0.0 , 0.0 , 0.0 ) ; vec2 Hy = texture2D ( Ht , Hr ) . rg ; if ( Hy . g > 0.0 ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",
places:1}],group:{type:"group",parts:[{type:"textline",tokens:"Hx . rg = Gi ( Ht , Hu , Hr , Hy , Hw ) ; if ( Hx . r == - Hx . g ) {".split(" ")}]}}]},{type:"textline",tokens:"vec2 Hz ; vec3 HA ; HA . x = Gw ( Ht , Hv , EG . xy , EI . x ) ; HA . y = EH . y ; Hz . x = HA . x ; float HB = texture2D ( Ht , HA . xy , 0.0 ) . r ; HA . z = GE ( Ht , Hv , EG . zw , EI . y ) ; Hz . y = HA . z ; Hz = abs ( Fd ( Hz / u_texel_size . xx - Hs . xx ) ) ; vec2 HC = sqrt ( Hz ) ; float HD = texture2D ( Ht , HA . zy + u_texel_size * vec2 ( 1 , 0 ) , 0.0 ) . r ; Hx . rg = Ha ( Hu , HC , HB , HD , Hw . y ) ; HA . y = Hr . y ; Hi ( Ht , Hx . rg , HA . xyzy , Hz ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SMAA_DISABLE_DIAG_DETECTION",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"} else Hy . r = 0.0 ;".split(" ")}]}}]},{type:"textline",tokens:"} if ( Hy . r > 0.0 ) { vec2 HE ; vec3 HF ; HF . y = GM ( Ht , Hv , EH . xy , EI . z ) ; HF . x = EG . x ; HE . x = HF . y ; float HG = texture2D ( Ht , HF . xy , 0.0 ) . g ; HF . z = GU ( Ht , Hv , EH . zw , EI . w ) ; HE . y = HF . z ; HE = abs ( Fd ( HE / u_texel_size . yy - Hs . yy ) ) ; vec2 HH = sqrt ( HE ) ; float HI = texture2D ( Ht , HF . xz + u_texel_size * vec2 ( 0 , 1 ) , 0.0 ) . g ; Hx . ba = Ha ( Hu , HH , HG , HI , Hw . x ) ; HF . x = Hr . x ; Hq ( Ht , Hx . ba , HF . xyxz , HE ) ; } return Hx ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec4 H_ ( vec2 HK , sampler2D HL , sampler2D HM".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",tokens:[",","sampler2D","HN"]}]}}]},{type:"textline",tokens:") { vec4 HO ; HO . x = texture2D ( HM , EF . xy ) . a ; HO . y = texture2D ( HM , EF . zw ) . g ; HO . wz = texture2D ( HM , HK ) . xz ; if ( dot ( HO , vec4 ( 1.0 , 1.0 , 1.0 , 1.0 ) ) < 1e-5 ) { vec4 HP = texture2D ( HL , HK , 0.0 ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",tokens:"vec4 HQ = texture2D ( HN , b_ ) ; vec2 HR = 2.0 * t ( HQ ) - 1.0 ; HP . a = sqrt ( 2.0 * length ( HR ) ) ;".split(" ")}]}}]},{type:"textline",tokens:"return HP ; } else { bool HS = max ( HO . x , HO . z ) > max ( HO . y , HO . w ) ; vec4 HT = vec4 ( 0.0 , HO . y , 0.0 , HO . w ) ; vec2 HU = HO . yw ; EZ ( bvec4 ( HS , HS , HS , HS ) , HT , vec4 ( HO . x , 0.0 , HO . z , 0.0 ) ) ; EZ ( bvec2 ( HS , HS ) , HU , HO . xz ) ; HU /= dot ( HU , vec2 ( 1.0 , 1.0 ) ) ; vec4 HV = HT * vec4 ( u_texel_size , - u_texel_size ) + HK . xyxy ; vec4 HW = HU . x * texture2D ( HL , HV . xy , 0.0 ) ; HW += HU . y * texture2D ( HL , HV . zw , 0.0 ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",tokens:"vec4 HX = texture2D ( HN , HV . xy ) ; vec2 HY = 2.0 * t ( HX ) - 1.0 ; vec2 HZ = HU . x * HY ; HX = texture2D ( HN , HV . zw ) ; HY = 2.0 * t ( HX ) - 1.0 ; HZ += HU . y * HY ; HW . a = sqrt ( 2.0 * length ( HZ ) ) ;".split(" ")}]}}]},{type:"textline",tokens:["return","HW",";","}","}"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec4 Il ( vec2 Ia , sampler2D Ib , sampler2D Ic".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",tokens:[",","sampler2D","Id"]}]}}]},{type:"textline",tokens:[")","{"]},{type:"condition",parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",tokens:"vec4 Ie = texture2D ( Id , b_ ) ; vec2 If ; If = 2.0 * t ( Ie ) - 1.0 ; vec4 Ig = texture2D ( Ib , Ia ) ; vec4 Ih = texture2D ( Ic , Ia - If ) ; float Ii = abs ( Ig . a * Ig . a - Ih . a * Ih . a ) / 2.0 ; float Ij = 0.5 * clamp ( 1.0 - sqrt ( Ii ) * SMAA_REPROJECTION_WEIGHT_SCALE , 0.0 , 1.0 ) ; vec4 Ik = mix ( Ig , Ih , Ij ) ; Ik . a = 1.0 ; return Ik ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec4 Ig = texture2D ( Ib , Ia ) ; vec4 Ih = texture2D ( Ic , Ia ) ; return mix ( Ig , Ih , 0.5 ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:["void","main","(",")","{"]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec4 Im = vec4 ( Fv ( b_ , u_color".split(" ")},{type:"condition",
parts:[{type:"if",expression:["SMAA_PREDICATION"],group:{type:"group",parts:[{type:"textline",tokens:[",","u_predication_tex"]}]}}]},{type:"textline",tokens:") , 0.0 , 0.0 ) ;".split(" ")}]}},{type:"elif",expression:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec4 Im = HJ ( b_ , EJ , u_color , u_area_tex , u_search_tex , u_subsample_indices ) ;".split(" ")}]}},{type:"elif",expression:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec4 Im = H_ ( b_ , u_color , u_blend".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",tokens:[",","u_velocity_tex"]}]}}]},{type:"textline",tokens:[")",";"]}]}},{type:"elif",expression:["SMAA_PASS","SMAA_RESOLVE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec4 Im = vec4 ( Il ( b_ , u_color , u_color_prev".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SMAA_REPROJECTION"],group:{type:"group",parts:[{type:"textline",tokens:[",","u_velocity_tex"]}]}}]},{type:"textline",tokens:[")",")",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec4 Im = texture2D ( u_color , b_ ) ;".split(" ")}]}}]},{type:"textline",tokens:["gl_FragColor","=","Im",";","}"]}]};a["postprocessing/smaa.glslv"]={type:"group",parts:[{type:"define",name:"SMAA_EDGE_DETECTION",tokens:["1"]},{type:"define",name:"SMAA_BLENDING_WEIGHT_CALCULATION",
tokens:["2"]},{type:"define",name:"SMAA_NEIGHBORHOOD_BLENDING",tokens:["3"]},{type:"define",name:"AA_METHOD_SMAA_LOW",tokens:["1"]},{type:"define",name:"AA_METHOD_SMAA_MEDIUM",tokens:["2"]},{type:"define",name:"AA_METHOD_SMAA_HIGH",tokens:["3"]},{type:"define",name:"AA_METHOD_SMAA_ULTRA",tokens:["4"]},{type:"textline",tokens:"attribute vec2 a_position ; uniform vec2 u_texel_size ; varying vec2 b_ ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec4","EF",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"varying vec4 EG ; varying vec4 EH ; varying vec4 EI ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec2","EJ",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["AA_METHOD",
"AA_METHOD_SMAA_LOW",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",tokens:["4"]}]}},{type:"elif",expression:["AA_METHOD","AA_METHOD_SMAA_MEDIUM",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",tokens:["8"]}]}},{type:"elif",expression:["AA_METHOD","AA_METHOD_SMAA_HIGH",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",tokens:["16"]}]}},{type:"elif",
expression:["AA_METHOD","AA_METHOD_SMAA_ULTRA",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",tokens:["32"]}]}}]},{type:"condition",parts:[{type:"ifndef",name:"SMAA_MAX_SEARCH_STEPS",group:{type:"group",parts:[{type:"define",name:"SMAA_MAX_SEARCH_STEPS",tokens:["16"]}]}}]},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"void EK ( vec2 Eo ) { EG = u_texel_size . xyxy * vec4 ( - 1.0 , 0.0 , 0.0 , - 1.0 ) + Eo . xyxy ; EH = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + Eo . xyxy ; EI = u_texel_size . xyxy * vec4 ( - 2.0 , 0.0 , 0.0 , - 2.0 ) + Eo . xyxy ; }".split(" ")}]}},
{type:"elif",expression:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"void EN ( vec2 EL , out vec2 EM ) { EM = EL / u_texel_size ; EG = u_texel_size . xyxy * vec4 ( - 0.25 , - 0.125 , 1.25 , - 0.125 ) + EL . xyxy ; EH = u_texel_size . xyxy * vec4 ( - 0.125 , - 0.25 , - 0.125 , 1.25 ) + EL . xyxy ; EI = u_texel_size . xxyy * vec4 ( - 2.0 , 2.0 , - 2.0 , 2.0 ) * float ( SMAA_MAX_SEARCH_STEPS ) + vec4 ( EG . xz , EH . yw ) ; }".split(" ")}]}},
{type:"elif",expression:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"void EP ( vec2 EO ) { EF = u_texel_size . xyxy * vec4 ( 1.0 , 0.0 , 0.0 , 1.0 ) + EO . xyxy ; }".split(" ")}]}}]},{type:"textline",tokens:"void main ( ) { b_ = 2.0 * a_position ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SMAA_PASS","SMAA_EDGE_DETECTION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["EK",
"(","b_",")",";"]}]}},{type:"elif",expression:["SMAA_PASS","SMAA_BLENDING_WEIGHT_CALCULATION",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"EN ( b_ , EJ ) ;".split(" ")}]}},{type:"elif",expression:["SMAA_PASS","SMAA_NEIGHBORHOOD_BLENDING",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["EP","(","b_",")",";"]}]}}]},{type:"textline",tokens:"gl_Position = vec4 ( 4.0 * ( a_position . xy - 0.25 ) , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao.glslf"]=
{type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"textline",tokens:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"include",file:"depth_fetch.glslf"},{type:"include",file:"procedural.glslf"},{type:"define",name:"SSAO_QUALITY_8",tokens:["1"]},{type:"define",name:"SSAO_QUALITY_16",tokens:["2"]},{type:"define",name:"SSAO_QUALITY_24",tokens:["3"]},{type:"define",name:"SSAO_QUALITY_32",tokens:["4"]},{type:"textline",tokens:"uniform sampler2D u_color ; uniform sampler2D u_depth ; uniform sampler2D u_ssao_special_tex ; uniform vec2 u_camera_range ; uniform vec2 u_texel_size ; varying vec2 b_ ; uniform float u_ssao_radius_increase ; uniform float u_ssao_influence ; uniform float u_ssao_dist_factor ; float EK ( in vec2 Eo ) { return EA ( u_depth , Eo , u_camera_range ) ; } void main ( ) { float EL = texture2D ( u_color , b_ ) . r ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SSAO_WHITE"],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( EL , 1.0 , 0.0 , 1.0 ) ; return ;".split(" ")}]}}]},{type:"textline",tokens:"vec3 EM = normalize ( 2.0 * texture2D ( u_ssao_special_tex , b_ * 0.25 / u_texel_size ) . rgb - 1.0 ) ; float EN = EK ( b_ ) ; float EO = EN * ( u_camera_range . y - u_camera_range . x ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SSAO_QUALITY","SSAO_QUALITY_8",{type:"equal_expr",
places:2}],group:{type:"group",parts:[{type:"textline",tokens:"const float EP = 8.0 ; const int EQ = 1 ;".split(" ")}]}},{type:"elif",expression:["SSAO_QUALITY","SSAO_QUALITY_16",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"const float EP = 16.0 ; const int EQ = 2 ;".split(" ")}]}},{type:"elif",expression:["SSAO_QUALITY","SSAO_QUALITY_24",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"const float EP = 24.0 ; const int EQ = 3 ;".split(" ")}]}},
{type:"elif",expression:["SSAO_QUALITY","SSAO_QUALITY_32",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"const float EP = 32.0 ; const int EQ = 4 ;".split(" ")}]}}]},{type:"textline",tokens:"float ER = u_ssao_radius_increase * 0.001 ; const float ES = 1.0 + 2.4 / EP ; float ET = 0.0 ; for ( int EU = 0 ; EU < EQ ; EU ++ ) for ( int EV = - 1 ; EV <= 1 ; EV += 2 ) for ( int EW = - 1 ; EW <= 1 ; EW += 2 ) for ( int EX = - 1 ; EX <= 1 ; EX += 2 ) { vec3 EY = reflect ( normalize ( vec3 ( EV , EW , EX ) ) , EM ) * ( ER *= ES ) ; vec3 EZ = vec3 ( b_ , EO ) ; EZ += vec3 ( EY . xy , EY . z * EO * 2.0 ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SSAO_HEMISPHERE"],group:{type:"group",parts:[{type:"textline",tokens:"EZ . z -= 1.4 * ( EZ . z - EO ) * step ( EO , EZ . z ) ;".split(" ")}]}}]},{type:"textline",tokens:"float E_ = EK ( EZ . xy ) * ( u_camera_range . y - u_camera_range . x ) ; float Fa = clamp ( ( EO - E_ ) / E_ , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SSAO_HEMISPHERE"],group:{type:"group",parts:[{type:"textline",tokens:"ET += mix ( 1.0 , Fa , step ( E_ , EZ . z ) ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"ET += mix ( step ( EZ . z , E_ ) , 0.5 , Fa ) ;".split(" ")}]}}]},{type:"textline",tokens:"} ET = ET / EP ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SSAO_HEMISPHERE"],group:{type:"group",parts:[{type:"textline",tokens:"ET = clamp ( ET * ET + 0.6 * ET , 0.0 , 1.0 ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"ET = clamp ( ET * ET + ET , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",
tokens:"float Fb = u_ssao_influence * ( 1.0 - u_ssao_dist_factor * EN ) ; ET = mix ( 1.0 , ET , Fb ) ; gl_FragColor = vec4 ( EL , ET , 0.0 , 1.0 ) ; }".split(" ")}]};a["postprocessing/ssao_blur.glslf"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"textline",tokens:["precision","PRECISION","sampler2D",";"]},{type:"include",file:"precision_statement.glslf"},{type:"condition",parts:[{type:"if",expression:["SSAO_BLUR_DEPTH"],group:{type:"group",parts:[{type:"include",file:"depth_fetch.glslf"}]}}]},
{type:"textline",tokens:"uniform sampler2D u_ssao_mask ; uniform vec2 u_texel_size ; varying vec2 b_ ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SSAO_BLUR_DEPTH"],group:{type:"group",parts:[{type:"textline",tokens:"uniform sampler2D u_depth ; uniform vec2 u_camera_range ; uniform float u_ssao_blur_discard_value ; float EK ( in vec2 Eo ) { return EA ( u_depth , Eo , u_camera_range ) ; }".split(" ")}]}}]},{type:"textline",tokens:"void main ( ) { float EL = 0.0 ;".split(" ")},{type:"condition",
parts:[{type:"if",expression:["SSAO_BLUR_DEPTH"],group:{type:"group",parts:[{type:"textline",tokens:"float EM = EK ( b_ ) ; float EN = 0.0 ; float EO = u_ssao_blur_discard_value * 100.0 ;".split(" ")}]}}]},{type:"textline",tokens:"vec2 EP = vec2 ( - 2.0 ) ; for ( int EQ = 0 ; EQ < 4 ; ++ EQ ) { for ( int ER = 0 ; ER < 4 ; ++ ER ) { vec2 ES = ( EP + vec2 ( float ( EQ ) , float ( ER ) ) ) * u_texel_size ; float ET = texture2D ( u_ssao_mask , b_ + ES ) . g ;".split(" ")},{type:"condition",parts:[{type:"if",
expression:["SSAO_BLUR_DEPTH"],group:{type:"group",parts:[{type:"textline",tokens:"float EU = EK ( b_ + ES ) ; float EV = 1.0 - clamp ( abs ( EU - EM ) * EO , 0.0 , 1.0 ) ; EL += ET * EV ; EN += EV ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["EL","+=","ET",";"]}]}}]},{type:"textline",tokens:["}","}"]},{type:"condition",parts:[{type:"if",expression:["SSAO_BLUR_DEPTH"],group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , b_ ) . r , EL / EN , 0.0 , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"gl_FragColor = vec4 ( texture2D ( u_ssao_mask , b_ ) . r , EL / 16.0 , 0.0 , 1.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]};a["postprocessing/velocity.glslf"]={type:"group",parts:[{type:"include",file:"precision_statement.glslf"},{type:"include",file:"pack.glslf"},{type:"textline",tokens:"uniform sampler2D u_depth ; uniform mat4 u_view_proj_inverse ; uniform mat4 u_view_proj_prev ; varying vec2 b_ ; void main ( ) { float Eo = texture2D ( u_depth , b_ ) . x ; vec4 EK = vec4 ( b_ * 2.0 - 1.0 , 2.0 * Eo - 1.0 , 1.0 ) ; vec4 EL = u_view_proj_inverse * EK ; vec4 EM = EL / EL . w ; vec4 EN = u_view_proj_prev * EM ; EN /= EN . w ; vec2 EO = ( EK . xy - EN . xy ) / 4.0 + 0.5 ; EO = clamp ( EO , 0.0 , 1.0 ) ; gl_FragColor = h ( EO ) ; }".split(" ")}]};
a["include/precision_statement.glslf"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"textline",tokens:["precision","PRECISION","float",";"]}]};a["include/std_enums.glsl"]={type:"group",parts:[{type:"define",name:"TEXTURE_COORDS_UV_ORCO",tokens:["1"]},{type:"define",name:"TEXTURE_COORDS_NORMAL",tokens:["2"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MIX",tokens:["1"]},{type:"define",name:"TEXTURE_BLEND_TYPE_MULTIPLY",tokens:["2"]},{type:"define",name:"SHADOW_SRC_NONE",tokens:["1"]},
{type:"define",name:"SHADOW_SRC_DEPTH",tokens:["2"]},{type:"define",name:"SHADOW_SRC_MASK",tokens:["3"]},{type:"define",name:"SHADOW_DST_NONE",tokens:["1"]},{type:"define",name:"SHADOW_DST_DEPTH",tokens:["2"]},{type:"define",name:"SHADOW_DST_MASK",tokens:["3"]},{type:"define",name:"NO_SHADOWS",tokens:["1"]},{type:"define",name:"SHADOW_CASTING",tokens:["2"]},{type:"define",name:"SHADOW_MASK_GENERATION",tokens:["3"]},{type:"define",name:"SHADOW_MAPPING_OPAQUE",tokens:["4"]},{type:"define",name:"SHADOW_MAPPING_BLEND",
tokens:["5"]},{type:"define",name:"SPECULAR_PHONG",tokens:["1"]},{type:"define",name:"SPECULAR_COOKTORR",tokens:["2"]},{type:"define",name:"SPECULAR_WARDISO",tokens:["3"]},{type:"define",name:"SPECULAR_BLINN",tokens:["4"]},{type:"define",name:"SPECULAR_TOON",tokens:["5"]},{type:"define",name:"DIFFUSE_LAMBERT",tokens:["1"]},{type:"define",name:"DIFFUSE_OREN_NAYAR",tokens:["2"]},{type:"define",name:"DIFFUSE_FRESNEL",tokens:["3"]},{type:"define",name:"DIFFUSE_MINNAERT",tokens:["4"]},{type:"define",name:"DIFFUSE_TOON",
tokens:["5"]},{type:"define",name:"MAPPING_TYPE_TEXTURE",tokens:["0.0"]},{type:"define",name:"MAPPING_TYPE_POINT",tokens:["1.0"]},{type:"define",name:"MAPPING_TYPE_VECTOR",tokens:["2.0"]},{type:"define",name:"MAPPING_TYPE_NORMAL",tokens:["3.0"]},{type:"define",name:"MIX",tokens:["0"]},{type:"define",name:"ADD",tokens:["1"]},{type:"define",name:"SUBTRACT",tokens:["2"]},{type:"define",name:"MULTIPLY",tokens:["3"]},{type:"define",name:"SCREEN",tokens:["4"]},{type:"define",name:"OVERLAY",tokens:["5"]},
{type:"define",name:"DIFFERENCE",tokens:["6"]},{type:"define",name:"DIVIDE",tokens:["7"]},{type:"define",name:"DARKEN",tokens:["8"]},{type:"define",name:"LIGHTEN",tokens:["9"]},{type:"define",name:"HUE",tokens:["10"]},{type:"define",name:"SATURATION",tokens:["11"]},{type:"define",name:"VALUE",tokens:["12"]},{type:"define",name:"COLOR",tokens:["13"]},{type:"define",name:"SOFT_LIGHT",tokens:["14"]},{type:"define",name:"LINEAR_LIGHT",tokens:["15"]},{type:"define",name:"REFL_NONE",tokens:["0"]},{type:"define",
name:"REFL_MIRRORMAP",tokens:["1"]},{type:"define",name:"REFL_PLANE",tokens:["2"]},{type:"define",name:"REFL_CUBE",tokens:["3"]},{type:"define",name:"INVERSE_QUADRATIC",tokens:["0"]},{type:"define",name:"LINEAR",tokens:["1"]},{type:"define",name:"QUADRATIC",tokens:["2"]},{type:"define",name:"HEMI",tokens:["1"]},{type:"define",name:"SPOT",tokens:["2"]},{type:"define",name:"POINT",tokens:["3"]},{type:"define",name:"SUN",tokens:["4"]}]};a["include/pack.glslf"]={type:"group",parts:[{type:"textline",tokens:"float a = 255.0 ; float b = 0.0 ; float c = 1.0 ; vec4 h ( const in float d ) { vec4 e = vec4 ( a * a * a , a * a , a , c ) ; vec4 f = vec4 ( b , c / a , c / a , c / a ) ; vec4 g = fract ( d * e ) ; g -= g . xxyz * f ; return g ; } float l ( const in vec4 i ) { float j ; vec4 k = vec4 ( c / ( a * a * a ) , c / ( a * a ) , c / a , c ) ; j = dot ( i , k ) ; return j ; } vec4 h ( const in vec2 m ) { vec2 n = vec2 ( a , c ) ; vec2 o = vec2 ( b , c / a ) ; vec4 p = fract ( m . xxyy * n . xyxy ) ; p -= p . xxzz * o . xyxy ; if ( m . r == c ) p . rg = vec2 ( b , c ) ; if ( m . g == c ) p . ba = vec2 ( b , c ) ; return p ; } vec2 t ( const in vec4 q ) { vec2 r ; vec2 s = vec2 ( c / a , c ) ; r . r = dot ( q . rg , s ) ; r . g = dot ( q . ba , s ) ; return r ; }".split(" ")}]};
a["include/procedural.glslf"]={type:"group",parts:[{type:"textline",tokens:"float u = 0.0 ; float v = 1.0 ; vec4 x ( vec4 w ) { return w - floor ( w * ( v / 289.0 ) ) * 289.0 ; } vec3 x ( vec3 y ) { return y - floor ( y * ( v / 289.0 ) ) * 289.0 ; } vec2 x ( vec2 z ) { return z - floor ( z * ( v / 289.0 ) ) * 289.0 ; } vec4 B ( vec4 A ) { return A - floor ( A * ( v / 7.0 ) ) * 7.0 ; } vec4 D ( vec4 C ) { return x ( ( 34.0 * C + 5.0 ) * C ) ; }".split(" ")},{type:"define",name:"K",tokens:["0.142857142857"]},
{type:"define",name:"K2",tokens:["0.0714285714285"]},{type:"define",name:"JITTER",tokens:["0.7"]},{type:"textline",tokens:"vec2 Q ( vec2 E ) { vec2 F = x ( floor ( E ) ) ; vec2 G = fract ( E ) ; vec4 H = G . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 I = G . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 J = D ( F . x + vec4 ( u , v , u , v ) ) ; J = D ( J + F . y + vec4 ( u , u , v , v ) ) ; vec4 L = B ( J ) * K + K2 ; vec4 M = B ( floor ( J * K ) ) * K + K2 ; vec4 N = H + JITTER * L ; vec4 O = I + JITTER * M ; vec4 P = N * N + O * O ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:[1],group:{type:"group",parts:[{type:"textline",tokens:"P . xy = min ( P . xy , P . zw ) ; P . x = min ( P . x , P . y ) ; return P . xx ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"P . xy = ( P . x < P . y ) ? P . xy : P . yx ; P . xz = ( P . x < P . z ) ? P . xz : P . zx ; P . xw = ( P . x < P . w ) ? P . xw : P . wx ; P . y = min ( P . y , P . z ) ; P . y = min ( P . y , P . w ) ; return sqrt ( P . xy ) ;".split(" ")}]}}]},
{type:"textline",tokens:"} vec3 ae ( vec2 R , float S ) { vec2 T = x ( floor ( R ) ) ; vec2 U = fract ( R ) ; vec4 V = U . x + vec4 ( - 0.5 , - 1.5 , - 0.5 , - 1.5 ) ; vec4 W = U . y + vec4 ( - 0.5 , - 0.5 , - 1.5 , - 1.5 ) ; vec4 X = D ( T . x + vec4 ( u , v , u , v ) ) ; X = D ( X + T . y + vec4 ( u , u , v , v ) ) ; vec4 Y = B ( X ) * K + K2 ; vec4 Z = B ( floor ( X * K ) ) * K + K2 ; vec4 _ = V + JITTER * Y ; vec4 aa = W + JITTER * Z ; vec4 ab = _ * _ + aa * aa ; _ += S ; aa += S ; vec4 ac = _ * _ + aa * aa ; _ += S ; aa += S ; vec4 ad = _ * _ + aa * aa ; ab . xy = min ( ab . xy , ab . zw ) ; ab . x = min ( ab . x , ab . y ) ; ac . xy = min ( ac . xy , ac . zw ) ; ac . x = min ( ac . x , ac . y ) ; ad . xy = min ( ad . xy , ad . zw ) ; ad . x = min ( ad . x , ad . y ) ; return vec3 ( ab . x , ac . x , ad . x ) ; } vec3 ag ( vec3 af ) { return x ( ( ( af * 34.0 ) + v ) * af ) ; } float au ( vec2 ah ) { const vec4 ai = vec4 ( 0.211324865405187 , 0.366025403784439 , - 0.577350269189626 , 0.024390243902439 ) ; vec2 aj = floor ( ah + dot ( ah , ai . yy ) ) ; vec2 ak = ah - aj + dot ( aj , ai . xx ) ; vec2 al ; al = ( ak . x > ak . y ) ? vec2 ( v , u ) : vec2 ( u , v ) ; vec4 am = ak . xyxy + ai . xxzz ; am . xy -= al ; aj = x ( aj ) ; vec3 an = ag ( ag ( aj . y + vec3 ( u , al . y , v ) ) + aj . x + vec3 ( u , al . x , v ) ) ; vec3 ao = max ( 0.5 - vec3 ( dot ( ak , ak ) , dot ( am . xy , am . xy ) , dot ( am . zw , am . zw ) ) , u ) ; ao = ao * ao ; ao = ao * ao ; vec3 ap = 2.0 * fract ( an * ai . www ) - v ; vec3 aq = abs ( ap ) - 0.5 ; vec3 ar = floor ( ap + 0.5 ) ; vec3 as = ap - ar ; ao *= 1.79284291400159 - 0.85373472095314 * ( as * as + aq * aq ) ; vec3 at ; at . x = as . x * ak . x + aq . x * ak . y ; at . yz = as . yz * am . xz + aq . yz * am . yw ; return 130.0 * dot ( ao , at ) ; } vec2 aA ( vec2 av ) { float aw = dot ( av , vec2 ( 12.9898 , 78.233 ) ) ; float ax = dot ( av , vec2 ( 12.9898 , 78.233 ) * 2.0 ) ; float ay = fract ( sin ( aw ) * 43758.5453 ) * 2.0 - v ; float az = fract ( sin ( ax ) * 43758.5453 ) * 2.0 - v ; return vec2 ( ay , az ) ; }".split(" ")}]};
a["include/caustics.glslf"]={type:"group",parts:[{type:"var",name:"CAUST_SPEED",tokens:["vec2","(","0.0",")"]},{type:"var",name:"CAUST_SCALE",tokens:["0.0"]},{type:"var",name:"CAUST_BRIGHT",tokens:["0.0"]},{type:"define",name:"CAUSTICS_VIEW_DISTANCE",tokens:["100.0"]},{type:"textline",tokens:"void aY ( inout vec3 aB , float aC , float aD , float aE , vec3 aF , vec3 aG , vec3 aH , vec4 aI , vec3 aJ , float aK ) { if ( aK > CAUSTICS_VIEW_DISTANCE ) return ; vec4 aL = aI ; vec3 aM = aJ + aF ; aM . xz = 10.0 * sin ( 0.1 * aM . xz ) ; vec3 aN = aM + 2.0 * cross ( - aL . xyz , cross ( - aL . xyz , aM ) + aL . w * aM ) ; vec2 aO = aN . xz ; vec3 aP = aG ; float aQ = max ( dot ( aF , aP ) , 0.0 ) ; float aR = 0.025 ; vec2 aS = CAUST_SPEED * aD ; aO . s += 0.25 * sin ( dot ( aJ + aD , vec3 ( 1.0 ) ) ) ; aO . t += 0.35 * ( - sin ( dot ( aJ - aD , vec3 ( - 0.7 ) ) ) ) ; aO . st += 0.15 * cos ( 4.0 * aC - aS . x ) + 1.5 * sin ( aC - 0.3 * aS . y ) ; float aT = CAUST_SCALE * ( 1.0 + max ( 0.1 * aC , 0.0 ) ) ; vec3 aU = ae ( ( aO / aT ) , aR ) ; aU *= CAUST_BRIGHT ; aU *= aU ; float aV = min ( 0.25 * aC , - aC ) + 1.0 ; aV = max ( aV , 0.0 ) ; float aW = aE * aQ ; float aX = max ( sign ( aC ) , 0.0 ) ; aW = aW + max ( 0.5 * sign ( - aF . y ) * aX , 0.0 ) ; aW = min ( aW , 1.0 ) ; aB += aH * aU * aV * aW ; }".split(" ")}]};
a["include/gamma.glslf"]={type:"group",parts:[{type:"define",name:"GAMMA",tokens:["1"]},{type:"define",name:"PREMULTIPLY_ALPHA",tokens:["1"]},{type:"textline",tokens:"void a_ ( inout vec3 aZ ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["GAMMA"],group:{type:"group",parts:[{type:"textline",tokens:"aZ = max ( vec3 ( 0.0 ) , aZ ) ; aZ = pow ( aZ , vec3 ( 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",tokens:"} void bb ( inout vec3 ba ) {".split(" ")},{type:"condition",parts:[{type:"if",
expression:["GAMMA"],group:{type:"group",parts:[{type:"textline",tokens:"ba = max ( vec3 ( 0.0 ) , ba ) ; ba = pow ( ba , vec3 ( 1.0 / 2.2 ) ) ;".split(" ")}]}}]},{type:"textline",tokens:"} void be ( inout vec3 bc , in float bd ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["PREMULTIPLY_ALPHA"],group:{type:"group",parts:[{type:"textline",tokens:"bc = bc * bd ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]};a["include/math.glslv"]={type:"group",parts:[{type:"var",name:"EPSILON",
tokens:["0.0001"]},{type:"textline",tokens:"float bf = 0.0 ; float bg = 1.0 ; struct bh { vec3 a ; vec3 b ; vec3 c ; vec3 d ; vec3 e ; vec3 f ; } ; bool bk ( vec3 bi , vec3 bj ) { return any ( lessThan ( abs ( bi - bj ) , vec3 ( EPSILON ) ) ) ; } vec3 bn ( in vec4 bl , in vec3 bm ) { return bm + 2.0 * cross ( bl . xyz , cross ( bl . xyz , bm ) + bl . w * bm ) ; } vec4 bp ( in vec4 bo ) { return vec4 ( - bo . xyz , bo . w ) / dot ( bo , bo ) ; } vec3 bu ( vec4 bq , vec4 br , vec4 bs ) { vec3 bt = bs . xyz * bq . w ; bt = bn ( br , bt ) ; bt += bq . xyz * bs . w ; return bt ; } vec3 bA ( vec4 bv , vec4 bw , vec4 bx ) { vec3 by = bx . xyz - bv . xyz * bx . w ; vec4 bz = bp ( bw ) ; by = bn ( bz , by ) ; by /= bv . w ; return by ; } mat4 bB ( ) { return mat4 ( bg , bf , bf , bf , bf , bg , bf , bf , bf , bf , bg , bf , bf , bf , bf , bg ) ; } mat4 bD ( float bC ) { return mat4 ( bg , bf , bf , bf , bf , cos ( bC ) , sin ( bC ) , bf , bf , - sin ( bC ) , cos ( bC ) , bf , bf , bf , bf , bg ) ; } mat4 bF ( float bE ) { return mat4 ( cos ( bE ) , bf , - sin ( bE ) , bf , bf , bg , bf , bf , sin ( bE ) , bf , cos ( bE ) , bf , bf , bf , bf , bg ) ; } mat4 bH ( float bG ) { return mat4 ( cos ( bG ) , sin ( bG ) , bf , bf , - sin ( bG ) , cos ( bG ) , bf , bf , bf , bf , bg , bf , bf , bf , bf , bg ) ; } bh bJ ( in bh bI ) { return bh ( bI . a , bI . b , normalize ( bI . c ) , normalize ( bI . d ) , normalize ( bI . e ) , bI . f ) ; }".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2},"REFRACTIVE","USE_NODE_B4W_REFRACTION",{type:"logical_or_expr",places:4}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 bP ( vec4 bK ) { float bL = bK . x ; float bM = bK . y ; float bN = bK . w ; vec3 bO ; bO . x = ( bL + bN ) / 2.0 ; bO . y = ( bM + bN ) / 2.0 ; bO . z = bN ; return bO ; }".split(" ")}]}}]}]};a["include/shadow.glslf"]=
{type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"var",name:"CSM_BLEND_BETWEEN_CASCADES",tokens:["1.0"]},{type:"var",name:"CSM_FADE_LAST_CASCADE",tokens:["1.0"]},{type:"var",name:"SHADOW_TEX_RES",tokens:["0.0"]},{type:"define",name:"M_PI",tokens:["3.14159265359"]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["vec4","ca",";"]}]}}]},{type:"condition",parts:[{type:"if",
expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"const float cb = 0.1 ; const float cc = 0.1 ; const float cd = - 0.01 ; const float ce = 0.05 ; vec4 cf = vec4 ( 0.14383161 , 0.34495938 , - 0.38277543 , - 0.26496911 ) ; vec4 cg = vec4 ( 0.53742981 , 0.19984126 , 0.79197514 , - 0.094184101 ) ; vec4 ch = vec4 ( - 0.94201624 , - 0.91588581 , - 0.2418884 , 0.44323325 ) ; vec4 ci = vec4 ( - 0.81544232 , 0.94558609 , - 0.81409955 , 0.97484398 ) ; vec4 cj = vec4 ( - 0.1410079 , 0.2938776 , 0.27676845 , - 0.41893023 ) ; vec4 ck = vec4 ( - 0.4737342 , 0.78641367 , 0.19090188 , - 0.9293887 ) ; vec4 cl = vec4 ( - 0.39906216 , 0.45771432 , 0.99706507 , - 0.97511554 ) ; vec4 cm = vec4 ( - 0.87912464 , - 0.76890725 , 0.9143759 , 0.7564837 ) ; bool cp ( vec2 cn , float co ) { return all ( lessThanEqual ( cn , vec2 ( 1.0 + co ) ) ) && all ( greaterThanEqual ( cn , vec2 ( 0.0 - co ) ) ) ; } float cy ( float cq , float cr , mat2 cs , vec3 ct , float cu , PRECISION sampler2D cv ) { vec2 cw , cx ; cx . x = cq ; cx . y = cr ; cx = cs * cx ; cw = ct . xy + cx * cu / SHADOW_TEX_RES ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1",{type:"logic_negative_expr",places:1}],group:{type:"group",parts:[{type:"textline",tokens:"if ( ! cp ( cw , cd ) ) return 1.0 ; else".split(" ")}]}}]},{type:"textline",tokens:"return step ( ct . z , texture2D ( cv , cw ) . r ) ; } void cM ( inout float cz , inout float cA , float cB , float cC , mat2 cD , vec3 cE , vec3 cF , float cG , float cH , PRECISION sampler2D cI , PRECISION sampler2D cJ ) { vec2 cK , cL ; cL . x = cB ; cL . y = cC ; cL = cD * cL ; cK = cE . xy + cL * cG / SHADOW_TEX_RES ; cz += step ( cE . z , texture2D ( cI , cK ) . r ) ; cK = cF . xy + cL * cH / SHADOW_TEX_RES ; cA += step ( cF . z , texture2D ( cJ , cK ) . r ) ; } float cW ( vec3 cN , PRECISION sampler2D cO , float cP ) {".split(" ")},
{type:"condition",parts:[{type:"if",expression:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",parts:[{type:"textline",tokens:"if ( cN . z > u_perspective_cast_far_bound ) return 1.0 ; else {".split(" ")}]}}]},{type:"textline",tokens:"cN . z = clamp ( cN . z , 0.0 , 1.0 ) ; float cQ = 0.0 ; float cR = aA ( cN . xy ) . x * M_PI ; float cS = cos ( cR ) ; float cT = sin ( cR ) ; mat2 cU = mat2 ( cS , cT , - cT , cS ) ; for ( int cV = 0 ; cV < 4 ; cV ++ ) { cQ += cy ( cf [ cV ] , cj [ cV ] , cU , cN , cP , cO ) ; cQ += cy ( cg [ cV ] , ck [ cV ] , cU , cN , cP , cO ) ; cQ += cy ( ch [ cV ] , cl [ cV ] , cU , cN , cP , cO ) ; cQ += cy ( ci [ cV ] , cm [ cV ] , cU , cN , cP , cO ) ; } cQ /= 16.0 ; return clamp ( cQ , 0.0 , 1.0 ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["PERSPECTIVE_SHADOW_CAST"],group:{type:"group",parts:[{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:"return 1.0 ; } float dk ( vec3 cX , PRECISION sampler2D cY , vec3 cZ , PRECISION sampler2D c_ , float da , float db , float dc ) { float dd , de ; cX . z = clamp ( cX . z , 0.0 , 1.0 ) ; cZ . z = clamp ( cZ . z , 0.0 , 1.0 ) ; dd = 0.0 ; de = 0.0 ; float df = aA ( cX . xy ) . x * M_PI ; float dg = cos ( df ) ; float dh = sin ( df ) ; mat2 di = mat2 ( dg , dh , - dh , dg ) ; for ( int dj = 0 ; dj < 4 ; dj ++ ) { cM ( dd , de , cf [ dj ] , cj [ dj ] , di , cX , cZ , da , db , cY , c_ ) ; cM ( dd , de , cg [ dj ] , ck [ dj ] , di , cX , cZ , da , db , cY , c_ ) ; cM ( dd , de , ch [ dj ] , cl [ dj ] , di , cX , cZ , da , db , cY , c_ ) ; cM ( dd , de , ci [ dj ] , cm [ dj ] , di , cX , cZ , da , db , cY , c_ ) ; } dd = mix ( dd , de , dc ) ; dd /= 16.0 ; return clamp ( dd , 0.0 , 1.0 ) ; } float dp ( vec2 dl ) { float dm = min ( dl . x , dl . y ) ; float dn = min ( 1.0 - dl . x , 1.0 - dl . y ) ; return min ( dm , dn ) ; } float ds ( float dq , float dr ) { if ( dr >= 0.0 && dr <= cc ) dq = ( dq - 1.0 ) / cc * dr + 1.0 ; return dq ; } float dE ( vec3 dt , vec3 du , PRECISION sampler2D dv , PRECISION sampler2D dw , float dx , float dy , float dz , float dA ) { float dB ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["CSM_BLEND_BETWEEN_CASCADES"],group:{type:"group",parts:[{type:"textline",tokens:"float dC = dp ( dt . xy ) ; if ( - dA > dz && dC >= 0.0 && dC <= cb && cp ( du . xy , 0.0 ) ) { float dD = 1.0 - dC / cb ; dB = dk ( dt , dv , du , dw , dx , dy , dD ) ; } else".split(" ")}]}}]},{type:"textline",tokens:"dB = cW ( dt , dv , dx ) ; return dB ; } float dM ( vec3 dF , PRECISION sampler2D dG , float dH , float dI , float dJ ) { float dK = cW ( dF , dG , dH ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["CSM_FADE_LAST_CASCADE"],group:{type:"group",parts:[{type:"textline",tokens:"if ( - dJ > dI ) { float dL = dp ( dF . xy ) ; dK = ds ( dK , dL ) ; }".split(" ")}]}}]},{type:"textline",tokens:"return dK ; } float dT ( float dN ) { float dO = 1.0 ; vec3 dP = bW . xyz / bW . w ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 dQ = bX . xyz / bX . w ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 dR = bY . xyz / bY . w ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 dS = bZ . xyz / bZ . w ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:"if ( cp ( dP . xy , 0.0 ) ) { dO = dE ( dP , dQ , u_shadow_map0 , u_shadow_map1 , u_pcf_blur_radii [ 0 ] , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 0 ] , dN ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"if ( cp ( dP . xy , ce ) ) { dO = dM ( dP , u_shadow_map0 , u_pcf_blur_radii [ 0 ] , u_csm_center_dists [ 0 ] , dN ) ; }".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:"else { if ( cp ( dQ . xy , 0.0 ) ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:"dO = dE ( dQ , dR , u_shadow_map1 , u_shadow_map2 , u_pcf_blur_radii [ 1 ] , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 1 ] , dN ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"dO = dM ( dQ , u_shadow_map1 , u_pcf_blur_radii [ 1 ] , u_csm_center_dists [ 1 ] , dN ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:"else { if ( cp ( dR . xy , 0.0 ) ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:"dO = dE ( dR , dS , u_shadow_map2 , u_shadow_map3 , u_pcf_blur_radii [ 2 ] , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 2 ] , dN ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"dO = dM ( dR , u_shadow_map2 , u_pcf_blur_radii [ 2 ] , u_csm_center_dists [ 2 ] , dN ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:"else { if ( cp ( dS . xy , 0.0 ) ) dO = dM ( dS , u_shadow_map3 , u_pcf_blur_radii [ 3 ] , u_csm_center_dists [ 3 ] , dN ) ; }".split(" ")}]}}]},{type:"textline",tokens:["}"]}]}}]},
{type:"textline",tokens:["}"]}]}}]},{type:"textline",tokens:["return","dO",";","}"]}]}}]},{type:"textline",tokens:"float dY ( inout vec3 dU ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MAPPING_OPAQUE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec2 dV = texture2DProj ( u_shadow_mask , bU ) . rg ; vec3 dW = vec3 ( dV . r ) ; float dX = dV . g ; ca = vec4 ( dW , dX ) ; dU *= ca . a ; return ca . r ;".split(" ")}]}},{type:"elif",
expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"return dT ( bR . z ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["return","1.0",";"]}]}}]},{type:"textline",tokens:["}"]}]};a["include/mirror.glslf"]={type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE",
"REFL_PLANE",{type:"equal_expr",places:2},"REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2},"REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2},{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"define",name:"REFL_BUMP",tokens:["0.1"]},{type:"textline",tokens:"float ef ( in vec3 dZ , vec3 d_ , float ea , float eb ) { vec3 ec = normalize ( d_ + dZ ) ; float ed = 1.0 - dot ( dZ , ec ) ; float ee = eb + ( 1.0 - eb ) * pow ( ed , ea ) ; return ee ; } void et ( inout vec3 eg , vec3 eh , vec3 ei , float ej ) { vec3 ek = reflect ( - eh , ei ) ; float el = u_fresnel_params [ 2 ] ; float em = u_fresnel_params [ 3 ] ; float en = 1.0 ; if ( el != 0.0 ) en = ef ( eh , ek , el , em ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["REFLECTION_TYPE","REFL_CUBE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 eo = textureCube ( u_cube_reflection , ek ) . xyz ;".split(" ")}]}},{type:"elif",expression:["REFLECTION_TYPE","REFL_PLANE",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 ep = u_refl_plane . xyz * dot ( ei , u_refl_plane . xyz ) ; vec3 eq = ei - ep ; vec2 er = ( u_view_matrix_frag * vec4 ( eq , 0.0 ) ) . xy ; vec2 es = bU . xy / bU . z ; es += er * REFL_BUMP ; vec3 eo = texture2D ( u_plane_reflection , es ) . rgb ;".split(" ")}]}},
{type:"elif",expression:["REFLECTION_TYPE","REFL_MIRRORMAP",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 eo = textureCube ( u_mirrormap , ek ) . xyz ; ej = u_mirror_factor ;".split(" ")}]}}]},{type:"textline",tokens:"a_ ( eo . rgb ) ; eg = mix ( eg , eo , ej * en ) ; }".split(" ")}]}}]}]};a["include/environment.glslf"]={type:"group",parts:[{type:"textline",tokens:"vec3 ew ( vec3 eu ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_ENVIRONMENT_LIGHT"],
group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["SKY_TEXTURE"],group:{type:"group",parts:[{type:"textline",tokens:"return textureCube ( u_sky_texture , eu ) . rgb ;".split(" ")}]}},{type:"elif",expression:["SKY_COLOR"],group:{type:"group",parts:[{type:"textline",tokens:"float ev = 0.5 * eu . y + 0.5 ; return mix ( u_horizon_color , u_zenith_color , ev ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"return vec3 ( 1.0 ) ;".split(" ")}]}}]}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"return vec3 ( 0.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]};a["include/refraction.glslf"]={type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["REFRACTIVE"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_REFRACTION_CORRECTION"],group:{type:"group",parts:[{type:"textline",tokens:"float eC ( in float ex , inout vec2 ey , in vec2 ez ) { vec4 eA = texture2D ( u_scene_depth , ey ) ; float eB = l ( eA ) ; if ( eB < bV ) { ey = ez ; return ex ; } else { return eB ; } return ex ; }".split(" ")}]}}]},
{type:"textline",tokens:"vec3 eK ( in vec3 eD , in vec2 eE ) { vec2 eF = eD . xy / eD . z ; vec2 eG = eF + eE ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_REFRACTION_CORRECTION"],group:{type:"group",parts:[{type:"textline",tokens:"vec4 eH = texture2DProj ( u_scene_depth , eD ) ; float eI = l ( eH ) ; eC ( eI , eG , eF ) ;".split(" ")}]}}]},{type:"textline",tokens:"vec3 eJ = texture2D ( u_refractmap , eG ) . rgb ; a_ ( eJ ) ; return eJ ; }".split(" ")}]}}]}]};a["include/nodes.glslf"]=
{type:"group",parts:[{type:"var",name:"MAPPING_TRS_MATRIX",tokens:["mat4","(","0.0",")"]},{type:"var",name:"MAPPING_SCALE",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_TRANSLATION",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MIN_CLIP",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_MAX_CLIP",tokens:["vec3","(","0.0",")"]},{type:"var",name:"MAPPING_IS_NORMAL",tokens:["0.0"]},{type:"var",name:"RGB_IND",tokens:["0"]},{type:"var",name:"VALUE_IND",tokens:["0"]},{type:"var",
name:"LAMP_INDEX",tokens:["0"]},{type:"var",name:"NUM_LIGHTS",tokens:["0"]},{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"define",name:"M_PI",tokens:["3.14159265359"]},{type:"condition",parts:[{type:"if",
expression:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["varying","vec3","eL",";"]}]}}]},{type:"textline",tokens:"float ZERO_VALUE_NODES = 0.0 ; float UNITY_VALUE_NODES = 1.0 ; float eM = 0.5 ; vec3 eN = vec3 ( ZERO_VALUE_NODES ) ; vec3 eO = vec3 ( UNITY_VALUE_NODES ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_NODE_B4W_REFRACTION"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 eS ( in vec3 eP , in float eQ ) { vec3 eR = eN ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["USE_REFRACTION"],group:{type:"group",parts:[{type:"textline",tokens:"eR = eK ( bU , eP . xz * eQ ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"eR = texture2D ( u_refractmap , bU . xy / bU . z ) . rgb ; a_ ( eR ) ;".split(" ")}]}}]},{type:"textline",tokens:["return","eR",";","}"]}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE",
"USE_NODE_MIX_RGB_COLOR","USE_NODE_SEPHSV",{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 eZ ( vec3 eT ) { vec4 eU = vec4 ( ZERO_VALUE_NODES , - UNITY_VALUE_NODES / 3.0 , 2.0 / 3.0 , - UNITY_VALUE_NODES ) ; vec4 eV = mix ( vec4 ( eT . bg , eU . wz ) , vec4 ( eT . gb , eU . xy ) , step ( eT . b , eT . g ) ) ; vec4 eW = mix ( vec4 ( eV . xyw , eT . r ) , vec4 ( eT . r , eV . yzx ) , step ( eV . x , eT . r ) ) ; float eX = eW . x - min ( eW . w , eW . y ) ; float eY = 1.0e-10 ; return vec3 ( abs ( eW . z + ( eW . w - eW . y ) / ( 6.0 * eX + eY ) ) , eX / ( eW . x + eY ) , eW . x ) ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_HUE_SAT","USE_NODE_MIX_RGB_HUE","USE_NODE_MIX_RGB_SATURATION","USE_NODE_MIX_RGB_VALUE","USE_NODE_MIX_RGB_COLOR","USE_NODE_COMBHSV",{type:"logical_or_expr",places:6}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 fc ( vec3 e_ ) { vec4 fa = vec4 ( UNITY_VALUE_NODES , 2.0 / 3.0 , UNITY_VALUE_NODES / 3.0 , 3.0 ) ; vec3 fb = abs ( fract ( vec3 ( e_ . r , e_ . r , e_ . r ) + fa . xyz ) * 6.0 - fa . www ) ; return e_ . b * mix ( fa . xxx , clamp ( fb - fa . xxx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) , e_ . g ) ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_GEOMETRY_UV","USE_NODE_B4W_PARALLAX","USE_NODE_UV_MERGED",{type:"logical_or_expr",places:3}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 fe ( vec2 fd ) { return vec3 ( fd * 2.0 - vec2 ( UNITY_VALUE_NODES , UNITY_VALUE_NODES ) , ZERO_VALUE_NODES ) ; }".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_TEXTURE_COLOR","USE_NODE_TEXTURE_NORMAL","USE_NODE_B4W_PARALLAX",{type:"logical_or_expr",places:3}],group:{type:"group",
parts:[{type:"textline",tokens:"vec2 fg ( vec3 ff ) { return vec2 ( ff . xy * 0.5 + vec2 ( 0.5 , 0.5 ) ) ; }".split(" ")}]}}]},{type:"node",name:"CAMERA",declarations:[{type:"node_out",name:"fL",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"fM",qualifier:["float"],is_optional:!0},{type:"node_out",name:"fN",qualifier:["float"],is_optional:!0}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_fL"],statements:[{type:"textline",tokens:"fL = normalize ( fI . xyz ) ;".split(" ")}]}]},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_fM"],statements:[{type:"textline",tokens:"fM = abs ( fI . z ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_fN"],statements:[{type:"textline",tokens:"fN = length ( fI . xyz ) ;".split(" ")}]}]}]},{type:"node",name:"COMBRGB",declarations:[{type:"node_in",name:"fO",qualifier:["float"],is_optional:!1},{type:"node_in",name:"fP",qualifier:["float"],is_optional:!1},{type:"node_in",name:"fQ",qualifier:["float"],
is_optional:!1},{type:"node_out",name:"fR",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fR = vec3 ( fO , fP , fQ ) ;".split(" ")}]},{type:"node",name:"COMBHSV",declarations:[{type:"node_in",name:"fS",qualifier:["float"],is_optional:!1},{type:"node_in",name:"fT",qualifier:["float"],is_optional:!1},{type:"node_in",name:"fU",qualifier:["float"],is_optional:!1},{type:"node_out",name:"fV",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fV = fc ( vec3 ( fS , fT , fU ) ) ;".split(" ")}]},
{type:"node",name:"EMPTY_UV",declarations:[{type:"node_out",name:"fW",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fW = vec3 ( - 1.0 , - 1.0 , 0.0 ) ;".split(" ")}]},{type:"node",name:"EMPTY_VC",declarations:[{type:"node_out",name:"fX",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["fX","=","eN",";"]}]},{type:"node",name:"GEOMETRY_UV",declarations:[{type:"node_out",name:"fY",qualifier:["vec3"],is_optional:!1},{type:"node_param",name:"fh",qualifier:["varying",
"vec2"]}],statements:[{type:"textline",tokens:"fY = fe ( fh ) ;".split(" ")}]},{type:"node",name:"GEOMETRY_OR",declarations:[{type:"node_out",name:"fZ",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"fZ = 2.0 * eL - eO ;".split(" ")}]},{type:"node",name:"GEOMETRY_VC",declarations:[{type:"node_out",name:"f_",qualifier:["vec3"],is_optional:!1},{type:"node_param",name:"fi",qualifier:["varying","vec3"]}],statements:[{type:"textline",tokens:["f_","=","fi",";"]}]},{type:"node",
name:"GEOMETRY_VC1",declarations:[{type:"node_out",name:"ga",qualifier:["float"],is_optional:!1},{type:"node_param",name:"fj",qualifier:["varying","float"]}],statements:[{type:"textline",tokens:["ga","=","fj",";"]}]},{type:"node",name:"GEOMETRY_VC2",declarations:[{type:"node_out",name:"gb",qualifier:["float"],is_optional:!1},{type:"node_out",name:"gc",qualifier:["float"],is_optional:!1},{type:"node_param",name:"fk",qualifier:["varying","vec2"]}],statements:[{type:"textline",tokens:"gb = fk [ 0 ] ; gc = fk [ 1 ] ;".split(" ")}]},
{type:"node",name:"GEOMETRY_VC3",declarations:[{type:"node_out",name:"gd",qualifier:["float"],is_optional:!1},{type:"node_out",name:"ge",qualifier:["float"],is_optional:!1},{type:"node_out",name:"gf",qualifier:["float"],is_optional:!1},{type:"node_param",name:"fl",qualifier:["varying","vec3"]}],statements:[{type:"textline",tokens:"gd = fl [ 0 ] ; ge = fl [ 1 ] ; gf = fl [ 2 ] ;".split(" ")}]},{type:"node",name:"GEOMETRY_NO",declarations:[{type:"node_out",name:"gg",qualifier:["vec3"],is_optional:!1}],
statements:[{type:"textline",tokens:["gg","=","fD",";"]}]},{type:"node",name:"GEOMETRY_FB",declarations:[{type:"node_out",name:"gh",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"gh = ( gl_FrontFacing ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"GEOMETRY_VW",declarations:[{type:"node_out",name:"gi",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["gi","=","fu",";"]}]},{type:"node",name:"GEOMETRY_LO",declarations:[{type:"node_out",
name:"gj",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"gj [ 0 ] = fI [ 0 ] ; gj [ 1 ] = fI [ 1 ] ; gj [ 2 ] = fI [ 2 ] ;".split(" ")}]},{type:"node",name:"GEOMETRY_GL",declarations:[{type:"node_out",name:"gk",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"gk = vec3 ( fH . r , - fH . b , fH . g ) ;".split(" ")}]},{type:"node",name:"NEW_GEOMETRY",declarations:[{type:"node_out",name:"gl",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gm",
qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gn",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"go",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gp",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gq",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gr",qualifier:["float"],is_optional:!1},{type:"node_out",name:"gs",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"gl = eN ; gm = eN ; gn = eN ; go = eN ; gp = eN ; gq = eN ; gr = ZERO_VALUE_NODES ; gs = ZERO_VALUE_NODES ;".split(" ")}]},
{type:"node",name:"HUE_SAT",declarations:[{type:"node_in",name:"gt",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gu",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gv",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gw",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gx",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gy",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"vec3 gz = eZ ( gx ) ; gz [ 0 ] += ( gt - 0.5 ) ; if ( gz [ 0 ] > UNITY_VALUE_NODES ) gz [ 0 ] -= UNITY_VALUE_NODES ; else if ( gz [ 0 ] < ZERO_VALUE_NODES ) gz [ 0 ] += UNITY_VALUE_NODES ; gz *= vec3 ( UNITY_VALUE_NODES , gu , gv ) ; gz = mix ( eO , mix ( eN , gz , step ( eN , gz ) ) , step ( gz , eO ) ) ; gy = mix ( gx , fc ( gz ) , gw ) ;".split(" ")}]},
{type:"node",name:"INVERT",declarations:[{type:"node_in",name:"gA",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gB",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gC",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"gC = mix ( gB , eO - gB , gA ) ;".split(" ")}]},{type:"node",name:"LAMP",declarations:[{type:"node_out",name:"gD",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"gE",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gF",
qualifier:["float"],is_optional:!1},{type:"node_out",name:"gG",qualifier:["float"],is_optional:!0}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_gD"],statements:[{type:"textline",tokens:"gD = u_lamp_light_color_intensities [ LAMP_INDEX ] ;".split(" ")}]}]},{type:"textline",tokens:"vec4 gH = u_lamp_light_factors [ LAMP_INDEX ] ; vec3 gI = u_lamp_light_directions [ LAMP_INDEX ] ; vec3 gJ = u_lamp_light_positions [ LAMP_INDEX ] ; float gK = gH . z ; if ( gK != - UNITY_VALUE_NODES ) {".split(" ")},
{type:"textline",tokens:"gE = gJ - bQ ; gF = length ( gE ) ; gE = normalize ( gE ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_gG"],statements:[{type:"textline",tokens:"gG = gK / ( gK + gF * gF ) ; float gL = gH . x ; float gM = gH . y ; if ( gL > - UNITY_VALUE_NODES ) { float gN = dot ( gE , gI ) ; gN *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( gN - gL ) / gM ) ; gG *= gN ; }".split(" ")}]}]},{type:"textline",tokens:["}","else","{"]},{type:"node_condition",
parts:[{type:"node_if",expression:["USE_OUT_gE"],statements:[{type:"textline",tokens:["gE","=","gI",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_gF"],statements:[{type:"textline",tokens:"gF = length ( gJ - bQ ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_gG"],statements:[{type:"textline",tokens:["gG","=","UNITY_VALUE_NODES",";"]}]}]},{type:"textline",tokens:["}"]}]},{type:"node",name:"NORMAL",declarations:[{type:"node_in",name:"gO",
qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gP",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"gQ",qualifier:["float"],is_optional:!0},{type:"node_param",name:"fm",qualifier:["vec3"]}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_gP"],statements:[{type:"textline",tokens:["gP","=","fm",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_gQ"],statements:[{type:"textline",tokens:"gQ = - dot ( gO , fm ) ;".split(" ")}]}]}]},
{type:"node",name:"B4W_VECTOR_VIEW",declarations:[{type:"node_in",name:"gR",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gS",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"gS = - ( u_view_matrix_frag * vec4 ( gR , ZERO_VALUE_NODES ) ) . xyz ;".split(" ")}]},{type:"node",name:"BSDF_ANISOTROPIC",declarations:[{type:"node_in",name:"gT",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"gU",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gV",qualifier:["float"],
is_optional:!1},{type:"node_in",name:"gW",qualifier:["float"],is_optional:!1},{type:"node_in",name:"gX",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"gY",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"gZ",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["gZ","=","gT",";"]},{type:"textline",tokens:"gU ; gV ; gW ; gX ; gY ;".split(" ")}]},{type:"node",name:"BSDF_DIFFUSE",declarations:[{type:"node_in",name:"g_",qualifier:["vec3"],is_optional:!1},{type:"node_in",
name:"ha",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hb",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"hc",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["hc","=","g_",";"]},{type:"textline",tokens:["ha",";","hb",";"]}]},{type:"node",name:"BSDF_GLASS",declarations:[{type:"node_in",name:"hd",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"he",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hf",qualifier:["float"],is_optional:!1},
{type:"node_in",name:"hg",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"hh",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["hh","=","hd",";"]},{type:"textline",tokens:"he ; hf ; hg ;".split(" ")}]},{type:"node",name:"BSDF_GLOSSY",declarations:[{type:"node_in",name:"hi",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"hj",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hk",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"hl",qualifier:["vec3"],
is_optional:!1}],statements:[{type:"textline",tokens:["hl","=","hi",";"]},{type:"textline",tokens:["hj",";","hk",";"]}]},{type:"node",name:"BSDF_HAIR",declarations:[{type:"node_in",name:"hm",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"hn",qualifier:["float"],is_optional:!1},{type:"node_in",name:"ho",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hp",qualifier:["float"],is_optional:!1},{type:"node_out",name:"hq",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:["hq","=","hm",";"]},{type:"textline",tokens:"hn ; ho ; hp ;".split(" ")}]},{type:"node",name:"BSDF_TRANSPARENT",declarations:[{type:"node_in",name:"hr",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"hs",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["hs","=","hr",";"]}]},{type:"node",name:"BSDF_TRANSLUCENT",declarations:[{type:"node_in",name:"ht",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"hu",qualifier:["vec3"],is_optional:!1},{type:"node_out",
name:"hv",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["hv","=","ht",";"]},{type:"textline",tokens:["hu",";"]}]},{type:"node",name:"BSDF_REFRACTION",declarations:[{type:"node_in",name:"hw",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"hx",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hy",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hz",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"hA",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"hA [ 0 ] = hA [ 1 ] = hA [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"hw ; hx ; hy ; hz ;".split(" ")}]},{type:"node",name:"BSDF_TOON",declarations:[{type:"node_in",name:"hB",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"hC",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hD",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hE",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"hF",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:["hF","=","hB",";"]},{type:"textline",tokens:"hC ; hD ; hE ;".split(" ")}]},{type:"node",name:"BSDF_VELVET",declarations:[{type:"node_in",name:"hG",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"hH",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hI",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"hJ",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["hJ","=","hG",";"]},{type:"textline",tokens:["hH",";","hI",";"]}]},{type:"node",name:"SUBSURFACE_SCATTERING",
declarations:[{type:"node_in",name:"hK",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"hL",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hM",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"hN",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hO",qualifier:["float"],is_optional:!1},{type:"node_in",name:"hP",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"hQ",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"hQ [ 0 ] = hQ [ 1 ] = hQ [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},
{type:"textline",tokens:"hK ; hM ; hN ; hO ; hP ; hL ;".split(" ")}]},{type:"node",name:"EMISSION",declarations:[{type:"node_in",name:"hR",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"hS",qualifier:["float"],is_optional:!1},{type:"node_out",name:"hT",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["hT","=","hR",";"]},{type:"textline",tokens:["hS",";"]}]},{type:"node",name:"AMBIENT_OCCLUSION",declarations:[{type:"node_in",name:"hU",qualifier:["vec3"],is_optional:!1},
{type:"node_out",name:"hV",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"hV [ 0 ] = hV [ 1 ] = hV [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["hU",";"]}]},{type:"node",name:"HOLDOUT",declarations:[{type:"node_out",name:"hW",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"hW [ 0 ] = hW [ 1 ] = hW [ 2 ] = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"VOLUME_ABSORPTION",declarations:[{type:"node_in",name:"hX",qualifier:["vec3"],
is_optional:!1},{type:"node_in",name:"hY",qualifier:["float"],is_optional:!1},{type:"node_out",name:"hZ",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"hZ [ 0 ] = hZ [ 1 ] = hZ [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["hX",";","hY",";"]}]},{type:"node",name:"VOLUME_SCATTER",declarations:[{type:"node_in",name:"h_",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ia",qualifier:["float"],is_optional:!1},{type:"node_in",name:"ib",qualifier:["float"],
is_optional:!1},{type:"node_out",name:"ic",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"ic [ 0 ] = ic [ 1 ] = ic [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"h_ ; ia ; ib ;".split(" ")}]},{type:"node",name:"BUMP",declarations:[{type:"node_in",name:"id",qualifier:["float"],is_optional:!1},{type:"node_in",name:"ie",qualifier:["float"],is_optional:!1},{type:"node_in",name:"ig",qualifier:["float"],is_optional:!1},{type:"node_in",name:"ih",qualifier:["vec3"],
is_optional:!1},{type:"node_out",name:"ii",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["ii","=","ih",";"]},{type:"textline",tokens:"id ; ie ; ig ;".split(" ")}]},{type:"node",name:"NORMAL_MAP",declarations:[{type:"node_in",name:"ij",qualifier:["float"],is_optional:!1},{type:"node_in",name:"ik",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"il",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["il","=","ik",";"]},{type:"textline",tokens:["ij",
";"]}]},{type:"node",name:"VECT_TRANSFORM",declarations:[{type:"node_in",name:"im",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"io",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"io [ 0 ] = io [ 1 ] = io [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["im",";"]}]},{type:"node",name:"BLACKBODY",declarations:[{type:"node_in",name:"ip",qualifier:["float"],is_optional:!1},{type:"node_out",name:"iq",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"iq [ 0 ] = iq [ 1 ] = iq [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["ip",";"]}]},{type:"node",name:"WAVELENGTH",declarations:[{type:"node_in",name:"ir",qualifier:["float"],is_optional:!1},{type:"node_out",name:"is",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"is [ 0 ] = is [ 1 ] = is [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["ir",";"]}]},{type:"node",name:"SEPXYZ",declarations:[{type:"node_in",name:"it",qualifier:["vec3"],
is_optional:!1},{type:"node_out",name:"iu",qualifier:["float"],is_optional:!1},{type:"node_out",name:"iv",qualifier:["float"],is_optional:!1},{type:"node_out",name:"iw",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"iu = it [ 0 ] ; iv = it [ 1 ] ; iw = it [ 2 ] ;".split(" ")}]},{type:"node",name:"COMBXYZ",declarations:[{type:"node_in",name:"ix",qualifier:["float"],is_optional:!1},{type:"node_in",name:"iy",qualifier:["float"],is_optional:!1},{type:"node_in",name:"iz",qualifier:["float"],
is_optional:!1},{type:"node_out",name:"iA",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"iA [ 0 ] = ix ; iA [ 1 ] = iy ; iA [ 2 ] = iz ;".split(" ")}]},{type:"node",name:"BRIGHTCONTRAST",declarations:[{type:"node_in",name:"iB",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"iC",qualifier:["float"],is_optional:!1},{type:"node_in",name:"iD",qualifier:["float"],is_optional:!1},{type:"node_out",name:"iE",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"float iF = iC - iD * 0.5 ; iE = max ( ( UNITY_VALUE_NODES + iD ) * iB + iF , eN ) ;".split(" ")}]},{type:"node",name:"LIGHT_FALLOFF",declarations:[{type:"node_in",name:"iG",qualifier:["float"],is_optional:!1},{type:"node_in",name:"iH",qualifier:["float"],is_optional:!1},{type:"node_out",name:"iI",qualifier:["float"],is_optional:!1},{type:"node_out",name:"iJ",qualifier:["float"],is_optional:!1},{type:"node_out",name:"iK",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"iI = iJ = iK = ZERO_VALUE_NODES ;".split(" ")},
{type:"textline",tokens:["iG",";","iH",";"]}]},{type:"node",name:"TEX_IMAGE",declarations:[{type:"node_in",name:"iL",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"iM",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"iN",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"iM [ 0 ] = iM [ 1 ] = iM [ 2 ] = ZERO_VALUE_NODES ; iN = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["iL",";"]}]},{type:"node",name:"TEX_ENVIRONMENT",declarations:[{type:"node_in",
name:"iO",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"iP",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"iP [ 0 ] = iP [ 1 ] = iP [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["iO",";"]}]},{type:"node",name:"TEX_SKY",declarations:[{type:"node_in",name:"iQ",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"iR",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"iR [ 0 ] = iR [ 1 ] = iR [ 2 ] = ZERO_VALUE_NODES ;".split(" ")},
{type:"textline",tokens:["iQ",";"]}]},{type:"node",name:"TEX_NOISE",declarations:[{type:"node_in",name:"iS",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"iT",qualifier:["float"],is_optional:!1},{type:"node_in",name:"iU",qualifier:["float"],is_optional:!1},{type:"node_in",name:"iV",qualifier:["float"],is_optional:!1},{type:"node_out",name:"iW",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"iX",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"iW [ 0 ] = iW [ 1 ] = iW [ 2 ] = ZERO_VALUE_NODES ; iX = UNITY_VALUE_NODES ;".split(" ")},
{type:"textline",tokens:"iS ; iT ; iU ; iV ;".split(" ")}]},{type:"node",name:"TEX_WAVE",declarations:[{type:"node_in",name:"iY",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"iZ",qualifier:["float"],is_optional:!1},{type:"node_in",name:"i_",qualifier:["float"],is_optional:!1},{type:"node_in",name:"ja",qualifier:["float"],is_optional:!1},{type:"node_in",name:"jb",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jc",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"jd",
qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"jc [ 0 ] = jc [ 1 ] = jc [ 2 ] = ZERO_VALUE_NODES ; jd = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"iY ; iZ ; i_ ; ja ; jb ;".split(" ")}]},{type:"node",name:"TEX_VORONOI",declarations:[{type:"node_in",name:"je",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"jf",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jg",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"jh",qualifier:["float"],
is_optional:!1}],statements:[{type:"textline",tokens:"jg [ 0 ] = jg [ 1 ] = jg [ 2 ] = ZERO_VALUE_NODES ; jh = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["je",";","jf",";"]}]},{type:"node",name:"TEX_MUSGRAVE",declarations:[{type:"node_in",name:"ji",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"jj",qualifier:["float"],is_optional:!1},{type:"node_in",name:"jk",qualifier:["float"],is_optional:!1},{type:"node_in",name:"jl",qualifier:["float"],is_optional:!1},{type:"node_in",
name:"jm",qualifier:["float"],is_optional:!1},{type:"node_in",name:"jn",qualifier:["float"],is_optional:!1},{type:"node_in",name:"jo",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jp",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"jq",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"jp [ 0 ] = jp [ 1 ] = jp [ 2 ] = ZERO_VALUE_NODES ; jq = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"ji ; jj ; jk ; jl ; jm ; jn ; jo ;".split(" ")}]},{type:"node",
name:"TEX_GRADIENT",declarations:[{type:"node_in",name:"jr",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"js",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"jt",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"js [ 0 ] = js [ 1 ] = js [ 2 ] = ZERO_VALUE_NODES ; jt = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["jr",";"]}]},{type:"node",name:"TEX_MAGIC",declarations:[{type:"node_in",name:"ju",qualifier:["vec3"],is_optional:!1},{type:"node_in",
name:"jv",qualifier:["float"],is_optional:!1},{type:"node_in",name:"jw",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jx",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"jy",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"jx [ 0 ] = jx [ 1 ] = jx [ 2 ] = ZERO_VALUE_NODES ; jy = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"ju ; jv ; jw ;".split(" ")}]},{type:"node",name:"TEX_CHECKER",declarations:[{type:"node_in",name:"jz",qualifier:["vec3"],
is_optional:!1},{type:"node_in",name:"jA",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"jB",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"jC",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jD",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"jE",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"jD [ 0 ] = jD [ 1 ] = jD [ 2 ] = ZERO_VALUE_NODES ; jE = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"jz ; jA ; jB ; jC ;".split(" ")}]},
{type:"node",name:"TEX_BRICK",declarations:[{type:"node_in",name:"jF",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"jG",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"jH",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"jI",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"jJ",qualifier:["float"],is_optional:!1},{type:"node_in",name:"jK",qualifier:["float"],is_optional:!1},{type:"node_in",name:"jL",qualifier:["float"],is_optional:!1},{type:"node_in",name:"jM",qualifier:["float"],
is_optional:!1},{type:"node_in",name:"jN",qualifier:["float"],is_optional:!1},{type:"node_out",name:"jO",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"jP",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"jO [ 0 ] = jO [ 1 ] = jO [ 2 ] = ZERO_VALUE_NODES ; jP = UNITY_VALUE_NODES ;".split(" ")},{type:"textline",tokens:"jF ; jG ; jH ; jI ; jJ ; jK ; jL ; jM ; jN ;".split(" ")}]},{type:"node",name:"ADD_SHADER",declarations:[{type:"node_in",name:"jQ",qualifier:["vec3"],
is_optional:!1},{type:"node_in",name:"jR",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"jS",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"jS = clamp ( jQ + jR , eN , eO ) ;".split(" ")}]},{type:"node",name:"MIX_SHADER",declarations:[{type:"node_in",name:"jT",qualifier:["float"],is_optional:!1},{type:"node_in",name:"jU",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"jV",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"jW",qualifier:["vec3"],
is_optional:!1}],statements:[{type:"textline",tokens:"float jX = clamp ( jT , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; jW = jX * jU + ( UNITY_VALUE_NODES - jX ) * jV ;".split(" ")}]},{type:"node",name:"UV_MERGED",declarations:[{type:"node_out",name:"jY",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"jZ",qualifier:["vec3"],is_optional:!1},{type:"node_param",name:"fn",qualifier:["varying","vec2"]}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_jY"],statements:[{type:"textline",
tokens:"jY = fe ( fn ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_jZ"],statements:[{type:"textline",tokens:"jZ = vec3 ( fn , ZERO_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"TEX_COORD_UV",declarations:[{type:"node_out",name:"j_",qualifier:["vec3"],is_optional:!1},{type:"node_param",name:"fo",qualifier:["varying","vec2"]}],statements:[{type:"textline",tokens:"j_ = vec3 ( fo , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"TEX_COORD_NO",declarations:[{type:"node_out",
name:"ka",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["ka","=","fC",";"]}]},{type:"node",name:"TEX_COORD_GE",declarations:[{type:"node_out",name:"kb",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["kb","=","eL",";"]}]},{type:"node",name:"TEX_COORD_OB",declarations:[{type:"node_out",name:"kc",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"kc [ 0 ] = kc [ 1 ] = kc [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",
name:"TEX_COORD_CA",declarations:[{type:"node_out",name:"kd",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"kd [ 0 ] = fI [ 0 ] ; kd [ 1 ] = fI [ 1 ] ; kd [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_WI",declarations:[{type:"node_out",name:"ke",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"ke [ 0 ] = ke [ 1 ] = ke [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"TEX_COORD_RE",declarations:[{type:"node_out",
name:"kf",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"kf [ 0 ] = kf [ 1 ] = kf [ 2 ] = UNITY_VALUE_NODES ;".split(" ")}]},{type:"node",name:"UVMAP",declarations:[{type:"node_out",name:"kg",qualifier:["vec3"],is_optional:!1},{type:"node_param",name:"fp",qualifier:["varying","vec2"]}],statements:[{type:"textline",tokens:"kg = vec3 ( fp , ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"PARTICLE_INFO",declarations:[{type:"node_out",name:"kh",qualifier:["float"],is_optional:!1},
{type:"node_out",name:"ki",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kj",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kk",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"kl",qualifier:["float"],is_optional:!1},{type:"node_out",name:"km",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"kn",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"kh = ZERO_VALUE_NODES ; ki = ZERO_VALUE_NODES ; kj = ZERO_VALUE_NODES ; kk = vec3 ( ZERO_VALUE_NODES ) ; kl = ZERO_VALUE_NODES ; km = kk ; kn = kk ;".split(" ")}]},
{type:"node",name:"HAIR_INFO",declarations:[{type:"node_out",name:"ko",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kp",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kq",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kr",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"ko = ZERO_VALUE_NODES ; kp = ZERO_VALUE_NODES ; kq = ZERO_VALUE_NODES ; kr = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"OBJECT_INFO",declarations:[{type:"node_out",
name:"ks",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"kt",qualifier:["float"],is_optional:!1},{type:"node_out",name:"ku",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kv",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kt = ZERO_VALUE_NODES ; ku = ZERO_VALUE_NODES ; kv = ZERO_VALUE_NODES ; ks = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"WIREFRAME",declarations:[{type:"node_in",name:"kw",qualifier:["float"],is_optional:!1},{type:"node_out",
name:"kx",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:["kx","=","kw",";"]}]},{type:"node",name:"TANGENT",declarations:[{type:"node_out",name:"ky",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"ky = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"LAYER_WEIGHT",declarations:[{type:"node_in",name:"kz",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kA",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"kB",qualifier:["float"],
is_optional:!1},{type:"node_out",name:"kC",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kB = kC = ZERO_VALUE_NODES ;".split(" ")},{type:"textline",tokens:["kA",";","kz",";"]}]},{type:"node",name:"LIGHT_PATH",declarations:[{type:"node_out",name:"kD",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kE",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kF",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kG",qualifier:["float"],is_optional:!1},
{type:"node_out",name:"kH",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kI",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kJ",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kK",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kL",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kM",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kD = kE = kF = ZERO_VALUE_NODES ; kG = kH = kI = ZERO_VALUE_NODES ; kJ = kJ = kL = kM = ZERO_VALUE_NODES ; kK = ZERO_VALUE_NODES ;".split(" ")}]},
{type:"node",name:"ATTRIBUTE",declarations:[{type:"node_out",name:"kN",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"kO",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"kP",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kN = kO = vec3 ( ZERO_VALUE_NODES ) ; kP = ZERO_VALUE_NODES ;".split(" ")}]},{type:"node",name:"SCRIPT",declarations:[],statements:[]},{type:"node",name:"CURVE_VEC",declarations:[{type:"node_in",name:"kQ",qualifier:["float"],is_optional:!1},
{type:"node_in",name:"kR",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"kS",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["kS","=","kR",";"]},{type:"textline",tokens:["kQ",";"]}]},{type:"node",name:"CURVE_RGB",declarations:[{type:"node_in",name:"kT",qualifier:["float"],is_optional:!1},{type:"node_in",name:"kU",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"kV",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["kV","=","kU",";"]},
{type:"textline",tokens:["kT",";"]}]},{type:"node",name:"VALTORGB",declarations:[{type:"node_in",name:"kW",qualifier:["float"],is_optional:!1},{type:"node_out",name:"kX",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"kY",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"kX [ 0 ] = kX [ 1 ] = kX [ 2 ] = clamp ( kW , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; kY = kX [ 0 ] ;".split(" ")}]},{type:"node",name:"MAPPING",declarations:[{type:"node_in",name:"kZ",qualifier:["vec3"],
is_optional:!1},{type:"node_out",name:"k_",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:["k_","=","kZ",";"]},{type:"node_condition",parts:[{type:"node_ifdef",name:"MAPPING_TRS_MATRIX",statements:[{type:"textline",tokens:"k_ = ( MAPPING_TRS_MATRIX * vec4 ( k_ , UNITY_VALUE_NODES ) ) . xyz ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_ifdef",name:"MAPPING_SCALE",statements:[{type:"textline",tokens:"k_ = k_ * MAPPING_SCALE ;".split(" ")}]}]},{type:"node_condition",
parts:[{type:"node_ifdef",name:"MAPPING_TRANSLATION",statements:[{type:"textline",tokens:"k_ = k_ + MAPPING_TRANSLATION ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_ifdef",name:"MAPPING_MIN_CLIP",statements:[{type:"textline",tokens:"k_ = max ( k_ , MAPPING_MIN_CLIP ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_ifdef",name:"MAPPING_MAX_CLIP",statements:[{type:"textline",tokens:"k_ = min ( k_ , MAPPING_MAX_CLIP ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",
expression:["MAPPING_IS_NORMAL"],statements:[{type:"textline",tokens:"k_ = normalize ( k_ ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ADD",declarations:[{type:"node_in",name:"la",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lb",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lc",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lc = la + lb ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",
tokens:"lc = clamp ( lc , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_SUBTRACT",declarations:[{type:"node_in",name:"ld",qualifier:["float"],is_optional:!1},{type:"node_in",name:"le",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lf",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lf = ld - le ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"lf = clamp ( lf , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_MULTIPLY",declarations:[{type:"node_in",name:"lg",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lh",qualifier:["float"],is_optional:!1},{type:"node_out",name:"li",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"li = lg * lh ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"li = clamp ( li , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",
name:"MATH_DIVIDE",declarations:[{type:"node_in",name:"lj",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lk",qualifier:["float"],is_optional:!1},{type:"node_out",name:"ll",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"ll = ( lk != ZERO_VALUE_NODES ) ? lj / lk : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"ll = clamp ( ll , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MATH_SINE",declarations:[{type:"node_in",name:"lm",qualifier:["float"],is_optional:!1},{type:"node_in",name:"ln",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lo",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lo = sin ( lm ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"lo = clamp ( lo , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",
tokens:["ln",";"]}]},{type:"node",name:"MATH_COSINE",declarations:[{type:"node_in",name:"lp",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lq",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lr",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lr = cos ( lp ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"lr = clamp ( lr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",tokens:["lq",";"]}]},{type:"node",name:"MATH_TANGENT",declarations:[{type:"node_in",name:"ls",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lt",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lu",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lu = tan ( ls ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"lu = clamp ( lu , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},
{type:"textline",tokens:["lt",";"]}]},{type:"node",name:"MATH_ARCSINE",declarations:[{type:"node_in",name:"lv",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lw",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lx",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lx = ( lv <= UNITY_VALUE_NODES && lv >= - UNITY_VALUE_NODES ) ? asin ( lv ) : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",
tokens:"lx = clamp ( lx , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",tokens:["lw",";"]}]},{type:"node",name:"MATH_ARCCOSINE",declarations:[{type:"node_in",name:"ly",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lz",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lA",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lA = ( ly <= UNITY_VALUE_NODES && ly >= - UNITY_VALUE_NODES ) ? acos ( ly ) : ZERO_VALUE_NODES ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"lA = clamp ( lA , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",tokens:["lz",";"]}]},{type:"node",name:"MATH_ARCTANGENT",declarations:[{type:"node_in",name:"lB",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lC",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lD",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lD = atan ( lB ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"lD = clamp ( lD , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",tokens:["lC",";"]}]},{type:"node",name:"MATH_POWER",declarations:[{type:"node_in",name:"lE",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lF",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lG",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"if ( lE < ZERO_VALUE_NODES || lE == ZERO_VALUE_NODES && lF == ZERO_VALUE_NODES ) lG = ZERO_VALUE_NODES ; else lG = pow ( lE , lF ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"lG = clamp ( lG , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_LOGARITHM",declarations:[{type:"node_in",name:"lH",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lI",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lJ",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lJ = ( lH > ZERO_VALUE_NODES && lI > ZERO_VALUE_NODES ) ? log2 ( lH ) / log2 ( lI ) : ZERO_VALUE_NODES ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"lJ = clamp ( lJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MINIMUM",declarations:[{type:"node_in",name:"lK",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lL",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lM",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lM = min ( lK , lL ) ;".split(" ")},{type:"node_condition",
parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"lM = clamp ( lM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MAXIMUM",declarations:[{type:"node_in",name:"lN",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lO",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lP",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lP = max ( lN , lO ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",
expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"lP = clamp ( lP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ROUND",declarations:[{type:"node_in",name:"lQ",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lR",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lS",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lS = floor ( lQ + 0.5 ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],
statements:[{type:"textline",tokens:"lS = clamp ( lS , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",tokens:["lR",";"]}]},{type:"node",name:"MATH_LESS_THAN",declarations:[{type:"node_in",name:"lT",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lU",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lV",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lV = ( lT < lU ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},{type:"node_condition",
parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"lV = clamp ( lV , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_GREATER_THAN",declarations:[{type:"node_in",name:"lW",qualifier:["float"],is_optional:!1},{type:"node_in",name:"lX",qualifier:["float"],is_optional:!1},{type:"node_out",name:"lY",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"lY = ( lW > lX ) ? UNITY_VALUE_NODES : ZERO_VALUE_NODES ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"lY = clamp ( lY , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_MODULO",declarations:[{type:"node_in",name:"lZ",qualifier:["float"],is_optional:!1},{type:"node_in",name:"l_",qualifier:["float"],is_optional:!1},{type:"node_out",name:"ma",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"ma = abs ( l_ ) > 0.000001 ? mod ( lZ , l_ ) : ZERO_VALUE_NODES ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"ma = clamp ( ma , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MATH_ABSOLUTE",declarations:[{type:"node_in",name:"mb",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mc",qualifier:["float"],is_optional:!1},{type:"node_out",name:"md",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"md = abs ( mb ) ;".split(" ")},{type:"node_condition",
parts:[{type:"node_if",expression:["MATH_USE_CLAMP"],statements:[{type:"textline",tokens:"md = clamp ( md , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]},{type:"textline",tokens:["mc",";"]}]},{type:"node",name:"MIX_RGB_MIX",declarations:[{type:"node_in",name:"me",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mf",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mg",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mh",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"float mi = clamp ( me , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mh = mix ( mf , mg , mi ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mh = clamp ( mh , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_ADD",declarations:[{type:"node_in",name:"mj",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mk",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ml",
qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mm",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"float mn = clamp ( mj , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mm = mix ( mk , mk + ml , mn ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mm = clamp ( mm , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_MULTIPLY",declarations:[{type:"node_in",
name:"mo",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mp",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mq",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mr",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"float ms = clamp ( mo , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mr = mix ( mp , mp * mq , ms ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mr = clamp ( mr , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_SUBTRACT",declarations:[{type:"node_in",name:"mt",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mu",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mv",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mw",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"float mx = clamp ( mt , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mw = mix ( mu , mu - mv , mx ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],
statements:[{type:"textline",tokens:"mw = clamp ( mw , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SCREEN",declarations:[{type:"node_in",name:"my",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mz",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mA",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mB",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"float mC = clamp ( my , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float mD = UNITY_VALUE_NODES - mC ; mB = eO - ( vec3 ( mD ) + mC * ( eO - mA ) ) * ( eO - mz ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mB = clamp ( mB , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIVIDE",declarations:[{type:"node_in",name:"mE",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mF",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mG",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mH",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"float mI = clamp ( mE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float mJ = UNITY_VALUE_NODES - mI ; mG += step ( mG , eN ) ; mH = mJ * mF + mI * mF / mG ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mH = clamp ( mH , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DIFFERENCE",declarations:[{type:"node_in",name:"mK",qualifier:["float"],is_optional:!1},{type:"node_in",
name:"mL",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mM",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mN",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"float mO = clamp ( mK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mN = mix ( mL , abs ( mL - mM ) , mO ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mN = clamp ( mN , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},
{type:"node",name:"MIX_RGB_DARKEN",declarations:[{type:"node_in",name:"mP",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mQ",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mR",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mS",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"float mT = clamp ( mP , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mS = min ( mQ . rgb , mR . rgb * mT ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],
statements:[{type:"textline",tokens:"mS = clamp ( mS , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LIGHTEN",declarations:[{type:"node_in",name:"mU",qualifier:["float"],is_optional:!1},{type:"node_in",name:"mV",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"mW",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"mX",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"float mY = clamp ( mU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; mX = max ( mV . rgb , mW . rgb * mY ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"mX = clamp ( mX , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_OVERLAY",declarations:[{type:"node_in",name:"mZ",qualifier:["float"],is_optional:!1},{type:"node_in",name:"m_",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"na",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"nb",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"float nc = clamp ( mZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 nd = vec3 ( UNITY_VALUE_NODES - nc ) ; nb = mix ( m_ * ( nd + 2.0 * nc * na ) , eO - ( nd + 2.0 * nc * ( eO - na ) ) * ( eO - m_ ) , step ( 0.5 , m_ ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"nb = clamp ( nb , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_DODGE",declarations:[{type:"node_in",
name:"ne",qualifier:["float"],is_optional:!1},{type:"node_in",name:"nf",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ng",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"nh",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"float ni = clamp ( ne , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 nj = eO - ni * ng ; vec3 nk = clamp ( nf / nj , 0.0 , 1.0 ) ; nh = mix ( mix ( nk , eO , step ( nj , eN ) ) , nf , step ( nf , eN ) ) ;".split(" ")},{type:"node_condition",
parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"nh = clamp ( nh , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_BURN",declarations:[{type:"node_in",name:"nl",qualifier:["float"],is_optional:!1},{type:"node_in",name:"nm",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nn",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"no",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"float np = clamp ( nl , 0.0 , 1.0 ) ; vec3 nq = vec3 ( 1.0 - np ) ; vec3 nr = nq + np * nn ; vec3 ns = clamp ( eO - ( eO - nm ) / nr , 0.0 , 1.0 ) ; no = mix ( ns , eN , step ( nr , eN ) ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"no = clamp ( no , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_HUE",declarations:[{type:"node_in",name:"nt",qualifier:["float"],is_optional:!1},{type:"node_in",name:"nu",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nv",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"nw",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"float nx = clamp ( nt , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 ny , nz , nA ; nw = nu ; nz = eZ ( nv ) ; if ( nz . y != ZERO_VALUE_NODES ) { ny = eZ ( nw ) ; ny . x = nz . x ; nA = fc ( ny ) ; nw = mix ( nw , nA , nx ) ; }".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"nw = clamp ( nw , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SATURATION",declarations:[{type:"node_in",
name:"nB",qualifier:["float"],is_optional:!1},{type:"node_in",name:"nC",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nD",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"nE",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"float nF = clamp ( nB , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float nG = UNITY_VALUE_NODES - nF ; nE = nC ; vec3 nH , nI ; nH = eZ ( nE ) ; if ( nH . y != ZERO_VALUE_NODES ) { nI = eZ ( nD ) ; nH . y = nG * nH . y + nF * nI . y ; nE = fc ( nH ) ; }".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"nE = clamp ( nE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_VALUE",declarations:[{type:"node_in",name:"nJ",qualifier:["float"],is_optional:!1},{type:"node_in",name:"nK",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nL",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"nM",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"float nN = clamp ( nJ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float nO = UNITY_VALUE_NODES - nN ; vec3 nP , nQ ; nP = eZ ( nK ) ; nQ = eZ ( nL ) ; nP . z = nO * nP . z + nN * nQ . z ; nM = fc ( nP ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"nM = clamp ( nM , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_COLOR",declarations:[{type:"node_in",name:"nR",qualifier:["float"],
is_optional:!1},{type:"node_in",name:"nS",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"nT",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"nU",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"float nV = clamp ( nR , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; vec3 nW , nX , nY ; nU = nS ; nX = eZ ( nT ) ; if ( nX . y != ZERO_VALUE_NODES ) { nW = eZ ( nU ) ; nW . x = nX . x ; nW . y = nX . y ; nY = fc ( nW ) ; nU = mix ( nU , nY , nV ) ; }".split(" ")},{type:"node_condition",
parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"nU = clamp ( nU , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_SOFT_LIGHT",declarations:[{type:"node_in",name:"nZ",qualifier:["float"],is_optional:!1},{type:"node_in",name:"n_",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oa",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"ob",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"float oc = clamp ( nZ , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float od = UNITY_VALUE_NODES - oc ; vec3 oe = oa + n_ - oa * n_ ; ob = n_ * ( vec3 ( od ) + vec3 ( oc ) * ( ( eO - n_ ) * oa + oe ) ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"ob = clamp ( ob , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"MIX_RGB_LINEAR_LIGHT",declarations:[{type:"node_in",name:"of",qualifier:["float"],is_optional:!1},{type:"node_in",name:"og",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oh",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"oi",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"float oj = clamp ( of , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; oi = og + oj * ( 2.0 * oh - eO ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["MIX_RGB_USE_CLAMP"],statements:[{type:"textline",tokens:"oi = clamp ( oi , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]},{type:"node",name:"OUTPUT",declarations:[{type:"node_in",name:"ok",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ol",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",
tokens:"fv = ok ; fz = ol ;".split(" ")}]},{type:"node",name:"MATERIAL_BEGIN",declarations:[{type:"node_in",name:"om",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"on",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oo",qualifier:["float"],is_optional:!1},{type:"node_in",name:"op",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"oq",qualifier:["float"],is_optional:!0},{type:"node_out",name:"or",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"os",qualifier:["vec3"],
is_optional:!1},{type:"node_out",name:"ot",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"ou",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"ov",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"ow",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"ox",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"oy",qualifier:["float"],is_optional:!1},{type:"node_param",name:"fq",qualifier:["const","vec2"]},{type:"node_param",name:"fr",qualifier:["const","vec3"]}],
statements:[{type:"textline",tokens:"ot = clamp ( om , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"textline",tokens:"ou = fr [ 0 ] * clamp ( on , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_NORMAL"],statements:[{type:"textline",tokens:"ov = normalize ( op ) ;".split(" ")}]},{type:"node_else",statements:[{type:"textline",tokens:["ov","=","fC",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["SHADELESS_MAT",
{type:"logic_negative_expr",places:1},"NODES_GLOW",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["MATERIAL_EXT"],statements:[{type:"textline",tokens:"or = oq * ot ;".split(" ")}]},{type:"node_else",statements:[{type:"textline",tokens:"or = fJ * ot ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_DIFFUSE"],statements:[{type:"textline",tokens:["ot","*=","oo",";"]}]}]},
{type:"textline",tokens:"os = fK * u_environment_energy * ew ( ov ) ; oy = dY ( ot ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["NUM_LIGHTS",0,{type:"g_expr",places:2}],statements:[{type:"textline",tokens:"ow = vec2 ( fq [ 0 ] , fq [ 1 ] ) ;".split(" ")},{type:"textline",tokens:"ox = vec2 ( fr [ 1 ] , fr [ 2 ] ) ;".split(" ")}]}]},{type:"textline",tokens:["fy","=","oy",";"]}]},{type:"node_else",statements:[{type:"textline",tokens:"or = eN ; os = eO ;".split(" ")}]}]}]},
{type:"node",name:"MATERIAL_END",declarations:[{type:"node_in",name:"oz",qualifier:["vec4"],is_optional:!1},{type:"node_in",name:"oA",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oB",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oC",qualifier:["float"],is_optional:!0},{type:"node_in",name:"oD",qualifier:["float"],is_optional:!0},{type:"node_in",name:"oE",qualifier:["float"],is_optional:!0},{type:"node_out",name:"oF",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"oG",
qualifier:["float"],is_optional:!0},{type:"node_out",name:"oH",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"oI",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"oJ",qualifier:["vec3"],is_optional:!0},{type:"node_param",name:"fs",qualifier:["float"]},{type:"node_param",name:"ft",qualifier:["float"]}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_oF"],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_DIFFUSE"],
statements:[{type:"textline",tokens:"oF = oz . rgb ;".split(" ")}]},{type:"node_else",statements:[{type:"textline",tokens:["oF","=","eN",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["MATERIAL_EXT","REFLECTION_TYPE","REFL_NONE",{type:"non_equal_expr",places:2},{type:"logical_and_expr",places:2}],statements:[{type:"textline",tokens:"et ( oF , fu , oB , oC ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_SPECULAR"],statements:[{type:"textline",
tokens:["oF","+=","oA",";"]}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_oH"],statements:[{type:"textline",tokens:["oH","=","oB",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["MATERIAL_EXT"],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_oI"],statements:[{type:"textline",tokens:"oI = oz . rgb ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_oJ"],statements:[{type:"textline",tokens:["oJ",
"=","oA",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_oG"],statements:[{type:"textline",tokens:"oG = clamp ( oE , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_SPECULAR"],statements:[{type:"textline",tokens:"float oK = max ( max ( oA . r , oA . g ) , oA . b ) * oD ; oG = clamp ( oE * ( UNITY_VALUE_NODES - oK ) + oK , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]}]}]}]}]},{type:"node_else",
statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_oG"],statements:[{type:"textline",tokens:"oG = clamp ( fs , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_SPECULAR"],statements:[{type:"textline",tokens:"float oK = max ( max ( oA . r , oA . g ) , oA . b ) * ft ; oG = fs * ( UNITY_VALUE_NODES - oK ) + oK ;".split(" ")}]}]}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_MATERIAL_SPECULAR"],
statements:[{type:"textline",tokens:["fw","=","oA",";"]}]},{type:"node_else",statements:[{type:"textline",tokens:["fw","=","eN",";"]}]}]},{type:"textline",tokens:["fx","=","oB",";"]}]},{type:"node",name:"LIGHTING_AMBIENT",declarations:[{type:"node_in",name:"oL",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oM",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"oN",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"oO",qualifier:["vec4"],is_optional:!1},{type:"node_out",name:"oP",
qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"oO = vec4 ( oL + oN * oM , ZERO_VALUE_NODES ) ; oP = vec3 ( ZERO_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"LIGHTING_LAMP",declarations:[{type:"node_in",name:"oQ",qualifier:["float"],is_optional:!1},{type:"node_out",name:"oR",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"oS",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"oT",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"oU",qualifier:["float"],
is_optional:!1}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["NODES_GLOW",{type:"logic_negative_expr",places:1},"NUM_LIGHTS",0,{type:"g_expr",places:2},{type:"logical_and_expr",places:2}],statements:[{type:"textline",tokens:"oS = u_light_factors [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_TYPE","HEMI",{type:"equal_expr",places:2}],statements:[{type:"textline",tokens:["oU","=","eM",";"]}]},{type:"node_else",
statements:[{type:"textline",tokens:["oU","=","ZERO_VALUE_NODES",";"]}]}]},{type:"textline",tokens:"oT = u_light_color_intensities [ LAMP_IND ] ; if ( LAMP_SHADOW_MAP_IND != - 1 ) oT *= oQ ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_TYPE","SPOT",{type:"equal_expr",places:2},"LAMP_TYPE","POINT",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],statements:[{type:"textline",tokens:"vec3 oV = u_light_positions [ LAMP_IND ] ; oR = oV - fH ;".split(" ")},
{type:"textline",tokens:"float oW = length ( oR ) ; oT *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + oW * oW ) ; oR = normalize ( oR ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_TYPE","SPOT",{type:"equal_expr",places:2}],statements:[{type:"textline",tokens:"vec3 oX = u_light_directions [ LAMP_IND ] ; float oY = dot ( oR , oX ) ; oY *= smoothstep ( ZERO_VALUE_NODES , UNITY_VALUE_NODES , ( oY - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; oT *= oY ;".split(" ")}]}]}]},{type:"node_else",
statements:[{type:"textline",tokens:"oR = u_light_directions [ LAMP_IND ] ;".split(" ")}]}]}]}]}]},{type:"node",name:"DIFFUSE_FRESNEL",declarations:[{type:"node_in",name:"oZ",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"o_",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"pa",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"pb",qualifier:["float"],is_optional:!1},{type:"node_in",name:"pc",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"pd",qualifier:["float"],
is_optional:!1}],statements:[{type:"textline",tokens:"pd = ZERO_VALUE_NODES ; if ( o_ . r != ZERO_VALUE_NODES ) { float pe = ( UNITY_VALUE_NODES - pb ) * dot ( pa , oZ ) + pb ; if ( pc [ 0 ] == ZERO_VALUE_NODES ) { pd = UNITY_VALUE_NODES ; } else { float pf = UNITY_VALUE_NODES + abs ( pe ) ; pf = pc [ 1 ] + ( UNITY_VALUE_NODES - pc [ 1 ] ) * pow ( pf , pc [ 0 ] ) ; pd = clamp ( pf , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; } pd = max ( pd , ZERO_VALUE_NODES ) ; }".split(" ")}]},{type:"node",name:"DIFFUSE_LAMBERT",
declarations:[{type:"node_in",name:"pg",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ph",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"pi",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"pj",qualifier:["float"],is_optional:!1},{type:"node_out",name:"pk",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"pk = ZERO_VALUE_NODES ; if ( ph . r != ZERO_VALUE_NODES ) { float pl = ( UNITY_VALUE_NODES - pj ) * dot ( pi , pg ) + pj ; pk = max ( pl , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_OREN_NAYAR",declarations:[{type:"node_in",name:"pm",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"pn",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"po",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"pp",qualifier:["float"],is_optional:!1},{type:"node_in",name:"pq",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"pr",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"pr = ZERO_VALUE_NODES ; if ( pn . r != ZERO_VALUE_NODES ) { float ps = ( UNITY_VALUE_NODES - pp ) * dot ( po , pm ) + pp ; if ( pq [ 0 ] > ZERO_VALUE_NODES ) { float pt = max ( dot ( po , fu ) , ZERO_VALUE_NODES ) ; float pu = pq [ 0 ] * pq [ 0 ] ; float pv = UNITY_VALUE_NODES - eM * ( pu / ( pu + 0.33 ) ) ; vec3 pw = pm - ps * po ; vec3 px = fu - pt * po ;".split(" ")},
{type:"textline",tokens:"if ( length ( pw ) == ZERO_VALUE_NODES || length ( px ) == ZERO_VALUE_NODES || abs ( ps ) > UNITY_VALUE_NODES || abs ( pt ) > UNITY_VALUE_NODES )".split(" ")},{type:"textline",tokens:"pr = ps * pv ; else { float py = acos ( ps ) ; float pz = acos ( pt ) ; vec3 pA = normalize ( pw ) ; vec3 pB = normalize ( px ) ; float pC , pD ; pC = max ( py , pz ) ; pD = min ( py , pz ) ; pD *= 0.95 ; float pE = max ( dot ( pA , pB ) , ZERO_VALUE_NODES ) ; float pF = 0.45 * ( pu / ( pu + 0.09 ) ) ; pr = ps * ( pv + ( pF * pE * sin ( pC ) * tan ( pD ) ) ) ; } } else pr = ps ; pr = max ( pr , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_MINNAERT",declarations:[{type:"node_in",name:"pG",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"pH",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"pI",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"pJ",qualifier:["float"],is_optional:!1},{type:"node_in",name:"pK",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"pL",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"pL = ZERO_VALUE_NODES ; if ( pH . r != ZERO_VALUE_NODES ) { float pM = ( UNITY_VALUE_NODES - pJ ) * dot ( pI , pG ) + pJ ; float pN = max ( dot ( pI , fu ) , ZERO_VALUE_NODES ) ; if ( pK [ 0 ] <= UNITY_VALUE_NODES ) pL = pM * pow ( max ( pN * pM , 0.1 ) , pK [ 0 ] - UNITY_VALUE_NODES ) ; else pL = pM * pow ( 1.0001 - pN , pK [ 0 ] - UNITY_VALUE_NODES ) ; pL = max ( pL , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_TOON",declarations:[{type:"node_in",name:"pO",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"pP",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"pQ",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"pR",qualifier:["float"],is_optional:!1},{type:"node_in",name:"pS",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"pT",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"pT = ZERO_VALUE_NODES ; if ( pP . r != ZERO_VALUE_NODES ) { float pU = ( UNITY_VALUE_NODES - pR ) * dot ( pQ , pO ) + pR ; float pV = acos ( pU ) ; if ( pV < pS [ 0 ] ) pT = UNITY_VALUE_NODES ; else if ( pV > ( pS [ 0 ] + pS [ 1 ] ) || pS [ 1 ] == ZERO_VALUE_NODES ) pT = ZERO_VALUE_NODES ; else pT = UNITY_VALUE_NODES - ( ( pV - pS [ 0 ] ) / pS [ 1 ] ) ; pT = max ( pT , ZERO_VALUE_NODES ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_PHONG",declarations:[{type:"node_in",name:"pW",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"pX",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"pY",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"pZ",qualifier:["float"],is_optional:!1},{type:"node_in",name:"p_",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"qa",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"qa = ZERO_VALUE_NODES ; if ( pX . g == UNITY_VALUE_NODES ) { vec3 qb = normalize ( pW + fu ) ; qa = ( UNITY_VALUE_NODES - pZ ) * max ( dot ( pY , qb ) , ZERO_VALUE_NODES ) + pZ ; qa = pow ( qa , p_ [ 0 ] ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_WARDISO",declarations:[{type:"node_in",name:"qc",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"qd",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"qe",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"qf",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"qg",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"qg = ZERO_VALUE_NODES ; if ( qd . g == UNITY_VALUE_NODES ) { vec3 qh = normalize ( qc + fu ) ; float qi = max ( dot ( qe , qh ) , 0.001 ) ;".split(" ")},
{type:"textline",tokens:"float qj = max ( dot ( qe , fu ) , 0.01 ) ; float qk = max ( dot ( qe , qc ) , 0.01 ) ; float ql = tan ( acos ( qi ) ) ; float qm = max ( qf [ 0 ] , 0.001 ) ; qg = qk * ( UNITY_VALUE_NODES / ( 4.0 * M_PI * qm * qm ) ) * ( exp ( - ( ql * ql ) / ( qm * qm ) ) / ( sqrt ( qj * qk ) ) ) ; }".split(" ")}]},{type:"node",name:"SPECULAR_TOON",declarations:[{type:"node_in",name:"qn",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"qo",qualifier:["vec2"],is_optional:!1},{type:"node_in",
name:"qp",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"qq",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"qr",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"qr = ZERO_VALUE_NODES ; if ( qo . g == UNITY_VALUE_NODES ) { vec3 qs = normalize ( qn + fu ) ; float qt = acos ( dot ( qs , qp ) ) ; if ( qt < qq [ 0 ] ) qr = UNITY_VALUE_NODES ; else if ( qt >= qq [ 0 ] + qq [ 1 ] || qq [ 1 ] == ZERO_VALUE_NODES ) qr = ZERO_VALUE_NODES ; else qr = UNITY_VALUE_NODES - ( qt - qq [ 0 ] ) / qq [ 1 ] ; }".split(" ")}]},
{type:"node",name:"SPECULAR_BLINN",declarations:[{type:"node_in",name:"qu",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"qv",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"qw",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"qx",qualifier:["float"],is_optional:!1},{type:"node_in",name:"qy",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"qz",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"qz = ZERO_VALUE_NODES ; if ( qv . g == UNITY_VALUE_NODES ) { if ( qy [ 0 ] < 1.0 || qy [ 1 ] == ZERO_VALUE_NODES ) qz = ZERO_VALUE_NODES ; else { if ( qy [ 1 ] < 100.0 ) qy [ 1 ] = sqrt ( 1.0 / qy [ 1 ] ) ; else qy [ 1 ] = 10.0 / qy [ 1 ] ; vec3 qA = normalize ( fu + qu ) ; float qB = ( UNITY_VALUE_NODES - qx ) * max ( dot ( qw , qA ) , ZERO_VALUE_NODES ) + qx ; if ( qB < ZERO_VALUE_NODES ) qz = ZERO_VALUE_NODES ; else { float qC = max ( dot ( qw , fu ) , 0.01 ) ; float qD = dot ( qw , qu ) ; if ( qD <= 0.01 ) qz = ZERO_VALUE_NODES ; else { float qE = max ( dot ( fu , qA ) , 0.01 ) ; float qF = UNITY_VALUE_NODES ; float qG = ( 2.0 * qB * qC ) / qE ; float qH = ( 2.0 * qB * qD ) / qE ; float qI = min ( min ( qF , qG ) , qH ) ; float qJ = sqrt ( pow ( qy [ 0 ] , 2.0 ) + pow ( qE , 2.0 ) - UNITY_VALUE_NODES ) ; float qK = pow ( qJ - qE , 2.0 ) / pow ( qJ + qE , 2.0 ) * ( UNITY_VALUE_NODES + pow ( qE * ( qJ + qE ) - UNITY_VALUE_NODES , 2.0 ) / pow ( qE * ( qJ - qE ) + UNITY_VALUE_NODES , 2.0 ) ) ; float qL = acos ( qB ) ; qz = max ( qK * qI * exp ( - pow ( qL , 2.0 ) / ( 2.0 * pow ( qy [ 1 ] , 2.0 ) ) ) , ZERO_VALUE_NODES ) ; } } } }".split(" ")}]},
{type:"node",name:"LIGHTING_APPLY",declarations:[{type:"node_in",name:"qM",qualifier:["vec4"],is_optional:!1},{type:"node_in",name:"qN",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"qO",qualifier:["float"],is_optional:!1},{type:"node_in",name:"qP",qualifier:["float"],is_optional:!1},{type:"node_in",name:"qQ",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"qR",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"qS",qualifier:["vec4"],is_optional:!1},{type:"node_in",name:"qT",
qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"qU",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"qV",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"qW",qualifier:["float"],is_optional:!1},{type:"node_out",name:"qX",qualifier:["vec4"],is_optional:!1},{type:"node_out",name:"qY",qualifier:["vec3"],is_optional:!1}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_NODE_B4W_TRANSLUCENCY"],statements:[{type:"textline",tokens:"if ( dot ( qQ , qR ) * dot ( fu , qR ) < ZERO_VALUE_NODES ) { float qZ = qS . x ; float q_ = qS . y ; float ra = qS . z ; float rb = qS . w ;".split(" ")},
{type:"textline",tokens:"float rc = clamp ( abs ( dot ( qQ , qR ) ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float rd = clamp ( dot ( fu , - qQ ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float re = pow ( rd , q_ ) ;".split(" ")},{type:"textline",tokens:"qX = qM + qW * vec4 ( qV * rc * pow ( qT , vec3 ( qZ ) ) , UNITY_VALUE_NODES ) ;".split(" ")},{type:"textline",tokens:"qX += ra * mix ( vec4 ( qT , UNITY_VALUE_NODES ) , vec4 ( UNITY_VALUE_NODES ) , rb ) * qW * vec4 ( qV * rc * vec3 ( re ) , UNITY_VALUE_NODES ) ; qY = qN ; } else {".split(" ")},
{type:"textline",tokens:"qY = qN + qV * qU * qP ; qX = qM + vec4 ( qV * qT * qO , qP ) ; }".split(" ")}]},{type:"node_else",statements:[{type:"textline",tokens:"qY = qN + qV * qU * qP ; qX = qM + vec4 ( qV * qT * qO , qP ) ;".split(" ")}]}]}]},{type:"node",name:"RGB",declarations:[{type:"node_out",name:"rf",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"rf = u_node_rgbs [ RGB_IND ] ;".split(" ")}]},{type:"node",name:"RGBTOBW",declarations:[{type:"node_in",name:"rg",qualifier:["vec3"],
is_optional:!1},{type:"node_out",name:"rh",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"rh = dot ( rg , vec3 ( 0.35 , 0.45 , 0.2 ) ) ;".split(" ")}]},{type:"node",name:"SEPRGB",declarations:[{type:"node_in",name:"ri",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"rj",qualifier:["float"],is_optional:!0},{type:"node_out",name:"rk",qualifier:["float"],is_optional:!0},{type:"node_out",name:"rl",qualifier:["float"],is_optional:!0}],statements:[{type:"node_condition",
parts:[{type:"node_if",expression:["USE_OUT_rj"],statements:[{type:"textline",tokens:"rj = ri . r ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_rk"],statements:[{type:"textline",tokens:"rk = ri . g ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_rl"],statements:[{type:"textline",tokens:"rl = ri . b ;".split(" ")}]}]}]},{type:"node",name:"SEPHSV",declarations:[{type:"node_in",name:"rm",qualifier:["vec3"],is_optional:!1},
{type:"node_out",name:"rn",qualifier:["float"],is_optional:!0},{type:"node_out",name:"ro",qualifier:["float"],is_optional:!0},{type:"node_out",name:"rp",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"vec3 rq = eZ ( rm ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_rn"],statements:[{type:"textline",tokens:"rn = rq . r ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_ro"],statements:[{type:"textline",
tokens:"ro = rq . g ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_rp"],statements:[{type:"textline",tokens:"rp = rq . b ;".split(" ")}]}]}]},{type:"node",name:"SQUEEZE",declarations:[{type:"node_in",name:"rr",qualifier:["float"],is_optional:!1},{type:"node_in",name:"rs",qualifier:["float"],is_optional:!1},{type:"node_in",name:"rt",qualifier:["float"],is_optional:!1},{type:"node_out",name:"ru",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",
tokens:"ru = UNITY_VALUE_NODES / ( UNITY_VALUE_NODES + pow ( 2.71828183 , - ( ( rr - rt ) * rs ) ) ) ;".split(" ")}]},{type:"node",name:"GAMMA",declarations:[{type:"node_in",name:"rv",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"rw",qualifier:["float"],is_optional:!1},{type:"node_out",name:"rx",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"rx = max ( eN , rv ) ; rx = pow ( rx , vec3 ( rw ) ) ;".split(" ")}]},{type:"node",name:"B4W_SRGB_TO_LINEAR",declarations:[{type:"node_in",
name:"ry",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"rz",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"rz = max ( eN , ry ) ; rz = pow ( rz , vec3 ( 2.2 ) ) ;".split(" ")}]},{type:"node",name:"B4W_LINEAR_TO_SRGB",declarations:[{type:"node_in",name:"rA",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"rB",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"rB = max ( eN , rA ) ; rB = pow ( rB , vec3 ( UNITY_VALUE_NODES / 2.2 ) ) ;".split(" ")}]},
{type:"node",name:"TEXTURE_EMPTY",declarations:[{type:"node_out",name:"rC",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"rD",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"rE",qualifier:["float"],is_optional:!1}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_rE"],statements:[{type:"textline",tokens:"rC [ 2 ] = rC [ 1 ] = rC [ 0 ] = 0.0 ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_rE"],statements:[{type:"textline",
tokens:"rD [ 2 ] = rD [ 1 ] = rD [ 0 ] = 0.0 ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_rE"],statements:[{type:"textline",tokens:["rE","=","0.0",";"]}]}]}]},{type:"node",name:"TEXTURE_ENVIRONMENT",declarations:[{type:"node_in",name:"rF",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"rG",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"rH",qualifier:["float"],is_optional:!0},{type:"node_param",name:"node_TEXTURE_ENVIRONMENT_var_texture",
qualifier:["uniform","samplerCube"]}],statements:[{type:"textline",tokens:"vec4 rI = textureCube ( node_TEXTURE_ENVIRONMENT_var_texture , rF ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_rG"],statements:[{type:"textline",tokens:"rG = rI . xyz ; a_ ( rG ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_rH"],statements:[{type:"textline",tokens:"rH = rI . w ;".split(" ")}]}]}]},{type:"node",name:"TEXTURE_COLOR",declarations:[{type:"node_in",
name:"rJ",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"rK",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"rL",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"rM",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"rN",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"rO",qualifier:["float"],is_optional:!0},{type:"node_out",name:"rP",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"rQ",qualifier:["float"],is_optional:!0},{type:"node_out",name:"rR",
qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"rS",qualifier:["float"],is_optional:!0},{type:"node_out",name:"rT",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"rU",qualifier:["float"],is_optional:!0},{type:"node_param",name:"node_TEXTURE_COLOR_var_texture",qualifier:["uniform","sampler2D"]}],statements:[{type:"textline",tokens:"vec4 rV = texture2D ( node_TEXTURE_COLOR_var_texture , fg ( rJ ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_rN"],
statements:[{type:"textline",tokens:"rN = rV . xyz ; a_ ( rN ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_rO"],statements:[{type:"textline",tokens:"rO = rV . w ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv2"],statements:[{type:"textline",tokens:"rV = texture2D ( node_TEXTURE_COLOR_var_texture , fg ( rK ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_rP"],statements:[{type:"textline",
tokens:"rP = rV . xyz ; a_ ( rP ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_rQ"],statements:[{type:"textline",tokens:"rQ = rV . w ;".split(" ")}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv3"],statements:[{type:"textline",tokens:"rV = texture2D ( node_TEXTURE_COLOR_var_texture , fg ( rL ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_rR"],statements:[{type:"textline",tokens:"rR = rV . xyz ; a_ ( rR ) ;".split(" ")}]}]},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_rS"],statements:[{type:"textline",tokens:"rS = rV . w ;".split(" ")}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv4"],statements:[{type:"textline",tokens:"rV = texture2D ( node_TEXTURE_COLOR_var_texture , fg ( rM ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_rT"],statements:[{type:"textline",tokens:"rT = rV . xyz ; a_ ( rT ) ;".split(" ")}]}]},{type:"node_condition",
parts:[{type:"node_if",expression:["USE_OUT_rU"],statements:[{type:"textline",tokens:"rU = rV . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"TEXTURE_NORMAL",declarations:[{type:"node_in",name:"rW",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"rX",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"rY",qualifier:["vec3"],is_optional:!0},{type:"node_in",name:"rZ",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"r_",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"sa",
qualifier:["float"],is_optional:!0},{type:"node_out",name:"sb",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"sc",qualifier:["float"],is_optional:!0},{type:"node_out",name:"sd",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"se",qualifier:["float"],is_optional:!0},{type:"node_out",name:"sf",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"sg",qualifier:["float"],is_optional:!0},{type:"node_param",name:"node_TEXTURE_NORMAL_var_texture",qualifier:["uniform","sampler2D"]}],
statements:[{type:"textline",tokens:"vec4 sh = texture2D ( node_TEXTURE_NORMAL_var_texture , fg ( rW ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_r_"],statements:[{type:"textline",tokens:"r_ = normalize ( fG * ( sh . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_sa"],statements:[{type:"textline",tokens:"sa = sh . w ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv2"],statements:[{type:"textline",
tokens:"sh = texture2D ( node_TEXTURE_NORMAL_var_texture , fg ( rX ) ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_sb"],statements:[{type:"textline",tokens:"sb = normalize ( fG * ( sh . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_sc"],statements:[{type:"textline",tokens:"sc = sh . w ;".split(" ")}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv3"],statements:[{type:"textline",tokens:"sh = texture2D ( node_TEXTURE_NORMAL_var_texture , fg ( rY ) ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_sd"],statements:[{type:"textline",tokens:"sd = normalize ( fG * ( sh . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_se"],statements:[{type:"textline",tokens:"se = sh . w ;".split(" ")}]}]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_uv4"],statements:[{type:"textline",tokens:"sh = texture2D ( node_TEXTURE_NORMAL_var_texture , fg ( rZ ) ) ;".split(" ")},{type:"node_condition",
parts:[{type:"node_if",expression:["USE_OUT_sf"],statements:[{type:"textline",tokens:"sf = normalize ( fG * ( sh . xyz - 0.5 ) ) ;".split(" ")}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_sg"],statements:[{type:"textline",tokens:"sg = sh . w ;".split(" ")}]}]}]}]}]},{type:"node",name:"VALUE",declarations:[{type:"node_out",name:"si",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"si = u_node_values [ VALUE_IND ] ;".split(" ")}]},{type:"node",name:"VECT_MATH_ADD",
declarations:[{type:"node_in",name:"sj",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"sk",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"sl",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"sm",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"sl = sj + sk ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_sm"],statements:[{type:"textline",tokens:"sm = ( abs ( sl [ 0 ] ) + abs ( sl [ 1 ] ) + abs ( sl [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},
{type:"node",name:"VECT_MATH_SUBTRACT",declarations:[{type:"node_in",name:"sn",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"so",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"sp",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"sq",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"sp = sn - so ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_sq"],statements:[{type:"textline",tokens:"sq = ( abs ( sp [ 0 ] ) + abs ( sp [ 1 ] ) + abs ( sp [ 2 ] ) ) / 3.0 ;".split(" ")}]}]}]},
{type:"node",name:"VECT_MATH_AVERAGE",declarations:[{type:"node_in",name:"sr",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"ss",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"st",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"su",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"st = sr + ss ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_su"],statements:[{type:"textline",tokens:"su = length ( st ) ;".split(" ")}]}]},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_st"],statements:[{type:"textline",tokens:"st = normalize ( st ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_DOT_PRODUCT",declarations:[{type:"node_in",name:"sv",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"sw",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"sx",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"sy",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:["sx","=",
"eN",";"]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_sy"],statements:[{type:"textline",tokens:"sy = dot ( sv , sw ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_CROSS_PRODUCT",declarations:[{type:"node_in",name:"sz",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"sA",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"sB",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"sC",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"sB = cross ( sz , sA ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_sC"],statements:[{type:"textline",tokens:"sC = length ( sB ) ;".split(" ")}]}]}]},{type:"node",name:"VECT_MATH_NORMALIZE",declarations:[{type:"node_in",name:"sD",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"sE",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"sF",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"sG",qualifier:["float"],is_optional:!0}],statements:[{type:"textline",tokens:"sF = normalize ( sD ) ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_sG"],statements:[{type:"textline",tokens:"sG = length ( sD ) ;".split(" ")}]}]},{type:"textline",tokens:["sE",";"]}]},{type:"node",name:"B4W_REFLECT",declarations:[{type:"node_in",name:"sH",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"sI",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"sJ",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"sJ = reflect ( - sH , sI ) ;".split(" ")}]},{type:"node",
name:"B4W_PARALLAX",declarations:[{type:"node_in",name:"sK",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"sL",qualifier:["float"],is_optional:!1},{type:"node_in",name:"sM",qualifier:["const","float"],is_optional:!1},{type:"node_in",name:"sN",qualifier:["const","float"],is_optional:!1},{type:"node_out",name:"sO",qualifier:["vec3"],is_optional:!1},{type:"node_param",name:"node_B4W_PARALLAX_var_texture",qualifier:["uniform","sampler2D"]}],statements:[{type:"textline",tokens:"float sP = length ( fI ) ; if ( sP < sN ) { vec2 sQ = fg ( sK ) ; float sR = clamp ( 0.5 * ( sN - sP ) , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ; float sS = sL * sR ;".split(" ")},
{type:"textline",tokens:"vec3 sT = normalize ( fu * fG ) ;".split(" ")},{type:"textline",tokens:"float sU = UNITY_VALUE_NODES / sM ;".split(" ")},{type:"textline",tokens:"vec2 sV = sT . xy * sS / ( sM * sT . z ) ; float sW = UNITY_VALUE_NODES ; float sX = texture2D ( node_B4W_PARALLAX_var_texture , sQ ) . a ;".split(" ")},{type:"textline",tokens:"for ( float sY = 1.0 ; sY <= sM ; sY ++ ) { if ( sX < sW ) { sW -= sU ; sQ -= sV ; sX = texture2D ( node_B4W_PARALLAX_var_texture , sQ ) . a ; } }".split(" ")},
{type:"textline",tokens:"vec2 sZ = sQ + sV ; float s_ = texture2D ( node_B4W_PARALLAX_var_texture , sZ ) . a - ( sW + sU ) ; float ta = sX - sW ; float tb = ta / ( ta - s_ ) ;".split(" ")},{type:"textline",tokens:"sQ = tb * sZ + ( UNITY_VALUE_NODES - tb ) * sQ ; sO = fe ( sQ ) ; } else sO = sK ;".split(" ")}]},{type:"node",name:"B4W_CLAMP",declarations:[{type:"node_in",name:"tc",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"td",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",
tokens:"td = clamp ( tc , ZERO_VALUE_NODES , UNITY_VALUE_NODES ) ;".split(" ")}]},{type:"node",name:"B4W_REFRACTION",declarations:[{type:"node_in",name:"te",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"tf",qualifier:["float"],is_optional:!1},{type:"node_out",name:"tg",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"tg = eS ( te , tf ) ;".split(" ")}]},{type:"node",name:"B4W_TRANSLUCENCY",declarations:[{type:"node_in",name:"th",qualifier:["float"],is_optional:!1},
{type:"node_in",name:"ti",qualifier:["float"],is_optional:!1},{type:"node_in",name:"tj",qualifier:["float"],is_optional:!1},{type:"node_in",name:"tk",qualifier:["float"],is_optional:!1},{type:"node_in",name:"tl",qualifier:["float"],is_optional:!1},{type:"node_out",name:"tm",qualifier:["float"],is_optional:!0},{type:"node_out",name:"tn",qualifier:["vec4"],is_optional:!0}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_tm"],statements:[{type:"textline",tokens:["tm","=",
"th",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_tn"],statements:[{type:"textline",tokens:"tn = vec4 ( ti , tj , tk , tl ) ;".split(" ")}]}]}]},{type:"node",name:"B4W_TIME",declarations:[{type:"node_out",name:"to",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:["to","=","u_time",";"]}]},{type:"node",name:"B4W_SMOOTHSTEP",declarations:[{type:"node_in",name:"tp",qualifier:["float"],is_optional:!1},{type:"node_in",name:"tq",qualifier:["float"],
is_optional:!1},{type:"node_in",name:"tr",qualifier:["float"],is_optional:!1},{type:"node_out",name:"ts",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"ts = smoothstep ( tq , tr , tp ) ;".split(" ")}]},{type:"node",name:"B4W_GLOW_OUTPUT",declarations:[{type:"node_in",name:"tt",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"tu",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"fv = tt ; fz = tu ;".split(" ")}]},{type:"node",name:"B4W_VECTOSCAL",
declarations:[{type:"node_in",name:"tv",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"tw",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"tw = ( tv . r + tv . g + tv . b ) / 3.0 ;".split(" ")}]},{type:"node",name:"B4W_SCALTOVEC",declarations:[{type:"node_in",name:"tx",qualifier:["float"],is_optional:!1},{type:"node_out",name:"ty",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"ty [ 0 ] = tx ; ty [ 1 ] = tx ; ty [ 2 ] = tx ;".split(" ")}]},
{type:"nodes_global"},{type:"textline",tokens:"void tz ( in vec3 fu , out vec3 fv , out vec3 fw , out vec3 fx , out float fy , out float fz ) { fv = eN ; fw = eN ; fx = eN ; fy = ZERO_VALUE_NODES ; fz = ZERO_VALUE_NODES ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_NODE_MATERIAL_BEGIN","USE_NODE_GEOMETRY_NO","CAUSTICS","CALC_TBN_SPACE","USE_NODE_TEX_COORD_NO",{type:"logical_or_expr",places:5}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 fA = normalize ( bS ) ; vec3 fB = fA ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["DOUBLE_SIDED_LIGHTING","USE_NODE_GEOMETRY_NO",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"if ( gl_FrontFacing ) fB = fB ; else fB = - fB ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["DOUBLE_SIDED_LIGHTING"],group:{type:"group",parts:[{type:"textline",tokens:["vec3","fC","=","fB",";"]}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["vec3","fC","=","fA",";"]}]}}]},
{type:"condition",parts:[{type:"if",expression:["USE_NODE_GEOMETRY_NO"],group:{type:"group",parts:[{type:"textline",tokens:["vec3","fD","=","fB",";"]}]}}]}]}}]},{type:"condition",parts:[{type:"if",expression:["CALC_TBN_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 fE = cross ( fB , bT . xyz ) * bT . w ; mat3 fF = mat3 ( bT . xyz , fE , fB ) ; mat3 fG = fF ;".split(" ")}]}}]},{type:"textline",tokens:"vec3 fH = bQ ; vec4 fI = bR ; float fJ = u_emit ; float fK = u_ambient ;".split(" ")},
{type:"nodes_main"},{type:"textline",tokens:["}"]}]};a["include/to_world.glslv"]={type:"group",parts:[{type:"define",name:"M_PI",tokens:["3.14159265359"]},{type:"define",name:"MAX_BILLBOARD_ANGLE",tokens:["(","M_PI","/","4.0",")"]},{type:"textline",tokens:"const vec3 tA = vec3 ( 0.0 , 1.0 , 0.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_SPHERICAL","BILLBOARD",{type:"logic_negative_expr",places:1},"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW",{type:"equal_expr",places:2},
{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"mat4 tG ( vec3 tB , mat4 tC ) { vec3 tD = vec3 ( tC [ 0 ] [ 0 ] , tC [ 1 ] [ 0 ] , tC [ 2 ] [ 0 ] ) ; vec3 tE = vec3 ( tC [ 0 ] [ 1 ] , tC [ 1 ] [ 1 ] , tC [ 2 ] [ 1 ] ) ; vec3 tF = vec3 ( tC [ 0 ] [ 2 ] , tC [ 1 ] [ 2 ] , tC [ 2 ] [ 2 ] ) ; tE = cross ( tF , tD ) ; tD = normalize ( tD ) ; tE = normalize ( tE ) ; tF = normalize ( tF ) ; return mat4 ( vec4 ( tD , 0.0 ) , vec4 ( tE , 0.0 ) , vec4 ( tF , 0.0 ) , vec4 ( tB , 1.0 ) ) ; }".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"mat4 tM ( vec3 tH , vec3 tI ) { vec3 tJ = tH - tI ; tJ . y = 0.0 ; vec3 tK = cross ( tA , tJ ) ; vec3 tL = cross ( tJ , tK ) ; tK = normalize ( tK ) ; tL = normalize ( tL ) ; tJ = normalize ( tJ ) ; return mat4 ( vec4 ( tK , 0.0 ) , vec4 ( tL , 0.0 ) , vec4 ( tJ , 0.0 ) , vec4 ( tI , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_JITTERED"],group:{type:"group",parts:[{type:"textline",tokens:"mat4 tW ( in vec3 tN , float tO , float tP , float tQ , vec3 tR ) { float tS = fract ( length ( tR ) / 0.17 ) ; float tT = tQ + tS / 10.0 ; float tU = tS ; if ( tQ != 0.0 ) tU /= tQ ; tN *= 1.0 + 0.5 * sin ( tO ) ; float tV = length ( tN ) * tP * sin ( 2.0 * 3.14 * tO * tT + tU ) ; return bH ( tV ) ; }".split(" ")}]}}]},
{type:"textline",tokens:"mat4 ug ( in vec3 tX , in vec3 tY , in mat4 tZ ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_SPHERICAL","BILLBOARD",{type:"logic_negative_expr",places:1},"BILLBOARD_ALIGN","BILLBOARD_ALIGN_VIEW",{type:"equal_expr",places:2},{type:"logical_and_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"mat4 t_ = tG ( tY , tZ ) ;".split(" ")}]}},{type:"elif",expression:["BILLBOARD_RANDOM"],group:{type:"group",
parts:[{type:"textline",tokens:"float ua = fract ( ( tY . x * 1.43 + tY . y * 0.123 + tY . z * 6.1 ) ) ; float ub = 2.0 * M_PI * ua ; vec3 uc = normalize ( vec3 ( tZ [ 0 ] [ 2 ] , 0.0 , tZ [ 2 ] [ 2 ] ) ) ; float ud = acos ( uc [ 2 ] ) ; if ( uc [ 0 ] < 0.0 ) ud = 2.0 * M_PI - ud ; float ue = ud - ub ; if ( ue < 0.0 ) ue = 2.0 * M_PI + ue ; float uf = ub ; if ( ue <= MAX_BILLBOARD_ANGLE ) uf += ue ; else if ( ue <= M_PI - MAX_BILLBOARD_ANGLE ) uf += MAX_BILLBOARD_ANGLE * ( 2.0 * ue - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) ; else if ( ue <= M_PI + MAX_BILLBOARD_ANGLE ) uf += ue - M_PI ; else if ( ue <= 2.0 * M_PI - MAX_BILLBOARD_ANGLE ) uf += MAX_BILLBOARD_ANGLE * ( 2.0 * ue - M_PI ) / ( 2.0 * MAX_BILLBOARD_ANGLE - M_PI ) + M_PI ; else uf += ue - 2.0 * M_PI ; mat4 t_ = bF ( uf ) ; t_ [ 3 ] = vec4 ( tY , 1.0 ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"mat4 t_ = tM ( tX , tY ) ;".split(" ")}]}}]},{type:"textline",tokens:["return","t_",";","}"]},{type:"condition",parts:[{type:"if",expression:["BILLBOARD_PRES_GLOB_ORIENTATION","STATIC_BATCH",{type:"logic_negative_expr",places:1},{type:"logical_and_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"mat4 um ( in vec3 uh , in vec3 ui , in mat4 uj , mat4 uk ) { mat4 ul = ug ( uh , ui , uj ) ; uk [ 3 ] = vec4 ( 0.0 , 0.0 , 0.0 , 1.0 ) ; ul = ul * uk ; return ul ; }".split(" ")}]}}]},
{type:"textline",tokens:"bh ut ( in vec3 un , in vec3 uo , in vec3 up , in vec3 uq , in vec3 ur , in mat4 us ) { un = ( us * vec4 ( un , 1.0 ) ) . xyz ; uo = ( us * vec4 ( uo , 1.0 ) ) . xyz ; up = ( us * vec4 ( up , 0.0 ) ) . xyz ; uq = ( us * vec4 ( uq , 0.0 ) ) . xyz ; ur = ( us * vec4 ( ur , 0.0 ) ) . xyz ; return bJ ( bh ( un , uo , up , uq , ur , vec3 ( 0.0 ) ) ) ; }".split(" ")}]};a["include/scale_texcoord.glslv"]={type:"group",parts:[{type:"textline",tokens:"vec2 uw ( vec2 uu , vec3 uv ) { return ( uu + 0.5 ) * uv . xy - 0.5 ; }".split(" ")}]};
a["include/skin.glslv"]={type:"group",parts:[{type:"define",name:"SKIN_SLERP",tokens:["0"]},{type:"condition",parts:[{type:"if",expression:["SKINNED"],group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["SKIN_SLERP"],group:{type:"group",parts:[{type:"textline",tokens:"vec4 uF ( in vec4 ux , in vec4 uy , in float uz ) { float uA = ux [ 0 ] * uy [ 0 ] + ux [ 1 ] * uy [ 1 ] + ux [ 2 ] * uy [ 2 ] + ux [ 3 ] * uy [ 3 ] ; if ( uA < 0.0 ) { uy *= - 1.0 ; uA = - uA ; } if ( abs ( uA ) >= 1.0 ) return ux ; float uB = acos ( uA ) ; float uC = sqrt ( 1.0 - uA * uA ) ; if ( abs ( uC ) < 0.001 ) return vec4 ( ux * 0.5 + uy * 0.5 ) ; float uD = sin ( ( 1.0 - uz ) * uB ) / uC ; float uE = sin ( uz * uB ) / uC ; return ux * uD + uy * uE ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 uV ( in vec3 uG , in vec4 uH , in vec4 uI , in vec4 uJ , in vec4 uK , in float uL ) { vec3 uM = bu ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( uG , 1.0 ) ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SKIN_SLERP"],group:{type:"group",parts:[{type:"textline",tokens:"vec4 uN = uF ( uH , uI , uL ) ; vec4 uO = mix ( uJ , uK , uL ) ; vec3 uP = bn ( uN , uM ) ; vec3 uQ = uP * uO . w + uO . xyz ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec3 uR = bn ( uH , uM ) ; vec3 uS = bn ( uI , uM ) ; vec3 uT = uR * uJ . w + uJ . xyz ; vec3 uU = uS * uK . w + uK . xyz ; vec3 uQ = mix ( uT , uU , uL ) ;".split(" ")}]}}]},{type:"textline",tokens:"return bA ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( uQ , 1.0 ) ) ; } vec3 ve ( in vec3 uW , in vec4 uX , in vec4 uY , in float uZ ) { vec3 u_ = bu ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( uW , 0.0 ) ) ;".split(" ")},{type:"condition",
parts:[{type:"if",expression:["SKIN_SLERP"],group:{type:"group",parts:[{type:"textline",tokens:"vec4 va = uF ( uX , uY , uZ ) ; vec3 vb = bn ( va , u_ ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec3 vc = bn ( uX , u_ ) ; vec3 vd = bn ( uY , u_ ) ; vec3 vb = mix ( vc , vd , uZ ) ;".split(" ")}]}}]},{type:"textline",tokens:"return bA ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( vb , 0.0 ) ) ; }".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",
tokens:"vec3 uV ( in vec3 vf , in vec4 vg , in vec4 vh ) { vec3 vi = bu ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( vf , 1.0 ) ) ; vec3 vj = bn ( vg , vi ) ; vec3 vk = vj * vh . w + vh . xyz ; return bA ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( vk , 1.0 ) ) ; } vec3 ve ( in vec3 vl , in vec4 vm ) { vec3 vn = bu ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( vl , 0.0 ) ) ; vec3 vo = bn ( vm , vn ) ; return bA ( u_arm_rel_trans , u_arm_rel_quat , vec4 ( vo , 0.0 ) ) ; }".split(" ")}]}}]},{type:"textline",
tokens:"void vD ( inout vec3 vp , inout vec3 vq , inout vec3 vr , inout vec3 vs ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:["float","vt","=","u_frame_factor",";"]}]}}]},{type:"textline",tokens:"if ( a_influence . y > 0.0 ) { vec3 vu = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 vv = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 vw = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec3 vx = vec3 ( 0.0 , 0.0 , 0.0 ) ; vec4 vy = a_influence ; for ( int vz = 0 ; vz < 4 ; vz ++ ) { int vA = int ( vy [ vz ] ) ; float vB = fract ( vy [ vz ] ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:"vu += vB * uV ( vp , u_quatsb [ vA ] , u_quatsa [ vA ] , u_transb [ vA ] , u_transa [ vA ] , vt ) ; vv += vB * ve ( vq , u_quatsb [ vA ] , u_quatsa [ vA ] , vt ) ; vw += vB * ve ( vr , u_quatsb [ vA ] , u_quatsa [ vA ] , vt ) ; vx += vB * ve ( vs , u_quatsb [ vA ] , u_quatsa [ vA ] , vt ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vu += vB * uV ( vp , u_quatsb [ vA ] , u_transb [ vA ] ) ; vv += vB * ve ( vq , u_quatsb [ vA ] ) ; vw += vB * ve ( vr , u_quatsb [ vA ] ) ; vx += vB * ve ( vs , u_quatsb [ vA ] ) ;".split(" ")}]}}]},
{type:"textline",tokens:"} vp = vu ; vq = vv ; vr = vw ; vs = vx ; } if ( ! ( a_influence . y > 0.0 ) ) { int vC = int ( a_influence [ 0 ] - 1.0 ) ; if ( vC > - 1 ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["FRAMES_BLENDING"],group:{type:"group",parts:[{type:"textline",tokens:"vp = uV ( vp , u_quatsb [ vC ] , u_quatsa [ vC ] , u_transb [ vC ] , u_transa [ vC ] , vt ) ; vq = ve ( vq , u_quatsb [ vC ] , u_quatsa [ vC ] , vt ) ; vr = ve ( vr , u_quatsb [ vC ] , u_quatsa [ vC ] , vt ) ; vs = ve ( vs , u_quatsb [ vC ] , u_quatsa [ vC ] , vt ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vp = uV ( vp , u_quatsb [ vC ] , u_transb [ vC ] ) ; vq = ve ( vq , u_quatsb [ vC ] ) ; vr = ve ( vr , u_quatsb [ vC ] ) ; vs = ve ( vs , u_quatsb [ vC ] ) ;".split(" ")}]}}]},{type:"textline",tokens:["}","}","}"]}]}}]}]};a["include/wind_bending.glslv"]={type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["WIND_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"void vS ( inout vec3 vE , in vec3 vF , in float vG , in float vH , in float vI , in vec3 vJ , in float vK ) { float vL = length ( vF ) ; float vM = vH * ( 1.0 + 0.1 * fract ( vL ) ) ; float vN = vG * vK * ( 1.0 + sin ( 2.0 * 3.14 * vI * vM + vL ) ) ; float vO = ( vE . y - vF . y ) * abs ( vN ) ; vO += 1.0 ; vO *= vO ; vO = vO * vO - vO ; vec3 vP = vE ; vP . xz += vJ . xz * vO * sign ( vN ) ; vec3 vQ = vP - vF ; if ( all ( equal ( vQ , vec3 ( 0.0 ) ) ) ) vE = vF ; else { float vR = length ( vE - vF ) ; vE = vF + normalize ( vQ ) * vR ; } }".split(" ")},
{type:"condition",parts:[{type:"if",expression:["DETAIL_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"vec4 vU ( vec4 vT ) { return vT * vT * ( 3.0 - 2.0 * vT ) ; } vec4 vW ( vec4 vV ) { return abs ( fract ( vV + 0.5 ) * 2.0 - 1.0 ) ; } vec4 vY ( vec4 vX ) { return vU ( vW ( vX ) ) ; } void wo ( inout vec3 vZ , in float v_ , in vec3 wa , in vec3 wb , in vec3 wc , in float wd , in float we , in float wf , in vec3 wg ) { float wh ; float wi ; float wj ; vec2 wk ; vec4 wl ; vec2 wm ; vec3 wn ; wh = dot ( wc , vec3 ( 1.0 ) ) ; wi = wh + wg . g ; wj = dot ( vZ , vec3 ( wg . g ) ) ; wk = ( v_ + vec2 ( wj , wi ) ) ; wl = ( ( fract ( ( wk . xxyy * vec4 ( 1.975 , 0.793 , 0.375 , 0.193 ) ) ) * 2.0 ) - 1.0 ) * length ( wb ) * wd ; wl = vY ( wl ) ; wm = wl . xz + wl . yw ; wm . y = 0.5 - wm . y ; wn = wm . xyx * wg . rbr * vec3 ( we * wa . x , wf , we * wa . z ) ; vZ += wn ; }".split(" ")}]}}]},
{type:"textline",tokens:"void wv ( inout vec3 wp , inout vec3 wq , in vec3 wr ) { vec3 ws = u_wind * 1.0 + 0.7 * sin ( u_time ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["BEND_CENTER_ONLY"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 wt = wq ; vec3 wu = a_emitter_center ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec3 wt = wp ; vec3 wu = wq ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["MAIN_BEND_COL"],
group:{type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["DETAIL_BEND"],group:{type:"group",parts:[{type:"textline",tokens:"wo ( wt , u_time , wr , ws , wu , au_detail_bending_freq , au_detail_bending_amp , au_branch_bending_amp , a_bending_col_detail ) ;".split(" ")}]}}]},{type:"textline",tokens:"vS ( wt , wu , au_wind_bending_amp , au_wind_bending_freq , u_time , ws , a_bending_col_main ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vS ( wt , wu , au_wind_bending_amp , au_wind_bending_freq , u_time , ws , 1.0 ) ;".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["BEND_CENTER_ONLY"],group:{type:"group",parts:[{type:"textline",tokens:"wp += wt - wq ; wq = wt ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"wp = wt ; wq = wu ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]}}]}]};a["include/nodes.glslv"]={type:"group",parts:[{type:"condition",parts:[{type:"if",expression:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:"attribute vec3 a_orco_tex_coord ; varying vec3 eL ;".split(" ")}]}}]},{type:"node",name:"TEX_COORD_UV",declarations:[{type:"node_param",name:"node_TEX_COORD_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"fo",qualifier:["varying","vec2"]}],statements:[{type:"textline",tokens:["fo","=","node_TEX_COORD_UV_var_a_uv",";"]}]},{type:"node",name:"UV_MERGED",declarations:[{type:"node_param",name:"node_UV_MERGED_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"fn",
qualifier:["varying","vec2"]}],statements:[{type:"textline",tokens:["fn","=","node_UV_MERGED_var_a_uv",";"]}]},{type:"node",name:"UVMAP",declarations:[{type:"node_param",name:"node_UVMAP_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",name:"fp",qualifier:["varying","vec2"]}],statements:[{type:"textline",tokens:["fp","=","node_UVMAP_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_UV",declarations:[{type:"node_param",name:"node_GEOMETRY_UV_var_a_uv",qualifier:["attribute","vec2"]},{type:"node_param",
name:"fh",qualifier:["varying","vec2"]}],statements:[{type:"textline",tokens:["fh","=","node_GEOMETRY_UV_var_a_uv",";"]}]},{type:"node",name:"GEOMETRY_VC",declarations:[{type:"node_param",name:"node_GEOMETRY_VC_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"ww",qualifier:["varying","vec3"]}],statements:[{type:"textline",tokens:["ww","=","node_GEOMETRY_VC_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC1",declarations:[{type:"node_param",name:"node_GEOMETRY_VC1_var_a_vertex_color",
qualifier:["attribute","float"]},{type:"node_param",name:"wx",qualifier:["varying","float"]}],statements:[{type:"textline",tokens:["wx","=","node_GEOMETRY_VC1_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC2",declarations:[{type:"node_param",name:"node_GEOMETRY_VC2_var_a_vertex_color",qualifier:["attribute","vec2"]},{type:"node_param",name:"wy",qualifier:["varying","vec2"]}],statements:[{type:"textline",tokens:["wy","=","node_GEOMETRY_VC2_var_a_vertex_color",";"]}]},{type:"node",name:"GEOMETRY_VC3",
declarations:[{type:"node_param",name:"node_GEOMETRY_VC3_var_a_vertex_color",qualifier:["attribute","vec3"]},{type:"node_param",name:"wz",qualifier:["varying","vec3"]}],statements:[{type:"textline",tokens:["wz","=","node_GEOMETRY_VC3_var_a_vertex_color",";"]}]},{type:"nodes_global"},{type:"textline",tokens:["void","wA","(",")","{"]},{type:"condition",parts:[{type:"if",expression:["USE_NODE_GEOMETRY_OR","USE_NODE_TEX_COORD_GE",{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",
tokens:["eL","=","a_orco_tex_coord",";"]}]}}]},{type:"nodes_main"},{type:"textline",tokens:["}"]}]};a["include/dynamic_grass.glslv"]={type:"group",parts:[{type:"var",name:"PRECISION",tokens:["lowp"]},{type:"condition",parts:[{type:"if",expression:["DYNAMIC_GRASS"],group:{type:"group",parts:[{type:"textline",tokens:"vec2 wF ( vec3 wB , float wC , vec2 wD ) { vec2 wE = vec2 ( ( wB . x - wD . x ) / wC , - ( wB . z - wD . y ) / wC ) ; return fract ( wE ) ; } vec2 wJ ( vec2 wG , float wH , vec2 wI ) { return vec2 ( wG . x * wH , - wG . y * wH ) + wI ; } bh wK ( ) { return bh ( vec3 ( - 10000.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) , vec3 ( 0.0 ) ) ; } bh xp ( vec3 wL , vec3 wM , vec3 wN , vec3 wO , vec3 wP , PRECISION sampler2D wQ , sampler2D wR , vec3 wS , float wT , vec3 wU , vec4 wV , mat4 wW ) { vec3 wX = bn ( wV , vec3 ( 0.0 , - 1.0 , 0.0 ) ) ; float wY = - wX . x ; float wZ = - wX . z ; vec2 w_ = vec2 ( wU . x + wT * ( - 1.0 - wY ) / 2.0 , wU . z + wT * ( 1.0 - wZ ) / 2.0 ) ; vec2 xa = wF ( wP , wT , w_ ) ; float xb = wT / 2.0 ; vec2 xc = abs ( wJ ( xa - vec2 ( 0.5 ) , wT , vec2 ( 0.0 ) ) ) ; float xd = xb * ( 1.0 + sqrt ( 2.0 ) ) / 2.0 ; if ( length ( xc ) > xd ) return wK ( ) ; float xe = wT / wS . z ; vec2 xf = ( xa - vec2 ( 0.5 ) ) * xe + vec2 ( 0.5 ) ; vec3 xg = wX * ( wT / wS . z - 1.0 ) / 2.0 ; xf . x += xg . x ; xf . y -= xg . z ; vec4 xh = texture2D ( wR , xf ) ; float xi = xh . r ; if ( xi < u_scale_threshold ) return wK ( ) ; float xj = wS . y - wS . x ; float xk = wS . y - texture2D ( wQ , xf ) . r * xj ; vec2 xl = wL . xz - wP . xz ; wP . xz = wJ ( xa , wT , w_ ) ; wP . y = xk ; wL . xz = wP . xz + xl ; wL . y *= xi ; wL . y += xk ; vec3 xm = xh . gba ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["BILLBOARD"],group:{type:"group",parts:[{type:"textline",tokens:"wL -= wP ; mat4 xn = ug ( wU , wP , wW ) ; bh xo = ut ( wL , wP , wM , wN , wO , xn ) ; xo . b = wP ; xo . f = xm ; return bJ ( xo ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"return bJ ( bh ( wL , wP , wM , wN , wO , xm ) ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]}}]}]};a["include/shadow.glslv"]={type:"group",parts:[{type:"var",name:"SHADOW_TEX_RES",
tokens:["0.0"]},{type:"condition",parts:[{type:"if",expression:["SHADOW_USAGE","SHADOW_MASK_GENERATION",{type:"equal_expr",places:2},"SHADOW_USAGE","SHADOW_MAPPING_BLEND",{type:"equal_expr",places:2},{type:"logical_or_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec4 xv ( mat4 xq , vec4 xr ) { vec2 xs = ( xq * u_v_light_matrix [ 3 ] ) . xy ; float xt = SHADOW_TEX_RES / 2.0 ; xs = floor ( xs * xt + 0.5 ) / xt - xs ; vec4 xu = xq * xr ; xu . xy += xs ; xu = u_b_light_matrix * xu ; return xu ; } void xz ( vec3 xw , vec3 xx ) { vec4 xy = u_v_light_matrix * vec4 ( xw + u_normal_offset * xx , 1.0 ) ; bW = xv ( u_p_light_matrix0 , xy ) ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["CSM_SECTION1"],group:{type:"group",parts:[{type:"textline",tokens:"bX = xv ( u_p_light_matrix1 , xy ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION2"],group:{type:"group",parts:[{type:"textline",tokens:"bY = xv ( u_p_light_matrix2 , xy ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["CSM_SECTION3"],group:{type:"group",parts:[{type:"textline",tokens:"bZ = xv ( u_p_light_matrix3 , xy ) ;".split(" ")}]}}]},
{type:"textline",tokens:["}"]}]}}]}]};a["include/fog.glslf"]={type:"group",parts:[{type:"var",name:"WAVES_HEIGHT",tokens:["0.0"]},{type:"textline",tokens:"void xK ( inout vec3 xD , in float xE , in float xF , in vec4 xG ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["USE_FOG"],group:{type:"group",parts:[{type:"textline",tokens:"float xH = clamp ( ( xE - u_fog_params . z ) / u_fog_params . y , 0.0 , 1.0 ) ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["FOG_TYPE","QUADRATIC",
{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:["xH","*=","xH",";"]}]}},{type:"elif",expression:["FOG_TYPE","LINEAR",{type:"equal_expr",places:2}],group:{type:"group",parts:[]}},{type:"elif",expression:["FOG_TYPE","INVERSE_QUADRATIC",{type:"equal_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"xH = sqrt ( xH ) ;".split(" ")}]}}]},{type:"textline",tokens:"if ( u_fog_params . w > 0.0 ) { if ( xF > u_fog_params . w ) xH = 0.0 ; else if ( xF > 0.0 ) { float xI = ( u_fog_params . w - xF ) / u_fog_params . w ; xH *= xI * xI ; } } float xJ = 1.0 - ( 1.0 - xH ) * ( 1.0 - u_fog_params . x ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["float","xJ","=","0.0",";"]}]}}]},{type:"textline",tokens:"xD = mix ( xD , xG . rgb , xJ ) ; }".split(" ")},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_FOG"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 xR ( in mat4 xL , in vec3 xM ) { vec3 xN = mix ( xL [ 0 ] . rgb , xL [ 1 ] . rgb , max ( sign ( xM . x ) , 0.0 ) ) ; vec3 xO = mix ( xL [ 2 ] . rgb , xL [ 3 ] . rgb , max ( sign ( xM . z ) , 0.0 ) ) ; vec3 xP = vec3 ( xL [ 0 ] . a , xL [ 1 ] . a , xL [ 2 ] . a ) ; vec3 xQ = mix ( xN , xO , abs ( xM . z ) ) ; xQ = mix ( xQ , xP , abs ( xM . y ) ) ; a_ ( xQ ) ; return xQ ; }".split(" ")}]}}]},
{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",parts:[{type:"textline",tokens:"void xT ( inout float xS ) { xS -= 0.5 ; xS = 4.0 * ( xS * xS * xS ) + 0.5 ; } void yi ( inout vec3 xU , in float xV , in vec3 xW , in float xX , in vec4 xY , in vec4 xZ , in float x_ ) { float ya = xZ . w * xV ; float yb = exp ( - ya * ya ) ; yb = clamp ( yb , 0.0 , 1.0 ) ; float yc = max ( xW . y , 0.0 ) ; xV = max ( xV - max ( xX / yc , 0.0 ) , 0.0 ) ; float yd = xY . w * xV ; float ye = 1.0 - yd ; ye = max ( ye , 0.0 ) ; xT ( ye ) ; ye += max ( x_ - 0.5 , 0.0 ) ; if ( ye < yb ) { vec3 yf = vec3 ( 0.0 , 0.02 , 0.05 ) ; vec3 yg = xY . rgb ; xX = clamp ( - xX * 0.03 , 0.0 , 0.8 ) ; vec3 yh = mix ( yg , yf , min ( yc , 1.0 ) ) ; yh = mix ( yh , vec3 ( 0.0 ) , xX ) ; xU = mix ( yh , xU , ye ) ; } if ( ye >= yb ) { xU = mix ( xZ . rgb , xU , yb ) ; } } void yp ( inout vec3 yj , in float yk , in float yl ) { float ym = u_underwater_fog_color_density . w * yk ; float yn = 1.0 - ym ; yn = clamp ( yn , 0.0 , 1.0 ) ; xT ( yn ) ; yl = clamp ( - yl * 0.03 , 0.0 , 0.8 ) ; vec3 yo = mix ( u_underwater_fog_color_density . rgb , vec3 ( 0.0 ) , yl ) ; yj = mix ( yo , yj , yn ) ; }".split(" ")}]}}]},
{type:"textline",tokens:"void yw ( inout vec3 yq , float yr , vec3 ys , float yt ) {".split(" ")},{type:"condition",parts:[{type:"if",expression:["PROCEDURAL_FOG"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 yu = xR ( u_cube_fog , ys ) ; vec4 yv = vec4 ( yu , u_fog_color_density . a ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:["vec4","yv","=","u_fog_color_density",";"]}]}}]},{type:"condition",parts:[{type:"if",expression:["WATER_EFFECTS"],group:{type:"group",
parts:[{type:"textline",tokens:"yi ( yq , yr , ys , u_cam_water_depth , u_underwater_fog_color_density , yv , yt ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"xK ( yq , yr , bQ . y , yv ) ;".split(" ")}]}}]},{type:"textline",tokens:["}"]}]};a["include/lighting_nodes.glslf"]={type:"group",parts:[{type:"var",name:"LAMP_IND",tokens:["0"]},{type:"var",name:"LAMP_SPOT_SIZE",tokens:["0"]},{type:"var",name:"LAMP_SPOT_BLEND",tokens:["0"]},{type:"var",name:"LAMP_LIGHT_DIST",
tokens:["0"]},{type:"var",name:"LAMP_LIGHT_FACT_IND",tokens:["0"]},{type:"var",name:"LAMP_FAC_CHANNELS",tokens:["rgb"]},{type:"var",name:"LAMP_SHADOW_MAP_IND",tokens:["0"]},{type:"define",name:"M_PI",tokens:["3.14159265359"]},{type:"textline",tokens:"float yz = 0.0 ; float yA = 1.0 ; float yB = 0.5 ; vec3 yC = vec3 ( yz ) ;".split(" ")},{type:"node",name:"LIGHTING_BEGIN",declarations:[{type:"node_out",name:"yR",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"yS",qualifier:["vec3"],is_optional:!1},
{type:"node_out",name:"yT",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"yU",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"yV",qualifier:["vec3"],is_optional:!0},{type:"node_out",name:"yW",qualifier:["vec2"],is_optional:!0},{type:"node_out",name:"yX",qualifier:["vec2"],is_optional:!0},{type:"node_out",name:"yY",qualifier:["float"],is_optional:!0},{type:"node_out",name:"yZ",qualifier:["float"],is_optional:!0},{type:"node_out",name:"y_",qualifier:["vec4"],is_optional:!0}],statements:[{type:"textline",
tokens:"yR = yD ; yS = yE ; yT = yF ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_yU"],statements:[{type:"textline",tokens:["yU","=","yG",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_yV"],statements:[{type:"textline",tokens:["yV","=","yI",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_yX"],statements:[{type:"textline",tokens:["yX","=","yK",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_yW"],
statements:[{type:"textline",tokens:["yW","=","yL",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_yY"],statements:[{type:"textline",tokens:["yY","=","yM",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_yZ"],statements:[{type:"textline",tokens:["yZ","=","yN",";"]}]}]},{type:"node_condition",parts:[{type:"node_if",expression:["USE_OUT_y_"],statements:[{type:"textline",tokens:["y_","=","yO",";"]}]}]}]},{type:"node",name:"LIGHTING_AMBIENT",declarations:[{type:"node_in",
name:"za",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"zb",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"zc",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"zd",qualifier:["vec4"],is_optional:!1},{type:"node_out",name:"ze",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"zd = vec4 ( za + zc * zb , yz ) ; ze = yC ;".split(" ")}]},{type:"node",name:"LIGHTING_LAMP",declarations:[{type:"node_in",name:"zf",qualifier:["float"],is_optional:!1},{type:"node_out",
name:"zg",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"zh",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"zi",qualifier:["vec3"],is_optional:!1},{type:"node_out",name:"zj",qualifier:["float"],is_optional:!1}],statements:[{type:"node_condition",parts:[{type:"node_if",expression:["NODES_GLOW",{type:"logic_negative_expr",places:1},"NUM_LIGHTS",0,{type:"g_expr",places:2},{type:"logical_and_expr",places:2}],statements:[{type:"textline",tokens:"zh = u_light_factors [ LAMP_LIGHT_FACT_IND ] . LAMP_FAC_CHANNELS ;".split(" ")},
{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_TYPE","HEMI",{type:"equal_expr",places:2}],statements:[{type:"textline",tokens:["zj","=","yB",";"]}]},{type:"node_else",statements:[{type:"textline",tokens:["zj","=","yz",";"]}]}]},{type:"textline",tokens:"zi = u_light_color_intensities [ LAMP_IND ] ; if ( LAMP_SHADOW_MAP_IND != - 1 ) zi *= zf ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_TYPE","SPOT",{type:"equal_expr",places:2},"LAMP_TYPE","POINT",{type:"equal_expr",
places:2},{type:"logical_or_expr",places:2}],statements:[{type:"textline",tokens:"vec3 zk = u_light_positions [ LAMP_IND ] ; zg = zk - yH ;".split(" ")},{type:"textline",tokens:"float zl = length ( zg ) ; zi *= LAMP_LIGHT_DIST / ( LAMP_LIGHT_DIST + zl * zl ) ; zg = normalize ( zg ) ;".split(" ")},{type:"node_condition",parts:[{type:"node_if",expression:["LAMP_TYPE","SPOT",{type:"equal_expr",places:2}],statements:[{type:"textline",tokens:"vec3 zm = u_light_directions [ LAMP_IND ] ; float zn = dot ( zg , zm ) ; zn *= smoothstep ( yz , yA , ( zn - LAMP_SPOT_SIZE ) / LAMP_SPOT_BLEND ) ; zi *= zn ;".split(" ")}]}]}]},
{type:"node_else",statements:[{type:"textline",tokens:"zg = u_light_directions [ LAMP_IND ] ;".split(" ")}]}]}]}]}]},{type:"node",name:"DIFFUSE_FRESNEL",declarations:[{type:"node_in",name:"zo",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"zp",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"zq",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"zr",qualifier:["float"],is_optional:!1},{type:"node_in",name:"zs",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"zt",qualifier:["float"],
is_optional:!1}],statements:[{type:"textline",tokens:"zt = yz ; if ( zp . r != yz ) { float zu = ( yA - zr ) * dot ( zq , zo ) + zr ; if ( zs [ 0 ] == yz ) { zt = yA ; } else { float zv = yA + abs ( zu ) ; zv = zs [ 1 ] + ( yA - zs [ 1 ] ) * pow ( zv , zs [ 0 ] ) ; zt = clamp ( zv , yz , yA ) ; } zt = max ( zt , yz ) ; }".split(" ")}]},{type:"node",name:"DIFFUSE_LAMBERT",declarations:[{type:"node_in",name:"zw",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"zx",qualifier:["vec2"],is_optional:!1},
{type:"node_in",name:"zy",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"zz",qualifier:["float"],is_optional:!1},{type:"node_out",name:"zA",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"zA = yz ; if ( zx . r != yz ) { float zB = ( yA - zz ) * dot ( zy , zw ) + zz ; zA = max ( zB , yz ) ; }".split(" ")}]},{type:"node",name:"DIFFUSE_OREN_NAYAR",declarations:[{type:"node_in",name:"zC",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"zD",qualifier:["vec2"],
is_optional:!1},{type:"node_in",name:"zE",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"zF",qualifier:["float"],is_optional:!1},{type:"node_in",name:"zG",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"zH",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"zH = yz ; if ( zD . r != yz ) { float zI = ( yA - zF ) * dot ( zE , zC ) + zF ; if ( zG [ 0 ] > yz ) { float zJ = max ( dot ( zE , yJ ) , yz ) ; float zK = zG [ 0 ] * zG [ 0 ] ; float zL = yA - yB * ( zK / ( zK + 0.33 ) ) ; vec3 zM = zC - zI * zE ; vec3 zN = yJ - zJ * zE ;".split(" ")},
{type:"textline",tokens:"if ( length ( zM ) == yz || length ( zN ) == yz || abs ( zI ) > yA || abs ( zJ ) > yA )".split(" ")},{type:"textline",tokens:"zH = zI * zL ; else { float zO = acos ( zI ) ; float zP = acos ( zJ ) ; vec3 zQ = normalize ( zM ) ; vec3 zR = normalize ( zN ) ; float zS , zT ; zS = max ( zO , zP ) ; zT = min ( zO , zP ) ; zT *= 0.95 ; float zU = max ( dot ( zQ , zR ) , yz ) ; float zV = 0.45 * ( zK / ( zK + 0.09 ) ) ; zH = zI * ( zL + ( zV * zU * sin ( zS ) * tan ( zT ) ) ) ; } } else zH = zI ; zH = max ( zH , yz ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_MINNAERT",declarations:[{type:"node_in",name:"zW",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"zX",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"zY",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"zZ",qualifier:["float"],is_optional:!1},{type:"node_in",name:"z_",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"Aa",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"Aa = yz ; if ( zX . r != yz ) { float Ab = ( yA - zZ ) * dot ( zY , zW ) + zZ ; float Ac = max ( dot ( zY , yJ ) , yz ) ; if ( z_ [ 0 ] <= yA ) Aa = Ab * pow ( max ( Ac * Ab , 0.1 ) , z_ [ 0 ] - yA ) ; else Aa = Ab * pow ( 1.0001 - Ac , z_ [ 0 ] - yA ) ; Aa = max ( Aa , yz ) ; }".split(" ")}]},
{type:"node",name:"DIFFUSE_TOON",declarations:[{type:"node_in",name:"Ad",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Ae",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"Af",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Ag",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Ah",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"Ai",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"Ai = yz ; if ( Ae . r != yz ) { float Aj = ( yA - Ag ) * dot ( Af , Ad ) + Ag ; float Ak = acos ( Aj ) ; if ( Ak < Ah [ 0 ] ) Ai = yA ; else if ( Ak > ( Ah [ 0 ] + Ah [ 1 ] ) || Ah [ 1 ] == yz ) Ai = yz ; else Ai = yA - ( ( Ak - Ah [ 0 ] ) / Ah [ 1 ] ) ; Ai = max ( Ai , yz ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_PHONG",declarations:[{type:"node_in",name:"Al",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Am",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"An",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Ao",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Ap",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"Aq",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"Aq = yz ; if ( Am . g != yz ) { vec3 Ar = normalize ( Al + yJ ) ; Aq = ( yA - Ao ) * max ( dot ( An , Ar ) , yz ) + Ao ; Aq = pow ( Aq , Ap [ 0 ] ) ; }".split(" ")}]},
{type:"node",name:"SPECULAR_WARDISO",declarations:[{type:"node_in",name:"As",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"At",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"Au",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Av",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"Aw",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"Aw = yz ; if ( At . g != yz ) { vec3 Ax = normalize ( As + yJ ) ; float Ay = max ( dot ( Au , Ax ) , 0.001 ) ;".split(" ")},
{type:"textline",tokens:"float Az = max ( dot ( Au , yJ ) , 0.01 ) ; float AA = max ( dot ( Au , As ) , 0.01 ) ; float AB = tan ( acos ( Ay ) ) ; float AC = max ( Av [ 0 ] , 0.001 ) ; Aw = AA * ( yA / ( 4.0 * M_PI * AC * AC ) ) * ( exp ( - ( AB * AB ) / ( AC * AC ) ) / ( sqrt ( Az * AA ) ) ) ; }".split(" ")}]},{type:"node",name:"SPECULAR_TOON",declarations:[{type:"node_in",name:"AD",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"AE",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"AF",
qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"AG",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"AH",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"AH = yz ; if ( AE . g != yz ) { vec3 AI = normalize ( AD + yJ ) ; float AJ = acos ( dot ( AI , AF ) ) ; if ( AJ < AG [ 0 ] ) AH = yA ; else if ( AJ >= AG [ 0 ] + AG [ 1 ] || AG [ 1 ] == yz ) AH = yz ; else AH = yA - ( AJ - AG [ 0 ] ) / AG [ 1 ] ; }".split(" ")}]},{type:"node",name:"SPECULAR_BLINN",declarations:[{type:"node_in",
name:"AK",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"AL",qualifier:["vec2"],is_optional:!1},{type:"node_in",name:"AM",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"AN",qualifier:["float"],is_optional:!1},{type:"node_in",name:"AO",qualifier:["vec2"],is_optional:!1},{type:"node_out",name:"AP",qualifier:["float"],is_optional:!1}],statements:[{type:"textline",tokens:"AP = yz ; if ( AL . g != yz ) { if ( AO [ 0 ] < 1.0 || AO [ 1 ] == yz ) AP = yz ; else { if ( AO [ 1 ] < 100.0 ) AO [ 1 ] = sqrt ( 1.0 / AO [ 1 ] ) ; else AO [ 1 ] = 10.0 / AO [ 1 ] ; vec3 AQ = normalize ( yJ + AK ) ; float AR = ( yA - AN ) * max ( dot ( AM , AQ ) , yz ) + AN ; if ( AR < yz ) AP = yz ; else { float AS = max ( dot ( AM , yJ ) , 0.01 ) ; float AT = dot ( AM , AK ) ; if ( AT <= 0.01 ) AP = yz ; else { float AU = max ( dot ( yJ , AQ ) , 0.01 ) ; float AV = yA ; float AW = ( 2.0 * AR * AS ) / AU ; float AX = ( 2.0 * AR * AT ) / AU ; float AY = min ( min ( AV , AW ) , AX ) ; float AZ = sqrt ( pow ( AO [ 0 ] , 2.0 ) + pow ( AU , 2.0 ) - yA ) ; float A_ = pow ( AZ - AU , 2.0 ) / pow ( AZ + AU , 2.0 ) * ( yA + pow ( AU * ( AZ + AU ) - yA , 2.0 ) / pow ( AU * ( AZ - AU ) + yA , 2.0 ) ) ; float Ba = acos ( AR ) ; AP = max ( A_ * AY * exp ( - pow ( Ba , 2.0 ) / ( 2.0 * pow ( AO [ 1 ] , 2.0 ) ) ) , yz ) ; } } } }".split(" ")}]},
{type:"node",name:"LIGHTING_APPLY",declarations:[{type:"node_in",name:"Bb",qualifier:["vec4"],is_optional:!1},{type:"node_in",name:"Bc",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Bd",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Be",qualifier:["float"],is_optional:!1},{type:"node_in",name:"Bf",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Bg",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Bh",qualifier:["vec4"],is_optional:!1},{type:"node_in",name:"Bi",
qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Bj",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Bk",qualifier:["vec3"],is_optional:!1},{type:"node_in",name:"Bl",qualifier:["float"],is_optional:!1},{type:"node_out",name:"Bm",qualifier:["vec4"],is_optional:!1},{type:"node_out",name:"Bn",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"Bn = Bc + Bk * Bj * Be ; Bm = Bb + vec4 ( Bk * Bi * Bd , Be ) ;".split(" ")}]},{type:"node",name:"LIGHTING_END",declarations:[{type:"node_in",
name:"Bo",qualifier:["vec4"],is_optional:!1},{type:"node_in",name:"Bp",qualifier:["vec3"],is_optional:!1}],statements:[{type:"textline",tokens:"yP = Bo . rgb ; yQ = Bp ;".split(" ")}]},{type:"nodes_global"},{type:"textline",tokens:"void Bq ( vec3 yD , vec3 yE , vec3 yF , vec3 yG , vec3 yH , vec3 yI , vec3 yJ , vec2 yK , vec2 yL , float yM , float yN , vec4 yO , out vec3 yP , out vec3 yQ ) {".split(" ")},{type:"nodes_main"},{type:"textline",tokens:["}"]}]};a["include/particles.glslv"]={type:"group",
parts:[{type:"var",name:"EPSILON",tokens:["0.0001"]},{type:"textline",tokens:"struct Bt { float a ; vec3 b ; float c ; vec3 d ; float e ; } ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["SIZE_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"void BA ( inout float Bu , float Bv , vec2 Bw , vec2 Bx ) { float By = Bx . x - Bw . x ; float Bz = ( Bv - Bw . x ) / By ; Bu = mix ( Bu , Bx . y , clamp ( Bz , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",
parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"void BH ( inout vec3 BB , float BC , vec4 BD , vec4 BE ) { float BF = BE . x - BD . x ; float BG = ( BC - BD . x ) / BF ; BB = mix ( BB , BE . yzw , clamp ( BG , 0.0 , 1.0 ) ) ; }".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SIZE_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"float BN ( float BI , float BJ , vec2 BK [ SIZE_RAMP_LENGTH ] ) { float BL = BI / BJ ; float BM = BK [ 0 ] . y ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SIZE_RAMP_LENGTH",1,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"BA ( BM , BL , BK [ 0 ] , BK [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SIZE_RAMP_LENGTH",2,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"BA ( BM , BL , BK [ 1 ] , BK [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["SIZE_RAMP_LENGTH",3,{type:"g_expr",places:2}],
group:{type:"group",parts:[{type:"textline",tokens:"BA ( BM , BL , BK [ 2 ] , BK [ 3 ] ) ;".split(" ")}]}}]},{type:"textline",tokens:["return","BM",";","}"]}]}}]},{type:"condition",parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"vec3 BT ( float BO , float BP , vec4 BQ [ COLOR_RAMP_LENGTH ] ) { float BR = BO / BP ; vec3 BS = BQ [ 0 ] . yzw ;".split(" ")},{type:"condition",parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",
1,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"BH ( BS , BR , BQ [ 0 ] , BQ [ 1 ] ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",2,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"BH ( BS , BR , BQ [ 1 ] , BQ [ 2 ] ) ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",3,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"BH ( BS , BR , BQ [ 2 ] , BQ [ 3 ] ) ;".split(" ")}]}}]},
{type:"textline",tokens:["return","BS",";","}"]}]}}]},{type:"textline",tokens:"float Cb ( float BU , float BV , float BW , float BX ) { float BY = max ( 0.01 , min ( BV , BW ) ) ; float BZ = max ( 0.01 , min ( BV , BX ) ) ; float B_ = BV - BZ ; float Ca = clamp ( BU / BY , 0.0 , 1.0 ) - step ( B_ , BU ) * ( BU - B_ ) / BZ ; return Ca ; } Bt Ch ( ) { Bt Cc ; float Cd ; if ( u_p_cyclic == 1 ) { Cd = mod ( u_p_time , u_p_length ) - a_p_delay ; if ( Cd < 0.0 ) Cd += u_p_length ; } if ( u_p_cyclic != 1 ) { Cd = u_p_time - a_p_delay ; } if ( Cd < 0.0 || Cd >= a_p_lifetime ) { Cc . a = 0.0001 ; Cc . b = vec3 ( 99999.0 , 0.0 , 0.0 ) ; } if ( ! ( Cd < 0.0 || Cd >= a_p_lifetime ) ) {".split(" ")},
{type:"condition",parts:[{type:"if",expression:["WORLD_SPACE"],group:{type:"group",parts:[{type:"textline",tokens:"vec3 Ce = a_position ; vec3 Cf = a_normal ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"vec3 Ce = ( u_model_matrix * vec4 ( a_position , 1.0 ) ) . xyz ; vec3 Cf = ( u_model_matrix * vec4 ( a_normal , 0.0 ) ) . xyz ;".split(" ")}]}}]},{type:"textline",tokens:"Ce += u_p_nfactor * Cd * Cf ; Ce += a_p_vels . xyz * Cd ; Ce . y -= u_p_gravity * Cd * Cd / 2.0 ; float Cg = max ( u_p_mass , EPSILON ) ; Ce += ( u_p_wind_fac * u_wind / Cg ) * Cd * Cd / 2.0 ; Cc . b = Ce ; Cc . e = a_p_vels . w * Cd ;".split(" ")},
{type:"condition",parts:[{type:"if",expression:["SIZE_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Cc . a = BN ( Cd , u_p_max_lifetime , u_p_size_ramp ) ;".split(" ")}]}},{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Cc . a = 1.0 ;".split(" ")}]}}]},{type:"condition",parts:[{type:"if",expression:["COLOR_RAMP_LENGTH",0,{type:"g_expr",places:2}],group:{type:"group",parts:[{type:"textline",tokens:"Cc . d = BT ( Cd , u_p_max_lifetime , u_p_color_ramp ) ;".split(" ")}]}},
{type:"else",group:{type:"group",parts:[{type:"textline",tokens:"Cc . d = vec3 ( 1.0 ) ;".split(" ")}]}}]},{type:"textline",tokens:"Cc . c = Cb ( Cd , a_p_lifetime , u_p_fade_in , u_p_fade_out ) ; } return Cc ; }".split(" ")}]};a["include/blending.glslf"]={type:"group",parts:[{type:"textline",tokens:"float Cj = 0.0 ; float Ck = 1.0 ; vec3 Cl = vec3 ( Cj ) ; vec3 Cm = vec3 ( Ck ) ; vec3 Ct ( vec3 Cn ) { vec4 Co = vec4 ( Cj , - Ck / 3.0 , 2.0 / 3.0 , - Ck ) ; vec4 Cp = mix ( vec4 ( Cn . bg , Co . wz ) , vec4 ( Cn . gb , Co . xy ) , step ( Cn . b , Cn . g ) ) ; vec4 Cq = mix ( vec4 ( Cp . xyw , Cn . r ) , vec4 ( Cn . r , Cp . yzx ) , step ( Cp . x , Cn . r ) ) ; float Cr = Cq . x - min ( Cq . w , Cq . y ) ; float Cs = 1.0e-10 ; return vec3 ( abs ( Cq . z + ( Cq . w - Cq . y ) / ( 6.0 * Cr + Cs ) ) , Cr / ( Cq . x + Cs ) , Cq . x ) ; } vec3 Cx ( vec3 Cu ) { vec4 Cv = vec4 ( Ck , 2.0 / 3.0 , Ck / 3.0 , 3.0 ) ; vec3 Cw = abs ( fract ( vec3 ( Cu . r , Cu . r , Cu . r ) + Cv . xyz ) * 6.0 - Cv . www ) ; return Cu . b * mix ( Cv . xxx , clamp ( Cw - Cv . xxx , Cj , Ck ) , Cu . g ) ; } vec3 CB ( vec3 Cy , vec3 Cz , float CA ) { return mix ( Cy , Cz , CA ) ; } vec3 CF ( vec3 CC , vec3 CD , float CE ) { return CE * CC + CD ; } vec3 CJ ( vec3 CG , vec3 CH , float CI ) { return CH - CI * CG ; } vec3 CO ( vec3 CK , vec3 CL , float CM ) { float CN = Ck - CM ; return ( vec3 ( CN ) + CM * CK ) * CL ; } vec3 CT ( vec3 CP , vec3 CQ , float CR ) { vec3 CS = vec3 ( Ck - CR ) ; return Cm - ( CS + CR * ( Cm - CP ) ) * ( Cm - CQ ) ; } vec3 CY ( vec3 CU , vec3 CV , float CW ) { vec3 CX = vec3 ( Ck - CW ) ; return mix ( CV * ( CX + 2.0 * CW * CU ) , Cm - ( CX + 2.0 * CW * ( Cm - CU ) ) * ( Cm - CV ) , step ( 0.5 , CV ) ) ; } vec3 Db ( vec3 CZ , vec3 C_ , float Da ) { return mix ( C_ , abs ( CZ - C_ ) , Da ) ; } vec3 Df ( vec3 Dc , vec3 Dd , float De ) { return mix ( Dd , Dd / ( Dc + step ( Dc , Cl ) ) , De ) ; } vec3 Dj ( vec3 Dg , vec3 Dh , float Di ) { return mix ( Dh , min ( Dg , Dh ) , Di ) ; } vec3 Dn ( vec3 Dk , vec3 Dl , float Dm ) { return max ( Dm * Dk , Dl ) ; } vec3 Du ( vec3 Do , vec3 Dp , float Dq ) { vec3 Dr = Ct ( Dp ) ; if ( Dr . y != Cj ) { vec3 Ds = Ct ( Do ) ; vec3 Dt = Cx ( vec3 ( Dr . x , Ds . yz ) ) ; return mix ( Do , Dt , Dq ) ; } return Do ; } vec3 DA ( vec3 Dv , vec3 Dw , float Dx ) { vec3 Dy = Ct ( Dv ) ; if ( Dy . y != Cj ) { vec3 Dz = Ct ( Dw ) ; return Cx ( vec3 ( Dy . x , mix ( Dy . y , Dz . y , Dx ) , Dy . z ) ) ; } return Dv ; } vec3 DG ( vec3 DB , vec3 DC , float DD ) { vec3 DE = Ct ( DB ) ; vec3 DF = Ct ( DC ) ; return Cx ( vec3 ( DE . xy , mix ( DE . z , DF . z , DD ) ) ) ; } vec3 DN ( vec3 DH , vec3 DI , float DJ ) { vec3 DK = Ct ( DI ) ; if ( DK . y != Cj ) { vec3 DL = Ct ( DH ) ; vec3 DM = Cx ( vec3 ( DK . xy , DL . z ) ) ; return mix ( DH , DM , DJ ) ; } return DH ; } vec3 DS ( vec3 DO , vec3 DP , float DQ ) { vec3 DR = Cm - ( Cm - DP ) * ( Cm - DO ) ; return mix ( DO , ( ( Cm - DO ) * DP * DO ) + DO * DR , DQ ) ; } vec3 DW ( vec3 DT , vec3 DU , float DV ) { return DT + DV * ( 2.0 * DU - Ck ) ; } float Eb ( float DX , float DY , float DZ , float D_ ) { float Ea = Ck - D_ ; return ( Ea + DZ * DX ) * DY ; } float Eh ( float Ec , float Ed , float Ee , float Ef ) { float Eg = Ck - Ef ; return Ck - ( Eg + Ee * ( Ck - Ec ) ) * ( Ck - Ed ) ; } float En ( float Ei , float Ej , float Ek , float El ) { float Em = Ck - El ; return mix ( Ej * ( Em + 2.0 * Ek * Ei ) , Ck - ( Em + 2.0 * Ek * ( Ck - Ei ) ) * ( Ck - Ej ) , step ( 0.5 , Ej ) ) ; }".split(" ")}]};
a["include/depth_fetch.glslf"]={type:"group",parts:[{type:"textline",tokens:"float EA ( in sampler2D Et , in vec2 Eu , in vec2 Ev ) { float Ew = texture2D ( Et , Eu ) . r ; float Ex = Ev . x ; float Ey = Ev . y ; float Ez = 2.0 * Ex / ( Ex + Ey - ( 2.0 * Ew - 1.0 ) * ( Ey - Ex ) ) ; return Ez ; }".split(" ")}]}};b4w.module.animation=function(a,r){var u=r("__animation"),h=r("__print"),b=r("__armature"),l=r("__obj_util");a.SLOT_0=u.SLOT_0;a.SLOT_1=u.SLOT_1;a.SLOT_2=u.SLOT_2;a.SLOT_3=u.SLOT_3;a.SLOT_4=u.SLOT_4;a.SLOT_5=u.SLOT_5;a.SLOT_6=u.SLOT_6;a.SLOT_7=u.SLOT_7;a.SLOT_ALL=u.SLOT_ALL;a.OBJ_ANIM_TYPE_NONE=u.OBJ_ANIM_TYPE_NONE;a.OBJ_ANIM_TYPE_ARMATURE=u.OBJ_ANIM_TYPE_ARMATURE;a.OBJ_ANIM_TYPE_OBJECT=u.OBJ_ANIM_TYPE_OBJECT;a.OBJ_ANIM_TYPE_VERTEX=u.OBJ_ANIM_TYPE_VERTEX;a.OBJ_ANIM_TYPE_SOUND=u.OBJ_ANIM_TYPE_SOUND;
a.OBJ_ANIM_TYPE_PARTICLES=u.OBJ_ANIM_TYPE_PARTICLES;a.OBJ_ANIM_TYPE_MATERIAL=u.OBJ_ANIM_TYPE_MATERIAL;a.AB_CYCLIC=u.AB_CYCLIC;a.AB_FINISH_RESET=u.AB_FINISH_RESET;a.AB_FINISH_STOP=u.AB_FINISH_STOP;var c=new Float32Array(8);a.is_animated=function(a){return u.is_animated(a)};a.get_actions=function(){h.error("get_actions() deprecated, use get_anim_names() instead");for(var a=[],b=u.get_all_actions(),c=0;c<b.length;c++)a.push(u.strip_baked_suffix(b[c].name));return a};a.get_current_action=function(b,c){h.error("get_current_action() deprecated, use get_current_anim_name() instead");
return a.get_current_anim_name(b,c)};a.get_anim_names=function(a){return u.obj_is_animatable(a)?u.get_anim_names(a):[]};a.get_current_anim_name=function(a,b){if(!u.is_animated(a))return null;b=b||u.SLOT_0;return u.get_anim_by_slot_num(a,b)};a.apply=function(a,b,c){if(c>u.SLOT_7)h.error("Can't apply animation to slot "+c+' for object "'+a.name+'". Object can have maximum of 8 animation slots');else{c=c||u.SLOT_0;if(u.is_animated(a)){var d=u.get_slot_num_by_anim(a,b);if(-1!=d&&d!=c){h.error('Animation "'+
b+'" is already applied to object "'+a.name+'" (slot "'+d+'").');return}}u.validate_action_by_name(a,b)?u.apply(a,b,c):h.error('No fcurves in action "'+b+'"')}};a.remove=function(a){u.remove(a)};a.remove_slot_animation=function(a,b){u.is_animated(a)&&(b=b||u.SLOT_0,u.remove_slot_animation(a,b))};a.apply_def=function(a){u.apply_def(a)};a.play=function(a,b,c){u.is_animated(a)?(c=c||u.SLOT_0,u.play(a,b,c),u.update_object_animation(a,0,c,!0)):h.error('Object "'+a.name+'" has no applied animation')};a.stop=
function(a,b){u.is_animated(a)&&(b=b||u.SLOT_0,u.stop(a,b))};a.is_play=function(a,b){if(!u.is_animated(a))return!1;b=b||u.SLOT_0;return u.is_play(a,b)};a.set_current_frame_float=function(b,c,l){h.error("set_current_frame_float() deprecated, use set_frame() instead");a.set_frame(b,c,l)};a.get_current_frame_float=function(b,c){h.error("get_current_frame_float() deprecated, use get_frame() instead");return a.get_frame(b,c)};a.set_frame=function(a,b,c){u.is_animated(a)&&(c=c||u.SLOT_0,u.set_frame(a,b,
c))};a.set_first_frame=function(a,b){u.is_animated(a)&&u.set_first_frame(a,b)};a.set_last_frame=function(a,b){if(u.is_animated(a)){b=b||u.SLOT_0;var c=u.get_anim_start_frame(a,b),d=u.get_anim_length(a,b);u.set_frame(a,c+d-u.LAST_FRAME_EPSILON,b)}};a.get_frame=function(a,b){if(!u.is_animated(a))return 0;b=b||u.SLOT_0;return u.get_current_frame_float(a,b)};a.set_speed=function(a,b,c){u.is_animated(a)&&(c=c||u.SLOT_0,u.set_speed(a,b||1,c))};a.get_speed=function(a,b){if(!u.is_animated(a))return 0;b=b||
u.SLOT_0;return a.anim_slots[b]?u.get_speed(a,b):0};a.get_frame_range=function(a,b){h.error("get_frame_range() deprecated, use get_anim_start_frame() and get_anim_length() instead");if(u.is_animated(a)){b=b||u.SLOT_0;var c=a.anim_slots[b];if(c)return[c.start,c.start+c.length]}return null};a.get_anim_start_frame=function(a,b){return u.is_animated(a)&&(b=b||u.SLOT_0,a.anim_slots[b])?u.get_anim_start_frame(a,b):-1};a.get_anim_length=function(a,b){return u.is_animated(a)&&(b=b||u.SLOT_0,a.anim_slots[b])?
u.get_anim_length(a,b):-1};a.cyclic=function(b,c,l){h.error("cyclic() deprecated, use set_behavior() instead");a.set_behavior(b,c?u.AB_CYCLIC:u.AB_FINISH_RESET,l)};a.is_cyclic=function(a,b){h.error("is_cyclic() deprecated, use get_behavior() instead");if(!u.is_animated(a))return!1;b=b||u.SLOT_0;return u.is_cyclic(a,b)};a.set_behavior=function(a,b,c){u.is_animated(a)&&(c=c||u.SLOT_0,u.set_behavior(a,b,c))};a.get_behavior=function(a,b){if(!u.is_animated(a))return null;b=b||u.SLOT_0;return u.get_behavior(a,
b)};a.apply_smoothing=function(a,b,c,d){d=d||u.SLOT_0;u.is_animated(a)&&u.apply_smoothing(a,b,c,d)};a.update_object_animation=function(a,b,c,d){h.error("update_object_animation() deprecated, use set_frame() instead");u.is_animated(a)&&(c=c||u.SLOT_0,u.update_object_animation(a,b||0,c,d||!1))};a.frame_to_sec=function(a){return u.frame_to_sec(a)};a.get_bone_translation=function(a,n,q){h.error("get_bone_translation() deprecated, use armature.get_bone_tsr() instead");if(!l.is_armature(a))return null;
if(!b.check_bone(a,n))return h.error('There is no bone: "',n,'" in "',a.name,'".'),null;q||(q=new Float32Array(3));b.get_bone_tsr(a,n,!1,!1,c);q[0]=c[0];q[1]=c[1];q[2]=c[2];return q};a.get_first_armature_object=function(a){h.error("get_first_armature_object() deprecated");return null};a.get_slot_num_by_anim=function(a,b){return u.is_animated(a)&&b?u.get_slot_num_by_anim(a,b):null};a.get_anim_type=function(a,b){return u.is_animated(a)?u.get_anim_type(a,b):null};a.apply_to_first_empty_slot=function(a,
b){return u.apply_to_first_empty_slot(a,b)};a.get_skel_mix_factor=function(a){return a.render.anim_mix_factor};a.set_skel_mix_factor=function(a,b,c){l.is_armature(a)?(b=Math.min(Math.max(b,0),1),a.render.anim_mix_factor!=b&&u.set_skel_mix_factor(a,b,c||0)):h.error("Can't blend animation. Object \""+a.name+'" is not armature')}};b4w.module.anchors=function(a,r){var u=r("__anchors");r("__print");a.attach_move_cb=u.attach_move_cb;a.detach_move_cb=u.detach_move_cb;a.is_anchor=u.is_anchor;a.get_element_id=u.get_element_id};b4w.module.armature=function(a,r){var u=r("__armature"),h=r("__obj_util"),b=r("__transform"),l=r("__print");a.get_bone_tsr=function(a,b,n){if(!h.is_armature(a))return null;if(!u.check_bone(a,b))return l.error('There is no bone: "',b,'" in "',a.name,'".'),null;n||(n=new Float32Array(8));u.get_bone_tsr(a,b,!1,!1,n);return n};a.get_bone_tsr_rel=function(a,b,n){if(!h.is_armature(a))return null;if(!u.check_bone(a,b))return l.error('There is no bone: "',b,'" in "',a.name,'".'),null;n||(n=new Float32Array(8));
u.get_bone_tsr(a,b,!1,!0,n);return n};a.set_bone_tsr=function(a,f,n){h.is_armature(a)&&(u.check_bone(a,f)?(u.set_bone_tsr(a,f,n,!1),b.update_transform(a)):l.error('There is no bone: "',f,'" in "',a.name,'".'))};a.set_bone_tsr_rel=function(a,f,n){h.is_armature(a)&&(u.check_bone(a,f)?(u.set_bone_tsr(a,f,n,!0),b.update_transform(a)):l.error('There is no bone: "',f,'" in "',a.name,'".'))}};b4w.module.assets=function(a,r){var u=r("__assets");a.AT_ARRAYBUFFER=u.AT_ARRAYBUFFER;a.AT_JSON=u.AT_JSON;a.AT_TEXT=u.AT_TEXT;a.AT_AUDIOBUFFER=u.AT_AUDIOBUFFER;a.AT_IMAGE_ELEMENT=u.AT_IMAGE_ELEMENT;a.AT_AUDIO_ELEMENT=u.AT_AUDIO_ELEMENT;a.enqueue=function(a,b,l,c){u.enqueue(a,b,l,c)}};b4w.module.camera=function(a,r){function u(a,b){if(!q.is_camera(a))return k.error("get_eye(): Wrong object"),null;b||(b=new Float32Array(3));B.copy(a.render.trans,b);return b}function h(a,c){b.is_target_camera(a)?(B.copy(c,a.render.pivot),e.update_transform(a),d.sync_transform(a)):k.error("set_pivot(): Wrong object or camera move style")}var b=r("__camera");r("__config");var l=r("__constraints"),c=r("__container"),f=r("__mat3"),n=r("__mat4"),q=r("__obj_util"),d=r("__physics"),k=r("__print"),e=r("__transform"),
m=r("__util"),B=r("__vec3"),N=r("__vec4"),G=new Float32Array(2),w=new Float32Array(3),t=new Float32Array(3),C=new Float32Array(4),D=new Float32Array(9);a.MS_STATIC=b.MS_STATIC;a.MS_ANIMATION=b.MS_STATIC;a.MS_TARGET_CONTROLS=b.MS_TARGET_CONTROLS;a.MS_EYE_CONTROLS=b.MS_EYE_CONTROLS;a.MS_HOVER_CONTROLS=b.MS_HOVER_CONTROLS;a.is_camera=function(a){k.error("camera.is_camera() deprecated, use objects.is_camera() instead");return q.is_camera(a)};a.is_target_camera=b.is_target_camera;a.is_eye_camera=b.is_eye_camera;
a.is_hover_camera=b.is_hover_camera;a.set_move_style=function(a,c){if(!q.is_camera(a))return k.error("set_move_style(): Wrong object"),!1;if(c!=b.MS_STATIC&&c!=b.MS_EYE_CONTROLS&&c!=b.MS_HOVER_CONTROLS&&c!=b.MS_TARGET_CONTROLS)return k.error("set_move_style(): Wrong camera move style"),!1;a.render.move_style=c;a.render.horizontal_limits=null;a.render.vertical_limits=null;a.render.hover_angle_limits=null;a.render.use_distance_limits=!1;b.init_ortho_props(a);switch(c){case b.MS_TARGET_CONTROLS:var f=
u(a,w),h=m.quat_to_dir(a.render.quat,m.AXIS_MY,t),f=B.scaleAndAdd(f,h,10,h);B.copy(f,a.render.pivot)}e.update_transform(a);d.sync_transform(a);return!0};a.get_move_style=function(a){return q.is_camera(a)?b.get_move_style(a):(k.error("get_move_style(): Wrong object"),null)};a.set_velocity_params=function(a,c){if(b.is_target_camera(a)||b.is_eye_camera(a)||b.is_hover_camera(a)){var d=a.render;d.velocity_trans=m.clamp(c[0],0,Infinity);d.velocity_rot=m.clamp(c[1],0,Infinity);d.velocity_zoom=m.clamp(c[2],
0,1)}else k.error("set_velocity_params(): Wrong object or camera move style")};a.get_velocity_params=function(a,c){if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&!b.is_hover_camera(a))return k.error("get_velocity_params(): Wrong object or camera move style"),null;c||(c=new Float32Array(3));var d=a.render;c[0]=d.velocity_trans;c[1]=d.velocity_rot;c[2]=d.velocity_zoom;return c};a.set_look_at=function(a,c,f,k){var h=a.render;b.eye_target_up_to_trans_quat(c,f,k,h.trans,h.quat);e.update_transform(a);
d.sync_transform(a)};a.get_eye=u;a.set_pivot=h;a.set_trans_pivot=function(a,c,f){b.is_target_camera(a)?(B.copy(c,a.render.trans),B.copy(f,a.render.pivot),e.update_transform(a),d.sync_transform(a)):k.error("set_trans_pivot(): Wrong object or camera move style")};a.get_pivot=function(a,c){if(!b.is_target_camera(a))return k.error("get_pivot(): Wrong object or camera move style"),null;c||(c=new Float32Array(3));B.copy(a.render.pivot,c);return c};a.rotate_pivot=function(b,c,d){k.error("rotate_pivot() deprecated, use rotate_camera() or rotate_target_camera() instead");
a.rotate_target_camera(b,c,d)};a.move_pivot=function(a,c,h){if(b.is_target_camera(a)){var m=a.render;if(m.use_panning){var l=f.fromMat4(m.world_matrix,D),n=B.subtract(m.trans,m.pivot,t);w[0]=c;w[1]=0;w[2]=h;B.scale(w,B.len(n),w);B.transformMat3(w,l,w);B.add(m.pivot,w,m.pivot);B.add(m.trans,w,m.trans);e.update_transform(a);d.sync_transform(a)}}else k.error("move_pivot(): wrong object")};a.rotate_hover_cam=function(b,c){k.error("rotate_hover_cam() deprecated, use rotate_camera() or rotate_hover_camera() instead");
a.rotate_hover_camera(b,c,0)};a.get_hover_cam_angle=function(a){k.error("get_hover_cam_angle() deprecated, use get_camera_angles() instead");return b.is_hover_camera(a)?-b.get_camera_angles(a,G)[1]:(k.error("get_hover_cam_angle(): wrong object or camera move style"),null)};a.set_hover_cam_angle=function(a,c){k.error("set_hover_cam_angle() deprecated, use rotate_camera() or rotate_hover_camera() instead");if(b.is_hover_camera(a))if(a.render.use_distance_limits){var f=b.get_camera_angles(a,G);(f=-c-
f[1])&&b.rotate_hover_camera(a,0,f);e.update_transform(a);d.sync_transform(a)}else k.error("set_hover_cam_angle(): distance/hover_angle limits are not defined or disabled");else k.error("set_hover_cam_angle(): wrong object or camera move style")};a.get_hover_angle_limits=function(a,c){if(!b.is_hover_camera(a))return k.error("get_hover_angle_limits(): wrong object"),null;a.render.hover_angle_limits?(c||(c=new Float32Array(2)),c[0]=a.render.hover_angle_limits.down,c[1]=a.render.hover_angle_limits.up):
k.error("get_hover_angle_limits(): camera hasn't angle limits");return c};a.get_cam_dist_limits=function(a,c){if(!b.is_hover_camera(a)&&!b.is_target_camera(a))return k.error("get_cam_dist_limits(): wrong object"),null;a.render.use_distance_limits?(c||(c=new Float32Array(2)),c[0]=a.render.distance_max,c[1]=a.render.distance_min):k.error("get_cam_dist_limits(): camera hasn't distance limits");return c};a.translate_hover_cam_v=function(b,c){k.error("translate_hover_cam_v() deprecated, use hover_cam_set_translation() instead");
a.hover_cam_set_translation(b,c)};a.hover_cam_set_translation=function(a,c){if(b.is_hover_camera(a)){var f=a.render;if(f.use_distance_limits){var h=B.subtract(c,f.trans,w);B.add(h,f.hover_pivot,f.hover_pivot)}e.set_translation(a,c);e.update_transform(a);d.sync_transform(a)}else k.error("hover_cam_set_translation(): wrong object")};a.set_hover_pivot=function(a,c){if(b.is_hover_camera(a)){var f=a.render;if(f.use_distance_limits&&f.hover_angle_limits){var h=B.subtract(c,f.hover_pivot,w),h=B.add(h,f.trans,
h);e.set_translation(a,h)}B.copy(c,f.hover_pivot);e.update_transform(a);d.sync_transform(a)}else k.error("set_hover_pivot(): Wrong object or camera move style")};a.get_hover_cam_pivot=function(a,c){if(!b.is_hover_camera(a))return k.error("get_hover_cam_pivot(): wrong object"),null;c||(c=new Float32Array(3));B.copy(a.render.hover_pivot,c);return c};a.has_distance_limits=function(a){return b.is_target_camera(a)||b.is_hover_camera(a)?a.render.use_distance_limits:(k.error("has_distance_limits(): wrong object"),
null)};a.apply_vertical_limits=function(a,c,f,h){switch(b.get_move_style(a)){case b.MS_TARGET_CONTROLS:case b.MS_EYE_CONTROLS:h|=e.SPACE_WORLD;break;case b.MS_HOVER_CONTROLS:if(c>f){k.error("apply_vertical_limits(): wrong vertical limits");return}break;default:k.error("apply_vertical_limits(): wrong object");return}a.render.vertical_limits={down:c,up:f};b.prepare_vertical_limits(a,h==e.SPACE_LOCAL);e.update_transform(a);d.sync_transform(a)};a.clear_vertical_limits=function(a){a.render.vertical_limits=
null};a.get_vertical_limits=function(a,c){if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&!b.is_hover_camera(a))return k.error("get_vertical_limits(): wrong object"),null;var d=a.render;c=c||new Float32Array(2);return d.vertical_limits?(c[0]=d.vertical_limits.down,c[1]=d.vertical_limits.up,c):null};a.has_vertical_limits=function(a){return b.is_target_camera(a)||b.is_eye_camera(a)||b.is_hover_camera(a)?Boolean(a.render.vertical_limits):(k.error("has_vertical_limits(): wrong object"),null)};a.apply_horizontal_limits=
function(a,c,f,h){switch(b.get_move_style(a)){case b.MS_TARGET_CONTROLS:case b.MS_EYE_CONTROLS:h|=e.SPACE_WORLD;break;case b.MS_HOVER_CONTROLS:if(c>f){k.error("apply_horizontal_limits(): wrong horizontal limits");return}break;default:k.error("apply_horizontal_limits(): wrong object");return}a.render.horizontal_limits={left:c,right:f};b.prepare_horizontal_limits(a,h==e.SPACE_LOCAL);e.update_transform(a);d.sync_transform(a)};a.clear_horizontal_limits=function(a){a.render.horizontal_limits=null};a.get_horizontal_limits=
function(a,c){if(!b.is_target_camera(a)&&!b.is_eye_camera(a)&&!b.is_hover_camera(a))return k.error("get_horizontal_limits(): wrong object"),null;var d=a.render;c=c||new Float32Array(2);return d.horizontal_limits?(c[0]=d.horizontal_limits.left,c[1]=d.horizontal_limits.right,c):null};a.has_horizontal_limits=function(a){return b.is_target_camera(a)||b.is_eye_camera(a)||b.is_hover_camera(a)?Boolean(a.render.horizontal_limits):(k.error("has_horizontal_limits(): wrong object"),null)};a.apply_hover_angle_limits=
function(a,c,f){b.is_hover_camera(a)?c<f?k.error("apply_hover_angle_limits(): wrong hover angle limits"):(c=m.angle_wrap_periodic(c,-Math.PI,Math.PI),f=m.angle_wrap_periodic(f,-Math.PI,Math.PI),c=m.clamp(c,-Math.PI/2,0),f=m.clamp(f,-Math.PI/2,0),a.render.hover_angle_limits={down:c,up:f},b.hover_camera_update_distance(a),e.update_transform(a),d.sync_transform(a)):k.error("apply_hover_angle_limits(): wrong object")};a.clear_hover_angle_limits=function(a){b.is_hover_camera(a)?a.render.hover_angle_limits=
null:k.error("clear_hover_angle_limits(): wrong object")};a.apply_distance_limits=function(a,c,f){if(b.is_target_camera(a)||b.is_hover_camera(a))if(c>f)k.error("apply_distance_limits(): wrong distance limits");else{var h=a.render;h.use_distance_limits=!0;h.distance_min=c;h.distance_max=f;e.update_transform(a);d.sync_transform(a)}else k.error("apply_distance_limits(): wrong object")};a.clear_distance_limits=function(a){b.is_target_camera(a)||b.is_hover_camera(a)?a.render.use_distance_limits=!1:k.error("clear_distance_limits(): wrong object")};
a.set_eye_params=function(b,c,d){k.error("set_eye_params() deprecated, use rotate_camera() or rotate_eye_camera() instead");a.rotate_eye_camera(b,c,Math.PI/2-d)};a.is_look_up=function(a){m.quat_to_dir(a.render.quat,m.AXIS_MY,w);return 0<=w[1]?!0:!1};a.rotate_camera=function(c,g,f,h,m){switch(a.get_move_style(c)){case b.MS_STATIC:break;case b.MS_TARGET_CONTROLS:b.rotate_target_camera(c,g,f,h,m);break;case b.MS_EYE_CONTROLS:b.rotate_eye_camera(c,g,f,h,m);break;case b.MS_HOVER_CONTROLS:b.rotate_hover_camera(c,
g,f,h,m);break;default:k.error("rotate_camera(): Wrong object")}e.update_transform(c);d.sync_transform(c)};a.rotate_target_camera=function(a,c,f,h,m){b.is_target_camera(a)?(b.rotate_target_camera(a,c,f,h,m),e.update_transform(a),d.sync_transform(a)):k.error("rotate_target_camera(): wrong object")};a.rotate_eye_camera=function(a,c,f,h,m){b.is_eye_camera(a)?(b.rotate_eye_camera(a,c,f,h,m),e.update_transform(a),d.sync_transform(a)):k.error("rotate_eye_camera(): wrong object")};a.rotate_hover_camera=
function(a,c,f,h,m){b.is_hover_camera(a)?(b.rotate_hover_camera(a,c,f,h,m),e.update_transform(a),d.sync_transform(a)):k.error("rotate_hover_camera(): wrong object")};a.rotate=function(b,c,d){k.error("rotate() deprecated, use rotate_camera() or rotate_eye_camera() instead");a.rotate_eye_camera(b,c,-d)};a.get_camera_angles=function(a,c){c||(c=new Float32Array(2));b.get_camera_angles(a,c);return c};a.get_camera_angles_char=function(a,c){c||(c=new Float32Array(2));b.get_camera_angles_char(a,c);return c};
a.get_angles=function(a,c){k.error("get_angles() deprecated, use get_camera_angles() instead");c||(c=new Float32Array(2));b.get_angles(a,c);return c};a.set_stereo_distance=function(a,c){for(var d=a.render.cameras,e=0;e<d.length;e++){var f=d[e];f.type!=b.TYPE_STEREO_LEFT&&f.type!=b.TYPE_STEREO_RIGHT||b.set_stereo_params(f,c,f.stereo_eye_dist)}};a.get_stereo_distance=function(a){a=a.render.cameras;for(var c=0;c<a.length;c++){var d=a[c];if(d.type==b.TYPE_STEREO_LEFT||d.type==b.TYPE_STEREO_RIGHT)return d.stereo_conv_dist}return 0};
a.is_underwater=function(a){k.error("is_underwater() deprecated, always returns false");return a.render.underwater};a.translate_view=function(a,c,d,e){a=a.render.cameras;for(var f=0;f<a.length;f++){var k=a[f];k.reflection_plane||b.set_projection(k,k.aspect);var h=w;h[0]=-c;h[1]=-d;h[2]=0;n.translate(k.proj_matrix,h,k.proj_matrix);n.rotateZ(k.proj_matrix,e,k.proj_matrix);n.multiply(k.proj_matrix,k.view_matrix,k.view_proj_matrix);b.calc_view_proj_inverse(k);b.calc_sky_vp_inverse(k)}};a.get_fov=function(a){return m.rad(a.render.cameras[0].fov)};
a.set_fov=function(a,c){for(var d=a.render.cameras,e=0;e<d.length;e++){var f=d[e];f.fov=m.deg(c);f.reflection_plane||b.set_projection(f,f.aspect);n.multiply(f.proj_matrix,f.view_matrix,f.view_proj_matrix);b.calc_view_proj_inverse(f);b.calc_sky_vp_inverse(f)}};a.correct_up=function(a,b){b||(b=m.AXIS_Y);l.correct_up(a,b)};a.zoom_object=function(a,c){if(b.is_target_camera(a)){e.get_object_center(c,!1,w);h(a,w);e.update_transform(a);var f=e.get_object_size(c),m=b.get_angular_diameter(a)/2,f=f/Math.sin(m),
m=e.obj_point_distance(a,w);e.move_local(a,0,f-m,0);e.update_transform(a);d.sync_transform(a)}else k.error("zoom_object(): wrong object")};a.set_ortho_scale=function(c,d){if(q.is_camera(c)&&a.is_ortho_camera(c)){var e=c.render;if(b.is_target_camera(c)){var f=B.dist(e.trans,e.pivot);e.init_top=d/2*e.init_dist/f}else b.is_hover_camera(c)&&a.has_distance_limits(c)?(f=B.distance(e.trans,e.hover_pivot),e.init_top=d/2*e.init_dist/f):c.render.cameras[0].top=d/2;b.update_ortho_scale(c)}else k.error("set_ortho_scale(): wrong object")};
a.get_ortho_scale=function(b){return q.is_camera(b)&&a.is_ortho_camera(b)?2*b.render.cameras[0].top:(k.error("get_ortho_scale(): wrong object"),null)};a.is_ortho_camera=function(a){return q.is_camera(a)?a.render.cameras[0].type==b.TYPE_ORTHO:(k.error("is_ortho_camera(): wrong object"),null)};a.calc_ray=function(a,d,e,f){f||(f=new Float32Array(3));var h=a.render.cameras[0];switch(h.type){case b.TYPE_PERSP:case b.TYPE_PERSP_ASPECT:case b.TYPE_STEREO_LEFT:case b.TYPE_STEREO_RIGHT:var m=Math.tan(h.fov*
Math.PI/360),l=m*h.aspect;d=c.canvas_to_viewport_coords(d,e,G,h);C[0]=(2*d[0]/h.width-1)*l;C[1]=-1;C[2]=(2*d[1]/h.height-1)*m;C[3]=0;N.transformMat4(C,a.render.world_matrix,C);f[0]=C[0];f[1]=C[1];f[2]=C[2];B.normalize(f,f);return f;default:return k.error("Non-compatible camera"),f}};a.project_point=function(a,c,d){d||(d=new Float32Array(2));return b.project_point(a,c,d)}};b4w.module.config=function(a,r){var u=r("__config");a.P_LOW=u.P_LOW;a.P_HIGH=u.P_HIGH;a.P_ULTRA=u.P_ULTRA;a.P_CUSTOM=u.P_CUSTOM;a.set=u.set;a.get=u.get;a.reset=u.reset;a.get_std_assets_path=u.get_std_assets_path};b4w.module.controls=function(a,r){var u=r("__controls"),h=r("__print");a.CT_CONTINUOUS=u.CT_CONTINUOUS;a.CT_TRIGGER=u.CT_TRIGGER;a.CT_SHOT=u.CT_SHOT;a.CT_LEVEL=u.CT_LEVEL;a.CT_CHANGE=u.CT_CHANGE;a.KEY_BACKSPACE=8;a.KEY_TAB=9;a.KEY_ENTER=13;a.KEY_SHIFT=16;a.KEY_CTRL=17;a.KEY_ALT=18;a.KEY_PAUSE=19;a.KEY_CAPSLOCK=20;a.KEY_ESC=27;a.KEY_SPACE=32;a.KEY_LEFT=37;a.KEY_UP=38;a.KEY_RIGHT=39;a.KEY_DOWN=40;a.KEY_1=49;a.KEY_2=50;a.KEY_3=51;a.KEY_4=52;a.KEY_5=53;a.KEY_6=54;a.KEY_7=55;a.KEY_8=56;a.KEY_9=57;a.KEY_A=
65;a.KEY_B=66;a.KEY_C=67;a.KEY_D=68;a.KEY_E=69;a.KEY_F=70;a.KEY_G=71;a.KEY_H=72;a.KEY_I=73;a.KEY_J=74;a.KEY_K=75;a.KEY_L=76;a.KEY_M=77;a.KEY_N=78;a.KEY_O=79;a.KEY_P=80;a.KEY_Q=81;a.KEY_R=82;a.KEY_S=83;a.KEY_T=84;a.KEY_U=85;a.KEY_V=86;a.KEY_W=87;a.KEY_X=88;a.KEY_Y=89;a.KEY_Z=90;a.KEY_NUM0=96;a.KEY_NUM1=97;a.KEY_NUM2=98;a.KEY_NUM3=99;a.KEY_NUM4=100;a.KEY_NUM5=101;a.KEY_NUM6=102;a.KEY_NUM7=103;a.KEY_NUM8=104;a.KEY_NUM9=105;a.KEY_DEC_POINT=110;a.KEY_SEMI_COLON=186;a.KEY_EQUAL_SIGN=187;a.KEY_COMMA=188;
a.KEY_DASH=189;a.KEY_PERIOD=190;a.KEY_FORWARD_SLASH=191;a.KEY_GRAVE_ACCENT=192;a.KEY_LEFT_SQ_BRACKET=219;a.KEY_BACK_SLASH=220;a.KEY_RIGHT_SQ_BRACKET=221;a.KEY_SINGLE_QUOTE=222;a.PL_SINGLE_TOUCH_MOVE=u.PL_SINGLE_TOUCH_MOVE;a.PL_MULTITOUCH_MOVE_ZOOM=u.PL_MULTITOUCH_MOVE_ZOOM;a.PL_MULTITOUCH_MOVE_PAN=u.PL_MULTITOUCH_MOVE_PAN;a.create_custom_sensor=u.create_custom_sensor;a.create_keyboard_sensor=u.create_keyboard_sensor;a.create_collision_sensor=function(a,h,c){return u.create_collision_sensor(a,h||"ANY",
c||!1)};a.create_collision_impulse_sensor=u.create_collision_impulse_sensor;a.create_ray_sensor=function(a,h,c,f,n,q,d){return u.create_ray_sensor(a,h,c,f||"ANY",n||!1,q||!1,d||!1)};a.create_mouse_click_sensor=u.create_mouse_click_sensor;a.create_mouse_wheel_sensor=u.create_mouse_wheel_sensor;a.create_mouse_move_sensor=u.create_mouse_move_sensor;a.create_touch_move_sensor=u.create_touch_move_sensor;a.create_touch_zoom_sensor=u.create_touch_zoom_sensor;a.create_motion_sensor=u.create_motion_sensor;
a.create_vertical_velocity_sensor=u.create_vertical_velocity_sensor;a.create_gyro_angles_sensor=u.create_gyro_angles_sensor;a.create_gyro_delta_sensor=u.create_gyro_delta_sensor;a.create_timer_sensor=function(a,h){return u.create_timer_sensor(a,h||!1)};a.reset_timer_sensor=u.reset_timer_sensor;a.create_elapsed_sensor=u.create_elapsed_sensor;a.create_timeline_sensor=u.create_timeline_sensor;a.create_selection_sensor=function(a,h){return u.create_selection_sensor(a,h||!1)};a.set_custom_sensor=function(a,
h){u.sensor_set_value(a,h)};a.get_custom_sensor=function(a){return a.value};a.get_sensor_value=u.get_sensor_value;a.get_sensor_payload=u.get_sensor_payload;a.create_sensor_manifold=function(a,h,c,f,n,q,d){n=n||u.default_AND_logic_fun;u.create_sensor_manifold(a,h,c,f,n,q,void 0===d?null:d)};a.create_kb_sensor_manifold=function(a,h,c,f,n,q){f=u.create_keyboard_sensor(f);u.create_sensor_manifold(a,h,c,[f],u.default_AND_logic_fun,n,void 0===q?null:q)};a.check_sensor_manifolds=function(a){return u.check_sensor_manifold(a,
null)};a.check_sensor_manifold=u.check_sensor_manifold;a.remove_sensor_manifolds=function(a){h.error("remove_sensor_manifolds() deprecated, use remove_sensor_manifold() instead");u.remove_sensor_manifold(a,null)};a.remove_sensor_manifold=u.remove_sensor_manifold;a.reset=u.reset;a.register_keyboard_events=u.register_keyboard_events;a.register_mouse_events=function(a,h,c){u.register_mouse_events(a,h,!!c)};a.register_wheel_events=u.register_wheel_events;a.register_touch_events=u.register_touch_events;
a.register_device_orientation=u.register_device_orientation;a.unregister_keyboard_events=u.unregister_keyboard_events;a.unregister_mouse_events=u.unregister_mouse_events;a.unregister_wheel_events=u.unregister_wheel_events;a.unregister_touch_events=u.unregister_touch_events;a.unregister_device_orientation=u.unregister_device_orientation};b4w.module.constraints=function(a,r){var u=r("__camera"),h=r("__constraints"),b=r("__obj_util"),l=r("__physics"),c=r("__print"),f=r("__transform");a.append_stiff=function(a,b,c,k,e){e=e||1;b instanceof Array&&2==b.length?h.append_stiff_bone(a,b[0],b[1],c,k,e):h.append_stiff_obj(a,b,c,k,e);f.update_transform(a);l.sync_transform(a)};a.append_semi_stiff=function(a,b,c,k){h.append_semi_stiff_obj(a,b,c,k);f.update_transform(a);l.sync_transform(a)};a.append_semi_stiff_cam=function(a,b,d,k,e,m,r,N){u.is_eye_camera(a)?
(h.append_semi_stiff_cam_obj(a,b,d,k,e,m,r,N),f.update_transform(a),l.sync_transform(a)):c.error("append_semi_stiff_cam(): wrong object type, only EYE camera objects can be parented.")};a.append_semi_soft_cam=function(a,b,d,k){if(u.is_eye_camera(a)){if(!k||0>k)k=.25;h.append_semi_soft_cam_obj(a,b,d,k);f.update_transform(a);l.sync_transform(a)}else c.error("append_semi_soft_cam(): wrong object type, only EYE camera objects can be parented.")};a.append_stiff_trans=function(a,b,c){h.append_stiff_trans_obj(a,
b,c);f.update_transform(a);l.sync_transform(a)};a.append_copy_trans=function(a,b,c){h.append_copy_trans_obj(a,b,c);f.update_transform(a);l.sync_transform(a)};a.append_stiff_trans_rot=function(a,b,c,k){h.append_stiff_trans_rot_obj(a,b,c,k,1);f.update_transform(a);l.sync_transform(a)};a.append_track=function(a,b){3==b.length?h.append_track_point(a,b):h.append_track_obj(a,b);f.update_transform(a);l.sync_transform(a)};a.append_follow=function(a,b,c,k){3==b.length?h.append_follow_point(a,b,c,k):h.append_follow_obj(a,
b,c,k);f.update_transform(a);l.sync_transform(a)};a.append_stiff_viewport=function(a,b,c){h.append_stiff_viewport(a,b,c);f.update_transform(a);l.sync_transform(a)};a.remove=function(a){a.constraint&&h.remove(a)};a.get_parent=function(a){c.error("constraints.get_parent() deprecated, use objects.get_parent() instead");return b.get_parent(a)}};b4w.module.container=function(a,r){var u=r("__container"),h=r("__print");a.get_canvas=u.get_canvas;a.get_container=u.get_container;a.insert_to_container=function(a,l){2!=arguments.length?h.error("insert_to_container(): two arguments required"):a&&l&&u.insert_to_container(a,l)};a.set_canvas_offsets=u.set_canvas_offsets;a.update_canvas_offsets=u.update_canvas_offsets;a.client_to_canvas_coords=u.client_to_canvas_coords;a.force_offsets_updating=u.force_offsets_updating};b4w.module.data=function(a,r){var u=r("__data");r("__print");r("__util");a.load=u.load;a.unload=function(a){u.unload(a|0)};a.set_debug_resources_root=u.set_debug_resources_root;a.is_primary_loaded=u.is_primary_loaded;a.load_and_add_new=u.load;a.cleanup=a.unload};b4w.module.debug=function(a,r){function u(a){var b={};if(!a)return b;a=a.split("\n");for(var c=0;c<a.length;c++){var d=a[c];if(-1!=d.search(new RegExp(/^[A-Z.]+ /))){var e=d.split(" ")[0];e in b||(b[e]=0);b[e]++}}c=a=0;for(e in b)switch(e){case "KIL":case "TEX":case "TXB":case "TXP":case "KIL.F":case "TEX.F":case "TXB.F":case "TXD.F":case "TXL.F":case "TXQ.F":case "TXP.F":c+=b[e];break;default:a+=b[e]}b.ALU_OPS=a;b.TEX_OPS=c;return b}function h(a,b){var c=new XMLHttpRequest;c.open("POST",a,!1);c.send(b);
if(200==c.status)return c.responseText;throw"Error POST XHR: "+c.status;}function b(a){a.sort(function(a,b){return b.fstats.ALU_OPS-a.fstats.ALU_OPS});for(var b=0;b<a.length;b++){var c=a[b],d=c.fstats,f=c.vstats,k=l(c.cshader),k=k?"\t\t("+k.join(", ")+")":"\t\t(NA)";e.groupCollapsed("FRAG --\x3e","ALU",d.ALU_OPS,"TEX",d.TEX_OPS,"\t\tVERT --\x3e","ALU",f.ALU_OPS,"TEX",f.TEX_OPS,k);e.groupCollapsed("directives");for(var k=c.shaders_info.directives,h=0;h<k.length;h++){var m=k[h];e.log(m[0],m[1])}e.groupEnd();
e.groupCollapsed("vert src");e.log(c.vsrc);e.groupEnd();e.groupCollapsed("vert stats");for(var n in f)"ALU_OPS"!=n&&"TEX_OPS"!=n&&e.log(n,f[n]);e.groupEnd();e.groupCollapsed("frag src");e.log(c.fsrc);e.groupEnd();e.groupCollapsed("frag stats");for(n in d)"ALU_OPS"!=n&&"TEX_OPS"!=n&&e.log(n,d[n]);e.groupEnd();e.groupEnd()}}function l(a){for(var b=m.get_all_scenes(),c=0;c<b.length;c++)for(var e=b[c],f=q.get_scene_objs(e,"MESH",q.DATA_ID_ALL),k=0;k<f.length;k++){var h=d.get_scene_data(f[k],e);if(h&&
h.batches.length)for(var h=h.batches,l=0;l<h.length;l++){var n=h[l];if(n.shader==a&&n.material_names.length)return n.material_names}}return null}r("__batch");r("__config");var c=r("__controls"),f=r("__debug"),n=r("__extensions"),q=r("__objects"),d=r("__obj_util"),k=r("__physics"),e=r("__print"),m=r("__scenes"),B=r("__scenegraph"),N=r("__sfx"),G=r("__shaders"),w=r("__textures"),t=r("__util"),C=r("vec3");a.WM_NONE=f.WM_NONE;a.WM_OPAQUE_WIREFRAME=f.WM_OPAQUE_WIREFRAME;a.WM_TRANSPARENT_WIREFRAME=f.WM_TRANSPARENT_WIREFRAME;
a.WM_FRONT_BACK_VIEW=f.WM_FRONT_BACK_VIEW;a.WM_DEBUG_SPHERES=f.WM_DEBUG_SPHERES;a.physics_stats=function(){k.debug_workers()};a.physics_id=function(a){e.log("O",k.find_obj_by_body_id(a));for(var b=k.get_active_scene()._physics.bundles,c=0;c<b.length;c++){var d=b[c];d.physics.body_id==a&&e.log("B",d)}};a.visible_objects=function(){for(var a=m.get_active(),b=q.get_scene_objs(a,"MESH",q.DATA_ID_ALL),a=[m.get_subs(a,"MAIN_OPAQUE"),m.get_subs(a,"MAIN_BLEND")],c=0;c<a.length;c++){var d=a[c],f=d.bundles;
if(f.length){e.group(d.type,"DYNAMIC");for(var k=0;k<b.length;k++){var h=b[k],l=h.render;if("DYNAMIC"==l.type)for(var n=0;n<f.length;n++){var t=f[n];if(t.do_render&&t.obj_render==l){e.log_raw(h.name,h);break}}}e.groupEnd();e.groupCollapsed(d.type,"STATIC");for(k=0;k<b.length;k++)if(h=b[k],l=h.render,"DYNAMIC"!=l.type)for(n=0;n<f.length;n++)if(t=f[n],t.do_render&&t.obj_render==l){e.log_raw(h.name,h);break}e.groupEnd()}}};a.object_info=function(a){for(var b=m.get_active(),c=q.get_scene_objs(b,"MESH",
q.DATA_ID_ALL),d=0;d<c.length;d++){var f=c[d];if(f.name==a){e.log("Object",f);for(var k=m.get_all_subscenes(b),h=0;h<k.length;h++){for(var l=k[h],n=l.bundles,t=[],r=0;r<n.length;r++)n[r].obj_render==f.render&&t.push(n[r]);e.log("Subscene "+l.type,t)}}}};a.objects_stat=function(){var a=m.get_active();console.log("Armatures: "+q.get_scene_objs(a,"ARMATURE",q.DATA_ID_ALL).length);console.log("Cameras: "+q.get_scene_objs(a,"CAMERA",q.DATA_ID_ALL).length);console.log("Curves: "+q.get_scene_objs(a,"CURVE",
q.DATA_ID_ALL).length);console.log("Empties: "+q.get_scene_objs(a,"EMPTY",q.DATA_ID_ALL).length);console.log("Lamps: "+q.get_scene_objs(a,"LAMP",q.DATA_ID_ALL).length);console.log("Meshes: "+q.get_scene_objs(a,"MESH",q.DATA_ID_ALL).length);console.log("Speakers: "+q.get_scene_objs(a,"SPEAKER",q.DATA_ID_ALL).length)};a.num_vertices=function(){for(var a=0,b=m.get_active(),b=[m.get_subs(b,"MAIN_OPAQUE"),m.get_subs(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.bundles,e=0;e<d.length;e++){var f=
d[e].batch;f&&(a+=f.num_vertices)}}return a};a.num_triangles=function(){for(var a=0,b=m.get_active(),b=[m.get_subs(b,"MAIN_OPAQUE"),m.get_subs(b,"MAIN_BLEND")],c=0;c<b.length;c++){var d=b[c];if(d)for(var d=d.bundles,e=0;e<d.length;e++){var f=d[e].batch;f&&(a+=f.num_triangles)}}return a};a.num_draw_calls=function(){for(var a=m.get_active(),b=[m.get_subs(a,"MAIN_OPAQUE"),m.get_subs(a,"MAIN_BLEND")],b=b[0].bundles.length+b[1].bundles.length,a=m.subs_array(a,["MAIN_PLANE_REFLECT","MAIN_CUBE_REFLECT"]),
c=0;c<a.length;c++)var d=a[c],b="MAIN_PLANE_REFLECT"==d.type?b+d.bundles.length:b+6*d.bundles.length;return b};a.num_shaders=function(){var a=G.get_compiled_shaders();return t.get_dict_length(a)};a.geometry_stats=function(){for(var a=m.get_active(),b=m.get_all_subscenes(a),a={},c=0;c<b.length;c++){var d=b[c];if("SINK"!=d.type&&"WIREFRAME"!=d.type)for(var e=d.bundles,f=0;f<e.length;f++){var k=e[f].batch,h=e[f].obj_render;k&&("COLOR_PICKING"!=d.type&&"OUTLINE_MASK"!=d.type||h.origin_selectable||h.origin_outlining)&&
(a[k.id]=k)}}var e=d=c=b=0,l;for(l in a)k=a[l],k=k.bufs_data,k.debug_ibo_bytes&&(d++,e+=k.debug_ibo_bytes/1048576),b++,c+=k.debug_vbo_bytes/1048576;return{vbo_number:b,vbo_memory:c,ibo_number:d,ibo_memory:e}};a.num_textures=function(){for(var a=[],b=0,c=m.get_active(),c=[m.get_subs(c,"MAIN_OPAQUE"),m.get_subs(c,"MAIN_BLEND")],d=0;d<c.length;d++){var e=c[d];if(e)for(var e=e.bundles,f=0;f<e.length;f++){var k=e[f].batch;if(k)for(var k=k.textures,h=0;h<k.length;h++){var l=k[h];if("IMAGE"===l.source||
"ENVIRONMENT_MAP"===l.source){var n=l.w_texture;-1===a.indexOf(n)&&(a.push(n),l=l.width*l.height*4/1048576/l.compress_ratio,l*=1.3333,b+=l)}}}}return{number:a.length,memory:b}};a.num_render_targets=function(){for(var a=[],b=0,c=m.get_active(),c=m.get_all_subscenes(c),d=0;d<c.length;d++){var e=c[d];if("SINK"!=e.type){var f=e.camera,k=[f.color_attachment,f.depth_attachment];k.push.apply(k,e.textures_internal);for(e=0;e<k.length;e++){var h=k[e];w.is_texture(h)&&-1==a.indexOf(h)&&(a.push(h),b+=f.width*
f.height*w.get_texture_channel_size(h))}}}return{number:a.length,memory:b/1024/1024}};a.make_camera_frustum_shot=function(){var a=m.get_active();(a=m.get_subs(a,"MAIN_OPAQUE"))&&m.make_frustum_shot(a.camera,a,[1,1,0])};a.make_light_frustum_shot=function(){var a=m.get_active(),b=m.get_subs(a,"MAIN_OPAQUE"),a=m.subs_array(a,["SHADOW_CAST"]);if(b)for(var c=0;c<a.length;c++){var d=a[c],e;switch(c){case 0:e=[1,0,0];break;case 1:e=[0,1,0];break;case 2:e=[0,0,1];break;default:e=[1,0,1]}m.make_frustum_shot(d.camera,
b,e)}};a.scenegraph_to_dot=function(){for(var a=m.get_all_scenes(),b=0;b<a.length;b++){var c=m.get_graph(a[b]);e.log("\n"+B.debug_convert_to_dot(c))}};a.scenes_to_dot=function(){};a.controls_info=c.debug;a.object_distance=function(a,b){return C.dist(a.render.trans,b.render.trans)};a.msg=f.msg;a.fbmsg=f.fbmsg;a.print_telemetry=f.print_telemetry;a.plot_telemetry=f.plot_telemetry;a.fbres=function(a,b){b||(b=16);var c=function(){f.fbmsg("FBRES",a());setTimeout(c,b)};c()};a.assert_constants=function(){var a=
new Float32Array(3),b=new Float32Array([0,0,0,1]),c=new Float32Array([1,0,0]),d=new Float32Array([0,1,0]),e=new Float32Array([0,0,1]),f=new Float32Array([-1,0,0]),k=new Float32Array([0,-1,0]),h=new Float32Array([0,0,-1]);if(!t.cmp_arr(a,t.VEC3_IDENT))throw"Wrong VEC3_IDENT";if(!t.cmp_arr(b,t.QUAT4_IDENT))throw"Wrong QUAT4_IDENT";if(!t.cmp_arr(c,t.AXIS_X))throw"Wrong AXIS_X";if(!t.cmp_arr(d,t.AXIS_Y))throw"Wrong AXIS_Y";if(!t.cmp_arr(e,t.AXIS_Z))throw"Wrong AXIS_Z";if(!t.cmp_arr(f,t.AXIS_MX))throw"Wrong AXIS_MX";
if(!t.cmp_arr(k,t.AXIS_MY))throw"Wrong AXIS_MY";if(!t.cmp_arr(h,t.AXIS_MZ))throw"Wrong AXIS_MZ";};a.mute_music=function(){for(var a=N.get_speaker_objects(),b=0;b<a.length;b++){var c=a[b];"BACKGROUND_MUSIC"==N.get_spk_behavior(c)&&N.mute(c,!0)}};a.check_finite=function(a){f.check_finite(a)};a.set_debug_params=function(a){var b=m.get_active();if(b=m.get_subs(b,"WIREFRAME")){if("number"==typeof a.wireframe_mode)switch(a.wireframe_mode){case f.WM_NONE:case f.WM_OPAQUE_WIREFRAME:case f.WM_TRANSPARENT_WIREFRAME:case f.WM_FRONT_BACK_VIEW:case f.WM_DEBUG_SPHERES:m.set_wireframe_mode(b,
a.wireframe_mode);break;default:e.error("set_debug_params(): Wrong wireframe mode")}"object"==typeof a.wireframe_edge_color&&m.set_wireframe_edge_color(b,a.wireframe_edge_color)}else throw"Wireframe subscene not found.";};a.get_error_quantity=function(){return e.get_error_count()};a.get_warning_quantity=function(){return e.get_warning_count()};a.clear_errors_warnings=function(){return e.clear_errors_warnings()};a.analyze_shaders=function(a){var c=G.get_compiled_shaders(),d=0,f;for(f in c)a&&-1===
f.indexOf(a)||d++;var d="of "+d+" analyzing...",k={};for(f in c)if(!a||-1!==f.indexOf(a)){var m=c[f],l;var t=m.vshader;l=m.fshader;var q=n.get_debug_shaders();if(q){t=q.getTranslatedShaderSource(t);l=q.getTranslatedShaderSource(l);var q=h("/nvidia_vert",t),r=u(q),x=h("/nvidia_frag",l),w=u(x);l={vsrc:t,vout:q,vstats:r,fsrc:l,fout:x,fstats:w}}else e.error("WEBGL_debug_shaders not found (run Chrome with --enable-privileged-webgl-extensions)"),l=void 0;q=m.shaders_info;t=q.vert+" + "+q.frag;l.cshader=
m;l.shaders_info=q;m=k[t]=k[t]||[];m.push(l);e.log(d)}for(t in k)e.group("%c"+t,"color: #800"),m=k[t],b(m),e.groupEnd()};a.fake_load=f.fake_load};b4w.module.geometry=function(a,r){var u=r("__batch"),h=r("__geometry"),b=r("__print"),l=r("__renderer");a.extract_vertex_array=function(a,f,l){if(!h.has_dyn_geom(a))return b.error("Wrong object:",a.name),null;if(a=u.find_batch_material(a,f,"MAIN")){if((f=a.bufs_data)&&f.pointers&&f.pointers[l])return h.extract_array(f,l);b.error("Attribute not found:"+l);return null}b.error("Wrong material:",f);return null};a.extract_index_array=function(a,f){if(!h.has_dyn_geom(a))return b.error("Wrong object:",a.name),
null;var l=u.find_batch_material(a,f,"MAIN");if(l){if((l=l.bufs_data)&&l.pointers)return l.ibo_array;b.error("Buffer data not found");return null}b.error("Wrong material:",f);return null};a.update_vertex_array=function(a,f,l,q){var d=["MAIN","DEPTH","COLOR_ID"];if(h.has_dyn_geom(a))for(var k=0;k<d.length;k++){var e=u.find_batch_material(a,f,d[k]);e&&(e=e.bufs_data)&&e.pointers&&e.pointers[l]&&h.update_bufs_data_array(e,l,0,q)}else b.error("Wrong object:",a.name)};a.override_geometry=function(a,f,
n,q,d){var k=["MAIN","DEPTH","COLOR_ID"];if(h.has_dyn_geom(a))if(n instanceof Uint16Array||n instanceof Uint32Array)if(q instanceof Float32Array)for(var e=0;e<k.length;e++){var m=u.find_batch_material(a,f,k[e]);if(m){var r=m.bufs_data;if(r){h.update_bufs_data_index_array(r,m.draw_mode,n);var N=0,G;for(G in r.pointers)var w=r.pointers[G],N=N+q.length/3*w.num_comp;r.vbo_array=new Float32Array(N);var N=r.vbo_array,t=0;for(G in r.pointers)switch(w=r.pointers[G],G){case "a_position":N.set(q,t);w.offset=
t;w.length=q.length;t+=w.length;break;case "a_normal":var C;d&&(C=h.calc_shared_indices(n,q,q));var D=h.calc_normals(n,q,C);N.set(D,t);w.offset=t;w.length=q.length;t+=w.length;break;case "a_tangent":w.offset=t;w.length=q.length/3*w.num_comp;for(var D=new Float32Array(w.length),p=0;p<D.length;p+=4)D[p]=1,D[p+3]=1;N.set(D,t);t+=w.length;break;default:w.offset=t,w.length=q.length/3*w.num_comp,D=new Float32Array(w.length),N.set(D,t),t+=w.length}h.update_gl_buffers(r);l.assign_attribute_setters(m);(m=
u.find_batch_material_forked(a,m))&&m.bufs_data&&(m.bufs_data=r)}}}else b.error("Wrong positions_array type");else b.error("Wrong ibo_array type");else b.error("Wrong object:",a.name)};a.set_shape_key_value=function(a,f,l){h.check_shape_keys(a)?h.has_shape_key(a,f)?(l=parseFloat(l),h.apply_shape_key(a,f,l)):b.error("Wrong key name:",f):b.error("Wrong object:",a.name)};a.check_shape_keys=function(a){return h.check_shape_keys(a)};a.get_shape_keys_names=function(a){return h.check_shape_keys(a)?h.get_shape_keys_names(a):
(b.error("Wrong object:",a.name),null)};a.get_shape_key_value=function(a,f){return h.check_shape_keys(a)?h.has_shape_key(a,f)?h.get_shape_key_value(a,f):(b.error("Wrong key name:",f),null):(b.error("Wrong object:",a.name),null)}};b4w.module.hud=function(a,r){var u=r("__hud");r("__print");a.draw_mixer_strip=u.draw_mixer_strip;a.plot_array=u.plot_array};b4w.module.lights=function(a,r){function u(a){for(var c=n.get_active(),h=l.get_scene_objs(c,"LAMP",l.DATA_ID_ALL),m=0;m<h.length;m++){var p=h[m];if("SUN"==p.light.type){var g=p;break}}g?"number"==typeof a.hor_position&&"number"==typeof a.vert_position&&(h=(90-a.vert_position)/180*Math.PI,m=g.render,q.set_rotation_euler(g,[h,(180-a.hor_position)/180*Math.PI,0]),a=new Float32Array(3),d.quat_to_dir(m.quat,d.AXIS_Y,a),m=k.length(m.trans),k.copy(a,e),k.scale(e,m,e),q.set_translation(g,e),q.update_transform(g),
a=g.light,a.dynamic_intensity&&(m=c.world.light_settings.environment_energy,p=Math.cos(Math.abs(h)),h=Math.max(Math.min(3*p,1),0)*a.default_energy,m*=Math.max(p,.1),b.set_light_energy(a,h),n.set_environment_colors(c,m,null,null)),n.update_lamp_scene(g,c)):f.error("There is no sun on the scene")}function h(a){if(c.is_lamp(a))return a.light.type;f.error("get_light_type(): Wrong object");return!1}var b=r("__lights"),l=r("__objects"),c=r("__obj_util"),f=r("__print"),n=r("__scenes"),q=r("__transform"),
d=r("__util"),k=r("__vec3"),e=new Float32Array(3),m,B,N,G=60;a.get_lamps=function(a){var b=n.get_active(),b=l.get_scene_objs(b,"LAMP",l.DATA_ID_ALL);if(!a)return b;for(var c=[],d=0;d<b.length;d++){var e=b[d];e.light.type===a&&c.push(e)}return c};a.get_sun_params=function(){for(var a=n.get_active(),a=l.get_scene_objs(a,"LAMP",l.DATA_ID_ALL),b=null,c=0;c<a.length;c++){var d=a[c];if("SUN"==d.light.type){b=d;break}}return b?(b=b.light.direction,a=180*Math.atan2(b[2],b[0])/Math.PI+90,180<a&&(a-=360),b=
180*Math.atan2(b[1],Math.sqrt(b[0]*b[0]+b[2]*b[2]))/Math.PI,c={},c.hor_position=a,c.vert_position=b,c):null};a.set_sun_params=u;a.set_day_time=function(a){for(var b=n.get_active(),b=l.get_scene_objs(b,"LAMP",l.DATA_ID_ALL),c=0;c<b.length;c++){var d=b[c];if("SUN"==d.light.type){var e=d;break}}e?(e=12>a?15*a:15*(a-24),a=-Math.cos(a/12*Math.PI)*G,b={},b.hor_position=e,b.vert_position=a,u(b)):f.error("There is no sun on the scene")};a.set_date=function(a){m=a.getDate();B=a.getMonth();N=a.getFullYear();
if(m)if(1582==m&&10==a.m&&4<a.d&&15>a.d)f.error("The dates 5 through 14 October, 1582, do not exist in the Gregorian system!");else{a=m;var b=B,c=N,d,e;2<b?(d=a,e=b+1):(d=a-1,e=b+13);e=Math.floor(Math.floor(365.25*d)+Math.floor(30.6001*e)+c+1720995);588829<=c+31*(b+12*a)&&(a=Math.floor(.01*d),e+=2-a+Math.floor(.25*a));a=1E5*e;b=Math.floor(a);.5<a-b&&++b}else f.error("There is no year 0 in the Julian system!")};a.set_max_sun_angle=function(a){G=Math.min(Math.max(a,0),90)};a.get_light_params=function(a){if(c.is_lamp(a))var b=
a.light;else return f.error("get_light_params(): Wrong object"),!1;if(a=h(a))switch(a){case "SPOT":var d={light_type:a,light_color:b.color,light_energy:b.energy,light_spot_blend:b.spot_blend,light_spot_size:b.spot_size,light_distance:b.distance};break;case "POINT":d={light_type:a,light_color:b.color,light_energy:b.energy,light_distance:b.distance};break;default:d={light_type:a,light_color:b.color,light_energy:b.energy}}return d?d:!1};a.get_light_type=h;a.set_light_params=function(a,d){if(c.is_lamp(a)){var e=
a.light,k=n.get_active();"number"==typeof d.light_energy&&(b.set_light_energy(e,d.light_energy),n.update_lamp_scene(a,k));"object"==typeof d.light_color&&(b.set_light_color(e,d.light_color),n.update_lamp_scene(a,k));"number"==typeof d.light_spot_blend&&(b.set_light_spot_blend(e,d.light_spot_blend),n.update_lamp_scene(a,k));"number"==typeof d.light_spot_size&&(b.set_light_spot_size(e,d.light_spot_size),n.update_lamp_scene(a,k));"number"==typeof d.light_distance&&(b.set_light_distance(e,d.light_distance),
n.update_lamp_scene(a,k));l.update_all_mesh_shaders(k)}else f.error("set_light_params(): Wrong object")}};b4w.module.material=function(a,r){function u(a,b){for(var c=a.scenes_data[0].batches,d=0;d<c.length;d++){var f=c[d];if(-1<f.material_names.indexOf(b))return"MAIN"==f.type}return!1}function h(a,b){var c=l.find_batch_material(a,b,"MAIN");return Boolean(c&&c.specular_params[0])}function b(a,b){var c=l.find_batch_material(a,b,"MAIN");return Boolean(c&&c.specular_params[1])}var l=r("__batch"),c=r("__config"),f=r("__obj_util"),n=r("__print"),q=r("__shaders"),d=c.defaults;a.inherit_material=function(a,b,
c,d){f.is_dynamic_mesh(c)&&f.is_dynamic_mesh(a)?l.inherit_material(a,b,c,d):n.error("Wrong or batched object(s)")};a.get_materials_names=function(a){var b=[];a=a.scenes_data;for(var c=0;c<a.length;c++)for(var d=a[c].batches,f=0;f<d.length;f++)for(var h=0;h<d[f].material_names.length;h++)-1==b.indexOf(d[f].material_names[h])&&b.push(d[f].material_names[h]);return b};a.set_diffuse_color=function(a,b,c){var d=l.find_batch_material(a,b,"MAIN");d?(d.diffuse_color.set(c),(a=l.find_batch_material_forked(a,
b,"MAIN"))&&a.diffuse_color.set(c)):n.error('Couldn\'t set property "diffuse_color"!')};a.get_diffuse_color=function(a,b){var c=l.find_batch_material(a,b,"MAIN");if(c){var d=new Float32Array(4);d.set(c.diffuse_color);return d}n.error('Couldn\'t get property "diffuse_color"!')};a.set_diffuse_intensity=function(a,b,c){var d=l.find_batch_material(a,b,"MAIN");if(d){if(d.diffuse_intensity=c,a=l.find_batch_material_forked(a,b,"MAIN"))a.diffuse_intensity=c}else n.error('Couldn\'t set property "diffuse_color"!')};
a.get_diffuse_intensity=function(a,b){var c=l.find_batch_material(a,b,"MAIN");if(c)return c.diffuse_intensity;n.error('Couldn\'t get property "diffuse_intensity"!')};a.set_specular_color=function(a,b,c){var d=l.find_batch_material(a,b,"MAIN");d?(d.specular_color.set(c),(a=l.find_batch_material_forked(a,b,"MAIN"))&&a.specular_color.set(c)):n.error('Couldn\'t set property "specular_color"!')};a.get_specular_color=function(a,b){var c=l.find_batch_material(a,b,"MAIN");if(c){var d=Array(3);d[0]=c.specular_color[0];
d[1]=c.specular_color[1];d[2]=c.specular_color[2];return d}n.error('Couldn\'t get property "specular_color"!')};a.set_specular_color_factor=function(a,b,c){var d=l.find_batch_material(a,b,"MAIN");if(d){if(d.specular_color_factor=c,a=l.find_batch_material_forked(a,b,"MAIN"))a.specular_color_factor=c}else n.error('Couldn\'t set property "specular_color_factor"!')};a.get_specular_color_factor=function(a,b){var c=l.find_batch_material(a,b,"MAIN");if(c)return c.specular_color_factor;n.error('Couldn\'t get property "specular_color_factor"!')};
a.set_specular_intensity=function(a,b,c){h(a,b)||n.error('Property "specular_intensity" is missing!');l.find_batch_material(a,b,"MAIN").specular_params[0]=c;(a=l.find_batch_material_forked(a,b,"MAIN"))&&(a.specular_params[0]=c)};a.get_specular_intensity=function(a,b){h(a,b)||n.error('Property "specular_intensity" is missing!');return l.find_batch_material(a,b,"MAIN").specular_params[0]};a.check_specular_intensity=h;a.set_specular_hardness=function(a,c,d){b(a,c)||n.error('Property "specular_hardness" is missing!');
l.find_batch_material(a,c,"MAIN").specular_params[1]=d;(a=l.find_batch_material_forked(a,c,"MAIN"))&&(a.specular_params[1]=d)};a.get_specular_hardness=function(a,c){b(a,c)||n.error('Property "specular_hardness" is missing!');return l.find_batch_material(a,c,"MAIN").specular_params[1]};a.check_specular_hardness=b;a.set_emit_factor=function(a,b,c){var d=l.find_batch_material(a,b,"MAIN");if(d){if(d.emit=c,a=l.find_batch_material_forked(a,b,"MAIN"))a.emit=c}else n.error('Couldn\'t set property "emit_factor"!')};
a.get_emit_factor=function(a,b){var c=l.find_batch_material(a,b,"MAIN");if(c)return c.emit;n.error('Couldn\'t get property "emit_factor"!')};a.set_ambient_factor=function(a,b,c){var d=l.find_batch_material(a,b,"MAIN");if(d){if(d.ambient=c,a=l.find_batch_material_forked(a,b,"MAIN"))a.ambient=c}else n.error('Couldn\'t set property "ambient_factor"!')};a.get_ambient_factor=function(a,b){var c=l.find_batch_material(a,b,"MAIN");if(c)return c.ambient;n.error('Couldn\'t get property "ambient_factor"!')};
a.set_diffuse_color_factor=function(a,b,c){var d=l.find_batch_material(a,b,"MAIN");if(d){if(d.diffuse_color_factor=c,a=l.find_batch_material_forked(a,b,"MAIN"))a.diffuse_color_factor=c}else n.error('Couldn\'t set property "diffuse_color_factor"!')};a.get_diffuse_color_factor=function(a,b){var c=l.find_batch_material(a,b,"MAIN");if(c)return c.diffuse_color_factor;n.error('Couldn\'t get property "diffuse_color_factor"!')};a.set_alpha_factor=function(a,b,c){var d=l.find_batch_material(a,b,"MAIN");if(d){if(d.alpha_factor=
c,a=l.find_batch_material_forked(a,b,"MAIN"))a.alpha_factor=c}else n.error('Couldn\'t set property "alpha_factor"!')};a.get_alpha_factor=function(a,b){var c=l.find_batch_material(a,b,"MAIN");if(c)return c.alpha_factor;n.error('Couldn\'t get property "alpha_factor"!')};a.get_material_extended_params=function(a,b){if(!a||!b)return n.error("missing arguments in get_material_params"),null;if(!u(a,b))return null;var c=l.find_batch_material(a,b,"MAIN");if(!c)return null;var d={};"MAIN"==c.type&&(d.reflect_factor=
c.reflect_factor,d.fresnel=c.fresnel_params[2],d.fresnel_factor=5*(1-c.fresnel_params[3]),d.parallax_scale=c.parallax_scale,d.parallax_steps=l.get_batch_directive(c,"PARALLAX_STEPS")[1]);return d};a.get_water_material_params=function(a,b){if(!a||!b)return n.error("missing arguments in get_water_material_params"),null;if(!u(a,b))return null;var c=l.find_batch_material(a,b,"MAIN");if(!c||!c.water)return null;if(!c)return n.error("material not found"),null;var f={};if("MAIN"==c.type){if(d.shore_distance){var h=
f.shallow_water_col=Array(3);h[0]=c.shallow_water_col[0];h[1]=c.shallow_water_col[1];h[2]=c.shallow_water_col[2];h=f.shore_water_col=Array(3);h[0]=c.shore_water_col[0];h[1]=c.shore_water_col[1];h[2]=c.shore_water_col[2];f.shallow_water_col_fac=c.shallow_water_col_fac;f.shore_water_col_fac=c.shore_water_col_fac}f.foam_factor=c.foam_factor;f.norm_uv_velocity=c.water_norm_uv_velocity;f.absorb_factor=l.get_batch_directive(c,"ABSORB")[1];f.sss_strength=l.get_batch_directive(c,"SSS_STRENGTH")[1];f.sss_width=
l.get_batch_directive(c,"SSS_WIDTH")[1];f.dst_noise_scale0=l.get_batch_directive(c,"DST_NOISE_SCALE_0")[1];f.dst_noise_scale1=l.get_batch_directive(c,"DST_NOISE_SCALE_1")[1];f.dst_noise_freq0=l.get_batch_directive(c,"DST_NOISE_FREQ_0")[1];f.dst_noise_freq1=l.get_batch_directive(c,"DST_NOISE_FREQ_1")[1];f.dir_min_shore_fac=l.get_batch_directive(c,"DIR_MIN_SHR_FAC")[1];f.dir_freq=l.get_batch_directive(c,"DIR_FREQ")[1];f.dir_noise_scale=l.get_batch_directive(c,"DIR_NOISE_SCALE")[1];f.dir_noise_freq=
l.get_batch_directive(c,"DIR_NOISE_FREQ")[1];f.dir_min_noise_fac=l.get_batch_directive(c,"DIR_MIN_NOISE_FAC")[1];f.dst_min_fac=l.get_batch_directive(c,"DST_MIN_FAC")[1];f.waves_hor_fac=l.get_batch_directive(c,"WAVES_HOR_FAC")[1]}return f};a.set_material_extended_params=function(a,b,c){if(a&&b&&c)if(u(a,b)){var d=l.find_batch_material(a,b,"MAIN");if(d){var f=[d];(d=l.find_batch_material_forked(a,b,"MAIN"))&&f.push(d);for(a=0;a<f.length;a++)d=f[a],"number"==typeof c.material_reflectivity&&(d.reflect_factor=
c.material_reflectivity),"number"==typeof c.material_fresnel&&(d.fresnel_params[2]=c.material_fresnel),"number"==typeof c.material_fresnel_factor&&(d.fresnel_params[3]=1-c.material_fresnel_factor/5),"number"==typeof c.material_parallax_scale&&(d.parallax_scale=c.material_parallax_scale),"number"==typeof c.material_parallax_steps&&(b=q.glsl_value(parseFloat(c.material_parallax_steps)),l.set_batch_directive(d,"PARALLAX_STEPS",b),l.update_shader(d,!0))}else n.error("material not found")}else n.error("setting material params is not possible");
else n.error("missing arguments in set_material_params")};a.set_water_material_params=function(a,b,c){if(a&&b&&c)if(u(a,b)){var f=l.find_batch_material(a,b,"MAIN");if(f){var h=[f];(f=l.find_batch_material_forked(a,b,"MAIN"))&&h.push(f);for(a=0;a<h.length;a++)f=h[a],d.shore_distance&&("object"==typeof c.shallow_water_col&&f.shallow_water_col.set(c.shallow_water_col),"number"==typeof c.shallow_water_col_fac&&(f.shallow_water_col_fac=c.shallow_water_col_fac),"object"==typeof c.shore_water_col&&f.shore_water_col.set(c.shore_water_col),
"number"==typeof c.shore_water_col_fac&&(f.shore_water_col_fac=c.shore_water_col_fac)),d.shore_smoothing&&f.water_shore_smoothing&&("boolean"==typeof c.shore_smoothing&&(c.shore_smoothing?l.set_batch_directive(f,"SHORE_SMOOTHING",1):l.set_batch_directive(f,"SHORE_SMOOTHING",0)),"number"==typeof c.absorb_factor&&(b=q.glsl_value(parseFloat(c.absorb_factor)),l.set_batch_directive(f,"ABSORB",b))),"number"==typeof c.foam_factor&&d.foam&&(f.foam_factor=c.foam_factor),"number"==typeof c.norm_uv_velocity&&
(f.water_norm_uv_velocity=c.norm_uv_velocity),d.water_dynamic&&f.water_dynamic&&("boolean"==typeof c.water_dynamic&&(c.water_dynamic?l.set_batch_directive(f,"DYNAMIC",1):l.set_batch_directive(f,"DYNAMIC",0)),"number"==typeof c.waves_height&&(b=q.glsl_value(parseFloat(c.waves_height)),l.set_batch_directive(f,"WAVES_HEIGHT",b)),"number"==typeof c.waves_length&&(b=q.glsl_value(parseFloat(c.waves_length)),l.set_batch_directive(f,"WAVES_LENGTH",b)),"number"==typeof c.sss_strength&&(b=q.glsl_value(parseFloat(c.sss_strength)),
l.set_batch_directive(f,"SSS_STRENGTH",b)),"number"==typeof c.sss_width&&(b=q.glsl_value(parseFloat(c.sss_width)),l.set_batch_directive(f,"SSS_WIDTH",b)),"number"==typeof c.dst_noise_scale0&&(b=q.glsl_value(parseFloat(c.dst_noise_scale0)),l.set_batch_directive(f,"DST_NOISE_SCALE_0",b)),"number"==typeof c.dst_noise_scale1&&(b=q.glsl_value(parseFloat(c.dst_noise_scale1)),l.set_batch_directive(f,"DST_NOISE_SCALE_1",b)),"number"==typeof c.dst_noise_freq0&&(b=q.glsl_value(parseFloat(c.dst_noise_freq0)),
l.set_batch_directive(f,"DST_NOISE_FREQ_0",b)),"number"==typeof c.dst_noise_freq1&&(b=q.glsl_value(parseFloat(c.dst_noise_freq1)),l.set_batch_directive(f,"DST_NOISE_FREQ_1",b)),"number"==typeof c.dir_min_shore_fac&&(b=q.glsl_value(parseFloat(c.dir_min_shore_fac)),l.set_batch_directive(f,"DIR_MIN_SHR_FAC",b)),"number"==typeof c.dir_freq&&(b=q.glsl_value(parseFloat(c.dir_freq)),l.set_batch_directive(f,"DIR_FREQ",b)),"number"==typeof c.dir_noise_scale&&(b=q.glsl_value(parseFloat(c.dir_noise_scale)),
l.set_batch_directive(f,"DIR_NOISE_SCALE",b)),"number"==typeof c.dir_noise_freq&&(b=q.glsl_value(parseFloat(c.dir_noise_freq)),l.set_batch_directive(f,"DIR_NOISE_FREQ",b)),"number"==typeof c.dir_min_noise_fac&&(b=q.glsl_value(parseFloat(c.dir_min_noise_fac)),l.set_batch_directive(f,"DIR_MIN_NOISE_FAC",b)),"number"==typeof c.dst_min_fac&&(b=q.glsl_value(parseFloat(c.dst_min_fac)),l.set_batch_directive(f,"DST_MIN_FAC",b)),"number"==typeof c.waves_hor_fac&&(b=q.glsl_value(parseFloat(c.waves_hor_fac)),
l.set_batch_directive(f,"WAVES_HOR_FAC",b))),l.update_shader(f,!0)}else n.error("material not found")}else n.error("setting water material params is not possible");else n.error("missing arguments in set_water_material_params")}};b4w.module.particles=function(a,r){var u=r("__particles"),h=r("__print");a.set_size=function(a,l,c){u.obj_has_particles(a)?u.set_size(a,l,c):h.error('"',a.name,'" has no particle systems')};a.set_normal_factor=function(a,l,c){u.obj_has_particles(a)?u.set_normal_factor(a,l,c):h.error('"',a.name,'" has no particle systems')};a.set_factor=function(a,l,c){u.obj_has_particles(a)?(c=Math.min(c,1),c=Math.max(c,0),u.set_factor(a,l,c)):h.error('"',a.name,'" has no particle systems')}};b4w.module.physics=function(a,r){r("__config");var u=r("__ipc"),h=r("__physics"),b=r("__print"),l=r("__util");a.CM_WALK=0;a.CM_RUN=1;a.CM_CLIMB=2;a.CM_FLY=3;a.enable_simulation=function(a){h.obj_has_physics(a)?h.enable_simulation(a):b.error("No physics for object "+a.name)};a.disable_simulation=function(a){h.obj_has_physics(a)?h.disable_simulation(a):b.error("No physics for object "+a.name)};a.has_physics=function(a){return h.obj_has_physics(a)};a.has_simulated_physics=function(a){return h.has_simulated_physics(a)};
a.has_dynamic_physics=function(a){return h.has_dynamic_physics(a)};a.set_gravity=function(a,f){h.obj_has_physics(a)?h.set_gravity(a,f):b.error("No physics for object "+a.name)};a.set_damping=function(a,f,l){h.obj_has_physics(a)?h.post_msg("set_damping",a.physics.body_id,f,l):b.error("No physics for object "+a.name)};a.reset_damping=function(a){if(h.obj_has_physics(a)){var f=a.physics_settings;h.post_msg("set_damping",a.physics.body_id,f.damping,f.rotation_damping)}else b.error("No physics for object "+
a.name)};a.set_transform=function(a,f,l){h.obj_has_physics(a)?h.set_transform.apply(this,arguments):b.error("No physics for object "+a.name)};a.sync_transform=function(a){h.obj_has_physics(a)?h.sync_transform(a):b.error("No physics for object "+a.name)};a.apply_velocity=function(a){h.obj_has_physics(a)?h.apply_velocity.apply(this,arguments):b.error("No physics for object "+a.name)};a.apply_velocity_world=function(a){h.obj_has_physics(a)?h.apply_velocity_world.apply(this,arguments):b.error("No physics for object "+
a.name)};a.apply_force=function(a,f,l,q){h.obj_has_physics(a)?h.apply_force.apply(this,arguments):b.error("No physics for object "+a.name)};a.apply_torque=function(a,f,l,q){h.obj_has_physics(a)?h.apply_torque.apply(this,arguments):b.error("No physics for object "+a.name)};a.vehicle_throttle=function(a,f){h.obj_has_physics(a)?(h.is_vehicle_chassis(a)||h.is_vehicle_hull(a)||b.error("Wrong object"),h.vehicle_throttle(a,l.clamp(f,-1,1))):b.error("No physics for object "+a.name)};a.vehicle_throttle_inc=
function(a,f,n){if(h.obj_has_physics(a)){h.is_vehicle_chassis(a)||h.is_vehicle_hull(a)||b.error("Wrong object");f=l.clamp(f,0,1);var q=a.vehicle.engine_force;-1==n||1==n?q=Math.max(-1,Math.min(q+n*f,1)):0==n&&0<=q?(q-=f,q=Math.max(0,q)):0==n&&0>q?(q+=f,q=Math.min(0,q)):b.error("Wrong steering direction");h.vehicle_throttle(a,l.clamp(q,-1,1))}else b.error("No physics for object "+a.name)};a.vehicle_steer=function(a,f){h.obj_has_physics(a)?(h.is_vehicle_chassis(a)||h.is_vehicle_hull(a)||b.error("Wrong object"),
h.vehicle_steer(a,l.clamp(f,-1,1))):b.error("No physics for object "+a.name)};a.vehicle_steer_inc=function(a,f,n){if(h.obj_has_physics(a)){h.is_vehicle_chassis(a)||h.is_vehicle_hull(a)||b.error("Wrong object");f=l.clamp(f,0,1);var q=a.vehicle.steering;-1==n||1==n?q=Math.max(-1,Math.min(q+n*f,1)):0==n&&0<=q?(q-=f,q=Math.max(0,q)):0==n&&0>q?(q+=f,q=Math.min(0,q)):b.error("Wrong steering direction");h.vehicle_steer(a,l.clamp(q,-1,1))}else b.error("No physics for object "+a.name)};a.vehicle_brake=function(a,
f){h.obj_has_physics(a)?(h.is_vehicle_chassis(a)||h.is_vehicle_hull(a)||b.error("Wrong object"),h.vehicle_brake(a,l.clamp(f,0,1))):b.error("No physics for object "+a.name)};a.vehicle_brake_inc=function(a,f){if(h.obj_has_physics(a)){h.is_vehicle_chassis(a)||h.is_vehicle_hull(a)||b.error("Wrong object");f=l.clamp(f,-1,1);var n=a.vehicle.brake_force;h.vehicle_brake(a,l.clamp(n+n*f,0,1))}else b.error("No physics for object "+a.name)};a.is_vehicle_chassis=function(a){return h.is_vehicle_chassis(a)};a.is_vehicle_hull=
function(a){return h.is_vehicle_hull(a)};a.get_vehicle_name=function(a){if(!h.obj_has_physics(a))return b.error("No physics for object "+a.name),null;if(h.is_vehicle_chassis(a)||h.is_vehicle_hull(a))return a.vehicle_settings.name;b.error("Wrong object");return null};a.get_vehicle_throttle=function(a){if(!h.obj_has_physics(a))return b.error("No physics for object "+a.name),null;if(h.is_vehicle_chassis(a)||h.is_vehicle_hull(a))return a.vehicle.engine_force;b.error("Wrong object");return null};a.get_vehicle_steering=
function(a){if(!h.obj_has_physics(a))return b.error("No physics for object "+a.name),null;if(h.is_vehicle_chassis(a)||h.is_vehicle_hull(a))return a.vehicle.steering;b.error("Wrong object")};a.get_vehicle_brake=function(a){if(!h.obj_has_physics(a))return b.error("No physics for object "+a.name),null;if(h.is_vehicle_chassis(a)||h.is_vehicle_hull(a))return a.vehicle.brake_force;b.error("Wrong object")};a.get_vehicle_speed=function(a){if(!h.obj_has_physics(a))return b.error("No physics for object "+a.name),
null;if(h.is_vehicle_chassis(a)||h.is_vehicle_hull(a))return h.get_vehicle_speed(a);b.error("Wrong object")};a.is_character=function(a){return h.is_character(a)};a.set_character_move_dir=function(a,f,l){h.obj_has_physics(a)?h.set_character_move_dir(a,f,l):b.error("No physics for object "+a.name)};a.set_character_move_type=function(a,f){h.obj_has_physics(a)?h.set_character_move_type(a,f):b.error("No physics for object "+a.name)};a.set_character_walk_velocity=function(a,f){h.obj_has_physics(a)?h.set_character_walk_velocity(a,
f):b.error("No physics for object "+a.name)};a.set_character_run_velocity=function(a,f){h.obj_has_physics(a)?h.set_character_run_velocity(a,f):b.error("No physics for object "+a.name)};a.set_character_fly_velocity=function(a,f){h.obj_has_physics(a)?h.set_character_fly_velocity(a,f):b.error("No physics for object "+a.name)};a.character_jump=function(a){h.obj_has_physics(a)?h.character_jump(a):b.error("No physics for object "+a.name)};a.character_rotation_inc=function(a,f,l){h.obj_has_physics(a)?h.character_rotation_inc(a,
f,l):b.error("No physics for object "+a.name)};a.set_character_rotation_quat=function(a,f){h.obj_has_physics(a)?h.set_character_rotation_quat(a,f):b.error("No physics for object "+a.name)};a.set_character_rotation=function(a,f,l){h.obj_has_physics(a)?h.set_character_rotation(a,f,l):b.error("No physics for object "+a.name)};a.set_character_rotation_v=function(a,f){h.obj_has_physics(a)?h.set_character_rotation_v(a,f):b.error("No physics for object "+a.name)};a.set_character_rotation_h=function(a,f){h.obj_has_physics(a)?
h.set_character_rotation_h(a,f):b.error("No physics for object "+a.name)};a.append_collision_test=function(a,f,l,q){h.obj_has_physics(a)?h.append_collision_test(a,f,l,q||!1):b.error("No physics for object "+a.name)};a.remove_collision_test=function(a,f,l){h.obj_has_physics(a)?h.remove_collision_test(a,f||"ANY",l):b.error("No physics for object "+a.name)};a.apply_collision_impulse_test=function(a,f){h.obj_has_physics(a)?h.apply_collision_impulse_test(a,f):b.error("No physics for object "+a.name)};
a.clear_collision_impulse_test=function(a){h.obj_has_physics(a)?h.clear_collision_impulse_test(a):b.error("No physics for object "+a.name)};a.append_ray_test=function(a,b,l,q,d,k){return h.append_ray_test(a,b,l,q,d,k||!1,!1,!1,!1)};a.append_ray_test_ext=function(a,b,l,q,d,k,e,m,r){return h.append_ray_test(a,b,l,q,d,k||!1,e||!1,m||!1,r||!1)};a.remove_ray_test=function(a){h.is_ray_test(a)?h.remove_ray_test(a):b.error("Wrong ray test ID")};a.change_ray_test_from_to=function(a,f,l){h.is_ray_test(a)?h.change_ray_test_from_to(a,
f,l):b.error("Wrong ray test ID")};a.apply_constraint=function(a,f,l,q,d,k,e,m,r,u){h.obj_has_physics(f)&&h.obj_has_physics(d)?h.apply_constraint(a,f,l,q,d,k,e,m,r,u):b.error("Wrong objects")};a.clear_constraint=function(a){h.obj_has_physics(a)&&h.has_constraint(a)?h.clear_constraint(a):b.error("Wrong object")};a.pull_to_constraint_pivot=function(a,f,l,q,d,k){h.obj_has_physics(a)&&h.obj_has_physics(q)?h.pull_to_constraint_pivot(a,f,l,q,d,k):b.error("Wrong objects")};a.get_worker_listeners=u.get_worker_listeners};b4w.module.rgb=function(a,r){r("__print");var u=r("__util"),h=new Float32Array(3);a.create=function(){return new Float32Array(3)};a.from_values=function(a,h,c){var f=new Float32Array(3);f[0]=a;f[1]=h;f[2]=c;return f};a.set=function(a,h,c,f){f[0]=a;f[1]=h;f[2]=c;return f};a.css_to_rgb=function(a,h,c,f){f=f||new Float32Array(3);f[0]=a/255;f[1]=h/255;f[2]=c/255;u.srgb_to_lin(f,f);return f};a.rgb_to_css=function(a){a=u.lin_to_srgb(a,h);return[Math.round(255*a[0]),Math.round(255*a[1]),Math.round(255*a[2])]};
a.rgb_to_css_hex=function(a){var l=function(a){a=Math.round(255*a).toString(16);return 1==a.length?"0"+a:a};a=u.lin_to_srgb(a,h);return"#"+l(a[0])+l(a[1])+l(a[2])}};
b4w.module.rgba=function(a,r){r("__print");var u=r("__util"),h=new Float32Array(3);a.create=function(){var a=new Float32Array(4);a[3]=1;return a};a.from_values=function(a,h,c,f){var n=new Float32Array(4);n[0]=a;n[1]=h;n[2]=c;n[3]=f;return n};a.set=function(a,h,c,f,n){n[0]=a;n[1]=h;n[2]=c;n[3]=f;return n};a.css_to_rgba=function(a,h,c,f,n){n=n||new Float32Array(4);n[0]=a/255;n[1]=h/255;n[2]=c/255;n[3]=f;u.srgb_to_lin(n,n);return n};a.rgba_to_css=function(a){var l=u.lin_to_srgb(a,h);return[Math.round(255*
l[0]),Math.round(255*l[1]),Math.round(255*l[2]),a[3]]}};b4w.module.scenes=function(a,r){var u=r("__batch"),h=r("__camera"),b=r("__data"),l=r("__graph"),c=r("__objects"),f=r("__obj_util"),n=r("__physics"),q=r("__print"),d=r("__scenes"),k=r("__util");a.DATA_ID_ALL=c.DATA_ID_ALL;a.set_active=function(a){var b=d.get_all_scenes();d.set_active(k.keysearch("name",a,b))};a.get_active=function(){return d.check_active()?d.get_active().name:""};a.get_scenes=function(){for(var a=d.get_all_scenes(),b=[],c=0;c<a.length;c++)b.push(a[c].name);return b};a.get_active_camera=
function(){if(d.check_active())return d.get_camera(d.get_active());q.error("No active scene");return!1};a.get_object_by_name=function(a,b){var d=c.get_object(c.GET_OBJECT_BY_NAME,a,b|0);if(d)return d;q.error("get object "+a+": not found")};a.get_object_by_dupli_name=function(a,b,d){if(a=c.get_object(c.GET_OBJECT_BY_DUPLI_NAME,a,b,d|0))return a;q.error("get object "+b+": not found")};a.get_object_by_dupli_name_list=function(a,b){var d=c.get_object(c.GET_OBJECT_BY_DUPLI_NAME_LIST,a,b|0);if(d)return d;
q.error("get object "+a+": not found")};a.get_object_data_id=function(a){return d.get_object_data_id(a)};a.pick_object=c.pick_object;a.outlining_is_enabled=function(a){return a&&a.render&&a.render.outlining};a.set_outline_intensity=function(a,b){a&&a.render&&a.render.outlining?a.render.outline_intensity=b:q.error("set_outline_intensity(): wrong object")};a.get_outline_intensity=function(a){if(a&&a.render&&a.render.outlining)return a.render.outline_intensity;q.error("get_outline_intensity(): wrong object")};
a.apply_outline_anim=function(a,b,d,f){a&&a.render&&a.render.outlining?c.apply_outline_anim(a,b,d,f):q.error("apply_outline_anim(): wrong object")};a.apply_outline_anim_def=function(a){if(a&&a.render&&a.render.outlining){var b=a.render.outline_anim_settings_default;c.apply_outline_anim(a,b.outline_duration,b.outline_period,b.outline_relapses)}else q.error("apply_outline_anim_def(): wrong object")};a.clear_outline_anim=function(a){a&&a.render&&a.render.outlining?c.clear_outline_anim(a):q.error("clear_outline_anim(): wrong object")};
a.set_outline_color=d.set_outline_color;a.get_outline_color=function(a){var b=d.get_active();if(b=d.get_subs(b,"OUTLINE"))return a=a||new Float32Array(3),a.set(b.outline_color),a};a.set_glow_intensity=function(b,c){q.error("set_glow_intensity() deprecated, use set_outline_intensity() instead");a.set_outline_intensity(b,c)};a.get_glow_intensity=function(b){q.error("get_glow_intensity() deprecated, use get_outline_intensity() instead");a.get_outline_intensity(b)};a.apply_glow_anim=function(b,c,d,f){q.error("apply_glow_anim() deprecated, use apply_outline_anim() instead");
a.apply_outline_anim(b,c,d,f)};a.apply_glow_anim_def=function(b){q.error("apply_glow_anim_def() deprecated, use apply_outline_anim_def() instead");a.apply_outline_anim_def(b)};a.clear_glow_anim=function(b){q.error("clear_glow_anim() deprecated, use clear_outline_anim() instead");a.clear_outline_anim(b)};a.set_glow_color=function(b){q.error("set_glow_color() deprecated, use set_outline_color() instead");a.set_outline_color(b)};a.get_glow_color=function(b){q.error("get_glow_color() deprecated, use get_outline_color() instead");
a.get_outline_color(b)};a.get_shadow_params=function(){if(!d.check_active())return q.error("No active scene"),!1;var a=d.get_active(),b=d.get_subs(a,"SHADOW_CAST");if(!b)return null;var c=a._render.shadow_params,f=d.get_subs(a,"MAIN_OPAQUE"),h=d.get_subs(a,"DEPTH"),k={};k.csm_resolution=c.csm_resolution;k.self_shadow_polygon_offset=b.self_shadow_polygon_offset;h&&(k.self_shadow_normal_offset=h.self_shadow_normal_offset);k.enable_csm=c.enable_csm;k.csm_num=c.csm_num;k.csm_first_cascade_border=c.csm_first_cascade_border;
k.first_cascade_blur_radius=c.first_cascade_blur_radius;k.csm_last_cascade_border=c.csm_last_cascade_border;k.last_cascade_blur_radius=c.last_cascade_blur_radius;k.fade_last_cascade=c.fade_last_cascade;k.blend_between_cascades=c.blend_between_cascades;c.enable_csm?(k.csm_borders=d.get_csm_borders(a,f.camera),k.blur_radii=new Float32Array(c.csm_num),k.blur_radii.set(f.camera.pcf_blur_radii.subarray(0,c.csm_num))):(k.csm_borders=null,k.blur_radii=null);return k};a.set_shadow_params=function(a){if(d.check_active()){var b=
d.get_active();"number"==typeof a.self_shadow_polygon_offset&&l.traverse(b._render.graph,function(b,c){"SHADOW_CAST"===c.type&&(c.self_shadow_polygon_offset=a.self_shadow_polygon_offset)});var c=d.get_subs(b,"DEPTH");c&&("number"==typeof a.self_shadow_normal_offset&&(c.self_shadow_normal_offset=a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(c.pcf_blur_radius=a.pcf_blur_radius));var f=d.get_subs(b,"MAIN_BLEND");f&&("number"==typeof a.self_shadow_normal_offset&&(f.self_shadow_normal_offset=
a.self_shadow_normal_offset),"number"==typeof a.pcf_blur_radius&&(f.pcf_blur_radius=a.pcf_blur_radius),f.need_perm_uniforms_update=!0);f=b._render.shadow_params;"number"==typeof a.csm_first_cascade_border&&(f.csm_first_cascade_border=a.csm_first_cascade_border);"number"==typeof a.first_cascade_blur_radius&&(f.first_cascade_blur_radius=a.first_cascade_blur_radius);"number"==typeof a.csm_last_cascade_border&&(f.csm_last_cascade_border=a.csm_last_cascade_border);"number"==typeof a.last_cascade_blur_radius&&
(f.last_cascade_blur_radius=a.last_cascade_blur_radius);if(c){for(var k=c.bundles,n=0;n<k.length;n++){var t=k[n];t.obj_render.shadow_receive&&(t=t.batch,u.assign_shadow_receive_dirs(t,f),u.update_shader(t))}c.need_perm_uniforms_update=!0}c=b._camera.render.cameras;for(n=0;n<c.length;n++)h.update_camera_shadows(c[n],f);d.schedule_shadow_update(b)}else q.error("No active scene")};a.get_environment_colors=function(){if(!d.check_active())return q.error("No active scene"),!1;var a=d.get_active();return d.get_environment_colors(a)};
a.set_environment_colors=function(a,b,c){if(d.check_active()){var f=d.get_active();d.set_environment_colors(f,parseFloat(a),b,c)}else q.error("No active scene")};a.get_fog_color_density=function(a){if(!d.check_active())return q.error("No active scene"),!1;var b=d.get_active();return d.get_fog_color_density(b,a)};a.set_fog_color_density=function(a){if(d.check_active()){var b=d.get_active();d.set_fog_color_density(b,a)}else q.error("No active scene")};a.get_ssao_params=function(){if(!d.check_active())return q.error("No active scene"),
!1;var a=d.get_active();return d.get_ssao_params(a)};a.set_ssao_params=function(a){if(d.check_active()){var b=d.get_active();d.set_ssao_params(b,a)}else q.error("No active scene")};a.get_color_correction_params=function(){if(!d.check_active())return q.error("No active scene"),null;var a=d.get_active(),a=d.get_subs(a,"COMPOSITING");if(!a)return null;var b={};b.brightness=a.brightness;b.contrast=a.contrast;b.exposure=a.exposure;b.saturation=a.saturation;return b};a.set_color_correction_params=function(a){if(d.check_active()){var b=
d.get_active();if(b=d.get_subs(b,"COMPOSITING"))"number"==typeof a.brightness&&(b.brightness=a.brightness),"number"==typeof a.contrast&&(b.contrast=a.contrast),"number"==typeof a.exposure&&(b.exposure=a.exposure),"number"==typeof a.saturation&&(b.saturation=a.saturation),b.need_perm_uniforms_update=!0}else q.error("No active scene")};a.get_sky_params=function(){if(!d.check_active())return q.error("No active scene"),!1;var a=d.get_active();return d.get_sky_params(a)};a.set_sky_params=function(a){if(d.check_active()){var b=
d.get_active();d.set_sky_params(b,a)}else q.error("No active scene")};a.get_dof_params=function(){if(!d.check_active())return q.error("No active scene"),!1;var a=d.get_active();return d.get_subs(a,"DOF")?d.get_dof_params(a):null};a.set_dof_params=function(a){if(d.check_active()){var b=d.get_active();d.set_dof_params(b,a)}else q.error("No active scene")};a.get_god_rays_params=function(){if(!d.check_active())return q.error("No active scene"),!1;var a=d.get_active();return d.get_subs(a,"GOD_RAYS")?d.get_god_rays_params(a):
null};a.set_god_rays_params=function(a){if(d.check_active()){var b=d.get_active();d.set_god_rays_params(b,a)}else q.error("No active scene")};a.get_bloom_params=function(){if(!d.check_active())return q.error("No active scene"),!1;var a=d.get_active();return d.get_subs(a,"BLOOM")?d.get_bloom_params(a):null};a.set_bloom_params=function(a){if(d.check_active()){var b=d.get_active();d.set_bloom_params(b,a)}else q.error("No active scene")};a.get_glow_material_params=function(){if(!d.check_active())return q.error("No active scene"),
!1;var a=d.get_active();return d.get_subs(a,"GLOW_COMBINE")?d.get_glow_material_params(a):null};a.set_glow_material_params=function(a){if(d.check_active()){var b=d.get_active();d.set_glow_material_params(b,a)}else q.error("No active scene")};a.get_wind_params=function(){if(!d.check_active())return q.error("No active scene"),!1;var a=d.get_active();return d.get_wind_params(a)};a.set_wind_params=function(a){if(d.check_active()){var b=d.get_active();c.set_wind_params(b,a)}else q.error("No active scene")};
a.get_water_surface_level=d.get_water_surface_level;a.set_water_params=function(a){if(d.check_active()){var b=d.get_active();d.set_water_params(b,a)}else q.error("No active scene")};a.get_water_mat_params=function(a){if(d.check_active()){var b=d.get_active();d.get_water_mat_params(b,a)}else q.error("No active scene")};a.update_scene_materials_params=function(){if(d.check_active()){var a=d.get_active();d.update_scene_permanent_uniforms(a)}else q.error("No active scene")};a.hide_object=function(a){f.is_dynamic_mesh(a)||
f.is_empty(a)?d.hide_object(a):q.error("show/hide is only supported for dynamic meshes/empties")};a.show_object=function(a){f.is_dynamic_mesh(a)||f.is_empty(a)?d.show_object(a):q.error("show/hide is only supported for dynamic meshes/empties")};a.is_hidden=function(a){if(f.is_dynamic_mesh(a)||f.is_empty(a))return d.is_hidden(a);q.error("show/hide is only supported for dynamic meshes/empties");return!1};a.is_visible=function(a){return a.render.is_visible};a.check_object=function(a){return d.check_active()?
c.objects_storage_check(a,d.get_active()):(q.error("No active scene"),!1)};a.check_object_by_name=function(a,b){return c.get_object(c.GET_OBJECT_BY_NAME,a,b|0)?!0:!1};a.check_object_by_dupli_name=function(a,b,d){return c.get_object(c.GET_OBJECT_BY_DUPLI_NAME,a,b,d|0)?!0:!1};a.check_object_by_dupli_name_list=function(a,b){return c.get_object(c.GET_OBJECT_BY_DUPLI_NAME_LIST,a,b|0)?!0:!1};a.get_all_objects=function(a,b){var f=d.get_active();a||(a="ALL");b||0===b||(b=c.DATA_ID_ALL);return c.get_scene_objs(f,
a,b)};a.get_object_name=function(a){return a?a.origin_name:(q.error("Wrong object name"),"")};a.get_object_name_hierarchy=function(a){if(!a)return q.error("Wrong object name"),null;for(var b=[];a;)b.push(a.origin_name),a=f.get_dg_parent(a);return b.reverse()};a.get_object_type=function(a){return a&&a.type?a.type:(q.error("Wrong object"),"UNDEFINED")};a.get_object_dg_parent=function(a){q.error("scenes.get_object_dg_parent() deprecated, use objects.get_dg_parent() instead");return f.get_dg_parent(a)};
a.get_object_children=function(a){return a.cons_descends.slice(0)};a.get_first_character=function(){for(var a=c.get_scene_objs(d.get_active(),"MESH",c.DATA_ID_ALL),b=0;b<a.length;b++){var f=a[b];if(n.is_character(f))return f}return null};a.get_shore_dist=function(a,b){b||0===b||(b=1);return d.get_shore_dist(a,b)};a.get_cam_water_depth=function(){return d.get_cam_water_depth()};a.get_type_mesh_object=function(a){return f.is_mesh(a)?a.render.type:null};a.get_meta_tags=function(){if(!d.check_active())return q.error("No active scene"),
!1;var a=d.get_active();return d.get_meta_tags(a)};a.append_object=function(a,b){if(a.render.is_copied){if(b)var c=d.get_all_scenes(),c=k.keysearch("name",b,c);else c=d.get_active();d.append_object(c,a,!0)}else q.error('object "'+a.name+'" has been created not by coping.')};a.remove_object=function(a){if(a.render.is_copied){var f=d.get_active();b.prepare_object_unloading(f,a,!1);c.remove_object(a)}else q.error("Can't remove object \""+a.name+'". It was not copied.')};a.marker_frame=function(a){var b=
d.get_active();if(b.timeline_markers&&a in b.timeline_markers)return d.marker_frame(b,a);q.error('"'+a+'" marker not found.');return 0};a.get_mb_params=function(){var a=d.get_active();return(a=d.get_subs(a,"MOTION_BLUR"))?{mb_factor:a.mb_factor,mb_decay_threshold:a.mb_decay_threshold}:null};a.set_mb_params=function(a){var b=d.get_active();(b=d.get_subs(b,"MOTION_BLUR"))?("number"==typeof a.mb_decay_threshold&&(b.mb_decay_threshold=a.mb_decay_threshold),"number"==typeof a.mb_factor&&(b.mb_factor=a.mb_factor)):
q.error("The motion blur subscene doesn't exist.")};a.can_select_objects=function(){var a=d.get_active();return Boolean(d.get_subs(a,"COLOR_PICKING"))}};b4w.module.sfx=function(a,r){var u=r("__obj_util"),h=r("__scenes"),b=r("__sfx"),l=r("__print");a.play=function(a,f,h){b.play(a,f,h)};a.play_def=function(a){b.play_def(a)};a.is_play=function(a){return b.is_play(a)};a.speaker_play=function(a,f,h,q){l.error("speaker_play() deprecated, use play() or play_def() instead");b.cyclic(a,f);q&&b.playrate(a,q);b.play(a,0,h)};a.speaker_stop=function(a){l.error("speaker_stop() deprecated, use stop() instead");b.stop(a)};a.stop=function(a){b.stop(a)};a.pause=function(a){b.speaker_pause(a)};
a.resume=function(a){b.speaker_resume(a)};a.speaker_playback_rate=function(a,f){l.error("speaker_playback_rate() deprecated, use playrate() instead");b.playrate(a,f)};a.playrate=function(a,f){b.playrate(a,f)};a.get_playrate=function(a){return b.get_playrate(a)};a.cyclic=function(a,f){b.cyclic(a,f)};a.is_cyclic=function(a){return b.is_cyclic(a)};a.listener_reset_speed=function(a,f){b.listener_reset_speed(a,f)};a.speaker_reset_speed=function(a,f,h){b.speaker_reset_speed(a,f,h)};a.get_volume=function(a){return a&&
"object"===typeof a?b.get_volume(a):b.get_master_volume()};a.set_volume=function(a,f){a&&"object"===typeof a?b.set_volume(a,f):b.set_master_volume(f)};a.mute=function(a,f){a&&"object"===typeof a?b.mute(a,f):b.mute_master(f)};a.is_muted=function(a){return a&&"object"===typeof a?b.is_muted(a):b.is_master_muted()};a.get_speaker_objects=function(){return b.get_speaker_objects().slice(0)};a.get_speakers=function(){l.error("get_speakers() deprecated, use get_speaker_objects() instead");return a.get_speaker_objects()};
a.check_active_speakers=b.check_active_speakers;a.set_compressor_params=function(a){b.set_compressor_params(h.get_active(),a)};a.get_compressor_params=function(){return b.get_compressor_params(h.get_active())};a.duck=function(a,f,h){a&&"object"===typeof a?b.duck(a,f,h):b.duck_master(f,h)};a.unduck=function(a){a&&"object"===typeof a?b.unduck(a):b.unduck_master()};a.apply_playlist=b.apply_playlist;a.clear_playlist=b.clear_playlist;a.detect_audio_container=b.detect_audio_container;a.detect_video_container=
b.detect_video_container;a.set_positional_params=b.set_positional_params;a.get_positional_params=b.get_positional_params;a.set_filter_params=b.set_filter_params;a.get_filter_params=b.get_filter_params;a.get_filter_freq_response=b.get_filter_freq_response;a.get_duration=function(a){if(a&&u.is_speaker(a))return b.get_duration(a);l.error('Object "'+(a?a.name:void 0)+'" is not a valid speaker')}};b4w.module.textures=function(a,r){var u=r("__print"),h=r("__textures");a.get_canvas_texture_context=function(a,l){l||(l=0);var c=h.get_canvas_context(a,l);if(c)return c;u.error('Canvas texture with ID "'+a+'" not found!')};a.update_canvas_texture_context=function(a,l){l||(l=0);h.update_canvas_context(a,l)||u.error('Canvas texture with ID "'+a+'" not found!')};a.play_video=function(a,l){l||(l=0);h.play_video(a,l)||u.error('Texture with name "'+a+'" not found!')};a.pause_video=function(a,l){l||(l=0);
h.pause_video(a,l)||u.error('Texture with name "'+a+'" not found!')};a.reset_video=function(a,l){l||(l=0);h.reset_video(a,l)||u.error('Texture with name "'+a+'" not found!')}};b4w.module.time=function(a,r){var u=r("__time");a.set_timeout=u.set_timeout;a.clear_timeout=u.clear_timeout;a.get_timeline=u.get_timeline;a.animate=u.animate;a.clear_animation=u.clear_animation};b4w.module.transform=function(a,r){var u=r("__obj_util"),h=r("__physics"),b=r("__print"),l=r("__quat"),c=r("__transform"),f=r("__util"),n=new Float32Array(3),q=new Float32Array(4);a.SPACE_LOCAL=c.SPACE_LOCAL;a.SPACE_WORLD=c.SPACE_WORLD;a.set_translation=function(a,f,e,l){u.is_dynamic(a)?(n[0]=f,n[1]=e,n[2]=l,c.set_translation(a,n),c.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_rel=function(a,f,e,l){u.is_dynamic(a)?(n[0]=f,n[1]=e,
n[2]=l,c.set_translation_rel(a,n),c.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_v=function(a,f){u.is_dynamic(a)?(c.set_translation(a,f),c.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_rel_v=function(a,f){u.is_dynamic(a)?(c.set_translation_rel(a,f),c.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_translation_obj_rel=
function(a,k,e,l,q){u.is_dynamic(a)?(n[0]=k,n[1]=e,n[2]=l,f.transform_vec3(n,1,q.render.quat,q.render.trans,n),c.set_translation(a,n),c.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_translation=function(a,b){b||(b=new Float32Array(3));c.get_translation(a,b);return b};a.get_translation_rel=function(a,b){b||(b=new Float32Array(3));c.get_translation_rel(a,b);return b};a.set_rotation=function(a,f,e,l,n){u.is_dynamic(a)?(q[0]=f,q[1]=e,q[2]=l,q[3]=
n,c.set_rotation(a,q),c.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_rel=function(a,f,e,l,n){u.is_dynamic(a)?(q[0]=f,q[1]=e,q[2]=l,q[3]=n,c.set_rotation_rel(a,q),c.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_quat=function(){b.error("set_rotation_quat() deprecated, use set_rotation() instead");return a.set_rotation};a.set_rotation_v=function(a,f){u.is_dynamic(a)?(c.set_rotation(a,
f),c.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_rel_v=function(a,f){u.is_dynamic(a)?(c.set_rotation_rel(a,f),c.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_quat_v=function(){b.error("set_rotation_quat_v() deprecated, use set_rotation_v() instead");return a.set_rotation_v};a.get_rotation=function(a,b){b||(b=new Float32Array(4));c.get_rotation(a,b);return b};a.get_rotation_rel=
function(a,b){b||(b=new Float32Array(4));c.get_rotation_rel(a,b);return b};a.get_rotation_quat=function(){b.error("get_rotation_quat() deprecated, use get_rotation() instead");return a.get_rotation};a.set_rotation_euler=function(a,f,e,l){u.is_dynamic(a)?(n[0]=f,n[1]=e,n[2]=l,c.set_rotation_euler(a,n),c.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_rel=function(a,f,e,l){u.is_dynamic(a)?(n[0]=f,n[1]=e,n[2]=l,c.set_rotation_euler_rel(a,
n),c.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_v=function(a,f){u.is_dynamic(a)?(c.set_rotation_euler(a,f),c.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_rotation_euler_rel_v=function(a,f){u.is_dynamic(a)?(c.set_rotation_euler_rel(a,f),c.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_scale=function(a,f){u.is_dynamic(a)?
(c.set_scale(a,f),c.update_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_scale_rel=function(a,f){u.is_dynamic(a)?(c.set_scale_rel(a,f),c.update_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_scale=function(a){return c.get_scale(a)};a.get_scale_rel=function(a){return c.get_scale_rel(a)};a.empty_reset_transform=function(a){if("EMPTY"!=a.type)b.error("Wrong object: "+a.name);else{for(var f=0;f<a.cons_descends.length;f++)if(!u.is_dynamic(a.cons_descends[f])){b.error('Wrong object: "'+
a.cons_descends[f].name+'" is not dynamic.');return}c.set_translation(a,[0,0,0]);c.set_rotation(a,[0,0,0,1]);c.set_scale(a,1);c.update_transform(a);h.sync_transform(a)}};a.get_object_size=function(a){return u.is_mesh(a)?c.get_object_size(a):(b.error("Wrong object: "+a.name),0)};a.get_object_center=function(a,f,e){return u.is_mesh(a)?c.get_object_center(a,f,e):(b.error("Wrong object: "+a.name),null)};a.move_local=function(a,f,e,l){u.is_dynamic(a)?(c.move_local(a,f,e,l),c.update_transform(a),h.sync_transform(a)):
b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.rotate_x_local=function(a,k){if(u.is_dynamic(a)){var e=l.setAxisAngle(f.AXIS_X,k,q);c.rotate_local(a,e);c.update_transform(a);h.sync_transform(a)}else b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.rotate_y_local=function(a,k){if(u.is_dynamic(a)){var e=l.setAxisAngle(f.AXIS_Y,k,q);c.rotate_local(a,e);c.update_transform(a);h.sync_transform(a)}else b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.rotate_z_local=function(a,k){if(u.is_dynamic(a)){var e=
l.setAxisAngle(f.AXIS_Z,k,q);c.rotate_local(a,e);c.update_transform(a);h.sync_transform(a)}else b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.get_object_bounding_box=function(a){return c.get_object_bounding_box(a)};a.set_tsr=function(a,f){u.is_dynamic(a)?(c.set_tsr(a,f),c.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+a.name+'" is not dynamic.')};a.set_tsr_rel=function(a,f){u.is_dynamic(a)?(c.set_tsr_rel(a,f),c.update_transform(a),h.sync_transform(a)):b.error('Wrong object: "'+
a.name+'" is not dynamic.')};a.get_tsr=function(a,b){b||(b=new Float32Array(8));c.get_tsr(a,b);return b};a.get_tsr_rel=function(a,b){b||(b=new Float32Array(8));c.get_tsr_rel(a,b);return b};a.distance=function(a,b){return c.distance(a,b)}};b4w.module.tsr=function(a,r){r("__print");var u=r("__tsr");a.create=u.create;a.from_values=u.from_values;a.copy=u.copy;a.identity=u.identity;a.create_sep=u.create_sep;a.set_sep=u.set_sep;a.set_trans=u.set_trans;a.set_scale=u.set_scale;a.set_transcale=u.set_transcale;a.set_quat=u.set_quat;a.get_trans_view=u.get_trans_view;a.get_scale=u.get_scale;a.get_quat_view=u.get_quat_view;a.invert=u.invert;a.to_mat4=function(a,b){b||(b=new Float32Array(16));u.to_mat4(a,b);return b};a.from_mat4=u.from_mat4;a.multiply=
u.multiply;a.transform_vec3=u.transform_vec3;a.transform_vec3_inv=u.transform_vec3_inv;a.transform_vectors=u.transform_vectors;a.transform_dir_vectors=u.transform_dir_vectors;a.transform_dir_vec3=u.transform_dir_vec3;a.transform_tangents=u.transform_tangents;a.translate=u.translate;a.interpolate=u.interpolate};b4w.module.util=function(a,r){var u=r("__obj_util"),h=r("__print"),b=r("__util"),l=r("__vec3");a.AXIS_X=new Float32Array([1,0,0]);a.AXIS_Y=new Float32Array([0,1,0]);a.AXIS_Z=new Float32Array([0,0,1]);a.AXIS_MX=new Float32Array([-1,0,0]);a.AXIS_MY=new Float32Array([0,-1,0]);a.AXIS_MZ=new Float32Array([0,0,-1]);a.f32=function(a){return new Float32Array(a||0)};a.assert=b.assert;a.keyfind=b.keyfind;a.keysearch=b.keysearch;a.matrix_to_quat=function(a){return b.matrix_to_quat(a)};a.euler_to_quat=function(a,
f){f||(f=new Float32Array(4));return b.euler_to_quat(a,f)};a.quat_to_euler=function(a,f){f||(f=new Float32Array(3));return b.quat_to_euler(a,f)};a.sign=b.sign;a.clamp=b.clamp;a.quat_to_dir=b.quat_to_dir;a.ground_project_quat=function(a,f){return b.quat_project(a,b.AXIS_MY,b.AXIS_Y,b.AXIS_MZ,f)};a.cam_quat_to_mesh_quat=function(a,f){return b.cam_quat_to_mesh_quat(a,f)};a.quat_project=function(a,f,n,q,d){return 0!=l.dot(n,q)?(h.error("Wrong in-plane direction"),null):b.quat_project(a,f,n,q,d)};a.hash_code=
b.hash_code;a.smooth=b.smooth;a.smooth_v=b.smooth_v;a.is_vector=b.is_vector;a.correct_cam_quat_up=b.correct_cam_quat_up;a.quat_to_angle_axis=b.quat_to_angle_axis;a.random_from_array=b.random_from_array;a.xz_direction=b.xz_direction;a.line_plane_intersect=b.line_plane_intersect;a.is_mesh=function(a){h.error("util.is_mesh() deprecated, use objects.is_mesh() instead");return u.is_mesh(a)};a.is_armature=function(a){h.error("util.is_armature() deprecated, use objects.is_armature() instead");return u.is_armature(a)};
a.angle_wrap_0_2pi=b.angle_wrap_0_2pi;a.angle_wrap_periodic=b.angle_wrap_periodic;a.smooth_step=b.smooth_step;a.lerp=b.lerp};"object"==typeof module&&module.exports&&(GLOBAL.b4w={module:{}});b4w.module.version=function(a,r){r("__print");var u=r("__version");a.version=u.version;a.version_str=u.version_str;a.type=u.type;a.date=u.date;a.date_str=u.date_str};"object"==typeof module&&module.exports&&b4w.module.version(exports);b4w.module.objects=function(a,r){var u=r("__geometry"),h=r("__objects"),b=r("__obj_util"),l=r("__print"),c=r("__scenes");r("__util");a.get_meta_tags=function(a){if(a)return h.get_meta_tags(a)};a.copy=function(a,n,q){return b.is_mesh(a)?b.is_dynamic(a)?u.has_dyn_geom(a)||u.check_shape_keys(a)||!q?-1==h.get_scene_objs(c.get_active(),"MESH",h.DATA_ID_ALL).indexOf(a)?(l.error('object "'+a.name+'" does not belong to the active scene.'),!1):h.copy(a,n||"",q):(l.error('object "'+a.name+'" has not dynamic geometry for deep copying.'),
!1):(l.error('object "'+a.name+'" is not dynamic.'),!1):(l.error('object "'+a.name+'" is not of type "MESH".'),!1)};a.set_nodemat_value=function(a,c,q){b.is_mesh(a)?h.set_nodemat_value(a,c,q):l.error('The type of the object "'+a.name+'" is not "MESH".')};a.set_nodemat_rgb=function(a,c,q,d,k){b.is_mesh(a)?h.set_nodemat_rgb(a,c,q,d,k):l.error('The type of the object "'+a.name+'" is not "MESH".')};a.update_boundings=function(a){b.is_mesh(a)?u.has_dyn_geom(a)||u.check_shape_keys(a)?h.update_boundings(a):
l.error('object "'+a.name+'" has not dynamic geometry.'):l.error('The type of the object "'+a.name+'" is not "MESH".')};a.get_parent=b.get_parent;a.get_dg_parent=b.get_dg_parent;a.is_mesh=b.is_mesh;a.is_armature=b.is_armature;a.is_speaker=b.is_speaker;a.is_camera=b.is_camera;a.is_lamp=b.is_lamp;a.is_empty=b.is_empty};b4w.module.main=function(a,r){function u(){window.performance||(z.log("Apply performance workaround"),window.performance={});var a=Date.now();window.performance.now||(z.log("Apply performance.now() workaround"),window.performance.now=function(){return Date.now()-a});A.set_timeline(0)}function h(a,b){a.addEventListener("webglcontextlost",function(a){a.preventDefault();z.error("WebGL context lost");l()},!1);C.setup_context(b);var c=C.get_renderer_info();c&&z.log("%cRENDERER INFO:","color: #00a",b.getParameter(c.UNMASKED_VENDOR_WEBGL)+
", "+b.getParameter(c.UNMASKED_RENDERER_WEBGL));H.setup_context(b);D.setup_context(b);K.setup_context(b);x.setup_context(b);t.setup_context(b);w.setup_canvas(a);N.init(a);F.setup_dim(a.width,a.height,1);L.init();pa=q();f()}function b(){na=function(){}}function l(){c()||(U=performance.now()/1E3,L.pause(),I.pause(),K.pause(),d.pause())}function c(){return ba<U}function f(){da(f);var a=performance.now()/1E3;R||(R=a);var b=a-R;if(!(b<1/Y.max_fps)){for(var d=A.get_timeline(),g=0;g<fa.length;g++)fa[g](d,
b);c()||(ba>R&&(b-=ba-Math.max(U,R)),d+=b,A.set_timeline(d),t.update(),e.update(),w.update(),n(d,b),pa(b));R=a}}function n(a,b){w.is_primary_loaded()&&(p.reset(),P.update(b),y.update(a,b),g.update(a,b),L.update(a,b),b&&k.update(b),w.is_primary_loaded()&&(I.update(a,b),w.is_primary_loaded()&&(na(b,a),w.is_primary_loaded()&&(G.update(a,b),w.is_primary_loaded()&&(d.update(),v.update(a,b),F.update(a,b),d.update_visibility(),V&&(V(Q.toDataURL()),V=null))))))}function q(){var a=60,b=0,c=Y.fps_measurement_interval,
d=Y.fps_callback_interval;return function(e){e<1/Y.max_fps||(a=S.smooth(1/e,a,e,c),e=I.get_fps(),b=(b+1)%d,0==b&&ja(Math.round(a),e))}}var d=r("__anchors"),k=r("__animation"),e=r("__assets"),m=r("__config"),B=r("__compat"),N=r("__container"),G=r("__controls"),w=r("__data"),t=r("__debug"),C=r("__extensions"),D=r("__geometry"),p=r("__hud"),g=r("__nla"),y=r("__logic_nodes"),v=r("__objects"),I=r("__physics"),z=r("__print"),H=r("__renderer"),F=r("__scenes"),L=r("__sfx"),x=r("__shaders"),K=r("__textures"),
A=r("__time"),P=r("__transform");r("__armature");var S=r("__util"),ea=r("__version"),aa=m.context,Y=m.defaults,Q=null,X=null,R=0,U=0,ba=0,fa=[],ja=function(){},pa=function(){},na=function(){},V=null,E=["webgl","experimental-webgl"],T=null,da=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/Y.max_fps)}}();a.init=function(a,b){m.set_paths();
z.set_verbose(Y.console_verbose);var c=ea.version_str()+" "+ea.type()+" ("+ea.date_str()+")";z.log("%cINIT ENGINE","color: #00a",c);if(!window.WebGLRenderingContext)return null;u();Q=a;B.apply_context_alpha_hack(d);var d,c=null;for(d=0;d<E.length;d++){var e=E[d];try{c=a.getContext(e,aa)}catch(f){}if(c)break}c&&B.detect_tegra_invalid_enum_issue(c);d=c;if(!d)return null;T=d;h(Q,d);m.apply_quality();B.set_hardware_defaults(d);x.load_shaders();Y.ie11_edge_touchscreen_hack&&(a.style["touch-action"]="none");
z.log("%cSET PRECISION:","color: #00a",Y.precision);b?(p.init(b),X=b):(m.defaults.show_hud_debug_info=!1,m.sfx.mix_mode=!1);return d};a.set_check_gl_errors=function(a){t.set_check_gl_errors(a)};a.resize=function(a,b,c){!1!==c&&(Q.style.width=a+"px",Q.style.height=b+"px",X&&(X.style.width=a+"px",X.style.height=b+"px"));X&&(X.width=a,X.height=b,p.update_dim());if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))Y.canvas_resolution_factor=1;
c=Math.floor(a*Y.canvas_resolution_factor);b=Math.floor(b*Y.canvas_resolution_factor);Y.allow_hidpi&&1<window.devicePixelRatio&&(c*=window.devicePixelRatio,b*=window.devicePixelRatio);Q.width=c;Q.height=b;if(c>T.drawingBufferWidth||b>T.drawingBufferHeight){z.warn("Canvas size exceeds platform limits, downscaling");var d=Math.min(T.drawingBufferWidth/c,T.drawingBufferHeight/b);c*=d;b*=d;Q.width=c;Q.height=b}F.setup_dim(c,b,c/a);F.check_active()&&P.update_transform(F.get_active()._camera);n(A.get_timeline(),
0);w.update_media_controls(Q.width,Q.height)};a.set_fps_callback=function(a){ja=a};a.clear_fps_callback=function(){ja=function(){}};a.set_render_callback=function(a){na=a};a.clear_render_callback=function(){b()};a.global_timeline=function(){return A.get_timeline()};a.redraw=function(){z.error("redraw() deprecated");n(A.get_timeline(),0)};a.pause=l;a.resume=function(){c()&&(ba=performance.now()/1E3,L.resume(),I.resume(),K.play(!0),d.resume())};a.is_paused=c;a.reset=function(){w.unload(0);X=Q=null;
ba=U=R=0;ja=function(){};pa=function(){};na=function(){};fa.length=0;T=null;A.reset()};a.canvas_data_url=function(a){V=a};a.get_canvas_elem=function(){return Q};a.detect_mobile=function(){return B.detect_mobile()};a.append_loop_cb=function(a){for(var b=0;b<fa.length;b++)if(fa[b]==a)return;fa.push(a)};a.remove_loop_cb=function(a){for(var b=0;b<fa.length;b++)if(fa[b]==a){fa.splice(b,1);break}}};b4w.module.nla=function(a,r){var u=r("__nla"),h=r("__time"),b=r("__print"),l=r("__util");a.set_frame=function(a){a=l.clamp(a,u.get_frame_start(),u.get_frame_end());u.check_logic_nodes()?b.error("The active scene is using NLA script."):u.set_frame(a,h.get_timeline())};a.get_frame=function(){return u.get_frame(h.get_timeline())};a.stop=function(){u.check_logic_nodes()?b.error("The active scene is using NLA script."):u.stop_nla()};a.play=function(a){u.check_logic_nodes()?b.error("The active scene is using NLA script."):
u.play_nla(a)};a.is_play=function(){return u.is_play()};a.get_frame_start=function(){return u.get_frame_start()};a.get_frame_end=function(){return u.get_frame_end()};a.check_nla=function(){return u.check_nla()};a.check_nla_scripts=function(){return u.check_logic_nodes()};a.check_logic_nodes=function(){return u.check_logic_nodes()};a.set_range=function(a,f){u.check_logic_nodes()?b.error("The active scene is using NLA script."):(f=parseFloat(f)||u.get_frame_end(),a=parseFloat(a)||u.get_frame_end(),
f=l.clamp(f,u.get_frame_start(),u.get_frame_end()),a=l.clamp(a,u.get_frame_start(),f),u.set_range(a,f))};a.reset_range=function(){u.check_logic_nodes()?b.error("The active scene is using NLA script."):u.reset_range()};a.set_cyclic=function(a){u.check_logic_nodes()?b.error("The active scene is using NLA script."):u.set_cyclic(a)};a.clear_callback=function(){u.check_logic_nodes()?b.error("The active scene is using NLA script."):u.clear_callback()}};b4w.module.app=function(a,r){function u(){var a=I.is_paused();document.addEventListener("visibilitychange",function(){document.hidden?(a=I.is_paused(),I.pause()):a||I.resume()},!1)}function h(a,b,c,d){var e=document.createElement("canvas"),f=document.getElementById(a);e.style.position="absolute";e.style.left=0;e.style.top=0;e.style.width=f.offsetWidth+"px";e.style.height=f.offsetHeight+"px";e.width=f.offsetWidth*window.devicePixelRatio;e.height=f.offsetHeight*window.devicePixelRatio;b?(b=document.createElement("canvas"),
b.style.position="absolute",e.style.left=0,e.style.top=0,b.style.pointerEvents="none"):b=null;f||(H.error('Warning: canvas container "'+a+'" not found, appending to body'),f=document.body);f.appendChild(e);if(!I.init(e,b))return c&&G("Browser could not initialize WebGL","For more info visit","https://www.blend4web.com/troubleshooting",d),!1;b&&p.insert_to_container(b,"LAST");return!0}function b(a,b){a?(b&&(document.getElementById(b).style.display="block"),P=document.getElementById(a)):(P=document.createElement("div"),
P.innerHTML=0,P.style.cssText="position:absolute;top: 23px;right: 20px;font-size: 45px;line-height: 50px;font-weight: bold;color: #000;",p.insert_to_container(P,"JUST_AFTER_CANVAS"))}function l(a,b){var c=String(a);b&&(c+="/"+String(b));P.innerHTML=c}function c(a){a=document.getElementById(a);var b=a.cloneNode(!0);a.parentNode.replaceChild(b,a);return b}function f(){var a=p.get_container();I.resize(a.clientWidth,a.clientHeight,!0)}function n(a,b,c){if(t.has_distance_limits(a))var d=L.get_translation(a,
R),e=t.get_hover_cam_pivot(a,U),d=K.subtract(d,e,R),d=Math.max(K.len(d),1);else d=10;e=L.get_rotation(a,fa);b=x.quat_to_dir(e,b,R);b[1]=0;K.normalize(b,b);K.scale(b,d*c,b);d=L.get_translation(a,U);K.add(d,b,d);t.hover_cam_set_translation(a,d)}function q(a,b){if(t.has_distance_limits(a)){var c=t.get_hover_angle_limits(a,Q);if(0>c[1]-c[0]){var d=t.get_camera_angles(a,X)[1],c=(c[0]-d)/(c[0]-c[1]),d=t.get_cam_dist_limits(a),c=Math.max(c,2/d[0]);t.rotate_hover_camera(a,0,c*b)}}else c=L.get_translation(a,
R),d=K.scale(x.AXIS_Y,-b,U),K.add(c,d,c),t.hover_cam_set_translation(a,c)}function d(a,b,c,d){L.move_local(a,5*b,5*c,5*d)}function k(a,b,c){var d=L.get_translation(a,R),e=t.get_pivot(a,U),d=K.dist(d,e),e=Math.abs(b);c=Math.pow(e*c,1-Math.pow(e*c,.15));L.move_local(a,0,0>b?.001<d?-d*c:0:c/(1-c)*d,0)}function e(a,b,c,d,e){for(a=d*c;0<b;--b)d+=a,e+=a,a=d*c;return e}function m(a,b,c,d,f,g){g?(f=t.get_pivot(a,R),g=t.get_eye(a),f=K.dist(f,g)+d,d=0<b?e(a,b,-c,f,d):e(a,-b,c/(1-c),f,d)):d-=b*f*c;return d}
function B(a,b,c){S=!0;ea=a;aa=b;Y=c;var e=F.get_active_camera(),f=!1,h=null,l=!1;switch(t.get_move_style(e)){case t.MS_TARGET_CONTROLS:f=!a;break;case t.MS_EYE_CONTROLS:h=F.get_first_character();break;case t.MS_STATIC:return;case t.MS_HOVER_CONTROLS:l=!0}var p=t.get_velocity_params(e,ja);a=g.create_elapsed_sensor();if(z.has_simulated_physics(e)){var r=g.create_collision_sensor(e,null,!0);g.create_sensor_manifold(e,"CAMERA_COLLISION",g.CT_CONTINUOUS,[r],null,function(a,b,c){if(1==c&&(c=g.get_sensor_payload(a,
b,0).coll_dist,0>c)){var d=g.get_sensor_payload(a,b,0).coll_norm;b=R;K.scale(d,-.25*c,b);c=L.get_translation(a,U);K.add(c,b,c);L.set_translation_v(a,c)}})}if(h){var r=L.get_translation(e),u=L.get_rotation(e),u=x.cam_quat_to_mesh_quat(u);r[1]-=.5;z.set_transform(h,r,u);D.append_stiff_trans(e,h,[0,.5,0]);var v=new Float32Array(2),w=!0;z.set_character_move_type(h,z.CM_FLY);g.create_kb_sensor_manifold(e,"TOGGLE_CHAR_MOVE_TYPE",g.CT_SHOT,g.KEY_C,function(){w=!w;z.set_character_move_type(h,w?z.CM_FLY:z.CM_WALK)})}r=
function(a,b,c){if(1==c)switch(c=g.get_sensor_value(a,b,0),t.get_velocity_params(a,p),b){case "FORWARD":h?v[0]=1:l?(b=t.get_camera_angles(a,X)[1],b=Math.abs(b)>=Math.PI/4?x.AXIS_MZ:x.AXIS_MY,n(a,b,.5*p[0]*c)):f?k(a,-p[2],c):d(a,0,-p[0]*c,0);break;case "BACKWARD":h?v[0]=-1:l?(b=t.get_camera_angles(a,X)[1],b=Math.abs(b)>=Math.PI/4?x.AXIS_Z:x.AXIS_Y,n(a,b,.5*p[0]*c)):f?k(a,p[2],c):d(a,0,p[0]*c,0);break;case "UP":l?q(a,30*-p[2]*c):h||d(a,0,0,-p[0]*c);break;case "DOWN":l?q(a,30*p[2]*c):h||d(a,0,0,p[0]*
c);break;case "LEFT":h?v[1]=1:l?n(a,x.AXIS_MX,.5*p[0]*c):d(a,-p[0]*c,0,0);break;case "RIGHT":h?v[1]=-1:l?n(a,x.AXIS_X,.5*p[0]*c):d(a,p[0]*c,0,0);break;case "ROT_LEFT":f?t.rotate_target_camera(a,2*-p[1]*c,0):t.rotate_eye_camera(a,2*p[1]*c,0);break;case "ROT_RIGHT":f?t.rotate_target_camera(a,2*p[1]*c,0):t.rotate_eye_camera(a,2*-p[1]*c,0);break;case "ROT_UP":f?t.rotate_target_camera(a,0,2*-p[1]*c):t.rotate_eye_camera(a,0,2*p[1]*c);break;case "ROT_DOWN":f?t.rotate_target_camera(a,0,2*p[1]*c):t.rotate_eye_camera(a,
0,2*-p[1]*c)}else switch(b){case "FORWARD":case "BACKWARD":h&&(v[0]=0);break;case "LEFT":case "RIGHT":h&&(v[1]=0)}h&&(z.set_character_move_dir(h,v[0],v[1]),a=t.get_camera_angles_char(a,Q),z.set_character_rotation(h,a[0],a[1]))};if(b)b=u=y=B=C=H=g.create_custom_sensor(0);else{b=g.create_keyboard_sensor(g.KEY_W);var u=g.create_keyboard_sensor(g.KEY_S),y=g.create_keyboard_sensor(g.KEY_A),B=g.create_keyboard_sensor(g.KEY_D),C=g.create_keyboard_sensor(g.KEY_R),H=g.create_keyboard_sensor(g.KEY_F)}var G=
g.create_keyboard_sensor(g.KEY_UP),I=g.create_keyboard_sensor(g.KEY_DOWN),J=g.create_keyboard_sensor(g.KEY_LEFT),P=g.create_keyboard_sensor(g.KEY_RIGHT),N=function(a){return a[0]&&(a[1]||a[2])};l||(g.create_sensor_manifold(e,"FORWARD",g.CT_CONTINUOUS,[a,b],null,r),g.create_sensor_manifold(e,"BACKWARD",g.CT_CONTINUOUS,[a,u],null,r));f?(g.create_sensor_manifold(e,"ROT_UP",g.CT_CONTINUOUS,[a,G,C],N,r),g.create_sensor_manifold(e,"ROT_DOWN",g.CT_CONTINUOUS,[a,I,H],N,r),g.create_sensor_manifold(e,"ROT_LEFT",
g.CT_CONTINUOUS,[a,J,y],N,r),g.create_sensor_manifold(e,"ROT_RIGHT",g.CT_CONTINUOUS,[a,P,B],N,r)):l?(g.create_sensor_manifold(e,"LEFT",g.CT_CONTINUOUS,[a,J,y],N,r),g.create_sensor_manifold(e,"RIGHT",g.CT_CONTINUOUS,[a,P,B],N,r),g.create_sensor_manifold(e,"FORWARD",g.CT_CONTINUOUS,[a,G,b],N,r),g.create_sensor_manifold(e,"BACKWARD",g.CT_CONTINUOUS,[a,I,u],N,r),g.create_sensor_manifold(e,"UP",g.CT_CONTINUOUS,[a,H],N,r),g.create_sensor_manifold(e,"DOWN",g.CT_CONTINUOUS,[a,C],N,r)):(g.create_sensor_manifold(e,
"UP",g.CT_CONTINUOUS,[a,C],N,r),g.create_sensor_manifold(e,"DOWN",g.CT_CONTINUOUS,[a,H],N,r),g.create_sensor_manifold(e,"LEFT",g.CT_CONTINUOUS,[a,y],N,r),g.create_sensor_manifold(e,"RIGHT",g.CT_CONTINUOUS,[a,B],N,r),g.create_sensor_manifold(e,"ROT_UP",g.CT_CONTINUOUS,[a,G],N,r),g.create_sensor_manifold(e,"ROT_DOWN",g.CT_CONTINUOUS,[a,I],N,r),g.create_sensor_manifold(e,"ROT_LEFT",g.CT_CONTINUOUS,[a,J],N,r),g.create_sensor_manifold(e,"ROT_RIGHT",g.CT_CONTINUOUS,[a,P],N,r));if(!c){var fa=0;c=g.create_mouse_wheel_sensor();
var ua=0,r=g.create_touch_zoom_sensor();g.create_sensor_manifold(e,"MOUSE_WHEEL",g.CT_LEVEL,[c],null,function(a,b,c){1==c&&(b=g.get_sensor_value(a,b,0),t.get_velocity_params(a,p),f||l?fa=m(a,b,p[2],fa,2,f):(p[0]*=1+b*p[2],t.set_velocity_params(a,p)))});g.create_sensor_manifold(e,"TOUCH_ZOOM",g.CT_LEVEL,[r],null,function(a,b,c,d){1==c&&(c=g.get_sensor_value(a,b,0),t.get_velocity_params(a,p),g.get_sensor_payload(a,b,0)===g.PL_MULTITOUCH_MOVE_ZOOM&&(ua=m(a,c,.03*p[2],ua,2,f)))});g.create_sensor_manifold(e,
"ZOOM_INTERPOL",g.CT_CONTINUOUS,[a],null,function(a,b,c){if(1==c&&(f||l))if(1E-5<Math.abs(fa)||1E-5<Math.abs(ua)){b=g.get_sensor_value(a,b,0);c=x.smooth(fa,0,b,.1*A);fa-=c;var d=x.smooth(ua,0,b,.15*A);ua-=d;if(l)q(a,-(c+d));else{b=t.get_pivot(a,R);var e=t.get_eye(a,U);.001<K.dist(b,e)+c+d?L.move_local(a,0,c+d,0):(c=K.subtract(e,b,U),d=K.normalize(c,ba),K.scale(d,.001,d),K.add(b,d,c),L.set_translation_v(a,c),ua=fa=0)}}else ua=fa=0})}var Fa=0,ya=0,mc=0,Oa=0;c=g.create_mouse_move_sensor("X");r=g.create_mouse_move_sensor("Y");
b=g.create_mouse_click_sensor();u=function(a,b,c,d){if(1==c){c=g.get_sensor_value(a,b,1);t.get_velocity_params(a,p);if(l)e=.003*p[0],f=7.5E-4*p[1];else var e=.003*p[1],f=7.5E-4*p[0];if(1===g.get_sensor_payload(a,b,0))Fa+="X"==d?-c*e:0,ya+="Y"==d?-c*e:0;else if(2===g.get_sensor_payload(a,b,0)||3===g.get_sensor_payload(a,b,0))mc+="X"==d?-c*f:0,Oa+="Y"==d?-c*f:0}};g.create_sensor_manifold(e,"MOUSE_X",g.CT_LEVEL,[b,c],null,u,"X");g.create_sensor_manifold(e,"MOUSE_Y",g.CT_LEVEL,[b,r],null,u,"Y");var xa=
0,Ba=0,Ga=0,ka=0;c=g.create_touch_move_sensor("X");r=g.create_touch_move_sensor("Y");b=function(a,b,c,d){if(1==c){var e=l?.003*p[0]:.003*p[1];c=g.get_sensor_value(a,b,0);g.get_sensor_payload(a,b,0)===g.PL_SINGLE_TOUCH_MOVE?(xa+="X"==d?-c*e:0,Ba+="Y"==d?-c*e:0):g.get_sensor_payload(a,b,0)===g.PL_MULTITOUCH_MOVE_PAN&&(a=l?.003*p[1]:7.5E-4*p[0],Ga+="X"==d?-c*a:0,ka+="Y"==d?-c*a:0)}};g.create_sensor_manifold(e,"TOUCH_X",g.CT_LEVEL,[c],null,b,"X");g.create_sensor_manifold(e,"TOUCH_Y",g.CT_LEVEL,[r],null,
b,"Y");g.create_sensor_manifold(e,"ROT_TRANS_INTERPOL",g.CT_CONTINUOUS,[a],null,function(a,b,c){if(1==c&&(1E-5<Math.abs(Fa)||1E-5<Math.abs(ya)||1E-5<Math.abs(xa)||1E-5<Math.abs(Ba)||1E-5<Math.abs(mc)||1E-5<Math.abs(Oa)||1E-5<Math.abs(Ga)||1E-5<Math.abs(ka))){var d=g.get_sensor_value(a,b,0),e=x.smooth(Fa,0,d,.08*A);b=x.smooth(ya,0,d,.08*A);Fa-=e;ya-=b;var k=x.smooth(xa,0,d,.12*A);c=x.smooth(Ba,0,d,.12*A);xa-=k;Ba-=c;var m=x.smooth(mc,0,d,.08*A),p=x.smooth(Oa,0,d,.08*A);mc-=m;Oa-=p;var r=x.smooth(Ga,
0,d,.12*A),d=x.smooth(ka,0,d,.12*A);Ga-=r;ka-=d;f?(t.rotate_target_camera(a,e+k,b+c),t.move_pivot(a,m+r,p+d)):l?(e+k&&n(a,x.AXIS_X,.2*(e+k)),b+c&&(e=t.get_camera_angles(a,X)[1],e=Math.abs(e)>Math.PI/4?x.AXIS_Z:x.AXIS_Y,n(a,e,.2*(b+c))),t.rotate_hover_camera(a,m+r,0)):(t.rotate_eye_camera(a,.5*(e+k),.5*(b+c)),h&&(a=t.get_camera_angles_char(a,Q),z.set_character_rotation(h,a[0],a[1])))}});g.create_kb_sensor_manifold(e,"DEC_STEREO_DIST",g.CT_SHOT,g.KEY_LEFT_SQ_BRACKET,function(a,b,c){b=t.get_stereo_distance(a);
t.set_stereo_distance(a,.9*b)});g.create_kb_sensor_manifold(e,"INC_STEREO_DIST",g.CT_SHOT,g.KEY_RIGHT_SQ_BRACKET,function(a,b,c){b=t.get_stereo_distance(a);t.set_stereo_distance(a,1.1*b)})}function N(){var a=F.get_active_camera();S=!1;for(var b="FORWARD BACKWARD ROT_UP ROT_DOWN ROT_LEFT ROT_RIGHT UP DOWN LEFT RIGHT MOUSE_WHEEL TOUCH_ZOOM ZOOM_INTERPOL MOUSE_X MOUSE_Y TOUCH_X TOUCH_Y ROT_TRANS_INTERPOL".split(" "),c=0;c<b.length;c++)g.remove_sensor_manifold(a,b[c]);t.get_move_style(a)==t.MS_EYE_CONTROLS&&
F.get_first_character()&&D.remove(a)}function G(a,b,c,d){var e=document.createElement("div"),f=document.createElement("div"),g=document.createElement("div");if(d)for(var h=0;h<d.length;h++){var k=document.getElementById(d[h]);k&&k.parentNode.removeChild(k)}e.style.cssText="z-index:10;width:100%;height:auto;position:absolute;top:50%;margin-top:150px;text-align:center;";f.style.cssText="color:#fff;font-size:24px;";g.style.cssText="color:#fff;font-size:20px;";f.innerHTML=a;g.innerHTML=b+'   <a style="color:#fff;font-size:20px;width:100%;" href="'+
c+'">'+c.replace("https://www.","")+"</a>";e.appendChild(f);e.appendChild(g);document.body.appendChild(e)}function w(a,b,c,d,e){function f(){var h=performance.now()-g;e(b+h*(c-b)/d);(h>=d||!a.parentNode)&&I.remove_loop_cb(f)}var g=performance.now();I.append_loop_cb(f)}r("animation");var t=r("camera"),C=r("config"),D=r("constraints"),p=r("container"),g=r("controls"),y=r("data"),v=r("debug"),I=r("main"),z=r("physics"),H=r("print"),F=r("scenes"),L=r("transform"),x=r("util"),K=r("vec3"),A=1,P=null,S=
!1,ea=!1,aa=!1,Y=!1,Q=new Float32Array(2),X=new Float32Array(2),R=new Float32Array(3),U=new Float32Array(3),ba=new Float32Array(3),fa=new Float32Array(4),ja=new Float32Array(3);a.init=function(a){a=a||{};var c=!1,d=null,e=function(){},k=null,m=null,n=0,r=null,t=!1,q=!0,v=!0,x=!0,A=!1,w=!1,F=!1,z=!1,B;for(B in a)switch(B){case "canvas_container_id":d=a.canvas_container_id;break;case "callback":e=a.callback;break;case "autoresize":c=a.autoresize;break;case "do_not_use_onload":break;case "gl_debug":t=
a.gl_debug;break;case "show_hud_debug_info":F=a.show_hud_debug_info;break;case "sfx_mix_mode":A=a.sfx_mix_mode;break;case "show_fps":w=a.show_fps;break;case "track_container_position":z=a.track_container_position;break;case "fps_wrapper_id":r=a.fps_wrapper_id;break;case "fps_elem_id":m=a.fps_elem_id;break;case "error_purge_elements":k=a.error_purge_elements;break;case "report_init_failure":x=a.report_init_failure;break;case "pause_invisible":v=a.pause_invisible;break;case "key_pause_enabled":q=a.key_pause_enabled;
break;case "force_container_ratio":n=a.force_container_ratio;break;default:C.set(B,a[B])}a=function(a){a.keyCode==g.KEY_P&&(I.is_paused()?I.resume():I.pause())};q&&document.addEventListener("keydown",a,!1);C.set("show_hud_debug_info",F);C.set("sfx_mix_mode",A);var D=F||A||null,q=function(){var a=h(d,D,x,k),g=p.get_canvas();if(a){var q=p.get_container();f();I.set_check_gl_errors(t);w&&(b(m,r),I.set_fps_callback(l));v&&u();n&&I.append_loop_cb(function(){q.style.height=q.clientWidth/n+"px"});c&&I.append_loop_cb(function(){var a=
q.clientWidth,b=q.clientHeight;a==g.clientWidth&&b==g.clientHeight||I.resize(a,b,!0)});z&&I.append_loop_cb(function(){p.force_offsets_updating()});e(g,!0)}else e(g,!1)};"complete"==document.readyState?window.setTimeout(q,0):window.addEventListener("load",q,!1);window.addEventListener("unload",function(){y.cleanup()},!1)};a.resize_to_container=f;a.set_onclick=function(a,b){var d=c(a);d.addEventListener("mouseup",function(a){b(d.value)},!1)};a.set_onchange=function(a,b){var d=c(a);d.addEventListener("change",
function(a){a=d.checked;b(void 0!=a?a:d.value)},!1)};a.set_onkeypress=function(a,b){var d=c(a);d.addEventListener("keypress",function(a){b(a.keyCode,d.value)},!1)};a.enable_camera_controls=B;a.disable_camera_controls=N;a.set_camera_move_style=function(a){var b=S;b&&N();var c=F.get_active_camera();t.set_move_style(c,a);b&&B(ea,aa,Y)};a.enable_object_controls=function(a){var b=z.is_vehicle_chassis(a)||z.is_vehicle_hull(a),c=function(a,c,d){if(1==d)switch(d=g.get_sensor_value(a,c,0),c){case "FORWARD":b?
z.vehicle_throttle(a,1):L.move_local(a,0,0,1*d);break;case "BACKWARD":b?z.vehicle_throttle(a,-1):L.move_local(a,0,0,-1*d);break;case "LEFT":b?z.vehicle_steer(a,-1):L.move_local(a,1*d,0,0);break;case "RIGHT":b?z.vehicle_steer(a,1):L.move_local(a,-1*d,0,0)}else switch(c){case "FORWARD":case "BACKWARD":b&&z.vehicle_throttle(a,0);break;case "LEFT":case "RIGHT":b&&z.vehicle_steer(a,0)}},d=g.create_elapsed_sensor(),e=g.create_keyboard_sensor(g.KEY_W),f=g.create_keyboard_sensor(g.KEY_S),h=g.create_keyboard_sensor(g.KEY_A),
k=g.create_keyboard_sensor(g.KEY_D),l=g.create_keyboard_sensor(g.KEY_UP),m=g.create_keyboard_sensor(g.KEY_DOWN),n=g.create_keyboard_sensor(g.KEY_LEFT),p=g.create_keyboard_sensor(g.KEY_RIGHT),q=function(a){return a[0]&&(a[1]||a[2])};g.create_sensor_manifold(a,"FORWARD",g.CT_CONTINUOUS,[d,e,l],q,c);g.create_sensor_manifold(a,"BACKWARD",g.CT_CONTINUOUS,[d,f,m],q,c);g.create_sensor_manifold(a,"LEFT",g.CT_CONTINUOUS,[d,h,n],q,c);g.create_sensor_manifold(a,"RIGHT",g.CT_CONTINUOUS,[d,k,p],q,c)};a.disable_object_controls=
function(a){for(var b=["FORWARD","BACKWARD","LEFT","RIGHT"],c=0;c<b.length;c++)g.remove_sensor_manifold(a,b[c])};a.enable_controls=function(a){var b=p.get_container();a=a||!1;g.register_keyboard_events(document,!1);g.register_mouse_events(b,!0,a);g.register_wheel_events(b,!0);g.register_touch_events(b,!0);g.register_device_orientation()};a.disable_controls=function(){var a=p.get_container();g.unregister_keyboard_events(document);g.unregister_mouse_events(a);g.unregister_wheel_events(a);g.unregister_touch_events(a);
g.unregister_device_orientation()};a.enable_debug_controls=function(){g.create_kb_sensor_manifold(null,"CAMERA_SHOT",g.CT_SHOT,g.KEY_K,function(){v.make_camera_frustum_shot()});g.create_kb_sensor_manifold(null,"LIGHT_SHOT",g.CT_SHOT,g.KEY_L,function(){v.make_light_frustum_shot()});g.create_kb_sensor_manifold(null,"TELEMETRY",g.CT_SHOT,g.KEY_T,function(){v.plot_telemetry()})};a.request_fullscreen=function(a,b,c){function d(){document.fullscreenElement===a||document.webkitFullScreenElement===a||document.mozFullScreenElement===
a||document.webkitIsFullScreen||document.msFullscreenElement===a?b():(document.removeEventListener("fullscreenchange",d,!1),document.removeEventListener("webkitfullscreenchange",d,!1),document.removeEventListener("mozfullscreenchange",d,!1),document.removeEventListener("MSFullscreenChange",d,!1),c())}b=b||function(){};c=c||function(){};document.addEventListener("fullscreenchange",d,!1);document.addEventListener("webkitfullscreenchange",d,!1);document.addEventListener("mozfullscreenchange",d,!1);document.addEventListener("MSFullscreenChange",
d,!1);a.requestFullScreen=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen||a.msRequestFullscreen;a.requestFullScreen==a.webkitRequestFullScreen?a.requestFullScreen(Element.ALLOW_KEYBOARD_INPUT):a.requestFullScreen()};a.exit_fullscreen=function(){var a=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen;if("function"!=typeof a)throw"B4W App: exit fullscreen method is not supported";a.apply(document)};a.check_fullscreen=
function(){return window.document.fullscreenEnabled||window.document.mozFullScreenEnabled||window.document.msFullscreenEnabled||window.document.webkitFullscreenEnabled?!0:!1};a.report_app_error=G;a.get_url_params=function(a){a=!!a;var b=location.href.toString();if(-1==b.indexOf("?"))return null;for(var b=b.split("?")[1].split("&"),c={},d=0;d<b.length;d++){var e=b[d].split("="),f=e[0];1<e.length?(e=e[1],a?f in c?c[f].push(e):c[f]=[e]:c[f]=e):a?f in c||(c[f]=[]):c[f]=""}return c};a.css_animate=function(a,
b,c,d,e,f,g,h){function k(e){a&&(l[b]=f+e+g,c>d&&e<=d||c<d&&e>=d)&&(l[b]=f+d+g,h())}if(a&&b&&isFinite(c)&&isFinite(d)&&isFinite(e)){f=f||"";g=g||"";h=h||function(){};var l=a.style,m=b.charAt(0).toUpperCase()+b.slice(1);if(void 0==l[b])if(void 0!=l["webkit"+m])b="webkit"+m;else if(void 0!=l["ms"+m])b="ms"+m;else if(void 0!=l["moz"+m])b="moz"+m;else return;w(a,c,d,e,k)}};a.attr_animate=function(a,b,c,d,e,f){function g(e){a&&(0<=e&&a.setAttribute(b,e),c>d&&e<=d||c<d&&e>=d)&&(a.setAttribute(b,d),f())}
a&&b&&isFinite(c)&&isFinite(d)&&isFinite(e)&&(f=f||function(){},w(a,c,d,e,g))};a.queue_animate=function(b){if(b.length){var c=b.shift(),d=c.elem,e=c.prop,f=c.from,g=c.to,h=c.duration,k=c.opt_prefix,l=c.opt_suffix,m=function(){c.cb&&c.cb();a.queue_animate(b)};"css"==c.type?a.css_animate(d,e,f,g,h,k,l,m):"attr"==c.type&&a.attr_animate(d,e,f,g,h,m)}};a.set_camera_smooth_factor=function(a){A=a};a.get_camera_smooth_factor=function(){return A}};b4w.module.camera_anim=function(a,r){function u(a,b,c,e){b=d.angle_wrap_0_2pi(a-b);a=d.angle_wrap_0_2pi(c-a);if(1E-6>Math.abs(b)||1E-6>2*Math.PI-Math.abs(b))b=0;if(1E-6>Math.abs(a)||1E-6>2*Math.PI-Math.abs(a))a=0;e[0]=b;e[1]=a;return e}var h=r("camera"),b=r("controls"),l=r("print"),c=r("scenes"),f=r("time"),n=r("transform"),q=r("tsr"),d=r("util"),k=r("vec3"),e=r("quat"),m=new Float32Array(2),B=new Float32Array(2),N=new Float32Array(3),G=new Float32Array(3),w=new Float32Array(3),t=new Float32Array(4),
C=new Float32Array(2),D=new Float32Array(2),p=new Float32Array(8),g=new Float32Array(8),y=new Float32Array(8),v=!1,I=!1,z=!1,H=!1;a.track_to_target=function(a,c,f,g,p,q,r,u){if(!h.is_eye_camera(a))l.error("track_to_target(): wrong object");else if(a&&c){if(d.is_vector(c))var v=c;else v=w,n.get_object_center(c,!1,v);c=f||1;f=g||2;var y=p||1;p=q||1;G[0]=0;G[1]=-1;G[2]=0;var z=n.get_rotation(a);q=d.quat_to_dir(z,G);g=h.get_camera_angles(a,m);var B=n.get_translation(a);k.subtract(v,B,N);k.normalize(N,
N);var C=e.rotationTo(q,N,e.create());e.multiply(C,z,t);d.correct_cam_quat_up(t,!1);k.subtract(v,B,G);var D=k.length(G)*(1-1/f),v=Math.asin(N[1]);f=Math.acos(-N[2]/Math.abs(Math.cos(v)));0<N[0]&&(f=2*Math.PI-f);var H=f-g[0],I=v-g[1];w[0]=0;w[1]=0;w[2]=-1;f=n.get_rotation(a);0>d.quat_to_dir(f,w)[1]?(I=0<q[1]?v-Math.PI+g[1]:v+Math.PI+g[1],H=0<H?-Math.PI+H:Math.PI+H):Math.abs(H)>Math.PI&&(H=0<H?H-2*Math.PI:H+2*Math.PI);var ja=0,v=b.create_elapsed_sensor();q=Math.abs(H/c);c=Math.abs(I/c);var pa=q>c?q:
c,na=pa+y,V=na+p,E=V+y,T=H,da=I,qa=D,O=function(){b.remove_sensor_manifold(a,"TRACK_TO_TARGET");r&&r()};b.create_sensor_manifold(a,"TRACK_TO_TARGET",b.CT_CONTINUOUS,[v],null,function(a,c,d){if(d)if(h.is_eye_camera(a))if(d=b.get_sensor_value(a,c,0),ja+=d,ja<pa){var e=H/pa*d;d*=I/pa;c=ja/pa;c=6*c*(1-c);e*=c;d*=c;T-=e;da-=d;h.rotate_eye_camera(a,e,d)}else ja<na?(T&&(h.rotate_eye_camera(a,T,da),T=0,u&&u()),c=(ja-pa)/y,d=-D*d/y,qa-=e,n.move_local(a,0,6*d*c*(1-c),0)):ja<V?qa&&(n.move_local(a,0,qa,0),qa=
0):ja<E?(c=(ja-V)/y,d=D*d/y,d=6*d*c*(1-c),n.move_local(a,0,d,0)):(n.set_translation_v(a,B),O());else O()})}};a.auto_rotate=function(a,e){function f(c,e,l){if(1==l)if(l=h.get_move_style(c),l==h.MS_STATIC)g();else if(l!=h.MS_HOVER_CONTROLS&&h.has_horizontal_limits(c)){l=h.get_horizontal_limits(c,D);if(null===n||l[0]!=n[0]||l[1]!=n[1]){n=n||C;n.set(l);p=Math.min(.2,d.angle_wrap_0_2pi(n[1]-n[0])/2);l=n;var r=h.get_camera_angles(k,m)[0];l=u(r,l[0],l[1],B);q=a*Math.min(1,l[0]/.2,l[1]/.2)}e=b.get_sensor_value(c,
e,0);l=h.get_camera_angles(c,m)[0];l=u(l,n[0],n[1],B);l[1]>p&&l[0]>p?q=d.sign(q)*a:l[1]<p?q-=Math.pow(a,2)/.4*e:l[0]<p&&(q+=Math.pow(a,2)/.4*e);h.rotate_camera(c,e*q,0)}else n=null,e=b.get_sensor_value(c,e,0),h.rotate_camera(c,e*a,0)}function g(){b.remove_sensor_manifold(k,"AUTO_ROTATE");b.remove_sensor_manifold(k,"DISABLE_AUTO_ROTATE");e()}e=e||function(){};var k=c.get_active_camera();if(h.get_move_style(k)==h.MS_STATIC)l.error("auto_rotate(): wrong camera type");else{var n=null,p=0,q=0;if(b.check_sensor_manifold(k,
"AUTO_ROTATE"))g();else{var r=b.create_mouse_move_sensor("X"),t=b.create_mouse_move_sensor("Y"),v=b.create_mouse_click_sensor(),w=b.create_touch_move_sensor(),y=b.create_touch_zoom_sensor(),z=b.create_elapsed_sensor();b.create_sensor_manifold(k,"DISABLE_AUTO_ROTATE",b.CT_LEVEL,[r,t,v,w,y],function(a){return a[0]&&a[2]||a[1]&&a[2]||a[3]||a[4]},g);b.create_sensor_manifold(k,"AUTO_ROTATE",b.CT_CONTINUOUS,[z],function(a){return a[0]},f)}}};a.is_auto_rotate=function(){var a=c.get_active_camera();return b.check_sensor_manifold(a,
"AUTO_ROTATE")};a.check_auto_rotate=function(){var a=c.get_active_camera();return h.get_move_style(a)==h.MS_STATIC?!1:!0};a.move_camera_to_point=function(a,b,c,e,m){if(h.get_move_style(a)!=h.MS_STATIC)l.error("move_camera_to_point(): wrong camera type");else if(!v)if(a)if(b){c=c||1;e=e||.01;var r=d.is_vector(a)?a:n.get_tsr(a,p),t=d.is_vector(b)?b:n.get_tsr(b,g);b=k.distance(q.get_trans_view(r),q.get_trans_view(t))/c;c=d.quat_to_dir(q.get_quat_view(r),d.AXIS_MY,N);var u=d.quat_to_dir(q.get_quat_view(t),
d.AXIS_MY,G);c=Math.min(Math.abs(k.dot(c,u)),1);e=Math.acos(c)/e;e=1E3*Math.max(b,e);v=!0;var w=f.animate(0,1,e,function(b){var c=q.interpolate(r,t,d.smooth_step(b),y);z?(f.clear_animation(w),v=z=!1):(n.set_tsr(a,c),1==b&&(v=!1,m&&m()))})}else l.error("move_camera_to_point(): you must specify the point object");else l.error("move_camera_to_point(): you must specify the camera object")};a.rotate_camera=function(a,b,c,d,e){if(!I)if(a)if(b||c){I=!0;var g=0,k=0,m=0!=b?b:c,n=f.animate(0,m,d||1E3,function(d){H?
(f.clear_animation(n),I=H=!1):(g-=d,k-=d,c&&b?h.rotate_camera(a,g,k):c?h.rotate_camera(a,0,k):b&&h.rotate_camera(a,g,0),k=g=d,d==m&&(I=!1,e&&e()))})}else l.error("rotate_camera(): you must specify the rotation angle");else l.error("rotate_camera(): you must specify the camera object")};a.stop_cam_moving=function(){z=!0};a.stop_cam_rotating=function(){H=!0};a.is_moving=function(){return v};a.is_rotating=function(){return I}};b4w.module.gyroscope=function(a,r){function u(a){var b=h.create_gyro_angles_sensor(),r=!0;h.create_sensor_manifold(a,"CAMERA_ROTATE_GYRO",h.CT_CONTINUOUS,[b],null,function(a,b,e){if(0<e){f=h.get_sensor_payload(a,b,0);r&&(c[0]=f[0],c[1]=f[1],c[2]=f[2],r=!1);e=b=0;0==window.orientation&&(b=f[1]-c[1],e=f[0]-c[0],f[1]>q&&f[1]<n&&(e=0));if(180==window.orientation){b=f[1]-c[1];0>f[1]&&(b=-b);e=c[0]-f[0];if(b>Math.PI/2||b<-Math.PI/2)b=0;f[1]>-n&&f[1]<-q&&(e=0)}if(-90==window.orientation){b=f[0]-c[0];if(b>
Math.PI/2||b<-Math.PI/2)b=0;e=c[1]-f[1];if(f[0]>d||f[0]<k)e=0}if(90==window.orientation){b=c[0]-f[0];if(b>Math.PI/2||b<-Math.PI/2)b=0;e=f[1]-c[1];if(f[0]>d||f[0]<k)e=0}l.rotate_camera(a,e,b);c[0]=f[0];c[1]=f[1];c[2]=f[2]}})}var h=r("controls"),b=r("scenes"),l=r("camera"),c=new Float32Array(3),f=new Float32Array(3),n=110*Math.PI/180,q=70*Math.PI/180,d=70*Math.PI/180,k=70*-Math.PI/180;a.enable_camera_rotation=function(){var a=b.get_active_camera();u(a)}};b4w.module.mixer=function(a,r){function u(){w=G.length=0;t=h(100);C=new Float32Array(t.length);D=new Float32Array(t.length);var a=B.get_speaker_objects();if(a.length){G.push(b());for(var d=0;d<a.length;d++)G.push(c(a[d]));G.sort(function(a,b){return"MASTER"==a.id?-1:"MASTER"==b.id?1:"COMPRESSOR"==a.id?-1:"COMPRESSOR"==b.id?1:a.id.toUpperCase()<b.id.toUpperCase()?-1:a.id.toUpperCase()>b.id.toUpperCase()?1:0})}}function h(a){for(var b=new Float32Array(a),c=0,d=0;d<a;d++)b[d]=20*Math.pow(1E3,c),c+=1/
(a-1);return b}function b(){var a=l("MASTER");a.params.push(["VOLUME",B.get_volume(null),0,1,50,!1]);var b=B.get_compressor_params();b&&(a.params.push(["THRESHOLD",b.threshold,-100,0,100,!1]),a.params.push(["KNEE",b.knee,0,40,40,!1]),a.params.push(["RATIO",b.ratio,1,20,20,!1]),a.params.push(["ATTACK",b.attack,0,1,1E3,!1]),a.params.push(["RELEASE",b.release,0,1,1E3,!1]));a.mute=B.is_muted(null)?1:0;a.solo=-1;return a}function l(a){return{id:a,params:[],active_param:0,mute:-1,solo:-1,speaker:null}}
function c(a){var b=l(m.get_object_name(a));b.mute=B.is_muted(a)?1:0;b.solo=0;b.speaker=a;return b}function f(a){if(a.speaker){a.params.length=0;a.params.push(["VOLUME",B.get_volume(a.speaker),0,1,50,!1]);var b=B.get_positional_params(a.speaker);b&&(a.params.push(["DIST_REF",b.dist_ref,0,1E3,1E4,!1]),a.params.push(["ATTENUATION",b.attenuation,0,50,1E3,!1]),a.params.push(["DIST_MAX",b.dist_max,0,1E4,1E4,!1]));if(b=B.get_filter_params(a.speaker))a.params.push(["EQ_FREQ",b.freq,20,2E4,100,!0]),a.params.push(["EQ_Q",
b.Q,0,10,100,!1]),a.params.push(["EQ_GAIN",b.gain,-70,30,100,!1]);N.clamp(a.active_param,0,a.params.length-1)}}function n(a){for(var b=0;b<G.length;b++){var c=G[b];if(c!=a&&1==c.solo)return!0}return!1}function q(a){for(var b=0;b<G.length;b++){var c=G[b];c!=a&&0==c.mute&&0==c.solo&&B.mute(c.speaker,!1)}}function d(){if(0==G.length)return[0,-1];var a=8*Math.floor(w/8),b=a+7,a=N.clamp(a,0,G.length-1),b=N.clamp(b,0,G.length-1);return[a,b]}var k=r("controls");r("debug");var e=r("hud"),m=r("scenes"),B=
r("sfx"),N=r("util"),G=[],w=0,t=null,C=null,D=null;a.enable_mixer_controls=function(){u();var a=k.create_keyboard_sensor(k.KEY_LEFT_SQ_BRACKET),b=k.create_keyboard_sensor(k.KEY_RIGHT_SQ_BRACKET),c=k.create_keyboard_sensor(k.KEY_SEMI_COLON),h=k.create_keyboard_sensor(k.KEY_SINGLE_QUOTE),l=k.create_keyboard_sensor(k.KEY_SHIFT),m=k.create_timer_sensor(.15,!0),r=k.create_timer_sensor(.05,!0),a=[a,b,c,h,l,m,r],b=function(a,b,c){if(1==c){c=Boolean(k.get_sensor_value(a,b,0))?-1:1;if(G.length){1==c&&w<G.length-
1?w++:-1==c&&0<w&&w--;c=d();for(var e=c[0];e<=c[1];e++)f(G[e])}"SWITCH_STRIP"==b?k.reset_timer_sensor(a,b,5,.15+.3):k.reset_timer_sensor(a,b,5,.15)}else k.reset_timer_sensor(a,b,5,10)};k.create_sensor_manifold(null,"SWITCH_STRIP",k.CT_TRIGGER,a,function(a){return(a[0]||a[1])&&!a[4]},b);k.create_sensor_manifold(null,"SWITCH_STRIP_HOLD",k.CT_SHOT,a,function(a){return(a[0]||a[1])&&!a[4]&&a[5]},b);k.create_sensor_manifold(null,"SWITCH_PARAM",k.CT_SHOT,a,function(a){return(a[0]||a[1])&&a[4]},function(a,
b,c){a=Boolean(k.get_sensor_value(a,b,0))?-1:1;(b=G[w])&&(1==a&&b.active_param<b.params.length-1?b.active_param++:-1==a&&0<b.active_param&&b.active_param--)});b=function(a,b,c){if(1==c){var d=Boolean(k.get_sensor_value(a,b,2))?-1:1,e=G[w];if(e)switch(c=e.params[e.active_param],c[1]=c[5]?c[1]*Math.pow(c[3]/c[2],d/c[4]):c[1]+(c[3]-c[2])/c[4]*d,c[1]=N.clamp(c[1],c[2],c[3]),c[0]){case "VOLUME":"MASTER"!=e.id?B.set_volume(e.speaker,c[1]):B.set_volume(null,c[1]);break;case "DIST_REF":d=B.get_positional_params(e.speaker);
d.dist_ref=c[1];B.set_positional_params(e.speaker,d);break;case "ATTENUATION":d=B.get_positional_params(e.speaker);d.attenuation=c[1];B.set_positional_params(e.speaker,d);break;case "DIST_MAX":d=B.get_positional_params(e.speaker);d.dist_max=c[1];B.set_positional_params(e.speaker,d);break;case "EQ_FREQ":d=B.get_filter_params(e.speaker);d.freq=c[1];B.set_filter_params(e.speaker,d);break;case "EQ_Q":d=B.get_filter_params(e.speaker);d.Q=c[1];B.set_filter_params(e.speaker,d);break;case "EQ_GAIN":d=B.get_filter_params(e.speaker);
d.gain=c[1];B.set_filter_params(e.speaker,d);break;case "THRESHOLD":e=B.get_compressor_params();e.threshold=c[1];B.set_compressor_params(e);break;case "KNEE":e=B.get_compressor_params();e.knee=c[1];B.set_compressor_params(e);break;case "RATIO":e=B.get_compressor_params();e.ratio=c[1];B.set_compressor_params(e);break;case "ATTACK":e=B.get_compressor_params();e.attack=c[1];B.set_compressor_params(e);break;case "RELEASE":e=B.get_compressor_params();e.release=c[1];B.set_compressor_params(e);break;default:throw"Unknown strip param";
}"INC_DEC"==b?k.reset_timer_sensor(a,b,6,.35):k.reset_timer_sensor(a,b,6,.05)}else k.reset_timer_sensor(a,b,6,10)};k.create_sensor_manifold(null,"INC_DEC",k.CT_TRIGGER,a,function(a){return(a[2]||a[3])&&!a[4]},b);k.create_sensor_manifold(null,"INC_DEC_HOLD",k.CT_SHOT,a,function(a){return(a[2]||a[3])&&!a[4]&&a[6]},b);k.create_sensor_manifold(null,"MUTE_SOLO",k.CT_SHOT,a,function(a){return(a[2]||a[3])&&a[4]},function(a,b,c){if(Boolean(k.get_sensor_value(a,b,2)))(a=G[w])&&0<=a.mute&&("MASTER"!=a.id?0==
a.mute?(a.mute=1,B.mute(a.speaker,!0),1==a.solo&&(a.solo=0,n(a)||q(a))):(a.mute=0,n(a)||B.mute(a.speaker,!1)):0==a.mute?(a.mute=1,B.mute(null,!0)):(a.mute=0,B.mute(null,!1)));else if((a=G[w])&&0<=a.solo)if(0==a.solo)for(a.solo=1,B.mute(a.speaker,!1),1==a.mute&&(a.mute=0),b=0;b<G.length;b++)c=G[b],c!=a&&0==c.mute&&0==c.solo&&B.mute(c.speaker,!0);else a.solo=0,n(a)?B.mute(a.speaker,!0):q(a)});a=k.create_elapsed_sensor();k.create_sensor_manifold(null,"MIXER_DRAW",k.CT_CONTINUOUS,[a],null,function(){if(G[w])for(var a=
d(),b=a[0];b<=a[1];b++){var c=G[b];e.draw_mixer_strip(c.id,b==w,b%8,c.params,c.active_param,c.mute,c.solo);if(c.speaker&&B.get_filter_params(c.speaker)){B.get_filter_freq_response(c.speaker,t,C,D);for(c=0;c<C.length;c++)C[c]=20*Math.log(C[c])/Math.LN10;e.plot_array("EQ",b%8,C,20,2E4,-10,10)}}});a=k.create_timer_sensor(1,!0);k.create_sensor_manifold(null,"MIXER_UPDATE",k.CT_TRIGGER,[a],null,function(){for(var a=d(),b=a[0];b<=a[1];b++)f(G[b])})}};b4w.module.npc_ai=function(a,r){function u(a,b){var c=b.destination,d=w;m.get_translation(b.empty,d);var e=t;m.get_translation(b.collider,e);var h=0;b.y_cor_water?h=b.y_cor_water:b.y_correction&&(h=b.y_correction,b.type==v&&(h*=.5),b.type==z&&(h*=a));switch(b.type){case v:if(b.random&&b.reached){c[0]=(12*Math.random()-6)*b.speed+d[0];c[2]=(12*Math.random()-6)*b.speed+d[2];var l=g,d=C,q=b.speed,r=b.rot_speed;m.get_rotation(b.collider,l);N.transformQuat(B.AXIS_Z,l,d);d[1]=0;N.normalize(d,d);l=Math.sin(r/
2);q=.5*q/l;l=N.dist(c,e);l<2*q&&N.scaleAndAdd(c,d,2*q-l,c);b.reached=!1}c[1]=e[1];h&&(c[1]+=h);break;case I:case z:b.random&&b.reached&&(b.type==z?(b.speed=Math.random()+.1,q=b.max_depth-b.min_depth):q=b.max_height-b.min_height,c[0]=10*Math.random()-5+d[0],c[1]=e[1]+(Math.random()*q-.5*q),c[2]=10*Math.random()-5+d[2],b.reached=!1);h&&(c[1]=e[1]+h);break}var c=w,q=t,l=C,e=y,u=b.rig,d=b.collider,h=b.destination,G=b.speed,Q=b.actions,X=n.get_current_anim_name(u);if(!n.is_play(u)||!Q.idle||-1==Q.idle.indexOf(X)){m.get_translation(d,
c);var r=h[0]-c[0],R=h[2]-c[2],r=Math.sqrt(r*r+R*R);if(r>2*G*a)b.state=20,B.xz_direction(h,c,l),Q=b.rig,n.is_animated(Q)&&(u=b.speed,G=n.get_frame(Q),Q=n.get_anim_length(Q),u*=Q/24*(1-G/Q),.9>r/u&&N.scaleAndAdd(h,l,u-r,h)),r=g,u=D,m.get_rotation(b.collider,r),N.transformQuat(B.AXIS_Z,r,q),u[0]=q[0],u[1]=0,u[2]=q[2],N.normalize(u,u),G=N.dot(u,l),Q=Math.acos(G),Q=Math.abs(Q)/Math.PI,Q=a/Q*b.rot_speed*b.rotation_mult,k.rotationTo(u,l,e),k.rotationTo(B.AXIS_Z,u,r),1<=Math.abs(G)?k.copy(r,e):(k.multiply(e,
r,e),k.slerp(r,e,Math.min(Q,1),e)),l=a,b.type!=I&&(l=Math.max(l,1/60),r=p,u=g,q=Math.asin(q[1]),k.setAxisAngle(B.AXIS_X,-q,u),q=Math.atan(b.y_correction/(b.speed*l)),k.setAxisAngle(B.AXIS_X,-q,r),k.slerp(u,r,l,r),k.multiply(e,r,e)),m.set_rotation_v(d,e),d=C,q=D,B.quat_to_dir(e,B.AXIS_Z,d),N.scale(d,b.speed*a,q),N.add(q,c,q),q[1]=b.type!=v?(h[1]-c[1])*a*.1+c[1]:h[1],m.set_translation_v(b.collider,q);else if(b.type==v)Q.move?X&&-1!=Q.move.indexOf(X)&&n.is_play(u)?b.state=20:(b.state=10,b.reached=!0):
(b.state=10,b.reached=!0);else if(b.type==z||b.type==I)b.reached=!0;if(f(b)&&(c=b.rig,!n.is_play(c))){e=null;switch(b.state){case 10:e=b.actions;e=e.idle?B.random_from_array(e.idle):null;break;case 20:e=n.get_current_anim_name(b.rig),d=h=b.actions,d.move_blends&&-1==d.move_blends.indexOf(e)&&d.move&&-1!=d.move.indexOf(e)&&.33<Math.random()?(h=b.actions,e=h.move.indexOf(e),e=h.move_blends[e]):(d=b.actions,d.move&&(-1!=d.move.indexOf(e)||!d.move_blends&&!d.move_start||!d.move_start&&!e||d.move_blends&&
-1!=d.move_blends.indexOf(e)||d.move_start&&-1!=d.move_start.indexOf(e))?(h=b.actions,h.move_blends?(d=h.move_blends.indexOf(e),-1!=d?(e=d+1,e=e<h.move.length?e:0,e=h.move[e]):e=-1!=h.move.indexOf(e)?e:B.random_from_array(h.move)):e=B.random_from_array(h.move)):(d=b.actions,e=d.move_start&&-1==d.move_start.indexOf(e)&&d.move&&-1==d.move.indexOf(e)?B.random_from_array(h.move_start):null))}e&&(n.apply(c,e),n.set_behavior(c,n.AB_FINISH_RESET),n.set_frame(c,0),n.play(c))}}}function h(a,b,c,d){if(d)if(1==
c)switch(d.type){case I:a:{for(c=0;3>c;c++){var e=q.get_sensor_payload(a,b,c).hit_fract;if(e){b=e;break a}}b=void 0}a=100*b;d.y_correction=a<d.min_height?10:a>d.max_height?-10:0;break;case v:a=q.get_sensor_payload(a,b,0).hit_fract;d.y_correction=d.prev_hit_pos==a?0:1-100*a;d.prev_hit_pos=a;break;case z:a=q.get_sensor_payload(a,b,0).hit_fract,"CLOSE_GROUND"==b?(d.y_correction=100*a-1,d.y_correction=.1>d.y_correction?.05:0):"CLOSE_WATER"==b&&(d.y_cor_water=100*a,d.y_cor_water=d.y_cor_water<d.min_depth?
-.02:d.y_cor_water>d.max_depth?.02:0)}else d.y_correction=0}function b(){for(var a=0;a<G.length;a++){var b=G[a];l(b);c(b);b.rig&&n.get_current_anim_name(b.rig)&&n.play(b.rig)}}function l(a){var b=N.create(),c=a.collider;switch(a.type){case I:var d=q.create_ray_sensor(c,b,[0,-100,0],"TERRAIN",!0),e=q.create_ray_sensor(c,b,[0,-100,0],"STONE",!0),b=q.create_ray_sensor(c,b,[0,-100,0],"WATER",!0),d=[d,e,b];q.create_sensor_manifold(c,"CLOSE_GROUND",q.CT_CONTINUOUS,d,function(a){return a[0]||a[1]||a[2]},
h,a);break;case v:d=q.create_ray_sensor(c,[0,1,0],[0,-99,0],"TERRAIN",!0);d=[d];q.create_sensor_manifold(c,"CLOSE_GROUND",q.CT_CONTINUOUS,d,null,h,a);break;case z:d=q.create_ray_sensor(c,[0,1,0],[0,-99,0],"TERRAIN",!0),b=q.create_ray_sensor(c,b,[0,100,0],"WATER",!0),d=[d],q.create_sensor_manifold(c,"CLOSE_WATER",q.CT_CONTINUOUS,[b],null,h,a),q.create_sensor_manifold(c,"CLOSE_GROUND",q.CT_CONTINUOUS,d,null,h,a)}}function c(a){function b(c,d,e){1==e?(m.get_translation(a.empty,a.destination),a.rotation_mult=
4):a.rotation_mult=1}var c=a.collider;if(a.type==v){var d=q.create_collision_sensor(c,"CONSTRUCTION",!1);q.create_sensor_manifold(c,"CONSTRUCTION_COLL",q.CT_CONTINUOUS,[d],null,b)}}function f(a){var b=a.rig;if(!n.is_play(b))return!0;b=n.get_current_anim_name(b);if(!b)return!0;var c=a.actions;switch(a.state){case 10:if(!c.idle)return!1;if(-1==c.idle.indexOf(b))break;break;case 20:if(!c.move||-1!=c.move.indexOf(b)||c.move_start&&-1!=c.move_start.indexOf(b)||c.move_blends&&-1!=c.move_blends.indexOf(b))return!1;
break;default:return!1}return!0}var n=r("animation"),q=r("controls"),d=r("main"),k=r("quat"),e=r("scenes"),m=r("transform"),B=r("util"),N=r("vec3"),G=[];new Float32Array(9);var w=new Float32Array(3),t=new Float32Array(3),C=new Float32Array(3),D=new Float32Array(3),p=new Float32Array(4),g=new Float32Array(4),y=new Float32Array(4),v=a.NT_WALKING=10,I=a.NT_FLYING=20,z=a.NT_SWIMMING=30;a.new_event_track=function(a){a.destination=new Float32Array(3);a.start=[];a.ended=[];a.fired=[];a.y_correction=null;
a.prev_hit_pos=null;a.y_cor_water=null;a.reached=!0;a.rotation_mult=1;if(!a.random)for(var b=0;b<a.path.length;b++)a.start[b]=-1,a.ended[b]=!1,a.fired[b]=!1;G.push(a)};a.enable_animation=function(){if(G.length){b();var a=q.create_elapsed_sensor();q.create_sensor_manifold(G[0].collider,"ELAPSED",q.CT_CONTINUOUS,[a],function(a){return a[0]},function(a,b,c){if(1==c)for(a=q.get_sensor_value(a,b,0),b=0;b<G.length;b++){c=G[b];var f=a;if(e.is_visible(c.obj))if(c.random)u(f,c);else{for(var g=d.global_timeline(),
h=0;h<c.path.length;h++)if(!c.ended[h]){c.fired[h]||(c.fired[h]=!0,c.destination[0]=c.path[h][0],c.destination[1]=c.path[h][1],c.destination[2]=c.path[h][2],c.start[h]=g+c.delay[h]);if(g<c.start[h])break;u(f,c);c.ended[h]=c.reached;break}f=void 0;a:{for(f=0;f<c.path.length;f++)if(0==c.ended[f]){f=!1;break a}f=!0}if(f)for(f=0;f<c.path.length;f++)c.fired[f]=!1,c.ended[f]=!1}}})}};a.disable_animation=function(){if(!(0>=G.length))for(var a=0;a<G.length;a++){var b=G[a];q.check_sensor_manifolds(b.collider)&&
q.remove_sensor_manifold(b.collider);n.is_play(b.rig)&&n.stop(b.rig)}}};b4w.module.mouse=function(a,r){function u(){1==z&&(z=0);var a=document.exitPointerLock||document.webkitExitPointerLock||document.mozExitPointerLock;"function"===typeof a&&a.apply(document);m.remove_sensor_manifold(G.get_active_camera(),"SMOOTH_PL")}function h(a){2==z&&(z=0);a.removeEventListener("mousedown",l,!1);a.removeEventListener("mouseup",c,!1);a.removeEventListener("mousemove",b,!1);m.remove_sensor_manifold(G.get_active_camera(),"SMOOTH_DRAG")}function b(a){v()&&(g[0]+=2*(a.clientX-D),g[1]+=
2*(a.clientY-p),D=a.clientX,p=a.clientY);a.preventDefault()}function l(a){D=a.clientX;p=a.clientY;a.currentTarget.addEventListener("mousemove",b,!1);a.preventDefault()}function c(a){a.currentTarget.removeEventListener("mousemove",b,!1);a.preventDefault()}function f(a,b,c){if(.01<Math.abs(g[0])||.01<Math.abs(g[1])){b=m.get_sensor_value(a,b,0);a=w.smooth(g[0],0,b,.1*C);c=w.smooth(g[1],0,b,.1*C);b=G.get_first_character();var d=G.get_active_camera();k.rotate_eye_camera(d,4E-4*-a,4E-4*-c);g[0]-=a;g[1]-=
c;b&&(a=k.get_camera_angles_char(d,y),B.set_character_rotation(b,a[0],a[1]))}}function n(){t.detect_mobile()||t.get_canvas_elem().addEventListener("mousemove",d)}function q(){t.detect_mobile()||(t.get_canvas_elem().removeEventListener("mousemove",d),I&&G.set_outline_intensity(I,0))}function d(a){a=e.client_to_canvas_coords(a.clientX,a.clientY,y);(a=G.pick_object(a[0],a[1]))?(G.outlining_is_enabled(a)&&G.set_outline_intensity(a,1),G.outlining_is_enabled(I)&&a!=I&&G.set_outline_intensity(I,0)):G.outlining_is_enabled(I)&&
G.set_outline_intensity(I,0);I=a}var k=r("camera"),e=r("container"),m=r("controls"),B=r("physics"),N=r("print"),G=r("scenes"),w=r("util"),t=r("main"),C=1,D=0,p=0,g=new Float32Array(2),y=new Float32Array(2),v=null,I=null,z=0;a.request_pointerlock=function(a,b,c,d,e){function k(){if(document.pointerLockElement===a||document.webkitPointerLockElement===a||document.mozPointerLockElement===a){h(a);a.addEventListener("mousemove",d,!1);var e=G.get_active_camera();if(!m.check_sensor_manifold(e,"SMOOTH_PL")){var g=
m.create_elapsed_sensor();m.create_sensor_manifold(e,"SMOOTH_PL",m.CT_CONTINUOUS,[g],null,f)}b()}else a.removeEventListener("mousemove",d,!1),z=0,document.removeEventListener("pointerlockchange",k,!1),document.removeEventListener("webkitpointerlockchange",k,!1),document.removeEventListener("mozpointerlockchange",k,!1),c()}if(1!=z){z=1;b=b||function(){};c=c||function(){};e=e||function(){return!0};d=d||function(a){if(e()){if("number"==typeof a.movementX){var b=a.movementX;a=a.movementY}else"number"==
typeof a.webkitMovementX?(b=a.webkitMovementX,a=a.webkitMovementY):"number"==typeof a.mozMovementX?(b=a.mozMovementX,a=a.mozMovementY):a=b=0;g[0]+=b;g[1]+=a}};document.addEventListener("pointerlockchange",k,!1);document.addEventListener("webkitpointerlockchange",k,!1);document.addEventListener("mozpointerlockchange",k,!1);var l=a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock;"function"===typeof l?l.apply(a):N.error("Pointer lock is not available")}};a.exit_pointerlock=u;
a.check_pointerlock=function(a){return"function"===typeof(a.requestPointerLock||a.webkitRequestPointerLock||a.mozRequestPointerLock)?!0:!1};a.request_mouse_drag=function(a,b){if(2!=z){z=2;u();v=b||function(){return!0};a.addEventListener("mousedown",l,!1);a.addEventListener("mouseup",c,!1);var d=G.get_active_camera();if(!m.check_sensor_manifold(d,"SMOOTH_DRAG")){var e=m.create_elapsed_sensor();m.create_sensor_manifold(d,"SMOOTH_DRAG",m.CT_CONTINUOUS,[e],null,f)}}};a.exit_mouse_drag=h;a.enable_mouse_hover_outline=
n;a.enable_mouse_hover_glow=function(){N.error("enable_mouse_hover_glow() deprecated, use enable_mouse_hover_outline() instead");n()};a.disable_mouse_hover_outline=q;a.disable_mouse_hover_glow=function(){N.error("disable_mouse_hover_glow() deprecated, use disable_mouse_hover_outline() instead");q()};a.get_coords_x=function(a){return"clientX"in a?a.clientX:a.touches&&"clientX"in a.touches[0]?a.touches[0].clientX:-1};a.get_coords_y=function(a){return"clientY"in a?a.clientY:a.touches&&"clientY"in a.touches[0]?
a.touches[0].clientY:-1};a.set_plock_smooth_factor=function(a){C=a};a.get_plock_smooth_factor=function(){return C}};b4w.module.preloader=function(a,r){var u=r("app"),h,b,l,c,f,n,q,d,k,e=null;a.create_simple_preloader=function(a){var d=null,k=null,q="#bf9221",r="#000",t;for(t in a)switch(t){case "canvas_container_id":d=a.canvas_container_id;break;case "background_container_id":k=a.background_container_id;break;case "bg_color":r=a.bg_color;break;case "bar_color":q=a.bar_color;break;case "preloader_fadeout":h=a.preloader_fadeout}a=document.createElement("div");t=document.createElement("div");a.id="simple_preloader_container";
var u=document.createElement("div"),D=document.createElement("div"),k=document.getElementById(k);e=document.getElementById(d);a.style.cssText="z-index: 4;background-color: "+r+";width: 100%;height: 100%;position: absolute;margin: 0;padding: 0;top: 0;left: 0;";t.style.cssText="position: absolute;left: 50%;top: 82%;width: 300px;height: 20px;margin-left: -150px;margin-top: -10px;border-style:solid;border-width:4px;border-color: #000;border-radius: 0px;";u.style.cssText="position: absolute;left: 0px;top: 1px;width: 0px;height: 18px;background-color: "+
q+";border-radius: 0px;";D.style.cssText="position: absolute;left: 50%;top: 50%;width: 100%;height: 100%;margin-left: -150px;margin-top: -10px;text-align: center;font-size: 17px;font-weight: bold;color: #000;font-family: Verdana;"+t.appendChild(u);t.appendChild(D);a.appendChild(t);document.body.appendChild(a);b="SIMPLE";l=a;c=u;f=D;n=k};a.create_rotation_preloader=function(a){var c=null,d=null,h="rgba(0,0,0,0)",k="",r="",u="rgba(0,0,0,0)",D;for(D in a)switch(D){case "canvas_container_id":c=a.canvas_container_id;
break;case "background_container_id":d=a.background_container_id;break;case "frame_bg_color":h=a.frame_bg_color;break;case "bg_color":u=a.bg_color;break;case "frame_class":k=a.frame_class;break;case "anim_elem_class":r=a.anim_elem_class}a=document.createElement("div");D=document.createElement("div");var p=document.createElement("div"),g=document.createElement("div"),d=document.getElementById(d);e=document.getElementById(c);a.style.cssText="z-index: 4;background-color: "+u+";width: 100%;height: 100%;position: absolute;margin: 0;padding: 0;top: 0;left: 0;";
D.style.cssText="position: absolute;left: 50%;top: 50%;width: 117px;height: 117px;margin-left: -58px;margin-top: -58px;background-color: "+h+";";p.style.cssText="position: absolute;left: 0px;top: 0px;width: 100%;height: 100%;background-position: center;background-repeat: no-repeat;";g.style.cssText="position: absolute;width: 100%;height: 100%;text-align: center;margin-top: 38px;font-size: 36px;color: #ffffff;font-family: Arial;font-weight: bold;";p.className=r;D.appendChild(p);D.className=k;D.appendChild(g);
a.appendChild(D);e.appendChild(a);b="ROTATION";l=a;q=p;f=g;n=d};a.create_advanced_preloader=function(a){var h=a.preloader_width,q=a.canvas_container_id,h=h/(h-a.img_width),r=document.getElementById(a.preloader_bar_id),u=document.getElementById(a.fill_band_id),t=document.getElementById(a.preloader_caption_id),C=document.getElementById(a.preloader_container_id);a=document.getElementById(a.background_container_id);e=document.getElementById(q);b="ADVANCED";c=r;d=u;k=h;f=t;l=C;n=a};a.update_preloader=
function(a){f.innerHTML=a+"%";"SIMPLE"==b&&(c.style.width=a+"%");"ADVANCED"==b&&(c.style.width=a/k+"%",d.style.width=100-a+"%");"ROTATION"==b&&(q.style.transform="rotate("+a+"deg)");100==a&&(h?(u.css_animate(n,"opacity",1,0,1500,null,null,function(){n.parentNode.removeChild(n)}),u.css_animate(l,"opacity",1,0,1E3,null,null,function(){l.parentNode.removeChild(l)})):(l.parentNode.removeChild(l),n&&n.parentNode.removeChild(n)))}};b4w.module.storage=function(a,r){function u(a){l=a;try{c=window.localStorage}catch(h){b.warn("Applying chrome localStorage bug workaround"),c=null}c||(b.warn("localStorage is not available, initializing temporary storage"),c={})}function h(){return c[l]?JSON.parse(c[l]):{}}var b=r("__print"),l="",c=null;a.init=u;a.set=function(a,b){var q=h();q[a]=String(b);c[l]=JSON.stringify(q)};a.cleanup=function(){delete c[l]};a.get=function(a){var b=h();return b[a]?b[a]:""};a.debug=function(){b.log(h())};u("b4w")};b4w.module.screenshooter=function(a,r){var u=r("main");a.shot=function(){u.canvas_data_url(function(a){var b=window.document.createElement("a");document.body.appendChild(b);b.style.display="none";b.href=a;b.download="screenshot.png";b.click();document.body.removeChild(b)})}};
